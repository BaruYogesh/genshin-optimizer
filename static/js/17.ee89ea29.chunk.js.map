{"version":3,"sources":["Build/Build.ts","Util/TimeUtil.ts","../node_modules/react-bootstrap/esm/ProgressBar.js","Build/BuildWorker.ts","Build/BuildDisplay.tsx"],"names":["calculateTotalBuildNumber","artifactsBySlot","setFilters","setKeys","Set","map","i","key","filteredArtifactsBySlot","slotKeys","Object","keys","slotKey","artifactsBySet","artifact","has","setKey","push","freeze","setCount","accu","result","slotPerm","index","length","num","artifactSetPermutations","reduce","entries","artifacts","getTalentStatKey","skillKey","stats","overwriteElement","hitMode","infusionAura","infusionSelf","reactionMode","characterEle","weaponType","ElementalData","includes","startsWith","eleKey","getTalentStatKeyVariant","msToUnits","ms","milliseconds","seconds","Math","floor","minutes","hours","timeString","timeText","strPadLeft","timeStringMs","_excluded","_excluded2","_excluded3","getPercentage","now","min","max","percentage","round","renderProgressBar","_ref","ref","_classNames","label","srOnly","striped","animated","className","style","variant","bsPrefix","props","_objectWithoutPropertiesLoose","React","createElement","_extends","role","classNames","width","ProgressBar","forwardRef","_ref2","isChild","useBootstrapPrefix","children","wrapperProps","child","cloneElement","displayName","defaultProps","Worker_fn","Worker","InfoDisplay","lazy","CharacterDisplayCard","warningBuildNumber","maxBuildsToShowList","artifactsSlotsToSelectMainStats","BuildDisplay","propCharacterKey","location","characterKey","useState","loadFromLocalStorage","setcharacterKey","builds","setbuilds","maxBuildsToShow","setmaxBuildsToShow","modalBuild","setmodalBuild","showArtCondModal","setshowArtCondModal","showCharacterModal","setshowCharacterModal","generatingBuilds","setgeneratingBuilds","generationProgress","setgenerationProgress","generationDuration","setgenerationDuration","generationSkipped","setgenerationSkipped","useForceUpdate","charDirty","setCharDirty","artifactSheets","usePromise","ArtifactSheet","getAll","artsDirty","setArtsDirty","isMounted","useRef","worker","character","characterSheet","weaponSheet","initialStats","statsDisplayKeys","setCharacterData","buildSettings","useMemo","initialBuildSettings","statFilters","mainStatKeys","optimizationTarget","mainStatAssumptionLevel","useLockedArts","useEquippedArts","ascending","buildSettingsDispatch","useCallback","action","state","type","mainStatKey","buildSettingsReducer","database","updateChar","useEffect","ReactGA","pageview","a","_getChar","CharacterSheet","get","WeaponSheet","weapon","Character","createInitialStats","getDisplayStatKeys","followAnyArt","followChar","undefined","current","terminate","selectCharacter","cKey","saveToLocalStorage","Array","isArray","sectionKey","section","JSON","stringify","split","fromEntries","allSlotKeys","totBuildNumber","artifactDatabase","_getArts","filter","art","lock","Artifact","splitArtifactsBySlot","forEach","generateBuilds","artifactSetEffects","setEffectsObjs","splitArtifacts","deepClone","values","artArr","mainStatVal","mainStatValue","numStars","level","minFilters","maxFilters","data","onmessage","e","progress","timing","skipped","category","variable","value","toString","obj","calculateBuildwithArtifact","postMessage","dropdownitemsForStar","star","setsWithMaxRarity","setobj","some","setsNumArr","setEffects","artsAccountedOther","cur","ind","every","parseInt","Dropdown","Item","onClick","nameWithIcon","characterName","name","characterDropDown","DropdownButton","title","disabled","Divider","CharacterSelection","onSelect","formula","Formula","sortByText","Stat","getStatVariant","getStatNamePretty","talentKey","field","getTalentFieldValue","text","getTalentOfKey","artsAccounted","artifactCondCount","count","crawlObject","conditionalValues","v","characterDispatch","val","Container","InfoComponent","pageKey","modalTitle","BuildModal","build","ArtConditionalModal","Row","Col","Card","bg","Header","Body","xs","lg","CharacterCard","header","cardClassName","onEdit","HitModeCard","Boolean","StatFilterCard","statKeys","basicKeys","setStatFilters","sFs","Button","Badge","setNum","ButtonGroup","as","ItemText","setNKey","setNkey","setNumKey","SetEffectDisplay","newBuild","equippedBuild","editable","icon","faCheckSquare","faSquare","AssumeFullLevelToggle","setmainStatAssumptionLevel","size","getStatNameWithPercent","slotMainStats","OverlayTrigger","overlay","Tooltip","id","Toggle","Menu","drop","align","minWidth","fields","getFormulaTargetsDisplayHeading","md","overflow","textOverflow","target","TargetSelectorDropdownItem","faSortAmountDownAlt","faSortAmountUp","BuildAlert","ListGroup","ArtifactDisplayItem","sheets","talentField","closeModal","Modal","show","onHide","contentClassName","Suspense","fallback","tabName","setCharacterKey","onClose","footer","closeArtCondModal","artSetKeyList","setKeysByRarities","reverse","flatMap","faUndo","faTimes","sheet","slotIcons","rarity","xl","Image","src","thumbnail","ns","stars","Footer","StatFilterItem","statKey","close","setFilter","isFloat","getStatUnit","inputProps","allowEmpty","float","minInputProps","placeholder","onChange","s","maxInputProps","InputGroup","Prepend","sKey","CustomFormControl","Append","faTrash","setHitmode","setReactionMode","setInfusionAura","remainingKeys","k","equippedArtifacts","currentlyEquipped","setToSlots","sort","slotarr1","slotarr","artifactSlotIcon","StatDisplayComponent","cardbg","totalBuildNumberString","toLocaleString","totalUnskipped","generationProgressString","generationSkippedString","totalUnskippedString","generationSkippedText","progPercent","Alert","toFixed","levels","0","4","8","12","16","20"],"mappings":"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","file":"static/js/17.ee89ea29.chunk.js","sourcesContent":["import ElementalData from \"../Data/ElementalData\"\r\nimport { StatKey, IArtifact, SubstatKey } from \"../Types/artifact\"\r\nimport { ArtifactSetEffects, ArtifactsBySlot, SetFilter } from \"../Types/Build\"\r\nimport { ArtifactSetKey, ElementKey, SetNum, SlotKey } from \"../Types/consts\"\r\nimport { BasicStats, BonusStats, ICalculatedStats } from \"../Types/stats\"\r\nimport { mergeStats } from \"../Util/StatUtil\"\r\nimport { deepClone } from \"../Util/Util\"\r\n\r\n/**\r\n * Remove artifacts that can never be used in optimized builds when trying to optimize for top `maxBuildsToShow` builds\r\n * @param {artifact[]} artifacts - List of artifacts of the same slot\r\n * @param {Object.<setKey, Object.<number, Object.<statKey, statValue>>>} artifactSetEffects - The list of the set effects\r\n * @param {Set.<statKey>} significantStats - A set of stats that pruning needs to take into consideration\r\n * @param {bool} ascending - Whether the sorting is ascending or descending\r\n * @param {Set.<setKey>} alwaysAccepted - The list of artifact sets that are always included\r\n */\r\nexport function pruneArtifacts(artifacts: IArtifact[], artifactSetEffects: ArtifactSetEffects, significantStats: Set<StatKey>, maxBuildsToShow: number = 1, ascending: boolean = false, alwaysAccepted: Set<ArtifactSetKey> = new Set()): IArtifact[] {\r\n  function shouldKeepFirst(first: Dict<StatKey, number>, second: Dict<StatKey, number>, preferFirst: boolean) {\r\n    let firstBetter = Object.entries(first).some(([k, v]) => !isFinite(v) || v > (second[k] ?? 0))\r\n    let secondBetter = Object.entries(second).some(([k, v]) => !isFinite(v) || v > (first[k] ?? 0))\r\n    if (ascending) [firstBetter, secondBetter] = [secondBetter, firstBetter]\r\n    // Keep if first is strictly better, uncomparable, or equal + prefer first.\r\n    // That is, return false if second is strictly better, or equal + NOT prefer first\r\n    return firstBetter || (!secondBetter && preferFirst)\r\n  }\r\n\r\n  // Prune unused set effects. Sets with no relevant effects are regrouped to \"other\"\r\n  const prunedSetEffects: PrunedArtifactSetEffects = { \"other\": {} }\r\n  Object.entries(artifactSetEffects).forEach(([set, effect]) => {\r\n    Object.entries(effect).forEach(([num, item]) => {\r\n      const effects = Object.entries(item).filter(([key]) => significantStats.has(key as StatKey))\r\n      if (effects.length > 0) {\r\n        prunedSetEffects[set] = prunedSetEffects[set] ?? {}\r\n        prunedSetEffects[set]![num] = Object.fromEntries(effects)\r\n      }\r\n      const modifiers = item.modifiers\r\n      if (modifiers) {\r\n        // Modifiers are treated as infinite stats\r\n        prunedSetEffects[set] = prunedSetEffects[set] ?? {}\r\n        prunedSetEffects[set]![num] = prunedSetEffects[set]![num] ?? {}\r\n\r\n        Object.keys(modifiers)\r\n          .filter(key => significantStats.has(key as StatKey))\r\n          .forEach(key =>\r\n            prunedSetEffects[set]![num]![key] = Infinity\r\n          )\r\n      }\r\n    })\r\n  })\r\n\r\n  // array of artifacts, artifact stats, and set (may be \"other\")\r\n  let tmp: { artifact: IArtifact, numberOfBetterSameSetArtifacts: number, stats: Dict<StatKey, number>, set: ArtifactSetKey | \"other\" }[] = artifacts.map(artifact => {\r\n    const stats: Dict<StatKey, number> = {}, set: ArtifactSetKey | \"other\" = (artifact.setKey in prunedSetEffects || alwaysAccepted.has(artifact.setKey)) ? artifact.setKey : \"other\"\r\n    if (significantStats.has(artifact.mainStatKey as any))\r\n      stats[artifact.mainStatKey] = artifact.mainStatVal!\r\n    for (const { key, value } of artifact.substats)\r\n      if (key && significantStats.has(key as SubstatKey))\r\n        stats[key] = (stats[key] ?? 0) + value\r\n    for (const key in stats)\r\n      if (key.endsWith(\"enemyRes_\"))\r\n        stats[key as StatKey] = -stats[key as StatKey]!\r\n    return { artifact, numberOfBetterSameSetArtifacts: 0, stats, set }\r\n  })\r\n\r\n  // Compare artifacts' base stats from the same set\r\n  tmp = tmp.filter((first) => {\r\n    const { artifact: candidate, stats: candidateStats, set: candidateSet } = first\r\n    return tmp.every(({ artifact: other, stats: otherStats, set: otherSet }) => {\r\n      if (candidateSet !== otherSet || shouldKeepFirst(candidateStats, otherStats, candidate.id! <= other.id!)) {\r\n        return true\r\n      } else {\r\n        first.numberOfBetterSameSetArtifacts += 1\r\n        return first.numberOfBetterSameSetArtifacts < maxBuildsToShow\r\n      }\r\n    })\r\n  })\r\n\r\n  // Cross-check with different sets\r\n  tmp = tmp.filter(({ artifact: candidate, stats: candidateStats, set: candidateSet }) => {\r\n    if (alwaysAccepted.has(candidate.setKey))\r\n      return true\r\n    // Possible \"additional stats\" if a build equips `candidate` on an empty slot.\r\n    let possibleStats = [...Object.values(prunedSetEffects[candidateSet]!), {}].map(c => {\r\n      const current: BonusStats = { ...candidateStats }\r\n      mergeStats(current, c)\r\n      return { stat: current, numberOfBetterArtifacts: 0 }\r\n    })\r\n    return tmp.every(({ artifact: other, stats: otherStats, set: otherSet, numberOfBetterSameSetArtifacts }) => {\r\n      if (candidateSet === otherSet) return true // Already checked same-set\r\n\r\n      // Remove possibilities that shouldn't be kept\r\n      possibleStats = possibleStats.filter(current => {\r\n        if (shouldKeepFirst(current.stat, otherStats, candidate.id! <= other.id!)) {\r\n          return true\r\n        } else {\r\n          current.numberOfBetterArtifacts += 1\r\n          return current.numberOfBetterArtifacts + numberOfBetterSameSetArtifacts < maxBuildsToShow\r\n        }\r\n      })\r\n      return possibleStats.length !== 0\r\n    })\r\n  })\r\n\r\n  return tmp.map(tmp => tmp.artifact)\r\n}\r\n\r\n/**\r\n * Generate all set of artifacts-by-slots based on the filters\r\n * @param {Object.<slotKey, artifact[]>} artifactsBySlot - list of artifacts, separated by slots\r\n * @param {Object.<setKey, number>} setFilters - minimum number of artifacts in each set\r\n *\r\n */\r\nexport function artifactSetPermutations(artifactsBySlot: ArtifactsBySlot, setFilters: SetFilter) {\r\n  const setKeys = new Set(setFilters.map(i => i.key)), filteredArtifactsBySlot = {}\r\n  const slotKeys = Object.keys(artifactsBySlot)\r\n\r\n  for (const slotKey of slotKeys) {\r\n    let artifactsBySet: Dict<ArtifactSetKey, IArtifact[]> = {}\r\n    for (const artifact of (artifactsBySlot[slotKey] ?? [])) {\r\n      if (setKeys.has(artifact.setKey)) {\r\n        if (artifactsBySet[artifact.setKey]) artifactsBySet[artifact.setKey]!.push(artifact)\r\n        else artifactsBySet[artifact.setKey] = [artifact]\r\n      } else {\r\n        if (artifactsBySet['null']) artifactsBySet['null'].push(artifact)\r\n        else artifactsBySet['null'] = [artifact]\r\n      }\r\n    }\r\n    filteredArtifactsBySlot[slotKey] = Object.freeze(artifactsBySet)\r\n  }\r\n\r\n  const setCount = {}, accu: ArtifactsBySlot = {}, result: ArtifactsBySlot[] = []\r\n\r\n  function slotPerm(index) {\r\n    if (index >= slotKeys.length) {\r\n      for (const { key, num } of setFilters)\r\n        if ((setCount[key] ?? 0) < num)\r\n          return\r\n      result.push({ ...accu })\r\n      return\r\n    }\r\n\r\n    const slotKey = slotKeys[index]\r\n    let artifactsBySet = filteredArtifactsBySlot[slotKey]\r\n    for (const setKey in artifactsBySet) {\r\n      setCount[setKey] = (setCount[setKey] ?? 0) + 1\r\n      accu[slotKey] = artifactsBySet[setKey]\r\n      slotPerm(index + 1)\r\n      setCount[setKey] -= 1\r\n    }\r\n  }\r\n\r\n  slotPerm(0)\r\n  return result\r\n}\r\n\r\n/**\r\n * Compute number of all artifact permutations based on the filters\r\n * @param {Object.<slotKey, artifact[]>} artifactsBySlot - list of artifacts, separated by slots\r\n * @param {Object.<setKey, number>} setFilters - minimum number of artifacts in each set\r\n */\r\nexport function calculateTotalBuildNumber(artifactsBySlot: ArtifactsBySlot, setFilters: SetFilter) {\r\n  return artifactSetPermutations(artifactsBySlot, setFilters).reduce((accu, artifactsBySlot) =>\r\n    accu + Object.entries(artifactsBySlot).reduce((accu, artifacts) => accu * artifacts[1]!.length, 1)\r\n    , 0)\r\n}\r\n\r\n/**\r\n * @callback artifactCallback\r\n * @param {Object.<artifactKey, artifact>} artifacts - the list of artifacts\r\n * @param {stats} stats - the total stats for the artifacts\r\n */\r\n\r\n/**\r\n * Generate all artifact permutations and accumulate the stats\r\n * @param {stats} initialStats - initial stats before any artifact is added\r\n * @param {Object.<slotKey, artifact[]>} artifactsBySlot - list of artifacts, separated by slots\r\n * @param {Object.<setKey, Object.<number, Object.<statKey, statValue>>>} artifactSetEffects - the list of the set effects\r\n * @param {artifactCallback} callback - the functions called with each permutation\r\n */\r\nexport function artifactPermutations(initialStats: ICalculatedStats, artifactsBySlot: ArtifactsBySlot, artifactSetEffects: ArtifactSetEffects, callback) {\r\n  const slotKeys = Object.keys(artifactsBySlot), setCount: Dict<ArtifactSetKey, SetNum> = {}, accu = {}\r\n  function slotPerm(index: number, stats: ICalculatedStats) {\r\n    if (index >= slotKeys.length) {\r\n      callback(accu, stats)\r\n      return\r\n    }\r\n\r\n    const slotKey = slotKeys[index]\r\n    for (const artifact of artifactsBySlot[slotKey] ?? []) {\r\n      const newStats = { ...stats }\r\n\r\n      // Hand-pick costly copying\r\n      if (newStats.modifiers) newStats.modifiers = deepClone(newStats.modifiers)\r\n\r\n      accumulate(slotKey, artifact, setCount, accu, newStats, artifactSetEffects)\r\n      slotPerm(index + 1, newStats)\r\n      setCount[artifact.setKey]! -= 1\r\n    }\r\n  }\r\n\r\n  slotPerm(0, initialStats)\r\n}\r\n\r\nfunction accumulate(slotKey: SlotKey, art: IArtifact, setCount: Dict<ArtifactSetKey, SetNum>, accu: Dict<SlotKey, IArtifact>, stats: ICalculatedStats, artifactSetEffects: ArtifactSetEffects) {\r\n  const setKey = art.setKey\r\n  accu[slotKey] = art\r\n  setCount[setKey] = (setCount[setKey] ?? 0) + 1 as SetNum\r\n\r\n  // Add artifact stats\r\n  if (art.mainStatKey in stats) stats[art.mainStatKey] += art.mainStatVal!\r\n  art.substats.forEach((substat) => {\r\n    if (substat?.key in stats) stats[substat.key] += substat.value\r\n  })\r\n\r\n  // Add set effects\r\n  const setEffect = artifactSetEffects[setKey]?.[setCount[setKey]!]\r\n  setEffect && mergeStats(stats, setEffect) // TODO: This may slow down the computation\r\n}\r\n\r\n/**\r\n  * Create statKey in the form of ${ele}_elemental_${type} for elemental DMG, ${ele}_${src}_${type} for talent DMG.\r\n  * @param {string} skillKey - The DMG src. Can be \"norm\",\"skill\". Use an elemental to specify a elemental hit \"physical\" -> physical_elemental_{type}. Use \"elemental\" here to specify a elemental hit of character's element/reactionMode\r\n  * @param {*} stats - The calculated stats\r\n  * @param {*} overwriteElement - Override the hit to be the character's elemental, that is not part of infusion.\r\n  */\r\nexport function getTalentStatKey(skillKey: string, stats: BasicStats, overwriteElement?: ElementKey | \"physical\") {\r\n  const { hitMode = \"\", infusionAura = \"\", infusionSelf = \"\", reactionMode = null, characterEle = \"anemo\", weaponType = \"sword\" } = stats\r\n  if ((Object.keys(ElementalData) as any).includes(skillKey)) return `${skillKey}_elemental_${hitMode}`//elemental DMG\r\n  if (!overwriteElement && weaponType === \"catalyst\") overwriteElement = characterEle\r\n\r\n  if (skillKey === \"elemental\" || skillKey === \"burst\" || skillKey === \"skill\" || overwriteElement) {\r\n    if (reactionMode && reactionMode.startsWith(overwriteElement || characterEle)) return `${reactionMode}_${skillKey}_${hitMode}`\r\n    return `${overwriteElement || characterEle}_${skillKey}_${hitMode}`\r\n  }\r\n  //auto attacks\r\n  let eleKey = \"physical\"\r\n  if (infusionSelf) eleKey = infusionSelf\r\n  else if (infusionAura) eleKey = infusionAura\r\n  if (reactionMode && reactionMode.startsWith(eleKey)) return `${reactionMode}_${skillKey}_${hitMode}`\r\n\r\n  return `${eleKey}_${skillKey}_${hitMode}`\r\n}\r\n\r\nexport function getTalentStatKeyVariant(skillKey: string, stats: BasicStats, overwriteElement: ElementKey | \"physical\" | undefined | \"\" = \"\") {\r\n  if ((Object.keys(ElementalData) as any).includes(skillKey)) return skillKey//elemental DMG\r\n  const { infusionAura = \"\", infusionSelf = \"\", reactionMode = null, characterEle = \"anemo\", weaponType = \"sword\" } = stats\r\n  if (!overwriteElement && weaponType === \"catalyst\") overwriteElement = characterEle\r\n\r\n  if (skillKey === \"elemental\" || skillKey === \"burst\" || skillKey === \"skill\" || overwriteElement) {\r\n    if (reactionMode && reactionMode.startsWith(overwriteElement || characterEle)) {\r\n      if ([\"pyro_vaporize\", \"hydro_vaporize\"].includes(reactionMode)) return \"vaporize\"\r\n      else if ([\"pyro_melt\", \"cryo_melt\"].includes(reactionMode)) return \"melt\"\r\n    }\r\n    return overwriteElement || characterEle\r\n  }\r\n  //auto attacks\r\n  let eleKey = \"physical\"\r\n  if (infusionSelf) eleKey = infusionSelf\r\n  else if (infusionAura) eleKey = infusionAura\r\n  if (reactionMode && reactionMode.startsWith(eleKey)) {\r\n    if ([\"pyro_vaporize\", \"hydro_vaporize\"].includes(reactionMode)) return \"vaporize\"\r\n    else if ([\"pyro_melt\", \"cryo_melt\"].includes(reactionMode)) return \"melt\"\r\n  }\r\n  return eleKey\r\n}\r\n\r\nexport type PrunedArtifactSetEffects = Dict<ArtifactSetKey | \"other\", Dict<SetNum, Dict<StatKey, number>>>\r\n","import { strPadLeft } from \"./Util\"\r\n\r\nexport function msToUnits(ms: number) {\r\n  let milliseconds = ms % 1000\r\n  let seconds = Math.floor((ms / 1000) % 60)\r\n  let minutes = Math.floor((ms / (1000 * 60)) % 60)\r\n  let hours = Math.floor((ms / (1000 * 60 * 60)))\r\n  return { hours, minutes, seconds, milliseconds }\r\n}\r\nexport function timeString(ms: number) {\r\n  //shows only in terms of hours/minutes. there are better calculations for days using Date functions.\r\n  let { hours, minutes, seconds } = msToUnits(ms)\r\n  let timeText = \"Minutes\"\r\n  if (hours) timeText = \"Hours\"\r\n  return `${hours ? `${hours}:` : \"\"}${strPadLeft(minutes, '0', 2)}:${strPadLeft(seconds, '0', 2)} ${timeText}`;\r\n}\r\nexport function timeStringMs(ms: number) {\r\n  //shows only in terms of hours/minutes. there are better calculations for days using Date functions.\r\n  let { hours, minutes, seconds, milliseconds } = msToUnits(ms)\r\n  let timeText = \"Minutes\"\r\n  if (hours) timeText = \"Hours\"\r\n  return `${hours ? `${hours}:` : \"\"}${strPadLeft(minutes, '0', 2)}:${strPadLeft(seconds, '0', 2)}.${strPadLeft(milliseconds, '0', 3)} ${timeText}`;\r\n}\r\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"min\", \"now\", \"max\", \"label\", \"srOnly\", \"striped\", \"animated\", \"className\", \"style\", \"variant\", \"bsPrefix\"],\n    _excluded2 = [\"isChild\"],\n    _excluded3 = [\"min\", \"now\", \"max\", \"label\", \"srOnly\", \"striped\", \"animated\", \"bsPrefix\", \"variant\", \"className\", \"children\"];\nimport classNames from 'classnames';\nimport React, { cloneElement } from 'react';\nimport { useBootstrapPrefix } from './ThemeProvider';\nimport { map } from './ElementChildren';\nvar ROUND_PRECISION = 1000;\n/**\n * Validate that children, if any, are instances of `<ProgressBar>`.\n */\n\nfunction onlyProgressBar(props, propName, componentName) {\n  var children = props[propName];\n\n  if (!children) {\n    return null;\n  }\n\n  var error = null;\n  React.Children.forEach(children, function (child) {\n    if (error) {\n      return;\n    }\n    /**\n     * Compare types in a way that works with libraries that patch and proxy\n     * components like react-hot-loader.\n     *\n     * see https://github.com/gaearon/react-hot-loader#checking-element-types\n     */\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n\n\n    var element = /*#__PURE__*/React.createElement(ProgressBar, null);\n    if (child.type === element.type) return;\n    var childType = child.type;\n    var childIdentifier = /*#__PURE__*/React.isValidElement(child) ? childType.displayName || childType.name || childType : child;\n    error = new Error(\"Children of \" + componentName + \" can contain only ProgressBar \" + (\"components. Found \" + childIdentifier + \".\"));\n  });\n  return error;\n}\n\nvar defaultProps = {\n  min: 0,\n  max: 100,\n  animated: false,\n  isChild: false,\n  srOnly: false,\n  striped: false\n};\n\nfunction getPercentage(now, min, max) {\n  var percentage = (now - min) / (max - min) * 100;\n  return Math.round(percentage * ROUND_PRECISION) / ROUND_PRECISION;\n}\n\nfunction renderProgressBar(_ref, ref) {\n  var _classNames;\n\n  var min = _ref.min,\n      now = _ref.now,\n      max = _ref.max,\n      label = _ref.label,\n      srOnly = _ref.srOnly,\n      striped = _ref.striped,\n      animated = _ref.animated,\n      className = _ref.className,\n      style = _ref.style,\n      variant = _ref.variant,\n      bsPrefix = _ref.bsPrefix,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: ref\n  }, props, {\n    role: \"progressbar\",\n    className: classNames(className, bsPrefix + \"-bar\", (_classNames = {}, _classNames[\"bg-\" + variant] = variant, _classNames[bsPrefix + \"-bar-animated\"] = animated, _classNames[bsPrefix + \"-bar-striped\"] = animated || striped, _classNames)),\n    style: _extends({\n      width: getPercentage(now, min, max) + \"%\"\n    }, style),\n    \"aria-valuenow\": now,\n    \"aria-valuemin\": min,\n    \"aria-valuemax\": max\n  }), srOnly ? /*#__PURE__*/React.createElement(\"span\", {\n    className: \"sr-only\"\n  }, label) : label);\n}\n\nvar ProgressBar = /*#__PURE__*/React.forwardRef(function (_ref2, ref) {\n  var isChild = _ref2.isChild,\n      props = _objectWithoutPropertiesLoose(_ref2, _excluded2);\n\n  props.bsPrefix = useBootstrapPrefix(props.bsPrefix, 'progress');\n\n  if (isChild) {\n    return renderProgressBar(props, ref);\n  }\n\n  var min = props.min,\n      now = props.now,\n      max = props.max,\n      label = props.label,\n      srOnly = props.srOnly,\n      striped = props.striped,\n      animated = props.animated,\n      bsPrefix = props.bsPrefix,\n      variant = props.variant,\n      className = props.className,\n      children = props.children,\n      wrapperProps = _objectWithoutPropertiesLoose(props, _excluded3);\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: ref\n  }, wrapperProps, {\n    className: classNames(className, bsPrefix)\n  }), children ? map(children, function (child) {\n    return /*#__PURE__*/cloneElement(child, {\n      isChild: true\n    });\n  }) : renderProgressBar({\n    min: min,\n    now: now,\n    max: max,\n    label: label,\n    srOnly: srOnly,\n    striped: striped,\n    animated: animated,\n    bsPrefix: bsPrefix,\n    variant: variant\n  }, ref));\n});\nProgressBar.displayName = 'ProgressBar';\nProgressBar.defaultProps = defaultProps;\nexport default ProgressBar;","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/BuildWorker.e6654026.worker.js\");\n}\n","import { faCheckSquare, faSortAmountDownAlt, faSortAmountUp, faSquare, faTimes, faTrash, faUndo } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React, { lazy, useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { Alert, Badge, Button, ButtonGroup, Card, Col, Container, Dropdown, DropdownButton, Image, InputGroup, ListGroup, Modal, OverlayTrigger, ProgressBar, Row, Tooltip } from 'react-bootstrap';\r\nimport ReactGA from 'react-ga';\r\n// eslint-disable-next-line\r\nimport Worker from \"worker-loader!./BuildWorker\";\r\nimport Artifact from '../Artifact/Artifact';\r\nimport { ArtifactSheet } from '../Artifact/ArtifactSheet';\r\nimport SetEffectDisplay from '../Artifact/Component/SetEffectDisplay';\r\nimport SlotNameWithIcon, { artifactSlotIcon } from '../Artifact/Component/SlotNameWIthIcon';\r\nimport Character from '../Character/Character';\r\nimport CharacterCard from '../Character/CharacterCard';\r\nimport { HitModeToggle, InfusionAuraDropdown, ReactionToggle } from '../Character/CharacterDisplay/DamageOptionsAndCalculation';\r\nimport StatDisplayComponent from '../Character/CharacterDisplay/StatDisplayComponent';\r\nimport CharacterSheet from '../Character/CharacterSheet';\r\nimport { getFormulaTargetsDisplayHeading } from '../Character/CharacterUtil';\r\nimport { CharacterSelectionDropdownList } from '../Components/CharacterSelection';\r\nimport CustomFormControl from '../Components/CustomFormControl';\r\nimport InfoComponent from '../Components/InfoComponent';\r\nimport { Stars } from '../Components/StarDisplay';\r\nimport { database } from '../Database/Database';\r\nimport Formula from '../Formula';\r\nimport Stat from '../Stat';\r\nimport { StatKey } from '../Types/artifact';\r\nimport { ArtifactsBySlot, Build, BuildSetting } from '../Types/Build';\r\nimport { ICharacter } from '../Types/character';\r\nimport { allSlotKeys, ArtifactSetKey, CharacterKey, SetNum, SlotKey } from '../Types/consts';\r\nimport { IFieldDisplay } from '../Types/IFieldDisplay';\r\nimport { ICalculatedStats } from '../Types/stats';\r\nimport { useForceUpdate, usePromise } from '../Util/ReactUtil';\r\nimport { timeStringMs } from '../Util/TimeUtil';\r\nimport { crawlObject, deepClone, loadFromLocalStorage, saveToLocalStorage } from '../Util/Util';\r\nimport WeaponSheet from '../Weapon/WeaponSheet';\r\nimport { calculateTotalBuildNumber } from './Build';\r\nimport { initialBuildSettings } from './BuildSetting';\r\nconst InfoDisplay = React.lazy(() => import('./InfoDisplay'));\r\n\r\n//lazy load the character display\r\nconst CharacterDisplayCard = lazy(() => import('../Character/CharacterDisplayCard'))\r\n\r\nconst warningBuildNumber = 10000000\r\nconst maxBuildsToShowList = [1, 2, 3, 4, 5, 8, 10]\r\nconst maxBuildsToShowDefault = 5\r\nconst autoBuildGenLimit = 100\r\nconst artifactsSlotsToSelectMainStats: SlotKey[] = [\"sands\", \"goblet\", \"circlet\"]\r\n\r\nfunction buildSettingsReducer(state: BuildSetting, action): BuildSetting {\r\n  switch (action.type) {\r\n    case 'mainStatKey': {\r\n      const { index, mainStatKey } = action\r\n      state.mainStatKeys[index] = mainStatKey\r\n      return { ...state, mainStatKeys: [...state.mainStatKeys] }//do this because this is a dependency, so needs to be a \"new\" array\r\n    }\r\n    case `setFilter`: {\r\n      const { index, key, num = 0 } = action\r\n      state.setFilters[index] = { key, num }\r\n      return { ...state, setFilters: [...state.setFilters] }//do this because this is a dependency, so needs to be a \"new\" array\r\n    }\r\n    default:\r\n      break;\r\n  }\r\n  return { ...state, ...action }\r\n}\r\n\r\nexport default function BuildDisplay({ location: { characterKey: propCharacterKey } }) {\r\n  const [characterKey, setcharacterKey] = useState(() => {\r\n    const { characterKey = \"\" } = loadFromLocalStorage(\"BuildsDisplay.state\") ?? {}\r\n    //NOTE that propCharacterKey can override the selected character.\r\n    return (propCharacterKey ?? characterKey) as CharacterKey | \"\"\r\n  })\r\n\r\n  const [builds, setbuilds] = useState([] as any[])\r\n  const [maxBuildsToShow, setmaxBuildsToShow] = useState(() => {\r\n    const { maxBuildsToShow = maxBuildsToShowDefault } = loadFromLocalStorage(\"BuildsDisplay.state\") ?? {}\r\n    return maxBuildsToShow\r\n  })\r\n\r\n  const [modalBuild, setmodalBuild] = useState(null) // the newBuild that is being displayed in the character modal\r\n  const [showArtCondModal, setshowArtCondModal] = useState(false)\r\n  const [showCharacterModal, setshowCharacterModal] = useState(false)\r\n\r\n  const [generatingBuilds, setgeneratingBuilds] = useState(false)\r\n  const [generationProgress, setgenerationProgress] = useState(0)\r\n  const [generationDuration, setgenerationDuration] = useState(0)//in ms\r\n  const [generationSkipped, setgenerationSkipped] = useState(0)\r\n\r\n  const [charDirty, setCharDirty] = useForceUpdate()\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n\r\n  const [artsDirty, setArtsDirty] = useForceUpdate()\r\n\r\n  const isMounted = useRef(false)\r\n\r\n  const worker = useRef(null as Worker | null)\r\n\r\n  type characterDataType = { character?: ICharacter, characterSheet?: CharacterSheet, weaponSheet?: WeaponSheet, initialStats?: ICalculatedStats, statsDisplayKeys?: { basicKeys: any, [key: string]: any } }\r\n  const [{ character, characterSheet, weaponSheet, initialStats, statsDisplayKeys }, setCharacterData] = useState({} as characterDataType)\r\n  const buildSettings = useMemo(() => character?.buildSettings ?? initialBuildSettings(), [character])\r\n  if (buildSettings.setFilters.length === 0) buildSettings.setFilters = initialBuildSettings().setFilters//hotfix for an issue with db. can be removed later.\r\n  const { setFilters, statFilters, mainStatKeys, optimizationTarget, mainStatAssumptionLevel, useLockedArts, useEquippedArts, ascending, } = buildSettings\r\n\r\n  const buildSettingsDispatch = useCallback((action) => {\r\n    if (!character) return\r\n    character.buildSettings = buildSettingsReducer(buildSettings, action)\r\n    database.updateChar(character)\r\n  }, [character, buildSettings])\r\n\r\n  useEffect(() => ReactGA.pageview('/build'), [])\r\n\r\n  //load the character data as a whole\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (!characterKey || !artifactSheets) return\r\n      const character = database._getChar(characterKey)\r\n      if (!character) return\r\n      const characterSheet = await CharacterSheet.get(characterKey)\r\n      const weaponSheet = await WeaponSheet.get(character.weapon.key)\r\n      if (!characterSheet || !weaponSheet) return\r\n      const initialStats = Character.createInitialStats(character, characterSheet, weaponSheet)\r\n      //NOTE: since initialStats are used, there are no inclusion of artifact formulas here.\r\n      const statsDisplayKeys = Character.getDisplayStatKeys(initialStats, { characterSheet, weaponSheet, artifactSheets })\r\n      setCharacterData({ character, characterSheet, weaponSheet, initialStats, statsDisplayKeys })\r\n    })()\r\n  }, [charDirty, characterKey, artifactSheets])\r\n\r\n  //register changes in artifact database\r\n  useEffect(() =>\r\n    database.followAnyArt(setArtsDirty),\r\n    [setArtsDirty])\r\n\r\n  //register changes in character in db\r\n  useEffect(() =>\r\n    characterKey ? database.followChar(characterKey, setCharDirty) : undefined,\r\n    [characterKey, setCharDirty])\r\n\r\n  //terminate worker when component unmounts\r\n  useEffect(() => () => worker.current?.terminate(), [])\r\n\r\n  //select a new character Key\r\n  const selectCharacter = useCallback((cKey = \"\") => {\r\n    if (characterKey === cKey) return\r\n    setcharacterKey(cKey)\r\n    setbuilds([])\r\n    setCharDirty()\r\n    setCharacterData({})\r\n  }, [setCharDirty, setcharacterKey, characterKey])\r\n\r\n  //save to BuildsDisplay.state on change\r\n  useEffect(() => {\r\n    if (isMounted.current) saveToLocalStorage(\"BuildsDisplay.state\", { characterKey, maxBuildsToShow })\r\n    else isMounted.current = true\r\n  }, [characterKey, maxBuildsToShow])\r\n\r\n  //validate optimizationTarget \r\n  useEffect(() => {\r\n    if (!statsDisplayKeys) return\r\n    if (!Array.isArray(optimizationTarget)) return\r\n    for (const sectionKey in statsDisplayKeys) {\r\n      const section = statsDisplayKeys[sectionKey]\r\n      for (const keys of section)\r\n        if (JSON.stringify(keys) === JSON.stringify(optimizationTarget)) return\r\n    }\r\n    buildSettingsDispatch({ optimizationTarget: initialBuildSettings().optimizationTarget })\r\n  }, [optimizationTarget, statsDisplayKeys, buildSettingsDispatch])\r\n\r\n  const { split, totBuildNumber } = useMemo(() => {\r\n    if (!characterKey) // Make sure we have all slotKeys\r\n      return { split: Object.fromEntries(allSlotKeys.map(slotKey => [slotKey, []])) as ArtifactsBySlot, totBuildNumber: 0 }\r\n    const artifactDatabase = database._getArts().filter(art => {\r\n      //if its equipped on the selected character, bypass the check\r\n      if (art.location === characterKey) return true\r\n\r\n      if (art.lock && !useLockedArts) return false\r\n      if (art.location && !useEquippedArts) return false\r\n      return true\r\n    })\r\n    const split = Artifact.splitArtifactsBySlot(artifactDatabase);\r\n    //filter the split slots on the mainstats selected.\r\n    artifactsSlotsToSelectMainStats.forEach((slotKey, index) =>\r\n      mainStatKeys[index] && (split[slotKey] = split[slotKey]?.filter((art) => art.mainStatKey === mainStatKeys[index])))\r\n    const totBuildNumber = calculateTotalBuildNumber(split, setFilters)\r\n    return artsDirty && { split, totBuildNumber }\r\n  }, [characterKey, useLockedArts, useEquippedArts, mainStatKeys, setFilters, artsDirty])\r\n\r\n  const generateBuilds = useCallback(() => {\r\n    if (!initialStats || !artifactSheets) return\r\n    setbuilds([])\r\n    setgeneratingBuilds(true)\r\n    setgenerationDuration(0)\r\n    setgenerationProgress(0)\r\n    setgenerationSkipped(0)\r\n    //get the formula for this target\r\n\r\n    initialStats.mainStatAssumptionLevel = mainStatAssumptionLevel\r\n    const artifactSetEffects = Artifact.setEffectsObjs(artifactSheets, initialStats)\r\n    const splitArtifacts = deepClone(split) as ArtifactsBySlot\r\n    //add mainStatVal to each artifact\r\n    Object.values(splitArtifacts).forEach(artArr => {\r\n      artArr!.forEach(art => {\r\n        art.mainStatVal = Artifact.mainStatValue(art.mainStatKey, art.numStars, Math.max(Math.min(mainStatAssumptionLevel, art.numStars * 4), art.level)) ?? 0;\r\n      })\r\n    })\r\n    //generate the key dependencies for the formula\r\n    const minFilters: Dict<StatKey, number> = Object.fromEntries(Object.entries(statFilters).map(([statKey, { min }]) => [statKey, min]).filter(([, min]) => typeof min === \"number\"))\r\n    const maxFilters: Dict<StatKey, number> = Object.fromEntries(Object.entries(statFilters).map(([statKey, { max }]) => [statKey, max]).filter(([, max]) => typeof max === \"number\"))\r\n    //create an obj with app the artifact set effects to pass to buildworker.\r\n    const data = {\r\n      splitArtifacts, initialStats, artifactSetEffects,\r\n      setFilters, minFilters, maxFilters, maxBuildsToShow, optimizationTarget, ascending\r\n    };\r\n    worker.current?.terminate()\r\n    worker.current = new Worker()\r\n    worker.current.onmessage = (e) => {\r\n      if (typeof e.data.progress === \"number\") {\r\n        const { progress, timing = 0, skipped = 0 } = e.data\r\n        setgenerationProgress(progress)\r\n        setgenerationDuration(timing)\r\n        setgenerationSkipped(skipped)\r\n        return\r\n      }\r\n      ReactGA.timing({\r\n        category: \"Build Generation\",\r\n        variable: \"timing\",\r\n        value: e.data.timing,\r\n        label: totBuildNumber.toString()\r\n      })\r\n      const builds = (e.data.builds as Build[]).map(obj =>\r\n        Character.calculateBuildwithArtifact(initialStats, obj.artifacts, artifactSheets))\r\n      setbuilds(builds)\r\n      setgeneratingBuilds(false)\r\n      worker.current?.terminate()\r\n      worker.current = null\r\n    };\r\n    worker.current.postMessage(data)\r\n  }, [artifactSheets, split, totBuildNumber, mainStatAssumptionLevel, ascending, initialStats, maxBuildsToShow, optimizationTarget, setFilters, statFilters])\r\n\r\n  //try to generate build when build numbers are low\r\n  useEffect(() => {\r\n    if (totBuildNumber && totBuildNumber <= autoBuildGenLimit) generateBuilds()\r\n    else setbuilds([])\r\n  }, [characterKey, split, totBuildNumber, buildSettings, generateBuilds])\r\n\r\n  const dropdownitemsForStar = useCallback((star, index) => artifactSheets && ArtifactSheet.setsWithMaxRarity(artifactSheets, star).map(([setKey, setobj]) => {\r\n    if (setFilters.some(filter => filter.key === setKey)) return false;\r\n    const setsNumArr = Object.keys(artifactSheets?.[setKey]?.setEffects ?? {})\r\n    const artsAccountedOther = setFilters.reduce((accu, cur, ind) => (cur.key && ind !== index) ? accu + cur.num : accu, 0)\r\n    if (setsNumArr.every((num: any) => parseInt(num) + artsAccountedOther > 5)) return false;\r\n    return (<Dropdown.Item key={setKey} onClick={() => buildSettingsDispatch({ type: 'setFilter', index, key: setKey, num: parseInt(setsNumArr[0] as any) ?? 0 })} >\r\n      {setobj.nameWithIcon}\r\n    </Dropdown.Item>)\r\n  }), [setFilters, buildSettingsDispatch, artifactSheets])\r\n\r\n  const characterName = characterSheet?.name ?? \"Character Name\"\r\n  const characterDropDown = useMemo(() => <DropdownButton title={characterName} disabled={generatingBuilds}>\r\n    <Dropdown.Item onClick={() => selectCharacter(\"\")}>Unselect Character</Dropdown.Item>\r\n    <Dropdown.Divider />\r\n    <CharacterSelectionDropdownList onSelect={cKey => selectCharacter(cKey)} />\r\n  </DropdownButton>, [characterName, generatingBuilds, selectCharacter])\r\n\r\n  const formula = usePromise(Array.isArray(optimizationTarget) ? Formula.get(optimizationTarget) : undefined, [optimizationTarget])\r\n  const sortByText = useMemo(() => {\r\n    if (Array.isArray(optimizationTarget)) {\r\n      if (!formula) return null\r\n      let [type, , talentKey] = (formula as any).keys as string[]\r\n      const field = (formula as any).field as IFieldDisplay\r\n      const variant = Character.getTalentFieldValue(field, \"variant\", initialStats)\r\n      const text = Character.getTalentFieldValue(field, \"text\", initialStats)\r\n      if (type === \"character\") {\r\n        if (talentKey === \"normal\" || talentKey === \"charged\" || talentKey === \"plunging\") talentKey = \"auto\"\r\n        return <b>{characterSheet?.getTalentOfKey(talentKey, initialStats?.characterEle)?.name}: <span className={`text-${variant}`}>{text}</span></b>\r\n      } else if (type === \"weapon\") {\r\n        return <b>{weaponSheet?.name}: <span className={`text-${variant}`}>{text}</span></b>\r\n      }\r\n    } else return <b>Basic Stat: <span className={`text-${Stat.getStatVariant(optimizationTarget)}`}>{Stat.getStatNamePretty(optimizationTarget)}</span></b>\r\n    // return <Badge variant=\"danger\">INVALID</Badge>\r\n  }, [optimizationTarget, formula, initialStats, characterSheet, weaponSheet])\r\n\r\n\r\n  const artsAccounted = setFilters.reduce((accu, cur) => cur.key ? accu + cur.num : accu, 0)\r\n  const artifactCondCount = useMemo(() => {\r\n    let count = 0;\r\n    crawlObject(initialStats?.conditionalValues?.artifact, [], v => Array.isArray(v), () => count++)\r\n    return count\r\n  }, [initialStats?.conditionalValues])\r\n  //rudimentary dispatcher, definitely not the same API as the real characterDispatch.\r\n  const characterDispatch = useCallback(val => database.updateChar({ ...character, ...val }), [character])\r\n  return <Container className=\"mt-2\">\r\n    <InfoComponent\r\n      pageKey=\"buildPage\"\r\n      modalTitle=\"Character Management Page Guide\"\r\n      text={[\"For self-infused attacks, like Noelle's Sweeping Time, enable the skill in the talent page.\",\r\n        \"You can compare the difference between equipped artifacts and generated builds.\",\r\n        \"The more complex the formula, the longer the generation time.\",]}\r\n    ><InfoDisplay /></InfoComponent>\r\n    <BuildModal {...{ build: modalBuild, showCharacterModal, characterKey, selectCharacter, setmodalBuild, setshowCharacterModal }} />\r\n    {!!initialStats && <ArtConditionalModal {...{ showArtCondModal, setshowArtCondModal, initialStats, characterDispatch, artifactCondCount }} />}\r\n    <Row className=\"mt-2 mb-2\">\r\n      <Col>\r\n        {/* Build Generator Editor */}\r\n        <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n          <Card.Header>Build Generator</Card.Header>\r\n          <Card.Body>\r\n            <Row >\r\n              <Col xs={12} lg={6}>\r\n                {/* character selection */}\r\n                {characterKey ?\r\n                  <CharacterCard header={characterDropDown} characterKey={characterKey} bg={\"lightcontent\"} cardClassName=\"mb-2\" onEdit={!generatingBuilds ? () => setshowCharacterModal(true) : undefined} /> :\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n                    <Card.Header>\r\n                      {characterDropDown}\r\n                    </Card.Header>\r\n                  </Card>}\r\n                {/* Hit mode options */}\r\n                {characterSheet && character && initialStats && <HitModeCard build={initialStats} characterSheet={characterSheet} className=\"mb-2\" character={character} />}\r\n                {/* Final Stat Filter */}\r\n                {Boolean(statsDisplayKeys) && <StatFilterCard className=\"mb-2\" statFilters={statFilters} statKeys={statsDisplayKeys?.basicKeys as any} setStatFilters={sFs => buildSettingsDispatch({ statFilters: sFs })} />}\r\n              </Col>\r\n              <Col xs={12} lg={6}><Row>\r\n                <Col className=\"mb-2\" xs={12}>\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any}><Card.Body>\r\n                    <Button className=\"w-100\" onClick={() => setshowArtCondModal(true)} disabled={generatingBuilds}>\r\n                      <span>Default Artifact Set Effects {Boolean(artifactCondCount) && <Badge variant=\"success\">{artifactCondCount} Selected</Badge>}</span>\r\n                    </Button>\r\n                  </Card.Body></Card>\r\n                </Col>\r\n                {/* Artifact set picker */}\r\n                {setFilters.map(({ key: setKey, num: setNum }, index) => <Col className=\"mb-2\" key={index} xs={12}>\r\n                  <Card className=\"h-100\" bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n                    <Card.Header>\r\n                      <ButtonGroup>\r\n                        {/* Artifact set */}\r\n                        <DropdownButton as={ButtonGroup} title={artifactSheets?.[setKey]?.nameWithIcon ?? \"Artifact Set Filter\"} disabled={generatingBuilds}>\r\n                          <Dropdown.Item onClick={() => buildSettingsDispatch({ type: 'setFilter', index, key: \"\" })}>Unselect Artifact</Dropdown.Item>\r\n                          <Dropdown.ItemText>Max Rarity 🟊🟊🟊🟊🟊</Dropdown.ItemText>\r\n                          {dropdownitemsForStar(5, index)}\r\n                          <Dropdown.Divider />\r\n                          <Dropdown.ItemText>Max Rarity 🟊🟊🟊🟊</Dropdown.ItemText>\r\n                          {dropdownitemsForStar(4, index)}\r\n                          <Dropdown.Divider />\r\n                          <Dropdown.ItemText>Max Rarity 🟊🟊🟊</Dropdown.ItemText>\r\n                          {dropdownitemsForStar(3, index)}\r\n                        </DropdownButton>\r\n                        {/* set number */}\r\n                        <DropdownButton as={ButtonGroup} title={`${setNum}-set`}\r\n                          disabled={generatingBuilds || !setKey || artsAccounted >= 5}\r\n                        >\r\n                          {!!initialStats && Object.keys(artifactSheets?.[setKey]?.setEffects ?? {}).map((num: any) => {\r\n                            let artsAccountedOther = setFilters.reduce((accu, cur) => (cur.key && cur.key !== setKey) ? accu + cur.num : accu, 0)\r\n                            return (parseInt(num) + artsAccountedOther <= 5) &&\r\n                              (<Dropdown.Item key={num} onClick={() => buildSettingsDispatch({ type: 'setFilter', index, key: setFilters[index].key, num: parseInt(num) })} >\r\n                                {`${num}-set`}\r\n                              </Dropdown.Item>)\r\n                          })}\r\n                        </DropdownButton>\r\n                      </ButtonGroup>\r\n                    </Card.Header>\r\n                    {setKey ? <Card.Body><Row className=\"mb-n2\">\r\n                      {!!initialStats && Object.keys(artifactSheets?.[setKey].setEffects ?? {}).map(setNKey => parseInt(setNKey) as SetNum).filter(setNkey => setNkey <= setNum).map(setNumKey =>\r\n                        <SetEffectDisplay newBuild={undefined} key={setKey + setNumKey} {...{ setKey, setNumKey, equippedBuild: initialStats, characterDispatch, editable: true }} />)}\r\n                    </Row></Card.Body> : null}\r\n                  </Card>\r\n                </Col>)}\r\n                <Col className=\"mb-2\" xs={12}>\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any}><Card.Body className=\"mb-n2\">\r\n                    <Button className=\"w-100 mb-2\" onClick={() => buildSettingsDispatch({ useEquippedArts: !useEquippedArts })} disabled={generatingBuilds}>\r\n                      <span><FontAwesomeIcon icon={useEquippedArts ? faCheckSquare : faSquare} /> Use Equipped Artifacts</span>\r\n                    </Button>\r\n                    <Button className=\"w-100 mb-2\" onClick={() => buildSettingsDispatch({ useLockedArts: !useLockedArts })} disabled={generatingBuilds}>\r\n                      <span><FontAwesomeIcon icon={useLockedArts ? faCheckSquare : faSquare} /> Use Locked Artifacts</span>\r\n                    </Button>\r\n                  </Card.Body></Card>\r\n                </Col>\r\n                {/* main stat selector */}\r\n                <Col className=\"mb-2\" xs={12}>\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n                    <Card.Header>\r\n                      <Row>\r\n                        <Col>Artifact Main Stat</Col>\r\n                        <Col xs=\"auto\"><AssumeFullLevelToggle mainStatAssumptionLevel={mainStatAssumptionLevel} setmainStatAssumptionLevel={v => buildSettingsDispatch({ mainStatAssumptionLevel: v })} /></Col>\r\n                      </Row>\r\n                    </Card.Header>\r\n                    <Card.Body className=\"mb-n2\">\r\n                      {artifactsSlotsToSelectMainStats.map((slotKey, index) =>\r\n                      (<div className=\"text-inline mb-1 d-flex justify-content-between\" key={slotKey}>\r\n                        <h6 className=\"d-inline mb-0\"><SlotNameWithIcon slotKey={slotKey} /></h6>\r\n                        <DropdownButton disabled={generatingBuilds} size=\"sm\"\r\n                          title={mainStatKeys[index] ? Stat.getStatNameWithPercent(mainStatKeys[index]) : \"Select a mainstat\"}\r\n                          className=\"d-inline\">\r\n                          <Dropdown.Item onClick={() => buildSettingsDispatch({ type: \"mainStatKey\", index, mainStatKey: \"\" })} >No MainStat</Dropdown.Item>\r\n                          {Artifact.slotMainStats(slotKey).map(mainStatKey =>\r\n                            <Dropdown.Item onClick={() => buildSettingsDispatch({ type: \"mainStatKey\", index, mainStatKey })} key={mainStatKey}>\r\n                              {Stat.getStatNameWithPercent(mainStatKey)}\r\n                            </Dropdown.Item>)}\r\n                        </DropdownButton>\r\n                      </div>))}\r\n                    </Card.Body>\r\n                  </Card>\r\n                </Col>\r\n              </Row></Col>\r\n            </Row>\r\n            <Row className=\"d-flex justify-content-between mb-2\">\r\n              <Col xs=\"auto\" >\r\n                <ButtonGroup>\r\n                  <Button\r\n                    className=\"h-100\"\r\n                    disabled={!characterKey || generatingBuilds}\r\n                    variant={(characterKey && totBuildNumber <= warningBuildNumber) ? \"success\" : \"warning\"}\r\n                    onClick={generateBuilds}\r\n                  ><span>Generate</span></Button>\r\n                  <Dropdown as={ButtonGroup}>\r\n                    <OverlayTrigger\r\n                      overlay={<Tooltip id=\"max-build-tooltip\">\r\n                        Decreasing the number of generated build will decrease build calculation time for large number of builds.\r\n                      </Tooltip>}\r\n                    >\r\n                      <Dropdown.Toggle ><b>{maxBuildsToShow}</b> {maxBuildsToShow === 1 ? \"Build\" : \"Builds\"}</Dropdown.Toggle>\r\n                    </OverlayTrigger>\r\n                    <Dropdown.Menu>\r\n                      {maxBuildsToShowList.map(v => <Dropdown.Item key={v} onClick={() => setmaxBuildsToShow(v)}>{v} {v === 1 ? \"Build\" : \"Builds\"}</Dropdown.Item>)}\r\n                    </Dropdown.Menu>\r\n                  </Dropdown>\r\n                  <Button\r\n                    className=\"h-100\"\r\n                    disabled={!generatingBuilds}\r\n                    variant=\"danger\"\r\n                    onClick={() => {\r\n                      if (!worker.current) return;\r\n                      worker.current.terminate();\r\n                      worker.current = null\r\n                      setgeneratingBuilds(false)\r\n                      setbuilds([])\r\n                      setgenerationDuration(0)\r\n                      setgenerationProgress(0)\r\n                      setgenerationSkipped(0)\r\n                    }}\r\n                  ><span>Cancel</span></Button>\r\n                </ButtonGroup>\r\n              </Col>\r\n              <Col xs=\"auto\">\r\n                {/* Dropdown to select sorting value */}\r\n                {<ButtonGroup>\r\n                  <Dropdown as={ButtonGroup} drop=\"up\">\r\n                    <Dropdown.Toggle disabled={generatingBuilds} variant=\"light\" >\r\n                      <span>Optimization Target: {sortByText}</span>\r\n                    </Dropdown.Toggle>\r\n                    <Dropdown.Menu align=\"right\" style={{ minWidth: \"40rem\" }} >\r\n                      <Row>\r\n                        {!!statsDisplayKeys && Object.entries(statsDisplayKeys).map(([sectionKey, fields]: [string, any]) => {\r\n                          const header = (characterSheet && weaponSheet && artifactSheets) ? getFormulaTargetsDisplayHeading(sectionKey, { characterSheet, weaponSheet, artifactSheets }, initialStats?.characterEle) : sectionKey\r\n                          return <Col xs={12} md={6} key={sectionKey}>\r\n                            <Dropdown.Header style={{ overflow: \"hidden\", textOverflow: \"ellipsis\" }}><b>{header}</b></Dropdown.Header>\r\n                            {fields.map((target, i) => {\r\n                              if (Array.isArray(target))\r\n                                return <TargetSelectorDropdownItem key={i} {...{ target, buildSettingsDispatch, initialStats }} />\r\n                              else if (typeof target === \"string\")\r\n                                return <Dropdown.Item key={i} onClick={() => buildSettingsDispatch({ optimizationTarget: target })}>{Stat.getStatNamePretty(target)}</Dropdown.Item>\r\n                              return null\r\n                            })}\r\n                          </Col>\r\n                        })}\r\n                      </Row>\r\n                    </Dropdown.Menu>\r\n                  </Dropdown>\r\n                  <Button onClick={() => buildSettingsDispatch({ ascending: !buildSettings.ascending })} disabled={generatingBuilds} variant={ascending ? \"danger\" : \"primary\"}>\r\n                    <FontAwesomeIcon icon={ascending ? faSortAmountDownAlt : faSortAmountUp} className=\"fa-fw\" />\r\n                    <span>{ascending ? \"Ascending\" : \"Descending\"}</span>\r\n                  </Button>\r\n                </ButtonGroup >}\r\n              </Col>\r\n            </Row>\r\n            <Row className=\"\">\r\n              <Col>{!!characterKey && <BuildAlert {...{ totBuildNumber, generatingBuilds, generationSkipped, generationProgress, generationDuration, characterName, maxBuildsToShow }} />}</Col>\r\n            </Row>\r\n          </Card.Body>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n    <Row className=\"mb-2\">\r\n      <Col>\r\n        <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n          <Card.Header>\r\n            <Row>\r\n              <Col>{characterKey ? <span>Showing <b>{builds.length}</b> Builds generated for {characterName}</span> : <span>Select a character to generate builds.</span>}</Col>\r\n            </Row>\r\n          </Card.Header>\r\n          {/* Build List */}\r\n          <ListGroup>\r\n            {builds.map((build, index) =>\r\n              index < maxBuildsToShow && characterSheet && weaponSheet && artifactSheets && <ArtifactDisplayItem sheets={{ characterSheet, weaponSheet, artifactSheets }} build={build} characterKey={characterKey as CharacterKey} index={index} key={index} statsDisplayKeys={statsDisplayKeys} onClick={() => setmodalBuild(build as any)} />\r\n            )}\r\n          </ListGroup>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n  </Container >\r\n}\r\n\r\nfunction TargetSelectorDropdownItem({ target, buildSettingsDispatch, initialStats }) {\r\n  const formula = usePromise(Formula.get(target), [target])\r\n  if (!formula) return null\r\n  const talentField = (formula as any).field as IFieldDisplay\r\n  return <Dropdown.Item onClick={() => buildSettingsDispatch({ optimizationTarget: target })} style={{ overflow: \"hidden\", textOverflow: \"ellipsis\" }}>\r\n    <span className={`text-${Character.getTalentFieldValue(talentField, \"variant\", initialStats)}`}>{Character.getTalentFieldValue(talentField, \"text\", initialStats)}</span>\r\n  </Dropdown.Item>\r\n}\r\n\r\nfunction BuildModal({ build, showCharacterModal, characterKey, selectCharacter, setmodalBuild, setshowCharacterModal }) {\r\n  const closeModal = useCallback(() => {\r\n    setmodalBuild(null)\r\n    setshowCharacterModal(false)\r\n  }, [setmodalBuild, setshowCharacterModal])\r\n  return <Modal show={Boolean(showCharacterModal || build)} onHide={closeModal} size=\"xl\" contentClassName=\"bg-transparent\">\r\n    <React.Suspense fallback={<span>Loading...</span>}>\r\n      <CharacterDisplayCard\r\n        character={undefined}\r\n        tabName={undefined}\r\n        characterKey={characterKey}\r\n        setCharacterKey={cKey => selectCharacter(cKey)}\r\n        newBuild={build}\r\n        onClose={closeModal}\r\n        editable={showCharacterModal}\r\n        footer={<Button variant=\"danger\" onClick={closeModal}>Close</Button>} />\r\n    </React.Suspense>\r\n  </Modal>\r\n}\r\n\r\nfunction ArtConditionalModal({ showArtCondModal, setshowArtCondModal, initialStats, characterDispatch, artifactCondCount }) {\r\n  const closeArtCondModal = useCallback(() => setshowArtCondModal(false), [setshowArtCondModal])\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n  if (!artifactSheets) return null\r\n  const artSetKeyList = Object.entries(ArtifactSheet.setKeysByRarities(artifactSheets)).reverse().flatMap(([, sets]) => sets)\r\n  return <Modal show={showArtCondModal} onHide={closeArtCondModal} size=\"xl\" contentClassName=\"bg-transparent\">\r\n    <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n      <Card.Header>\r\n        <Row>\r\n          <Col>\r\n            <h5>Default Artifact Set Effects  {Boolean(artifactCondCount) && <Badge variant=\"success\">{artifactCondCount} Selected</Badge>}</h5>\r\n          </Col>\r\n          <Col xs=\"auto\" >\r\n            <Button onClick={() => {\r\n              if (initialStats.conditionalValues.artifact) initialStats.conditionalValues.artifact = {}\r\n              characterDispatch({ conditionalValues: initialStats.conditionalValues })\r\n            }}><span><FontAwesomeIcon icon={faUndo} /> Reset All</span></Button>\r\n          </Col>\r\n          <Col xs=\"auto\" >\r\n            <Button variant=\"danger\" onClick={closeArtCondModal}>\r\n              <FontAwesomeIcon icon={faTimes} /></Button>\r\n          </Col>\r\n        </Row>\r\n      </Card.Header>\r\n      <Card.Body>\r\n        <Row>\r\n          {artSetKeyList.map(setKey => {\r\n            const sheet = artifactSheets[setKey]\r\n            let icon = Object.values(sheet.slotIcons)[0]\r\n            const rarity = sheet.rarity\r\n            const numStars = rarity[0]\r\n            return <Col className=\"mb-2\" key={setKey} xs={12} lg={6} xl={4}>\r\n              <Card className=\"h-100\" bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n                <Card.Header >\r\n                  <Row>\r\n                    <Col xs=\"auto\" className=\"ml-n3 my-n2\">\r\n                      <Image src={icon} className={`thumb-mid grad-${numStars}star m-1`} thumbnail />\r\n                    </Col>\r\n                    <Col >\r\n                      <h6><b>{artifactSheets?.[setKey].name ?? \"\"}</b></h6>\r\n                      <span>{rarity.map((ns, i) => <span key={ns}>{ns}<Stars stars={1} /> {i < (rarity.length - 1) ? \"/ \" : null}</span>)}</span>\r\n                    </Col>\r\n                  </Row>\r\n                </Card.Header>\r\n                <Card.Body><Row className=\"mb-n2\">\r\n                  {Boolean(setKey) && Object.keys(sheet.setEffects).map(key => parseInt(key) as SetNum).map(setNumKey =>\r\n                    <SetEffectDisplay newBuild={undefined} key={setKey + setNumKey} {...{ setKey, setNumKey, equippedBuild: initialStats, editable: true, characterDispatch, }} />)}\r\n                </Row></Card.Body>\r\n              </Card>\r\n            </Col>\r\n          })}\r\n        </Row>\r\n      </Card.Body>\r\n      <Card.Footer>\r\n        <Button variant=\"danger\" onClick={closeArtCondModal}>\r\n          <FontAwesomeIcon icon={faTimes} /> CLOSE</Button>\r\n      </Card.Footer>\r\n    </Card>\r\n  </Modal>\r\n}\r\n\r\nfunction StatFilterItem({ statKey, statKeys = [], min, max, close, setFilter }: {\r\n  statKey?, statKeys, min, max, close, setFilter\r\n}) {\r\n  const isFloat = Stat.getStatUnit(statKey) === \"%\"\r\n  const inputProps = {\r\n    disabled: !statKey,\r\n    allowEmpty: true,\r\n    float: isFloat,\r\n  }\r\n  const minInputProps = {\r\n    ...inputProps,\r\n    placeholder: \"MIN\",\r\n    value: min,\r\n    onChange: (s) => setFilter(statKey, s, max)\r\n  }\r\n  const maxInputProps = {\r\n    ...inputProps,\r\n    placeholder: \"MAX\",\r\n    value: max,\r\n    onChange: (s) => setFilter(statKey, min, s)\r\n  }\r\n  return <InputGroup className=\"mb-2\">\r\n    <DropdownButton\r\n      as={InputGroup.Prepend}\r\n      title={Stat.getStatNamePretty(statKey, \"New Stat\")}\r\n      id=\"input-group-dropdown-1\"\r\n    >\r\n      {statKeys.map(sKey => <Dropdown.Item key={sKey} onClick={() => { close?.(); setFilter(sKey, min, max) }}>{Stat.getStatNamePretty(sKey)}</Dropdown.Item>)}\r\n    </DropdownButton>\r\n    <CustomFormControl {...minInputProps} />\r\n    <CustomFormControl {...maxInputProps} />\r\n    {Boolean(close) && <InputGroup.Append>\r\n      <Button variant=\"danger\" onClick={close}><FontAwesomeIcon icon={faTrash} /></Button>\r\n    </InputGroup.Append>}\r\n  </InputGroup>\r\n}\r\n\r\nfunction HitModeCard({ characterSheet, character, build, className }: { characterSheet: CharacterSheet, character: ICharacter, build: ICalculatedStats, className: string }) {\r\n  const setHitmode = useCallback(({ hitMode }) => database.updateChar({ ...character, hitMode }), [character])\r\n  const setReactionMode = useCallback(({ reactionMode }) => database.updateChar({ ...character, reactionMode }), [character])\r\n  const setInfusionAura = useCallback(({ infusionAura }) => database.updateChar({ ...character, infusionAura }), [character])\r\n  if (!character) return null\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className={className}>\r\n    <Card.Header>\r\n      <Row>\r\n        <Col>Hit Mode Options</Col>\r\n        <Col xs=\"auto\"><InfusionAuraDropdown characterSheet={characterSheet} character={character} characterDispatch={setInfusionAura} /></Col>\r\n      </Row>\r\n    </Card.Header>\r\n    <Card.Body className=\"mb-n2\">\r\n      <HitModeToggle hitMode={character.hitMode} characterDispatch={setHitmode} className=\"w-100 mb-2\" />\r\n      <ReactionToggle build={build} character={character} characterDispatch={setReactionMode} className=\"w-100 mb-2\" />\r\n    </Card.Body>\r\n  </Card >\r\n}\r\n\r\nfunction StatFilterCard({ statKeys = [], statFilters = {}, setStatFilters, className }) {\r\n  const remainingKeys = statKeys.filter(key => !(Object.keys(statFilters) as any).some(k => k === key))\r\n  const setFilter = (sKey, min, max) => setStatFilters({ ...statFilters, [sKey]: { min, max } })\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className={className}>\r\n    <Card.Header>Final Stat Filter</Card.Header>\r\n    <Card.Body>\r\n      <Row className=\"mb-n2\">\r\n        {(Object.entries(statFilters) as [string, { min, max }][]).map(([statKey, { min, max }]) => {\r\n          return <Col xs={12} key={statKey} ><StatFilterItem statKey={statKey} statKeys={remainingKeys} setFilter={setFilter} min={min} max={max} close={() => {\r\n            delete statFilters[statKey]\r\n            setStatFilters({ ...statFilters })\r\n          }} /></Col>\r\n        })}\r\n        <Col xs={12}>\r\n          <StatFilterItem min={undefined} max={undefined} close={undefined} statKeys={remainingKeys} setFilter={setFilter} />\r\n        </Col>\r\n      </Row>\r\n    </Card.Body>\r\n  </Card>\r\n}\r\n\r\ntype ArtifactDisplayItemProps = {\r\n  sheets: {\r\n    characterSheet: CharacterSheet\r\n    weaponSheet: WeaponSheet,\r\n    artifactSheets: StrictDict<ArtifactSetKey, ArtifactSheet>\r\n  },\r\n  index: number,\r\n  characterKey: CharacterKey,\r\n  build: ICalculatedStats,\r\n  statsDisplayKeys: any,\r\n  onClick: () => void\r\n}\r\n//for displaying each artifact build\r\nfunction ArtifactDisplayItem({ sheets, sheets: { artifactSheets }, index, characterKey, build, statsDisplayKeys, onClick }: ArtifactDisplayItemProps) {\r\n  const character = database._getChar(characterKey)\r\n  if (!character) return null\r\n  const { equippedArtifacts } = character\r\n  const currentlyEquipped = allSlotKeys.every(slotKey => equippedArtifacts[slotKey] === build.equippedArtifacts?.[slotKey])\r\n  return (<div>\r\n    <ListGroup.Item\r\n      variant={index % 2 ? \"customdark\" : \"customdarker\"} className=\"text-white\" action\r\n      onClick={onClick}\r\n    >\r\n      <h5 className=\"mb-2\"><Row>\r\n        <Col xs=\"auto\">\r\n          <Badge variant=\"info\"><strong>{index + 1}{currentlyEquipped ? \" (Equipped)\" : \"\"}</strong></Badge>\r\n        </Col>\r\n        <Col xs=\"auto\">{(Object.entries(build.setToSlots) as [ArtifactSetKey, SlotKey[]][]).sort(([key1, slotarr1], [key2, slotarr2]) => slotarr2.length - slotarr1.length).map(([key, slotarr]) =>\r\n          <Badge key={key} variant={currentlyEquipped ? \"success\" : \"primary\"} className=\"mr-2\">\r\n            {slotarr.map(slotKey => artifactSlotIcon(slotKey))} {artifactSheets?.[key].name ?? \"\"}\r\n          </Badge>\r\n        )}</Col>\r\n      </Row></h5>\r\n      <StatDisplayComponent editable={false} {...{ sheets, character, newBuild: build, statsDisplayKeys, cardbg: (index % 2 ? \"lightcontent\" : \"darkcontent\") }} />\r\n    </ListGroup.Item>\r\n  </div>)\r\n}\r\n\r\nfunction BuildAlert({ totBuildNumber, generatingBuilds, generationSkipped, generationProgress, generationDuration, characterName, maxBuildsToShow }) {\r\n  const totalBuildNumberString = totBuildNumber?.toLocaleString() ?? totBuildNumber\r\n  const totalUnskipped = totBuildNumber - generationSkipped\r\n  const generationProgressString = generationProgress?.toLocaleString() ?? generationProgress\r\n  const generationSkippedString = generationSkipped?.toLocaleString() ?? generationSkipped\r\n  const totalUnskippedString = totalUnskipped?.toLocaleString() ?? totalUnskipped\r\n  const generationSkippedText = Boolean(generationSkipped) && <span>(<b>{generationSkippedString}</b> skipped)</span>\r\n  if (generatingBuilds) {\r\n    let progPercent = generationProgress * 100 / (totalUnskipped)\r\n    return <Alert variant=\"success\">\r\n      <span>Generating and testing <b className=\"text-monospace\">{generationProgressString}/{totalUnskippedString}</b> build configurations against the criteria for <b>{characterName}</b>. {generationSkippedText}</span><br />\r\n      <h6>Time elapsed: <strong className=\"text-monospace\">{timeStringMs(generationDuration)}</strong></h6>\r\n      <ProgressBar now={progPercent} label={`${progPercent.toFixed(1)}%`} />\r\n    </Alert>\r\n  } else if (!generatingBuilds && generationProgress) {//done\r\n    return <Alert variant=\"success\">\r\n      <span>Generated and tested <b className=\"text-monospace\">{totalUnskippedString}</b> Build configurations against the criteria for <b>{characterName}</b>. {generationSkippedText}</span>\r\n      <h6>Total duration: <strong className=\"text-monospace\">{timeStringMs(generationDuration)}</strong></h6>\r\n      <ProgressBar now={100} variant=\"success\" label=\"100%\" />\r\n    </Alert>\r\n  } else {\r\n    return totBuildNumber === 0 ?\r\n      <Alert variant=\"warning\" className=\"mb-0\"><span>Current configuration will not generate any builds for <b>{characterName}</b>. Please change your Artifact configurations, or add/unlock more Artifacts.</span></Alert>\r\n      : (totBuildNumber > warningBuildNumber ?\r\n        <Alert variant=\"warning\" className=\"mb-0\"><span>Current configuration will generate <b>{totalBuildNumberString}</b> builds for <b>{characterName}</b>. This might take quite a while to generate...</span></Alert> :\r\n        <Alert variant=\"success\" className=\"mb-0\"><span>Current configuration {totBuildNumber <= maxBuildsToShow ? \"generated\" : \"will generate\"} <b>{totalBuildNumberString}</b> builds for <b>{characterName}</b>.</span></Alert>)\r\n  }\r\n}\r\n\r\nconst levels = {\r\n  0: <span>No level assumption</span>,\r\n  4: <span>Assume at least level 4</span>,\r\n  8: <span>Assume at least level 8</span>,\r\n  12: <span>Assume at least level 12</span>,\r\n  16: <span>Assume at least level 16</span>,\r\n  20: <span>Assume at least level 20</span>\r\n}\r\nfunction AssumeFullLevelToggle({ mainStatAssumptionLevel = 0, setmainStatAssumptionLevel }) {\r\n  return <OverlayTrigger overlay={<Tooltip id=\"assume-level-tooltip\">Change Main Stat value to be at least a specific level. Does not change substats.</Tooltip>}  >\r\n    <Dropdown>\r\n      <Dropdown.Toggle variant={mainStatAssumptionLevel ? \"orange\" : \"primary\"}>{levels[mainStatAssumptionLevel]}</Dropdown.Toggle>\r\n      <Dropdown.Menu>\r\n        {Object.entries(levels).map(([key, text]) => <Dropdown.Item key={key} onClick={() => setmainStatAssumptionLevel(parseInt(key))}>{text}</Dropdown.Item>)}\r\n      </Dropdown.Menu>\r\n    </Dropdown>\r\n  </OverlayTrigger>\r\n}\r\n"],"sourceRoot":""}