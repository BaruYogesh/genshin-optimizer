{"version":3,"sources":["Components/CustomFormControl.tsx","Util/UIUtil.ts","Components/CharacterSelection.tsx","Components/FieldDisplay.tsx","Artifact/ArtifactCard.tsx","Artifact/PercentBadge.tsx","Character/CharacterDisplay/CharacterArtifactPane.tsx","Character/CharacterDisplay/CharacterOverviewPane.tsx","Character/CharacterDisplay/CharacterTalentPane.tsx","Character/CharacterDisplayCard.tsx","Character/CharacterUtil.tsx","Conditional/ConditionalSelector.tsx","Components/ConditionalDisplay.tsx","Components/DocumentDisplay.tsx","Artifact/Component/SetEffectDisplay.tsx","Character/CharacterDisplay/StatDisplayComponent.tsx","Components/StatDisplay.tsx","Character/StatInput.tsx","Character/CharacterDisplay/DamageOptionsAndCalculation.tsx"],"names":["CustomFormControl","value","onChange","className","disabled","float","placeholder","allowEmpty","max","min","useState","state","setState","sendChange","useCallback","undefined","parseFunc","parseFloat","parseInt","useEffect","toString","aria-label","type","e","target","onBlur","onKeyDown","key","valueStringWithUnit","unit","Math","round","toFixed","valueString","CharacterSelectionDropdownList","onSelect","database","_getCharKeys","sort","a","b","map","characterKey","DropDownItem","characterSheet","usePromise","CharacterSheet","get","Item","onClick","nameWIthIcon","FieldDisplay","field","index","equippedBuild","newBuild","compareAgainstEquipped","useContext","compareAgainstEquippedContext","stats","canShow","useMemo","fixedVal","fixed","fieldVal","Character","getTalentFieldValue","formula","retVal","fieldEquippedVal","diff","fieldText","fieldVariant","formulaTextOverlay","fieldFormulaText","placement","overlay","id","icon","faQuestionCircle","style","cursor","variant","allSubstatFilter","Set","allSubstats","ArtifactCard","artifactId","artifactObj","onEdit","onDelete","mainStatAssumptionLevel","effFilter","t","useTranslation","databaseArtifact","updateDatabaseArtifact","followArt","sheet","ArtifactSheet","_getArt","setKey","equipOnChar","charKey","setLocation","editable","art","location","slotKey","numStars","level","mainStatKey","substats","lock","mainStatLevel","mainStatVal","Artifact","mainStatValue","Stat","getStatUnit","getArtifactEfficiency","currentEfficiency","maxEfficiency","artifactValid","locationName","name","faBriefcase","slotName","getSlotName","slotDesc","getSlotDesc","slotDescEle","faInfoCircle","setEffects","setDesc","Object","keys","setNumKey","setNum","setEffectDesc","setDescEle","border","bg","text","Header","xs","md","src","slotIcons","thumbnail","stars","Body","Title","getStatName","stat","i","numRolls","rolls","length","efficiency","effOpacity","statName","opacity","has","valid","Footer","Toggle","size","Menu","Divider","lockArtifact","faLock","faLockOpen","faEdit","faTrashAlt","PercentBadge","floor","badgeColor","artLayoutSize","lg","CharacterArtifactPane","sheets","character","characterDispatch","artifacts","history","useHistory","statKeys","getDisplayStatKeys","edit","artid","push","pathname","artToEditId","artifactSheets","getAll","useForceUpdate","updateArt","followAnyArt","equipArts","window","confirm","equippedArtifacts","equipArtifacts","unequipArts","fromEntries","allSlotKeys","sKey","Card","StatDisplayComponent","statsDisplayKeys","Button","Boolean","Alert","Row","Col","entries","setToSlots","setNumKeyArr","SetEffectDisplay","find","CharacterOverviewPane","weaponSheet","constellation","ascension","build","tlvl","elementKey","characterEle","weaponTypeKey","Img","cardImg","StatIcon","Image","Assets","weaponTypes","star","colored","getLevelString","tKey","getTalentOfKey","img","roundedCircle","Badge","position","bottom","right","constellationName","Array","WeaponStatsEditorCard","MainStatsCards","WeaponStatsCard","title","statsVals","fields","statsToFields","ListGroup","WeaponDropdown","setStateWeapon","weaponSheets","WeaponSheet","Dropdown","as","ButtonGroup","allRarities","arr","Fragment","ItemText","getWeaponsOfType","filter","rarity","weaponObj","weapon","conditionalValues","setLevel","newLevel","clamp","ascensionMaxLevel","findIndex","ascenML","ambiguousLevel","setAscension","lowerAscension","substatKey","getSubStatKey","weaponDisplayMainVal","getMainStatValue","weaponDisplaySubVal","getSubStatValue","weaponPassiveName","passiveName","weaponBonusStats","document","InputGroup","Prepend","refineIndex","Text","Append","milestoneLevels","lv","lvlstr","description","passiveDescription","atk","DocumentDisplay","sections","editing","SetEditing","editingOther","SetEditingOther","editingMisc","SetEditingMisc","additionalKeys","displayStatKeys","editStatKeys","otherStatKeys","allElements","forEach","ele","miscStatkeys","specializedStatKey","getSpecializedStat","specializedStatVal","getSpecializedStatVal","specializedStatUnit","displayNewBuildProps","faSave","statKey","StatInput","prependEle","getStatNamePretty","getStatValueWithOverride","percent","onValueChange","defaultValue","getBaseStatValue","StatDisplay","fixedUnit","getStatNameRaw","xl","CharacterTalentPane","props","skillDisplayProps","ReactionDisplay","tText","SkillDisplayCard","talentKey","subtitle","asc","enabled","onClickTitle","ReactionComponents","superconduct_hit","electro","cryo","electrocharged_hit","hydro","overloaded_hit","pyro","pyro_swirl_hit","swirlEleToDisplay","setele","DropdownButton","element","shattered_hit","information","OverlayTrigger","Tooltip","crystalize_hit","crystalizeEleToDisplay","charEleKey","eleInterArr","ElementToReactionKeys","includes","Ele","anemo","geo","talentLimits","talentLevelKeys","header","talentLvlKey","talentLvlKeyRaw","levelBoost","newTalentLevelKey","talentStats","getTalentStats","statsEle","talentSheet","Subtitle","createContext","CustomMenu","React","forwardRef","ref","children","labeledBy","minWidth","aria-labelledby","Children","toArray","child","initialCharacter","hitMode","reactionMode","baseStatOverrides","buildSettings","setFilters","statFilters","mainStatKeys","optimizationTarget","useLockedArts","useEquippedArts","ascending","auto","skill","burst","infusionAura","characterReducer","action","_getChar","CharacterDisplayCard","propCharacterKey","propCharacter","propSetCharacterKey","setCharacterKey","footer","propNewBuild","onClose","tabName","useReducer","setcompareAgainstEquipped","firstUpdate","useRef","char","current","updateChar","possibleWeapons","weaponKey","ws1","ws2","talents","newCKey","deepClone","flexArts","calculateBuild","commonPaneProps","DamageOptionsAndCalculationEle","DamageOptionsAndCalculation","CharSelectDropdown","faTimes","Provider","Tab","Container","defaultActiveKey","mountOnEnter","unmountOnExit","Nav","fill","Link","eventKey","Content","Pane","HeaderIconDisplay","thumbImg","allCharacterKeys","CharDropdownItem","ElementalData","eleKey","DropdownItem","getFormulaTargetsDisplayHeading","startsWith","subkey","split","num","ConditionalSelector","conditional","conditionalValue","setConditional","conditionalNum","conditionalStateKey","states","values","evalIfFunc","maxStack","badge","whiteSpace","stateKey","condial","v","stack","faCheckSquare","faSquare","ConditionalDisplay","fieldClassName","Conditional","resolve","conditionalStats","conditionalFields","displayFields","condV","layeredAssignment","deletePropPath","objClearEmpties","section","talentText","setEffectText","setStats","setNumStats","setStatsFields","setEffectDocument","cardbg","sectionKey","sectionValues","JSON","stringify","DisplayStatDiff","label","val","oldVal","oldText","diffText","isArray","Formula","invalid","characterHP","characterDEF","characterATK","weaponATK","labelVariant","hasOverride","restProps","pointerEvents","faUndo","infusionVals","uncoloredEleIcons","InfusionAuraDropdown","isMelee","ReactionToggle","s","HitModeToggle","m","CalculationDisplay","fieldIndex","FormulaCalculationField","fieldKeys","subFormulaKeys","getPrintableFormulaStatKeyList","GetDependencies","modifiers","reverse","printStat","Collapse","subKey","expand","formulaField","fieldFixed","fieldUnit","fieldFormula","fieldFormulaDependency","fieldValue","ContextAwareToggle","callback","currentEventKey","AccordionContext","decoratedOnClick","useAccordionToggle","expanded","faWindowMinimize","faWindowMaximize","href","rel","immunityStatKey","elementImmunity"],"mappings":"kMAae,SAASA,EAAT,GAAoJ,IAAvHC,EAAsH,EAAtHA,MAAOC,EAA+G,EAA/GA,SAA+G,IAArGC,iBAAqG,MAAzF,GAAyF,MAArFC,gBAAqF,aAAnEC,aAAmE,SAApDC,EAAoD,EAApDA,YAAoD,IAAvCC,kBAAuC,SAAnBC,EAAmB,EAAnBA,IAAKC,EAAc,EAAdA,IAAc,EACtIC,mBAAS,IAD6H,mBACzJC,EADyJ,KAClJC,EADkJ,KAE1JC,EAAaC,uBACjB,WACE,GAAIP,GAAwB,KAAVI,EAAc,OAAOT,OAASa,GAChD,GAAc,KAAVJ,EAAc,OAAOT,EAAS,GAClC,IAAMc,EAAYX,EAAQY,WAAaC,SACvChB,EAASc,EAAUL,MAErB,CAACT,EAAUS,EAAON,EAAOE,IAI3B,OAFAY,qBAAU,wBAAMP,EAAQ,iBAACX,QAAD,IAACA,OAAD,EAACA,EAAOmB,kBAAR,QAAsB,MAAK,CAACnB,EAAOW,IAEpD,cAAC,IAAD,CACLX,MAAOU,EACPU,aAAW,eACXlB,UAAS,0BAAqBA,GAC9BmB,KAAK,SACLhB,YAAaA,EACbJ,SAAU,SAACqB,GAAD,OAAYX,EAASW,EAAEC,OAAOvB,QACxCwB,OAAQZ,EACRT,SAAUA,EACVsB,UAAW,SAACH,GAAD,MAAsB,UAAVA,EAAEI,KAAmBd,KAC5CL,IAAKA,EACLC,IAAKA,M,iCCrCF,SAASmB,EAAoB3B,EAAe4B,GACjD,OAAQA,GACN,IAAK,IAAK,OAAQC,KAAKC,MAAc,GAAR9B,GAAc,IAAI+B,QAAQ,GAAK,IAC5D,IAAK,MAAO,OAAO/B,EAAM+B,QAAQ,GAAK,IACtC,QAAS,OAAOF,KAAKC,MAAM9B,GAAO+B,QAAQ,IAIvC,SAASC,EAAYhC,EAAe4B,GACzC,OAAQA,GACN,IAAK,IAAK,OAAQC,KAAKC,MAAc,GAAR9B,GAAc,IAAI+B,QAAQ,GACvD,IAAK,MAAO,OAAO/B,EAAM+B,QAAQ,GACjC,QAAS,OAAOF,KAAKC,MAAM9B,GAAO+B,QAAQ,IAZ9C,qE,iCCAA,8EAKO,SAASE,EAAT,GAAuD,IAAbC,EAAY,EAAZA,SAC/C,OAAO,mCAAGC,IAASC,eAAeC,MAAM,SAACC,EAAGC,GAC1C,OAAID,EAAIC,GAAW,EACfD,EAAIC,EAAU,EAEX,KACLC,KAAI,SAAAC,GAAY,OAAI,cAACC,EAAD,CAAiCD,aAAcA,EAAcP,SAAUA,GAApDO,QAE7C,SAASC,EAAT,GAAmD,IAA3BD,EAA0B,EAA1BA,aAAcP,EAAY,EAAZA,SAC9BS,EAAiBC,YAAWC,IAAeC,IAAIL,GAAe,CAACA,IACrE,OAAKE,EACE,cAAC,IAASI,KAAV,CAAeC,QAAS,kBAAMd,EAASO,IAAvC,SAAuDE,EAAeM,eADjD,O,iCCf9B,gHASe,SAASC,EAAT,GAAiN,IAAD,IAAxLC,EAAwL,EAAxLA,MAAOC,EAAiL,EAAjLA,MAAOC,EAA0K,EAA1KA,cAAeC,EAA2J,EAA3JA,SAA2J,IAAjJpD,iBAAiJ,MAArI,MAAqI,EACvNqD,EAAyBC,qBAAWC,iCACpCC,EAASJ,GAAsBD,EAC/BM,EAAUC,mBAAQ,yBAAMF,IAAK,OAAGP,QAAH,IAAGA,GAAH,UAAGA,EAAOQ,eAAV,aAAG,OAAAR,EAAiBO,MAAgB,CAACP,EAAOO,IACzEG,GAAgB,OAALV,QAAK,IAALA,OAAA,EAAAA,EAAOW,QAAS,EAC3BC,EAAWH,mBAAQ,WACvB,GAAIT,EAAMnD,MAAO,OAAOgE,IAAUC,oBAAoBd,EAAO,QAASO,GACjE,GAAIP,EAAMe,QAAS,CAAC,IAAD,IAClBC,EAAM,UAAGH,IAAUC,oBAAoBd,EAAO,UAAWO,UAAnD,iBAAG,EAAyD,UAA5D,aAAG,SAA8DA,GAE3E,GAAIH,GAA0BF,GAAmC,kBAAXc,EAAqB,CAAC,IAAD,kBACrEC,EAAmBjB,EAAMnD,MAAQmD,EAAMnD,MAApB,UAA4BmD,EAAMe,eAAlC,iBAA4B,OAAAf,EAAgBE,UAA5C,iBAA4B,EAAiC,UAA7D,aAA4B,SAAsCA,GACzD,oBAArBe,IACTA,EAAmBnD,SAAQ,UAACmD,SAAD,iBAAC,EAAmBf,UAApB,iBAAC,EAAmCtB,eAApC,aAAC,SAA6C8B,KAC3E,IAAIQ,EAAOF,EAASC,EACpBD,EAAS,qDAAOC,SAAP,aAAO,EAAkBrC,QAAQ8B,UAAjC,QAA8CO,EAAkBC,EAAO,uBAAMnE,UAAWmE,EAAO,EAAI,eAAiB,cAA7C,eAA+DA,EAAO,EAAI,IAAM,IAAQ,OAAJA,QAAI,IAAJA,GAAA,UAAAA,EAAMtC,eAAN,oBAAAsC,EAAgBR,KAAaQ,EAAjH,OAAiI,MAEnN,OAAOF,KAER,CAACZ,EAAwBM,EAAUR,EAAeF,EAAOO,IAEtDY,EAAYV,mBAAQ,kBAAMI,IAAUC,oBAAoBd,EAAO,OAAQO,KAAQ,CAACP,EAAOO,IACvFa,EAAeX,mBAAQ,kBAAMI,IAAUC,oBAAoBd,EAAO,UAAWO,KAAQ,CAACP,EAAOO,IAE7Fc,EAAqBZ,mBAAQ,WACjC,IAAMa,EAAmBT,IAAUC,oBAAoBd,EAAO,cAAeO,GAC7E,OAAOe,EAAmB,cAAC,IAAD,CACxBC,UAAU,MACVC,QAAS,cAAC,IAAD,CAASC,GAAG,gBAAZ,SAA6BH,IAFd,SAIxB,cAAC,IAAD,CAAiBI,KAAMC,IAAkB5E,UAAU,OAAO6E,MAAO,CAAEC,OAAQ,YACzD,OACnB,CAAC7B,EAAOO,IAEL9B,EAAOgC,mBAAQ,kBAAMI,IAAUC,oBAAoBd,EAAO,OAAQO,KAAQ,CAACP,EAAOO,IAExF,OAAKC,EACE,eAAC,IAAUZ,KAAX,CAAgBkC,QAAS7B,EAAQ,EAAI,aAAe,eAAgBlD,UAAWA,EAA/E,UACL,iCAAM,4BAAIoE,IAAeE,KACzB,uBAAMtE,UAAS,sCAAiCqE,GAAhD,2BAAkER,QAAlE,IAAkEA,GAAlE,UAAkEA,EAAUhC,eAA5E,aAAkE,OAAAgC,EAAoBF,UAAtF,QAAmGE,EAAUnC,QAH1F,O,gUChBjBsD,EAAmB,IAAIC,IAAIC,KAElB,SAASC,EAAT,GAA2J,IAAD,UAAlIC,EAAkI,EAAlIA,WAAYC,EAAsH,EAAtHA,YAAaC,EAAyG,EAAzGA,OAAQC,EAAiG,EAAjGA,SAAiG,IAAvFC,+BAAuF,MAA7D,EAA6D,MAA1DC,iBAA0D,MAA9CT,EAA8C,EAC/JU,EAAMC,YAAe,CAAC,aAAtBD,EAD+J,EAEpHnF,wBAASK,GAF2G,mBAEhKgF,EAFgK,KAE9IC,EAF8I,KAGvK7E,qBAAU,kBACRoE,EAAanD,IAAS6D,UAAUV,EAAYS,QAA0BjF,IACtE,CAACwE,EAAYS,IACf,IAAME,EAAQrD,YAAWsD,IAAcpD,IAAd,iBAAmByC,QAAnB,IAAmBA,IAAgBD,EAAanD,IAASgE,QAAQb,QAAcxE,SAA/E,aAAkB,EAA0EsF,QAAS,CAACb,EAAaD,IACtIe,EAAc,SAACC,GAAD,OAAgCnE,IAASoE,YAAYjB,EAAagB,IAEhFE,IAAYjB,EACZkB,GAAG,OAAGlB,QAAH,IAAGA,IAAeO,EACrBnD,GAAiBC,YAAWC,IAAeC,IAAf,iBAAmB2D,SAAnB,IAAmBA,QAAnB,EAAmBA,GAAKC,gBAAxB,QAAoC,IAAK,QAACD,SAAD,IAACA,QAAD,EAACA,GAAKC,WACjF,IAAKD,GAAK,OAAO,KAZsJ,IAc/J7B,GAA8D6B,GAA9D7B,GAAI+B,GAA0DF,GAA1DE,QAASC,GAAiDH,GAAjDG,SAAUC,GAAuCJ,GAAvCI,MAAOC,GAAgCL,GAAhCK,YAAaC,GAAmBN,GAAnBM,SAAUC,GAASP,GAATO,KACvDC,GAAgBpF,KAAKtB,IAAIsB,KAAKrB,IAAIkF,EAAoC,EAAXkB,IAAeC,IAC1EK,GAAc,sBAAMhH,UAAW+G,KAAkBJ,GAAQ,cAAgB,GAA3D,SAAgElF,YAAmB,UAACwF,IAASC,cAAcN,GAAaF,GAAUK,WAA/C,QAAiE,EAAGI,IAAKC,YAAYR,OAhBrB,GAiB1HK,IAASI,sBAAsBd,GAAKd,GAAzE6B,GAjB+J,GAiB/JA,kBAAmBC,GAjB4I,GAiB5IA,cACrBC,GAAkC,IAAlBD,GAChBE,IAA6B,OAAdhF,SAAc,IAAdA,QAAA,EAAAA,GAAgBiF,MAAOjF,GAAeM,aAAe,iCAAM,cAAC,IAAD,CAAiB4B,KAAMgD,MAA7B,IAA8CjC,EAA9C,qDACpEkC,IAAgB,OAAL7B,QAAK,IAALA,OAAA,EAAAA,EAAO8B,YAAYpB,MAAY,qBAC1CqB,GAAQ,OAAG/B,QAAH,IAAGA,OAAH,EAAGA,EAAOgC,YAAYtB,IAC9BuB,GAAcF,GAAW,cAAC,IAAD,CAC7BtD,UAAU,MACVC,QAAS,cAAC,IAAD,CAASC,GAAG,mBAAZ,SAAgCoD,KAFZ,SAI7B,cAAC,IAAD,CAAiBnD,KAAMsD,QACL,KACdC,GAAU,OAAGnC,QAAH,IAAGA,OAAH,EAAGA,EAAOmC,WACpBC,GAAUpC,GAASmC,IAAc,cAAC,IAAD,CAASxD,GAAG,kBAAZ,SACpC0D,OAAOC,KAAKH,IAAY5F,KAAI,SAAAgG,GAAS,OAAI,uBAAsBtI,UAAU,YAAhC,UACxC,oBAAIA,UAAU,OAAd,SAAqB,cAAC,IAAD,CAAO+E,QAAQ,UAAf,SAA0BW,EAAE,eAAgB,CAAE6C,OAAQD,QAC3E,4BAAIvC,EAAMyC,cAAcF,OAF2BA,QAKjDG,GAAaN,GAAU,cAAC,IAAD,CAC3B3D,UAAU,MACVC,QAAS0D,GAFkB,SAI3B,cAAC,IAAD,CAAiBxD,KAAMsD,QACL,KAEpB,OAAQ,eAAC,IAAD,CAAMjI,UAAU,QAAQ0I,OAAM,UAAKhC,GAAL,QAAqBiC,GAAG,eAAeC,KAAM,YAA3E,UACN,cAAC,IAAKC,OAAN,CAAa7I,UAAU,MAAvB,SACE,eAAC,IAAD,WACE,cAAC,IAAD,CAAK8I,GAAI,EAAGC,GAAI,EAAhB,SACE,cAAC,IAAD,CAAOC,IAAG,iBAAEjD,QAAF,IAAEA,OAAF,EAAEA,EAAOkD,UAAUxC,WAAnB,QAA+B,GAAIzG,UAAS,4BAAuB0G,GAAvB,YAA2CwC,WAAS,MAE5G,eAAC,IAAD,CAAKlJ,UAAU,OAAf,UACE,6BAAI,mCAAS4H,GAAT,IAAoBI,QACxB,gCAAK,cAAC,IAAD,CAAkBvB,QAASA,KAAW,6CAAcE,SACzD,8BAAK,gCAAO,cAAC,IAAD,CAAOwC,MAAOzC,iBAIhC,eAAC,IAAK0C,KAAN,CAAWpJ,UAAU,0BAArB,UACE,cAAC,IAAKqJ,MAAN,UACE,iDAAMtD,QAAN,IAAMA,OAAN,EAAMA,EAAO2B,YAAb,QAAqB,eAArB,IAAsCe,QAExC,oBAAIzI,UAAU,OAAd,SACE,8BAAImH,IAAKmC,YAAY1C,IAArB,IAAoCI,QAEtC,cAAC,IAAD,CAAKhH,UAAU,OAAf,SACG6G,GAASvE,KAAI,SAACiH,EAAeC,GAAO,IAAD,MAClC,IAAKD,EAAKzJ,MAAO,OAAO,KACxB,IAAI2J,EAAQ,oBAAGF,EAAKG,aAAR,aAAG,EAAYC,cAAf,QAAyB,EACjCC,EAAU,UAAGL,EAAKK,kBAAR,QAAsB,EAChCC,EAAa,GAAmB,GAAbD,EACnBE,EAAW3C,IAAKmC,YAAYC,EAAK/H,KACrC,OAAQ,eAAC,IAAD,CAAasH,GAAI,GAAjB,UACN,cAAC,IAAD,CAAO/D,QAAS0E,EAAQ,UAAMA,EAAN,QAAuB,SAAUzJ,UAAU,mBAAnE,SAAsF,4BAAIyJ,GAAsB,QAAiB,IACjI,uBAAMzJ,UAAS,eAAUyJ,EAAV,QAAf,UAA0CK,EAA1C,WAAwDrI,YAAoB8H,EAAKzJ,MAAOqH,IAAKC,YAAYmC,EAAK/H,UAC9G,sBAAMxB,UAAU,cAAc6E,MAAO,CAAEkF,QAASF,GAAhD,SAA+DN,EAAK/H,KAAOiE,EAAUuE,IAAIT,EAAK/H,KAAOC,YAAoBmI,EAAY,OAAS,QAH9HJ,QAOtB,sBAAKxJ,UAAU,UAAf,UACE,eAAC,IAAD,WACE,cAAC,IAAD,UAAM,gCAAQ0F,EAAR,8CACN,cAAC,IAAD,CAAKoD,GAAG,OAAR,SAAe,cAAC,IAAD,CAAchJ,MAAOwH,GAAmB2C,MAAOzC,UAE/DF,KAAsBC,IAAiB,eAAC,IAAD,WACtC,cAAC,IAAD,UAAM,gCAAQ7B,EAAR,8CACN,cAAC,IAAD,CAAKoD,GAAG,OAAR,SAAe,cAAC,IAAD,CAAchJ,MAAOyH,GAAe0C,MAAOzC,gBAKhE,cAAC,IAAK0C,OAAN,CAAalK,UAAU,OAAvB,SACE,eAAC,IAAD,CAAKA,UAAU,4CAAf,UACGsG,GAAW,cAAC,IAAD,CAAKwC,GAAG,OAAR,SACV,eAAC,IAAD,WACE,cAAC,IAASqB,OAAV,CAAiBC,KAAK,KAAKpK,UAAU,YAArC,SAAkDyH,KAClD,eAAC,IAAS4C,KAAV,WACE,eAAC,IAASxH,KAAV,CAAeC,QAAS,kBAAMqD,EAAY,KAA1C,UAA+C,cAAC,IAAD,CAAiBxB,KAAMgD,MAAtE,gBACA,cAAC,IAAS2C,QAAV,IACA,cAAC,IAAD,CAAgCtI,SAAUmE,YAGvC,cAAC,IAAD,CAAK2C,GAAG,OAAR,SAAe,4BAAIrB,OAC5B,cAAC,IAAD,CAAKqB,GAAG,OAAR,SACE,eAAC,IAAD,WACGxC,GAAW,cAAC,IAAD,CAAgB9B,UAAU,MACpCC,QAAS,cAAC,IAAD,CAASC,GAAG,oBAAZ,SAAiCgB,EAAjC,2CADC,SAEV,sBAAM1F,UAAU,iBAAhB,SACE,cAAC,IAAD,CAAQoK,KAAK,KAAKtH,QAAS,kBAAMb,IAASsI,aAAa7F,IAAKoC,KAA5D,SACE,cAAC,IAAD,CAAiBnC,KAAMmC,GAAO0D,IAASC,IAAYzK,UAAU,gBAG/C,OACjBsF,GAAU,cAAC,IAAD,CAAQP,QAAQ,OAAOqF,KAAK,KACvCtH,QAASwC,EADE,SAEX,cAAC,IAAD,CAAiBX,KAAM+F,IAAQ1K,UAAU,cAExCuF,GAAY,cAAC,IAAD,CAAQR,QAAQ,SAASqF,KAAK,KAC3CtH,QAASyC,EADI,SAEb,cAAC,IAAD,CAAiBZ,KAAMgG,IAAY3K,UAAU,2B,8FCjJ5C,SAAS4K,EAAT,GAA+C,IAAvB9K,EAAsB,EAAtBA,MAAOmK,EAAe,EAAfA,MAAe,EACjB,kBAAVnK,EAC9B,CAAC,GAAD,OAAI6B,KAAKkJ,MAAc,IAAR/K,GAAgB,EAA/B,QAAwCA,EAAM+B,QAAQ,GAAK,KAAO,CAAC,YAAa/B,GAFvB,mBACtDgL,EADsD,KAC1ClC,EAD0C,KAI3D,OADKqB,IAAOa,EAAa,UAClB,cAAC,IAAD,CAAO/F,QAAS+F,EAAY9K,UAA0B,cAAf8K,EAA6B,GAAK,mBAAzE,SAA8FlC,M,8aCSjGmC,EAAgB,CAAEjC,GAAI,GAAIC,GAAI,EAAGiC,GAAI,GAgF5BC,MAjEf,YAAiL,IAAD,EAA/IC,EAA+I,EAA/IA,OAAQC,EAAuI,EAAvIA,UAAwB5I,EAA+G,EAA5H4I,UAAa5I,aAAgBY,EAA+F,EAA/FA,cAAeC,EAAgF,EAAhFA,SAAUkD,EAAsE,EAAtEA,SAAU8E,EAA4D,EAA5DA,kBAAmBC,EAAyC,EAAzCA,UAC/HC,EAAUC,cAEV/H,EAASJ,GAAsBD,EAC/BqC,EAAuB,iBAAGhC,QAAH,IAAGA,OAAH,EAAGA,EAAOgC,+BAAV,QAAqC,EAC5DgG,EAAW9H,mBAAQ,kBAAMF,GAASM,IAAU2H,mBAAmBjI,EAAO0H,KAAS,CAAC1H,EAAO0H,IACvFQ,EAAO/K,uBACX,SAAAgL,GAAK,OAAIL,EAAQM,KAAK,CACpBC,SAAU,YACVC,YAAaH,MACJ,CAACL,IACRS,EAAiBrJ,YAAWsD,IAAcgG,SAAU,IAXoH,EAcxJC,cAAbC,EAdqK,oBAe9KlL,qBAAU,kBAAMiB,IAASkK,aAAaD,MAEtC,IAAME,EAAYzL,uBAAY,WACvB0L,OAAOC,QAAQ,gEACflJ,IACLA,EAASmJ,mBAAqBtK,IAASuK,eAAejK,EAAca,EAASmJ,mBAC5D,OAAjBnB,QAAiB,IAAjBA,KAAoB,CAAEjK,KAAM,cAC3B,CAACoB,EAAca,EAAUgI,IAEtBqB,EAAc9L,uBAAY,WACzB0L,OAAOC,QAAQ,kEACpBrK,IAASuK,eAAejK,EAAc6F,OAAOsE,YAAYC,IAAYrK,KAAI,SAAAsK,GAAI,MAAI,CAACA,EAAM,SACvE,OAAjBxB,QAAiB,IAAjBA,KAAoB,CAAEjK,KAAM,cAC3B,CAACoB,EAAc6I,IAClB,OAAK5H,EACE,qCACL,eAACqJ,EAAA,EAAD,CAAM7M,UAAU,aAAa2I,GAAG,eAAeC,KAAM,YAArD,UACE,cAACiE,EAAA,EAAKzD,KAAN,UACE,cAAC0D,EAAA,EAAD,CAA4B5B,SAAQC,YAAWhI,gBAAeC,WAAU2J,iBAAkBvB,EAAUlF,eAEtG,eAACuG,EAAA,EAAK3C,OAAN,WACG9G,EAAW,cAAC4J,EAAA,EAAD,CAAQlK,QAASsJ,EAAjB,sDAAiF9F,GAAY,cAAC0G,EAAA,EAAD,CAAQlK,QAAS2J,EAAjB,mCACxGQ,QAAQzH,IAA4B,cAAC0H,EAAA,EAAD,CAAOlN,UAAU,mCAAmC+E,QAAQ,SAA5D,SAAsE,6DAAgCS,aAG/I,eAAC2H,EAAA,EAAD,CAAKnN,UAAU,QAAf,UACE,cAACoN,EAAA,EAAD,2BAASrC,GAAT,IAAwB/K,UAAU,qBAAlC,SACG+L,GAAkB3D,OAAOiF,QAAQrH,IAAckC,WAAW6D,EAAgBvI,EAAM8J,aAAahL,KAAI,qCAAE4D,EAAF,KAAUqH,EAAV,YAChG,eAACV,EAAA,EAAD,CAAmB7M,UAAU,mBAAmB2I,GAAG,eAAeC,KAAM,YAAxE,UACE,cAACiE,EAAA,EAAKhE,OAAN,2BAAckD,QAAd,IAAcA,OAAd,EAAcA,EAAiB7F,GAAQwB,YAAvC,QAA+C,KAC/C,cAACmF,EAAA,EAAKzD,KAAN,CAAWpJ,UAAU,YAArB,SACIuN,EAAqBjL,KAAI,SAAAgG,GAAS,OAAI,cAACkF,EAAA,EAAD,CAAiDtH,SAAQoC,YAAWnF,gBAAeC,WAAUgI,oBAAmB9E,YAAzFJ,EAASoC,UAHjEpC,SAQdmF,EACCsB,IAAYrK,KAAI,SAAAmE,GACd,IAAMF,EAAM8E,EAAUoC,MAAK,SAAAlH,GAAG,OAAIA,EAAIE,UAAYA,KAClD,OAAOwG,QAAQ1G,IAAQ,wBAAC6G,EAAA,EAAD,2BAASrC,GAAT,IAAwBvJ,IAAKiF,EAASzG,UAAU,SACrE,cAACmF,EAAA,EAAD,CAAcE,YAAakB,QAE1BoG,IAAYrK,KAAI,SAAAmE,GAAO,iBAC1BwG,QAAO,OAACzJ,QAAD,IAACA,GAAD,UAACA,EAAO+I,yBAAR,aAAC,EAA2B9F,KAAa,wBAAC2G,EAAA,EAAD,2BAASrC,GAAT,IAAwBvJ,IAAG,OAAEgC,QAAF,IAAEA,GAAF,UAAEA,EAAO+I,yBAAT,aAAE,EAA2B9F,GAAUzG,UAAU,SAC1H,cAACmF,EAAA,EAAD,CAAcC,WAAU,OAAE5B,QAAF,IAAEA,GAAF,UAAEA,EAAO+I,yBAAT,aAAE,EAA2B9F,GAAUjB,wBAAyBA,EAAyBF,OAAQ,wBAAMoG,EAAI,OAAClI,QAAD,IAACA,GAAD,UAACA,EAAO+I,yBAAR,aAAC,EAA2B9F,iBA9BtJ,M,0GC3BN,SAASiH,EAAT,GAA8M,IAAD,EAA5KjL,EAA4K,EAA5KA,eAAgBkL,EAA4J,EAA5JA,YAAarH,EAA+I,EAA/IA,SAAU6E,EAAqI,EAArIA,UAAqI,IAA1HA,UAAayC,EAA6G,EAA7GA,cAAmCxC,GAA0E,EAA9FzE,MAA8F,EAAvFkH,UAAuF,EAA1EzC,mBAAmBjI,EAAuD,EAAvDA,cAAeC,EAAwC,EAAxCA,SAC5K0K,EAAQ1K,GAAsBD,EACpC,IAAK2K,EAAO,OAAO,KAFuM,IAGlNC,EAASD,EAATC,KACFC,EAAaF,EAAMG,aACnBC,EAAgBzL,EAAeyL,cACrC,OAAO,eAACf,EAAA,EAAD,WACL,cAACC,EAAA,EAAD,CAAKtE,GAAI,GAAIC,GAAI,EAAjB,SAEE,eAAC8D,EAAA,EAAD,CAAMlE,GAAG,eAAeC,KAAM,YAAoB5I,UAAU,OAA5D,UACE,cAAC6M,EAAA,EAAKsB,IAAN,CAAUnF,IAAKvG,EAAe2L,QAASpO,UAAU,iBACjD,eAAC6M,EAAA,EAAKzD,KAAN,WACE,+BAAK3G,EAAeiF,KAApB,IAA2B2G,IAASL,GAApC,IAAiD,cAACM,EAAA,EAAD,CAAOtF,IAAG,UAAEuF,IAAOC,mBAAT,aAAE,EAAqBN,GAAgBlO,UAAU,mBAC5G,6BAAI,cAAC,IAAD,CAAOmJ,MAAO1G,EAAegM,KAAMC,SAAO,MAC9C,yCAAY5K,IAAU6K,eAAexD,MACrC,cAACgC,EAAA,EAAD,CAAKnN,UAAU,YAAf,SACG,CAAC,OAAQ,QAAS,SAASsC,KAAI,SAAAsM,GAAI,aAClC,eAACxB,EAAA,EAAD,CAAKtE,GAAI,EAAG9I,UAAU,MAAtB,UACE,cAACsO,EAAA,EAAD,CAAOtF,IAAG,UAAEvG,EAAeoM,eAAeD,EAAMd,EAAMG,qBAA5C,aAAE,EAAyDa,IAAK9O,UAAU,eAAe+O,eAAa,IAChH,oBAAI/O,UAAU,OAAd,SAAqB,cAACgP,EAAA,EAAD,CAAOjK,QAAQ,OAAOF,MAAO,CAAEoK,SAAU,WAAYC,OAAQ,IAAKC,MAAO,KAAzE,SAAgF,iCAASpB,EAAKa,GAAQ,UAF5FA,QAKrC,qBAAK5O,UAAU,cAAf,SAA6B,6BAAKyC,EAAe2M,sBACjD,cAACjC,EAAA,EAAD,CAAKnN,UAAU,OAAf,SACG,YAAIqP,MAAM,GAAGhH,QAAQ/F,KAAI,SAAAkH,GAAC,aACzB,cAAC4D,EAAA,EAAD,CAAKtE,GAAI,EAAG9I,UAAU,MAAtB,SACE,cAACsO,EAAA,EAAD,CAAOtF,IAAG,UAAEvG,EAAeoM,eAAf,uBAA8CrF,EAAI,GAAKsE,EAAMG,qBAA/D,aAAE,EAA4Ea,IAAK9O,UAAS,uBAAkB4N,EAAgBpE,EAAI,GAAK,eAA3C,mBACpGuF,eAAa,EAACjM,QAAS,kBAAMwD,GAAY8E,EAAkB,CAAEwC,cAAgBpE,EAAI,IAAOoE,EAAgBpE,EAAIA,EAAI,QAFnFA,gBAQ3C,eAAC4D,EAAA,EAAD,CAAKtE,GAAI,GAAIC,GAAI,EAAjB,UACE,cAACuG,GAAD,CAA6B7M,iBAAgBkL,cAAarH,WAAU6E,YAAWC,oBAAmBjI,gBAAeC,aACjH,cAACmM,GAAD,CAAsB9M,iBAAgBkL,cAAarH,WAAU6E,YAAWC,oBAAmBjI,gBAAeC,mBAKhH,SAASoM,EAAT,GAAiI,IAAtGC,EAAqG,EAArGA,MAAqG,IAA9FC,iBAA8F,MAAlF,GAAkF,EAA9ElM,EAA8E,EAA9EA,MAChD,GAAqD,IAAhD4E,OAAOC,KAAP,OAAYqH,QAAZ,IAAYA,IAAa,IAAY/F,OAAc,OAAO,KAC/D,IAAMgG,EAASC,YAAcF,EAAWlM,GACxC,OAAO,eAACqJ,EAAA,EAAD,CAAMlE,GAAG,cAAcC,KAAM,YAAoB5I,UAAU,OAA3D,UACL,cAAC6M,EAAA,EAAKhE,OAAN,CAAa7I,UAAU,YAAvB,SAAoCyP,IACpC,cAACI,EAAA,EAAD,CAAW7P,UAAU,aAAa+E,QAAQ,QAA1C,SACG4K,EAAOrN,KAAI,SAACW,EAAOuG,GAAR,OAAc,cAACxG,EAAA,EAAD,CAAcI,cAAUxC,EAAmBsC,MAAOsG,EAASvG,QAAOE,cAAeK,EAAOxD,UAAW,aAA3DwJ,WAKxE,SAASsG,EAAT,GAA8K,IAApJnC,EAAmJ,EAAnJA,YAAaO,EAAsI,EAAtIA,cAAe6B,EAAuH,EAAvHA,eAC9CC,EAAetN,YAAWuN,IAAYjE,SAAU,IACtD,OAAKgE,EAEE,eAACE,EAAA,EAAD,CAAUC,GAAIC,IAAd,UACL,cAACF,EAAA,EAAS/F,OAAV,CAAiBgG,GAAInD,IAArB,SACGW,EAAYjG,OAEf,cAACwI,EAAA,EAAS7F,KAAV,UACGgG,IAAY/N,KAAI,SAAC6G,EAAOK,EAAG8G,GAAX,OAAmB,eAAC,IAAMC,SAAP,WAClC,cAACL,EAAA,EAASM,SAAV,UAAwC,cAAC,IAAD,CAAOrH,MAAOA,KAA9B,OAASA,GAChCf,OAAOiF,QAAQ4C,IAAYQ,iBAAiBT,EAAc9B,IAAgBwC,QAAO,uCAAkCC,SAAWxH,KAAO7G,KAAI,mCAAEd,EAAF,KAAOoP,EAAP,YACxI,cAACV,EAAA,EAASrN,KAAV,CAAyBC,QAAS,kBAAMiN,EAAe,MAAOvO,IAA9D,SACGoP,EAAUlJ,MADOlG,MAIpBgI,IAAM8G,EAAI3G,OAAS,GAAM,cAAEuG,EAAA,EAAS5F,QAAX,MAP4BnB,WAPnC,KA6B5B,SAASmG,GAAT,GAAqL,IAApJ7M,EAAmJ,EAAnJA,eAAgBkL,EAAmI,EAAnIA,YAAarH,EAAsH,EAAtHA,SAAU6E,EAA4G,EAA5GA,UAAwB0F,EAAoF,EAAjG1F,UAAa0F,OAAUzF,EAA0E,EAA1EA,kBAAmBjI,EAAuD,EAAvDA,cAAeC,EAAwC,EAAxCA,SAEpI0K,EAAQ1K,GAAsBD,EAC5BwD,EAAqBkK,EAArBlK,MAAOkH,EAAcgD,EAAdhD,UACTkC,EAAiBpP,uBAAY,SAACa,EAAK1B,GACvC,GAAY,QAAR0B,EAAe,CACjB,GAAI1B,IAAU+Q,EAAOrP,IAAK,OACrB,IAEKsP,EAAsB3F,EAAtB2F,yBACDA,EAAkBD,OACzBzF,EAAkB,CAAE0F,sBAGxBD,EAAOrP,GAAO1B,EACdsL,EAAkB,CAAEyF,OAAQA,MAC3B,CAAC1F,EAAW0F,EAAQzF,IAEjB2F,EAAWpQ,uBAAY,SAACqQ,GAC5BA,EAAWC,YAAMD,EAAU,EAAG,IAC9B,IAAMnD,EAAYqD,IAAkBC,WAAU,SAAAC,GAAO,OAAIJ,GAAYI,KACrErB,EAAe,QAASiB,GACxBjB,EAAe,YAAalC,KAC3B,CAACkC,IAEEsB,EAAiBH,IAAkBC,WAAU,SAAAC,GAAO,OAAc,KAAVzK,GAAgBA,IAAUyK,KAAW,EAC7FE,EAAe3Q,uBAAY,WAC/B,IAAM4Q,EAAiBL,IAAkBC,WAAU,SAAAC,GAAO,OAAc,KAAVzK,GAAgBA,IAAUyK,KACtDrB,EAAe,YAA7ClC,IAAc0D,EAA4C1D,EAAY,EACzC0D,KAChC,CAACxB,EAAgBlC,EAAWlH,IAE/B,IAAKmH,EAAO,OAAO,KAEnB,IAAM0D,EAAa7D,EAAY8D,gBACzBvD,EAAgBzL,EAAeyL,cAC/BwD,EAAuB/D,EAAYgE,iBAAiBhL,EAAOkH,GAC3D+D,EAAsBjE,EAAYkE,gBAAgBlL,EAAOkH,GACzDiE,EAAoBnE,EAAYoE,YAChCC,EAAmBrE,EAAYnK,MAAMsK,GACrCmE,EAAWtE,EAAYsE,SAC7B,OAAO,eAACpF,EAAA,EAAD,CAAMlE,GAAG,eAAeC,KAAM,YAAoB5I,UAAU,OAA5D,UACL,cAAC6M,EAAA,EAAKhE,OAAN,UACE,cAACsE,EAAA,EAAD,UACE,cAACC,EAAA,EAAD,UACG9G,EAAW,eAAC4L,EAAA,EAAD,WACV,eAAC9B,EAAA,EAAD,CAAaD,GAAI+B,IAAWC,QAA5B,UACE,cAACrC,EAAD,CAAgBnC,YAAaA,EAAaO,cAAeA,EAAe6B,eAAgBA,IACxF,eAACG,EAAA,EAAD,CAAUC,GAAIC,IAAd,UACE,eAACF,EAAA,EAAS/F,OAAV,CAAiBgG,GAAInD,IAArB,wBAAyC6D,EAAOuB,YAAc,KAC9D,eAAClC,EAAA,EAAS7F,KAAV,WACE,cAAC6F,EAAA,EAASM,SAAV,UACE,8DAEF,cAACN,EAAA,EAAS5F,QAAV,IACC,YAAI+E,MAAM,GAAGhH,QAAQ/F,KAAI,SAAAd,GAAG,OAC3B,cAAC0O,EAAA,EAASrN,KAAV,CAAyBC,QAAS,kBAAMiN,EAAe,cAAevO,IAAtE,8BACiBA,EAAM,IADHA,eAM5B,cAAC0Q,EAAA,EAAWC,QAAZ,UACE,cAACD,EAAA,EAAWG,KAAZ,UAAiB,+CAEnB,cAACH,EAAA,EAAWI,OAAZ,UACE,cAACzS,EAAA,EAAD,CAAmBM,iBAAaS,EAAWb,SAAUgR,EAAUjR,MAAO6G,EAAOrG,IAAK,EAAGD,IAAK,OAE5F,cAAC6R,EAAA,EAAWI,OAAZ,UACE,cAACtF,EAAA,EAAD,CAAQ/M,UAAWoR,EAAgBvO,QAASwO,EAA5C,SAA0D,wCAAWJ,IAAkBrD,UAEzF,cAACuC,EAAA,EAAD,CAAaD,GAAI+B,IAAWI,OAA5B,SACE,eAACpC,EAAA,EAAD,CAAUC,GAAIC,IAAd,UACE,cAACF,EAAA,EAAS/F,OAAV,CAAiBgG,GAAInD,IAArB,0BACA,cAACkD,EAAA,EAAS7F,KAAV,UACGkI,IAAgBjQ,KAAI,YAAe,IAAD,mBAAZkQ,EAAY,KAARrC,EAAQ,KAE3BsC,EADYD,IAAOtB,IAAkBf,GACnB,cAAUqC,GAAV,cAAwBA,EAAxB,YAA8BtB,IAAkBf,IACxE,OAAO,cAACD,EAAA,EAASrN,KAAV,CAAmCC,QAAS,WAAQiN,EAAe,QAASyC,GAAKzC,EAAe,YAAaI,IAA7G,SAAqHsC,GAArH,UAAuBD,EAAvB,YAA6BrC,iBAK9B,gDAItB,cAACtD,EAAA,EAAKzD,KAAN,UACE,eAAC+D,EAAA,EAAD,CAAKnN,UAAU,QAAf,UACE,eAACoN,EAAA,EAAD,CAAKtE,GAAI,GAAIC,GAAI,EAAGiC,GAAI,EAAxB,UACE,cAACsD,EAAA,EAAD,CAAOtF,IAAK2E,EAAYmB,IAAK9O,UAAS,4BAAuB2N,EAAYgD,OAAnC,QAAiDzH,WAAS,IAChG,gCAAQyE,EAAY+E,iBAEtB,eAACtF,EAAA,EAAD,WACE,qBAAIpN,UAAU,OAAd,UAAsB2N,EAAYjG,KAAlC,QAA6CuI,IAAYtB,eAAekC,GAAxE,IAAkFiB,GAAqB,eAAC9C,EAAA,EAAD,CAAOjK,QAAQ,OAAf,wBAAkC8L,EAAOuB,YAAc,QAC9J,qBAAKpS,UAAU,OAAf,SAAsB,cAAC,IAAD,CAAOmJ,MAAOwE,EAAYgD,WAChD,6BAAKmB,IACL,qBAAK9R,UAAU,OAAf,SAAuB8R,GAAqBnE,EAAYgF,mBAAmB7E,KAC3E,cAAC0B,EAAD,CAAiBC,MAAO,aAAcC,UAAS,aAAIkD,IAAKlB,GAAuBF,EAAaA,EAAaI,OAAsBhR,GAAa4C,MAAOsK,IACnJ,cAAC0B,EAAD,CAAiBC,MAAO,cAAeC,UAAWsC,EAAkBxO,MAAOsK,IAC1EmE,EAAW,cAACY,EAAA,EAAD,CAAuBC,SAAUb,EAAU9O,gBAAeC,WAAUgI,oBAAmB9E,aAAiB,gBAgB9H,SAASiJ,GAAT,GAAgJ,IAAtH9M,EAAqH,EAArHA,eAAgBkL,EAAqG,EAArGA,YAAarH,EAAwF,EAAxFA,SAAU6E,EAA8E,EAA9EA,UAAWC,EAAmE,EAAnEA,kBAAmBjI,EAAgD,EAAhDA,cAAeC,EAAiC,EAAjCA,SAAiC,EAC/G7C,oBAAS,GADsG,mBACtIwS,EADsI,KAC7HC,EAD6H,OAErGzS,oBAAS,GAF4F,mBAEtI0S,EAFsI,KAExHC,EAFwH,OAGvG3S,oBAAS,GAH8F,mBAGtI4S,EAHsI,KAGzHC,EAHyH,KAKvIC,EAAiB,CAAC,SAAU,YAAa,WAAY,YAAa,SAClEC,EAAkB,CAAC,UAAW,WAAY,YAChDA,EAAgB1H,KAAhB,MAAA0H,EAAwBD,GACxB,IAAME,EAAe,CAAC,KAAM,MAAO,MAAO,OAAQ,MAAO,QACzDA,EAAa3H,KAAb,MAAA2H,EAAqBF,GACrB,IAAMG,EAAuB,GAE7B,CAAC,YAAD,mBAAgBC,MAAaC,SAAQ,SAAAC,GACnCH,EAAc5H,KAAd,UAAsB+H,EAAtB,UACAH,EAAc5H,KAAd,UAAsB+H,EAAtB,aAEFH,EAAc5H,KAAK,UAAW,WAAY,aAAc,UAExD,IAAMgI,EAAe,CACnB,cAAe,mBACf,eAAgB,oBAChB,gBAAiB,qBACjB,aAAc,kBACd,aAAc,kBACd,OAAQ,WAAY,UAAW,gBAE3BC,EAAqBpR,EAAeqR,mBAAmB3I,EAAU0C,WACjEkG,EAAqBtR,EAAeuR,sBAAsB7I,EAAU0C,WACpEoG,EAAsB9M,IAAKC,YAAYyM,GAEvCK,EAAuB,CAAE/I,YAAWhI,gBAAeC,WAAUkD,YACnE,OAAO,qCACL,eAACuG,EAAA,EAAD,CAAMlE,GAAG,eAAeC,KAAM,YAAoB5I,UAAU,OAA5D,UACE,cAAC6M,EAAA,EAAKhE,OAAN,UACE,eAACsE,EAAA,EAAD,WACE,cAACC,EAAA,EAAD,UACE,qDAED9G,EAAW,cAAC8G,EAAA,EAAD,CAAKtE,GAAG,OAAR,SACV,cAACkE,EAAA,EAAD,CAAQjI,QAASgO,EAAU,SAAW,OAAQjQ,QAAS,kBAAMkQ,GAAYD,IAAU3I,KAAK,KAAxF,SACE,iCAAM,cAAC,IAAD,CAAiBzF,KAAMoO,EAAUoB,IAASzJ,MAAhD,IAA4DqI,EAAU,OAAS,cAE1E,UAGZA,EACC,cAAClG,EAAA,EAAKzD,KAAN,UACE,cAAC+D,EAAA,EAAD,CAAKnN,UAAU,OAAf,SACGuT,EAAajR,KAAI,SAAA8R,GAAO,OACvB,cAAChH,EAAA,EAAD,CAAKpC,GAAI,EAAGlC,GAAI,GAAhB,SACE,cAACuL,EAAA,EAAD,CACEC,gBAAY1T,EACZX,cAAUW,EACVZ,UAAU,OACV0H,KAAM,iCAAO2G,IAAS+F,GAAhB,IAA2BjN,IAAKoN,kBAAkBH,MACxDjU,YAAW,eAAUgH,IAAKmC,YAAY8K,IACtCtU,MAAOgE,IAAU0Q,yBAAyBrJ,EAAW1I,EAAgBkL,EAAayG,GAClFK,QAAuC,MAA9BtN,IAAKC,YAAYgN,GAC1BM,cAAe,SAAA5U,GAAK,OAAIsL,EAAkB,CAAEjK,KAAM,eAAgBiT,UAAStU,QAAO2C,iBAAgBkL,iBAClGgH,aAAc7Q,IAAU8Q,iBAAiBzJ,EAAW1I,EAAgBkL,EAAayG,MAV5DA,UAe/B,cAACvH,EAAA,EAAKzD,KAAN,UACE,eAAC+D,EAAA,EAAD,CAAKnN,UAAU,OAAf,UACGsT,EAAgBhR,KAAI,SAAA8R,GAAO,OAAI,cAAChH,EAAA,EAAD,CAAKtE,GAAI,GAAIkC,GAAI,EAAjB,SAAmC,cAAC6J,EAAA,EAAD,aAAapS,eAAgBA,EAAgBkL,YAAaA,EAAayG,QAASA,GAAaF,KAAvGE,MACzD,eAAChH,EAAA,EAAD,CAAKpC,GAAI,EAAGlC,GAAI,GAAhB,UACE,iCAAM,6CAAN,IAA0B,iCAAO+K,GAAsBxF,IAASwF,GAAtC,IAA4D1M,IAAKmC,YAAYuK,SACvG,sBAAM7T,UAAS,cAAf,mBAAoC+T,EAAmBlS,QAAQsF,IAAK2N,UAAUjB,KAA9E,OAAqGI,gBAM/G,eAACpH,EAAA,EAAD,CAAMlE,GAAG,eAAeC,KAAM,YAAoB5I,UAAU,OAA5D,UACE,cAAC6M,EAAA,EAAKhE,OAAN,UACE,eAACsE,EAAA,EAAD,WACE,cAACC,EAAA,EAAD,UACE,iDAED9G,GAAY,cAAC8G,EAAA,EAAD,CAAKtE,GAAG,OAAR,SACX,cAACkE,EAAA,EAAD,CAAQjI,QAASkO,EAAe,SAAW,OAAQnQ,QAAS,kBAAMoQ,GAAiBD,IAAe7I,KAAK,KAAvG,SACE,iCAAM,cAAC,IAAD,CAAiBzF,KAAMsO,EAAekB,IAASzJ,MAArD,IAAiEuI,EAAe,OAAS,mBAKhGA,EACC,cAACpG,EAAA,EAAKzD,KAAN,UACE,cAAC+D,EAAA,EAAD,CAAKnN,UAAU,OAAf,SACGwT,EAAclR,KAAI,SAAA8R,GAAO,OACxB,cAAChH,EAAA,EAAD,CAAKpC,GAAI,EAAGlC,GAAI,GAAhB,SACE,cAACuL,EAAA,EAAD,CACErU,UAAU,OACV0H,KAAM,iCAAO2G,IAAS+F,GAAhB,IAA2BjN,IAAKmC,YAAY8K,MAClDjU,YAAW,eAAUgH,IAAK4N,eAAeX,IACzCtU,MAAOgE,IAAU0Q,yBAAyBrJ,EAAW1I,EAAgBkL,EAAayG,GAClFK,QAAuC,MAA9BtN,IAAKC,YAAYgN,GAC1BM,cAAe,SAAA5U,GAAK,OAAIsL,EAAkB,CAAEjK,KAAM,eAAgBiT,UAAStU,QAAO2C,iBAAgBkL,iBAClGgH,aAAc7Q,IAAU8Q,iBAAiBzJ,EAAW1I,EAAgBkL,EAAayG,MAR5DA,UAa/B,cAACvH,EAAA,EAAKzD,KAAN,UACE,cAAC+D,EAAA,EAAD,CAAKnN,UAAU,OAAf,SAAuBwT,EAAclR,KAAI,SAAA8R,GAAO,OAAI,cAAChH,EAAA,EAAD,CAAKtE,GAAI,GAAIkC,GAAI,EAAjB,SAAmC,cAAC6J,EAAA,EAAD,aAAapS,eAAgBA,EAAgBkL,YAAaA,EAAayG,QAASA,GAAaF,KAAvGE,aAInF,eAACvH,EAAA,EAAD,CAAMlE,GAAG,eAAeC,KAAM,YAAoB5I,UAAU,OAA5D,UACE,cAAC6M,EAAA,EAAKhE,OAAN,UACE,eAACsE,EAAA,EAAD,WACE,cAACC,EAAA,EAAD,UACE,gDAED9G,GAAY,cAAC8G,EAAA,EAAD,CAAKtE,GAAG,OAAR,SACX,cAACkE,EAAA,EAAD,CAAQjI,QAASoO,EAAc,SAAW,OAAQrQ,QAAS,kBAAMsQ,GAAgBD,IAAc/I,KAAK,KAApG,SACE,iCAAM,cAAC,IAAD,CAAiBzF,KAAMwO,EAAcgB,IAASzJ,MAApD,IAAgEyI,EAAc,OAAS,mBAK9FA,EACC,cAACtG,EAAA,EAAKzD,KAAN,UACE,cAAC+D,EAAA,EAAD,CAAKnN,UAAU,OAAf,SACG4T,EAAatR,KAAI,SAAA8R,GAAO,OACvB,cAAChH,EAAA,EAAD,CAAK4H,GAAI,EAAGlM,GAAI,GAAhB,SACE,cAACuL,EAAA,EAAD,CACErU,UAAU,OACV0H,KAAM,iCAAO2G,IAAS+F,GAAhB,IAA2BjN,IAAKmC,YAAY8K,MAClDjU,YAAW,eAAUgH,IAAK4N,eAAeX,IACzCtU,MAAOgE,IAAU0Q,yBAAyBrJ,EAAW1I,EAAgBkL,EAAayG,GAClFK,QAAuC,MAA9BtN,IAAKC,YAAYgN,GAC1BM,cAAe,SAAA5U,GAAK,OAAIsL,EAAkB,CAAEjK,KAAM,eAAgBiT,UAAStU,QAAO2C,iBAAgBkL,iBAClGgH,aAAc7Q,IAAU8Q,iBAAiBzJ,EAAW1I,EAAgBkL,EAAayG,MAR5DA,UAa/B,cAACvH,EAAA,EAAKzD,KAAN,UACE,cAAC+D,EAAA,EAAD,CAAKnN,UAAU,OAAf,SAAuB4T,EAAatR,KAAI,SAAA8R,GAAO,OAAI,cAAChH,EAAA,EAAD,CAAKtE,GAAI,GAAIkC,GAAI,EAAjB,SAAmC,cAAC6J,EAAA,EAAD,aAAapS,eAAgBA,EAAgBkL,YAAaA,EAAayG,QAASA,GAAaF,KAAvGE,gB,2CC9VvE,SAASa,GAAoBC,GAAkC,IACpEzS,EAAkHyS,EAAlHzS,eADmE,EAC+CyS,EAAlG/J,UAAa0C,EADsC,EACtCA,UAAWD,EAD2B,EAC3BA,cAAiBtH,EAAyD4O,EAAzD5O,SAAU8E,EAA+C8J,EAA/C9J,kBAAmBhI,EAA4B8R,EAA5B9R,SAAUD,EAAkB+R,EAAlB/R,cAGlGgS,EAAiB,2BAAQD,GAAR,IAAerH,cAChCC,EAAQ1K,GAAsBD,EACpC,OAAO,qCACL,cAACgK,EAAA,EAAD,UAAK,cAACC,EAAA,EAAD,UAAK,cAACgI,GAAD,CAAuB3S,iBAAgBW,WAAUD,sBAC3D,eAACgK,EAAA,EAAD,WANqB,CAAC,CAAC,OAAQ,yBAA0B,CAAC,QAAS,mBAAoB,CAAC,QAAS,oBAQ/E7K,KAAI,mCAAEsM,EAAF,KAAQyG,EAAR,YAClB,cAACjI,EAAA,EAAD,CAAgBtE,GAAI,GAAIC,GAAI,EAAGiC,GAAI,EAAGhL,UAAU,OAAhD,SACE,cAACsV,GAAD,2BACMH,GADN,IAEEI,UAAW3G,EACX4G,SAAUH,MAJJzG,QAOTnM,EAAeoM,eAAe,SAA9B,OAAwCf,QAAxC,IAAwCA,OAAxC,EAAwCA,EAAOG,eAAiB,cAACb,EAAA,EAAD,CAAKtE,GAAI,GAAIC,GAAI,EAAGiC,GAAI,EAAGhL,UAAU,OAArC,SACjE,cAACsV,GAAD,2BACMH,GADN,IAEEI,UAAU,SACVC,SAAS,6BAIf,cAACrI,EAAA,EAAD,UAvBsE,CAAC,CAAC,WAAY,0BAA2B,GAAI,CAAC,WAAY,0BAA2B,GAAI,CAAC,WAAY,sBAAuB,IAyBnL7K,KAAI,YAAyB,IAAD,mBAAtBsM,EAAsB,KAAhByG,EAAgB,KAATI,EAAS,KACpCC,EAAU7H,GAAa4H,EAC3B,OAAKhT,EAAeoM,eAAeD,EAA9B,OAAoCd,QAApC,IAAoCA,OAApC,EAAoCA,EAAOG,cACzC,cAACb,EAAA,EAAD,CAAgBvI,MAAO,CAAEkF,QAAS2L,EAAU,EAAI,IAAO5M,GAAI,GAAIC,GAAI,EAAG/I,UAAU,OAAhF,SACL,cAACsV,GAAD,2BACMH,GADN,IAEEI,UAAW3G,EACX4G,SAAUH,MAJGzG,GADqD,UAU1E,cAACzB,EAAA,EAAD,UACE,cAACC,EAAA,EAAD,UACE,qBAAIpN,UAAU,cAAd,+BAA+C4N,SAGnD,cAACT,EAAA,EAAD,CAAKnN,UAAU,QAAf,SAEG,YAAIqP,MAAM,GAAGhH,QAAQ/F,KAAI,SAAAkH,GACxB,IAAIoF,EAAI,uBAAmBpF,EAAI,GAC/B,OAAO,cAAC4D,EAAA,EAAD,CAAatE,GAAI,GAAIC,GAAI,EAAG/I,UAAU,OAC3C6E,MAAO,CAAEkF,QAAS6D,EAAgBpE,EAAI,EAAI,IADrC,SAEL,cAAC8L,GAAD,2BACMH,GADN,IAEEI,UAAW3G,EACX4G,SAAQ,2BAAsBhM,EAAI,GAClCmM,aAAc,kBAAMrP,GAAY8E,EAAkB,CAAEwC,cAAgBpE,EAAI,IAAOoE,EAAgBpE,EAAIA,EAAI,SAN1FA,WAazB,IAAMoM,GAAqB,CACzBC,iBAyBF,YAAsC,IAAD,EAATrS,EAAS,EAATA,MACpBoJ,EAAO,mBACb,OAAO,cAACC,EAAA,EAAD,CAAMlE,GAAG,cAAcC,KAAM,YAA7B,SAAiD,cAACiE,EAAA,EAAKzD,KAAN,CAAWpJ,UAAU,MAArB,SACtD,uBAAMA,UAAU,oBAAhB,UAAqCmH,IAAKmC,YAAYsD,GAAtD,IAA8DyB,IAASyH,QAAvE,IAAiFzH,IAAS0H,KAA1F,IAAgG,2CAASvS,EAAMoJ,UAAf,aAAS,EAAa/K,QAAQsF,IAAK2N,UAAUlI,cA3B/IoJ,mBA8BF,YAAwC,IAAD,EAATxS,EAAS,EAATA,MACtBoJ,EAAO,qBACb,OAAO,cAACC,EAAA,EAAD,CAAMlE,GAAG,cAAcC,KAAM,YAA7B,SAAiD,cAACiE,EAAA,EAAKzD,KAAN,CAAWpJ,UAAU,MAArB,SACtD,uBAAMA,UAAU,sBAAhB,UAAuCmH,IAAKmC,YAAYsD,GAAxD,IAAgEyB,IAASyH,QAAzE,IAAmFzH,IAAS4H,MAA5F,IAAmG,2CAASzS,EAAMoJ,UAAf,aAAS,EAAa/K,QAAQsF,IAAK2N,UAAUlI,cAhClJsJ,eAmCF,YAAoC,IAAD,EAAT1S,EAAS,EAATA,MAClBoJ,EAAO,iBACb,OAAO,cAACC,EAAA,EAAD,CAAMlE,GAAG,cAAcC,KAAM,YAA7B,SAAiD,cAACiE,EAAA,EAAKzD,KAAN,CAAWpJ,UAAU,MAArB,SACtD,uBAAMA,UAAU,kBAAhB,UAAmCmH,IAAKmC,YAAYsD,GAApD,IAA4DyB,IAASyH,QAArE,IAA+EzH,IAAS8H,KAAxF,IAA8F,2CAAS3S,EAAMoJ,UAAf,aAAS,EAAa/K,QAAQsF,IAAK2N,UAAUlI,cArC7IwJ,eA+CF,YAA+B,IAAD,EAAT5S,EAAS,EAATA,MAAS,EACNjD,mBAAS6H,OAAOC,KAAKgO,IAAmB,IADlC,mBACrB1C,EADqB,KAChB2C,EADgB,KAEtB1J,EAAI,UAAM+G,EAAN,cACV,OAAO,cAAC9G,EAAA,EAAD,CAAMlE,GAAG,cAAcC,KAAM,YAA7B,SAAiD,eAACiE,EAAA,EAAKzD,KAAN,CAAWpJ,UAAU,MAArB,UACtD,cAACuW,GAAA,EAAD,CAAgBnM,KAAK,KAAKqF,MAAO4G,GAAkB1C,GAAM3T,UAAU,iBAAiB+E,QAAQ,UAA5F,SACGqD,OAAOiF,QAAQgJ,IAAmB/T,KAAI,mCAAEd,EAAF,KAAOgV,EAAP,YAAoB,cAACtG,EAAA,EAASrN,KAAV,CAAyBC,QAAS,kBAAMwT,EAAO9U,IAA/C,SAAsDgV,GAAlChV,QAEjF,uBAAMxB,UAAS,eAAU2T,EAAV,QAAf,cAAqC,2CAASnQ,EAAMoJ,UAAf,aAAS,EAAa/K,QAAQsF,IAAK2N,UAAUlI,eArDpF6J,cAwDF,YAAmC,IAAD,EAATjT,EAAS,EAATA,MACjBoJ,EAAO,gBACP8J,EAAc,cAACC,GAAA,EAAD,CAClBnS,UAAU,MACVC,QAAS,eAACmS,GAAA,EAAD,CAASlS,GAAG,kBAAZ,6CAA8D,sBAAM1E,UAAU,WAAhB,wBAFrD,SAIlB,cAAC,IAAD,CAAiB2E,KAAMC,IAAkBC,MAAO,CAAEC,OAAQ,YAE5D,OAAO,cAAC+H,EAAA,EAAD,CAAMlE,GAAG,cAAcC,KAAM,YAA7B,SAAiD,cAACiE,EAAA,EAAKzD,KAAN,CAAWpJ,UAAU,MAArB,SACtD,uBAAMA,UAAU,iBAAhB,UAAkCmH,IAAKmC,YAAYsD,GAAnD,IAA2DyB,IAAS4H,MAApE,IAA4E5H,IAAS0H,KAArF,KAA4F,wBAAO/V,UAAU,gBAAjB,yBAA8C0W,EAA9C,OAA5F,IAAgK,2CAASlT,EAAMoJ,UAAf,aAAS,EAAa/K,QAAQsF,IAAK2N,UAAUlI,cAhE/MiK,eA0EF,YAAoC,IAAD,EAATrT,EAAS,EAATA,MAAS,EACXjD,mBAAS6H,OAAOC,KAAKyO,IAAwB,IADlC,mBAC1BnD,EAD0B,KACrB2C,EADqB,KAE3B1J,EAAe,YAAR+G,EAAoB,iBAApB,UAA0CA,EAA1C,mBACb,OAAO,cAAC9G,EAAA,EAAD,CAAMlE,GAAG,cAAcC,KAAM,YAA7B,SAAiD,eAACiE,EAAA,EAAKzD,KAAN,CAAWpJ,UAAU,MAArB,UACtD,cAACuW,GAAA,EAAD,CAAgBnM,KAAK,KAAKqF,MAAOqH,GAAuBnD,GAAM3T,UAAU,iBAAiB+E,QAAQ,UAAjG,SACGqD,OAAOiF,QAAQyJ,IAAwBxU,KAAI,mCAAEd,EAAF,KAAOgV,EAAP,YAAoB,cAACtG,EAAA,EAASrN,KAAV,CAAyBC,QAAS,kBAAMwT,EAAO9U,IAA/C,SAAsDgV,GAAlChV,QAEtF,uBAAMxB,UAAS,eAAU2T,EAAV,QAAf,cAAqC,2CAASnQ,EAAMoJ,UAAf,aAAS,EAAa/K,QAAQsF,IAAK2N,UAAUlI,gBA/EtF,SAASwI,GAAT,GAA0K,IAA/I3S,EAA8I,EAA9IA,eAAgBW,EAA8H,EAA9HA,SAAUD,EAAoH,EAApHA,cAC7C2K,EAAQ1K,GAAsBD,EACpC,IAAK2K,EAAO,OAAO,KACnB,IAAMiJ,EAAajJ,EAAMG,aACnB+I,EAAW,YAAQC,KAAsBF,IAAe,IAE9D,OADKC,EAAYE,SAAS,kBAAqD,aAAjCzU,EAAeyL,eAA8B8I,EAAYpL,KAAK,iBACrG,cAACiB,EAAA,EAAD,CAAMlE,GAAG,eAAeC,KAAM,YAAoB5I,UAAU,OAA5D,SACL,cAAC6M,EAAA,EAAKzD,KAAN,CAAWpJ,UAAU,YAArB,SACE,cAACmN,EAAA,EAAD,CAAKnN,UAAU,QAAf,SACGgX,EAAY1U,KAAI,SAAAd,GACf,IAAM2V,EAAMvB,GAAmBpU,GAC/B,OAAK2V,EACE,cAAC/J,EAAA,EAAD,CAAKtE,GAAG,OAAO9I,UAAU,OAAzB,SAA0C,cAACmX,EAAD,CAAK3T,MAAOsK,KAAjBtM,GAD3B,cA0B3B,IAAM6U,GAAoB,CACxB,KAAQ,iCAAOlP,IAAKmC,YAAY,kBAAxB,IAA4C+E,IAAS8H,KAArD,IAA4D9H,IAAS+I,SAC7E,QAAW,iCAAOjQ,IAAKmC,YAAY,qBAAxB,IAA+C+E,IAASyH,QAAxD,IAAkEzH,IAAS+I,SACtF,KAAQ,iCAAOjQ,IAAKmC,YAAY,kBAAxB,IAA4C+E,IAAS0H,KAArD,IAA4D1H,IAAS+I,SAC7E,MAAS,iCAAOjQ,IAAKmC,YAAY,mBAAxB,IAA6C+E,IAAS4H,MAAtD,IAA8D5H,IAAS+I,UAwBlF,IAAMN,GAAyB,CAC7B,QAAW,uBAAM9W,UAAU,kBAAhB,UAAmCmH,IAAKmC,YAAY,kBAApD,IAAwE+E,IAASyH,QAAjF,IAA2FzH,IAAS4H,MAApG,IAA4G5H,IAAS8H,KAArH,IAA4H9H,IAAS0H,KAArI,IAA4I1H,IAASgJ,OAChK,KAAQ,iCAAOlQ,IAAKmC,YAAY,uBAAxB,IAAiD+E,IAAS8H,KAA1D,IAAiE9H,IAASgJ,OAClF,QAAW,iCAAOlQ,IAAKmC,YAAY,0BAAxB,IAAoD+E,IAASyH,QAA7D,IAAuEzH,IAASgJ,OAC3F,KAAQ,iCAAOlQ,IAAKmC,YAAY,uBAAxB,IAAiD+E,IAAS0H,KAA1D,IAAiE1H,IAASgJ,OAClF,MAAS,iCAAOlQ,IAAKmC,YAAY,wBAAxB,IAAkD+E,IAAS4H,MAA3D,IAAmE5H,IAASgJ,QAavF,IAAMC,GAAe,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAaxC,SAAShC,GAAT,GAAuN,IAA3L7S,EAA0L,EAA1LA,eAA0L,IAA1K0I,UAAyBoM,GAAiJ,EAA7JvJ,WAA6J,EAAjJuJ,iBAAoBnM,EAA6H,EAA7HA,kBAAmBmK,EAA0G,EAA1GA,UAAWC,EAA+F,EAA/FA,SAAU3H,EAAqF,EAArFA,UAAW1K,EAA0E,EAA1EA,cAAeC,EAA2D,EAA3DA,SAAUkD,EAAiD,EAAjDA,SAAUqP,EAAuC,EAAvCA,aACzK7H,EAAQ1K,GAAsBD,EAClC,IAAK2K,EAAO,OAAO,KACnB,IAAI0J,EAA6B,KAE7BC,EAAe,EACnB,GAAIlC,KAAagC,EAAiB,CAAC,IAAD,EAC1BG,EAAkBH,EAAgBhC,GAClCoC,EAAkB,UAAG7J,EAAM,GAAD,OAAIyH,EAAJ,iBAAR,QAAiC,EAEzD,GADAkC,EAAeC,EAAkBC,EAC7BrR,EAAU,CAKZkR,EAAS,cAAC3K,EAAA,EAAKhE,OAAN,UACP,cAAC0N,GAAA,EAAD,CAAgB9G,MAAK,qBAAgBgI,EAAe,GAApD,SACG,YAAIpI,MAAMiI,GAAazJ,IAA4B,SAAd0H,GAAyBoC,EAAiB,EAAJ,IAAQtP,QAAQ/F,KAAI,SAAAkH,GAAC,OAC/F,cADmG,CAClG0G,EAAA,EAASrN,KAAV,CAAuBC,QAAS,kBAPR8U,EAOwCpO,EANpE+N,EAMyDhC,GANjCqC,OACxBxM,EAAkB,CAAEmM,oBAFC,IAAOK,GAOxB,wBAAgFpO,EAAImO,EAAa,IAA7EnO,eAI1BgO,EAAS,cAAC3K,EAAA,EAAKhE,OAAN,kCAA+B4O,EAAe,KAG3D,IAAMI,EAAcpV,EAAeqV,eAAevC,EAAWzH,GACvDiK,EAAWF,GAAe,cAAC1K,EAAA,EAAD,UAAK,cAACC,EAAA,EAAD,UACnC,cAACP,EAAA,EAAD,CAAMlE,GAAG,cAAcC,KAAM,YAAoB5I,UAAU,OAA3D,SACE,cAAC6P,EAAA,EAAD,CAAW7P,UAAU,aAAa+E,QAAQ,QAA1C,SACG6K,YAAciI,EAAa/J,GAAOxL,KAAI,SAACW,EAAOuG,GAAR,OACrC,cAACxG,EAAA,EAAD,CAAsBE,MAAOsG,EAASvG,QAAOE,gBAAeC,YAAzCoG,cAKrBwO,EAAcvV,EAAeoM,eAAe0G,EAAWzH,EAAMG,cAC7D6E,EAAQ,OAAGkF,QAAH,IAAGA,OAAH,EAAGA,EAAalF,SAC9B,OAAO,eAACjG,EAAA,EAAD,CAAMlE,GAAG,eAAeC,KAAM,YAAoB5I,UAAU,QAA5D,UACJwX,EACD,eAAC3K,EAAA,EAAKzD,KAAN,CAAWpJ,UAAU,QAArB,UACE,eAACmN,EAAA,EAAD,CAAKnN,UAAS,+BAA2BsG,GAAYqP,EAAgB,iBAAmB,IAAM7S,QAAS6S,EAAvG,UACE,cAACvI,EAAA,EAAD,CAAKtE,GAAG,OAAO9I,UAAU,mCAAzB,SACE,cAACsO,EAAA,EAAD,CAAOtF,IAAG,OAAEgP,QAAF,IAAEA,OAAF,EAAEA,EAAalJ,IAAK9O,UAAU,gBAE1C,eAACoN,EAAA,EAAD,CAAKpN,UAAU,cAAf,UACE,cAAC6M,EAAA,EAAKxD,MAAN,iBAAa2O,QAAb,IAAaA,OAAb,EAAaA,EAAatQ,OAC1B,cAACmF,EAAA,EAAKoL,SAAN,UAAgBzC,UAInB1C,EAAW,cAACD,EAAA,EAAD,CAAuBC,WAAU1H,oBAAmBjI,gBAAeC,WAAUkD,aAAiB,KACzGyR,Q,wBCnNMxU,GAAgC2U,6BAActX,GAErDuX,GAAaC,IAAMC,YACvB,WAAoEC,GAAc,IAA/EC,EAA8E,EAA9EA,SAAU1T,EAAoE,EAApEA,MAAO7E,EAA6D,EAA7DA,UAA8BwY,EAA+B,EAAlD,mBAC7B,OACE,qBACEF,IAAKA,EACLzT,MAAO,CAAEA,QAAO4T,SAAU,SAC1BzY,UAAWA,EACX0Y,kBAAiBF,EAJnB,SAME,cAACrL,EAAA,EAAD,UACGiL,IAAMO,SAASC,QAAQL,GAAUjW,KAAI,SAACuW,EAAOrP,GAAR,OAAc,cAAC4D,EAAA,EAAD,CAAatE,GAAI,EAAjB,SAAqB+P,GAAXrP,aAMlEsP,GAAmB,SAACvW,GAAD,MAA+B,CACtDA,aAAY,OAAEA,QAAF,IAAEA,IAAgB,GAC9BoE,MAAO,EACPkH,UAAW,EACXkL,QAAS,SACTC,aAAc,KACdzM,kBAAmBnE,OAAOsE,YAAYC,IAAYrK,KAAI,SAAAsK,GAAI,MAAI,CAACA,EAAM,QACrEkE,kBAAmB,GACnBmI,kBAAmB,GACnBC,cAAe,CACbC,WAAY,GACZC,YAAa,GACbC,aAAc,GACdC,mBAAoB,WACpB9T,wBAAyB,EACzB+T,eAAe,EACfC,iBAAiB,EACjBC,WAAW,GAEb5I,OAAQ,CACNrP,IAAK,GACLmF,MAAO,EACPkH,UAAW,EACXuE,YAAa,GAEfmF,gBAAiB,CACfmC,KAAM,EACNC,MAAO,EACPC,MAAO,GAETC,aAAc,GACdjM,cAAe,IAmBjB,SAASkM,GAAiBtZ,EAAmBuZ,GAA0C,IAAD,EACpF,GAAI,SAAUA,EAAQ,cAAQA,QAAR,IAAQA,OAAR,EAAQA,EAAQ5Y,MACpC,IAAK,YACH,OAAO,2BAAKX,GAAUuZ,EAAO5O,WAC/B,IAAK,SACH,OAAO,2BAAK3K,GAAZ,UAAsByB,IAAS+X,SAASxZ,EAAM+B,qBAA9C,QAA+D,IACjE,IAAK,eAAiB,IACZ6R,EAAiD2F,EAAjD3F,QAAStU,EAAwCia,EAAxCja,MAAO2C,EAAiCsX,EAAjCtX,eAAgBkL,EAAiBoM,EAAjBpM,YAClCsL,EAAoBzY,EAAMyY,kBAMhC,OALoBnV,IAAU8Q,iBAAiBpU,EAAOiC,EAAgBkL,EAAayG,KAC/DtU,SACXmZ,EAAkB7E,GAEzB6E,EAAkB7E,GAAWtU,EACxB,2BAAKU,GAAZ,IAAmByY,sBAKvB,OAAO,2BAAKzY,GAAUuZ,GAYT,SAASE,GAAT,GAAuO,IAAD,QAAtM1X,aAAc2X,OAAwL,MAArK,GAAqK,EAAtJC,EAAsJ,EAAjKhP,UAA2CiP,EAAsH,EAAvIC,gBAAsCC,EAAiG,EAAjGA,OAAkBC,EAA+E,EAAzFnX,SAAyF,IAAjEkD,gBAAiE,SAA/CkU,EAA+C,EAA/CA,QAASC,EAAsC,EAAtCA,QAAsC,EAC5MC,qBAAWZ,GAAkBhB,GAAiBoB,IAD8J,mBAC5O/O,EAD4O,KACjOC,EADiO,OAEvL7K,oBAAS,GAF8K,mBAE5O8C,EAF4O,KAEpNsX,EAFoN,KAG7OC,EAAcC,kBAAO,GACrB7K,EAAetN,YAAWuN,IAAYjE,SAAU,IAChDzJ,EAAY,iBAAG4X,QAAH,IAAGA,OAAH,EAAGA,EAAe5X,oBAAlB,QAAkC4I,EAAU5I,aACxDE,EAAiBC,YAAWC,KAAeC,IAAIL,GAAe,CAACA,IAC/DoL,EAAcjL,YAAWuN,IAAYrN,IAAIuI,EAAU0F,OAAOrP,KAAM,CAAC2J,EAAU0F,OAAOrP,MAClFuK,EAAiBrJ,YAAWsD,IAAcgG,SAAU,IAE1DhL,qBAAU,WAAO,IAAD,EACd,GAAKkZ,EAAL,CACA,IAAMY,EAAI,2BAAQhC,GAAiBoB,IAAzB,UAA+CjY,IAAS+X,SAASE,UAAjE,QAAsF,IAChG9O,EAAkB,CAAEjK,KAAM,YAAagK,UAAW2P,OACjD,CAACZ,IAEJlZ,qBAAU,WACR,GAAKmZ,EAAL,CACA,IAAMW,EAAI,2BAAQhC,GAAiBqB,EAAc5X,eAAkB4X,GACnE/O,EAAkB,CAAEjK,KAAM,YAAagK,UAAW2P,OACjD,CAACX,IAEJnZ,qBAAU,WAEJ4Z,EAAYG,QACdH,EAAYG,SAAU,EAIxBzU,GAAYrE,IAAS+Y,WAAW7P,KAC/B,CAACA,EAAW7E,IAGftF,qBAAU,WACR,IAAKmK,EAAU0F,OAAOrP,KAAOwO,GAAgBvN,EAAgB,CAC3D,IAAMwY,EAAkBhL,IAAYQ,iBAAiBT,EAAcvN,EAAeyL,eAE3EgN,EAHoD,YAGvC9S,OAAOiF,QAAQ4N,GAAiB9Y,MAAK,qCAAMgZ,GAAN,8BAAiBC,GAAjB,kBAA0BD,EAAIxK,OAASyK,EAAIzK,UAAQ,GAHjD,MAI3DxF,EAAU0F,OAAOrP,IAAM0Z,EACvB9P,EAAkB,CAAEyF,OAAQ1F,EAAU0F,YAEvC,CAACpO,EAAgBuN,IAEpBhP,qBAAU,WACJyB,GAAkB,YAAaA,EAAesD,QAAUoF,EAAU6C,YACpE5C,EAAkB,CAAE4C,WAAY5F,OAAOC,KAAK5F,EAAesD,MAAMsV,SAAS,OAC3E,CAAClQ,EAAU6C,WAAYvL,IAE1B,IAAM4X,EAAkB1Z,uBACtB,SAAA2a,GACE,IAAI9a,EAAQsY,GAAiBwC,GACvBR,EAAO7Y,IAAS+X,SAASsB,GAC3BR,IAAMta,EAAK,2BAAQA,GAAUsa,IACjC1P,EAAkB,CAAEjK,KAAM,YAAagK,UAAW3K,IAC9C8a,IAAY/Y,IACK,OAAnB6X,QAAmB,IAAnBA,KAAsBkB,MACvB,CAAC/Y,EAAc6I,EAAmBgP,IAEjChX,EAAWM,mBAAQ,WACvB,GAAK6W,EAAL,CACA,IAAMnX,EAAWmX,GAAgBgB,YAAUhB,GAG3C,OAFAnX,EAAS2V,QAAU5N,EAAU4N,QAC7B3V,EAAS4V,aAAe7N,EAAU6N,aAC3B5V,KACN,CAACmX,EAAcpP,EAAU4N,QAAS5N,EAAU6N,eAE5BwC,EAAarQ,EAAxBE,UAEF7F,EAAuB,iBAAGpC,QAAH,IAAGA,OAAH,EAAGA,EAAUoC,+BAAb,QAAwC,EAC/DrC,EAAgBO,mBAAQ,kBAAMjB,GAAkBkL,GAAe5B,GAAkBjI,IAAU2X,eAAetQ,EAAW1I,EAAgBkL,EAAa5B,EAAgBvG,KAA0B,CAAC2F,EAAW1I,EAAgBkL,EAAa5B,EAAgBvG,IACrP0F,GAASxH,mBAAQ,kBAAMjB,GAAkBkL,GAAe5B,GAAkB,CAAEtJ,iBAAgBkL,cAAa5B,oBAAkB,CAACtJ,EAAgBkL,EAAa5B,IACzJ2P,GAAkB,CAAEvQ,YAAW/H,WAAUD,eAAiBC,GAAYC,EAA0BF,OAAgBvC,EAAW0F,WAAU8E,oBAAmB/H,0BAC1JmY,IAAWE,GAAwBrQ,UAAYmQ,GAEnD,IAAMG,GAAiCzQ,IAAU,cAAC0Q,GAAA,EAAD,CAAmC1Q,UAAQyC,cAAaxC,YAAWC,oBAAmBhI,WAAUD,gBAAiBnD,UAAU,SAC5K,OAAQ,eAAC6M,EAAA,EAAD,CAAMlE,GAAG,cAAcC,KAAM,YAA7B,UACN,cAACiE,EAAA,EAAKhE,OAAN,UACE,eAACsE,EAAA,EAAD,WACE,cAACC,EAAA,EAAD,CAAKtE,GAAI,OAAQ9I,UAAU,UAA3B,SAEE,cAAC6b,GAAD,CAAoBpZ,eAAgBA,EAAgB0I,UAAWA,EAAWwC,YAAaA,EAAarH,SAAUA,EAAU8E,kBAAmBA,EAAmBiP,gBAAiBA,MAEhLpN,QAAQzH,IAA4B,cAAC4H,EAAA,EAAD,CAAKtE,GAAG,OAAR,SAAe,cAACoE,EAAA,EAAD,CAAOlN,UAAU,kBAAkB+E,QAAQ,SAA3C,SAAqD,6DAAgCS,SAExIpC,EAAW,cAACgK,EAAA,EAAD,CAAKtE,GAAG,OAAR,SACV,eAACsH,EAAA,EAAD,WACE,cAACpD,EAAA,EAAD,CAAQjI,QAAS1B,EAAyB,UAAY,UAAWpD,UAAWoD,EAAwBP,QAAS,kBAAM6X,GAA0B,IAA7I,SACE,8DAEF,cAAC3N,EAAA,EAAD,CAAQjI,QAAU1B,EAAqC,UAAZ,UAAuBpD,SAAUoD,EAAwBP,QAAS,kBAAM6X,GAA0B,IAA7I,SACE,8EAGG,KACR1N,QAAQuN,IAAY,cAACpN,EAAA,EAAD,CAAKtE,GAAG,OAAR,SACnB,cAACkE,EAAA,EAAD,CAAQjI,QAAQ,SAASjC,QAAS0X,EAAlC,SACE,cAAC,IAAD,CAAiB7V,KAAMmX,eAI9BvZ,GAAgB2I,IAAUzI,GAAkBkL,GAAe,cAACd,EAAA,EAAKzD,KAAN,UAC1D,cAAC7F,GAA8BwY,SAA/B,CAAwCjc,MAAOuD,EAA/C,SACE,eAAC2Y,EAAA,EAAIC,UAAL,CAAeC,iBAAkBzB,IAAqBrX,EAAW,eAAiB,aAAc+Y,cAAc,EAAMC,eAAe,EAAnI,UACE,eAACC,EAAA,EAAD,CAAKtX,QAAQ,QAAQ/E,UAAU,YAAYsc,MAAI,EAA/C,UACE,cAACD,EAAA,EAAIxZ,KAAL,UACE,cAACwZ,EAAA,EAAIE,KAAL,CAAUC,SAAS,YAAnB,SAA+B,oBAAIxc,UAAU,OAAd,2BAEhCoD,EAAW,cAACiZ,EAAA,EAAIxZ,KAAL,UACV,cAACwZ,EAAA,EAAIE,KAAL,CAAUC,SAAS,eAAnB,SAAkC,oBAAIxc,UAAU,OAAd,+BACtB,KACd,cAACqc,EAAA,EAAIxZ,KAAL,UACE,cAACwZ,EAAA,EAAIE,KAAL,CAAUC,SAAS,YAAnB,SAA+B,oBAAIxc,UAAU,OAAd,SAAsBoD,EAAW,oBAAsB,kBAExF,cAACiZ,EAAA,EAAIxZ,KAAL,UACE,cAACwZ,EAAA,EAAIE,KAAL,CAAUC,SAAS,SAAnB,SAA4B,oBAAIxc,UAAU,OAAd,4BAGhC,eAACgc,EAAA,EAAIS,QAAL,WACE,eAACT,EAAA,EAAIU,KAAL,CAAUF,SAAS,YAAnB,UACGb,GACD,cAACjO,EAAD,aAAuBjL,eAAgBA,EAAgBkL,YAAaA,GAAiB+N,QAEvF,eAACM,EAAA,EAAIU,KAAL,CAAUF,SAAS,YAAnB,UACGb,GACD,cAAC,EAAD,aAAuBzQ,OAAQA,GAAQG,eAAWzK,GAAlD,2BAAsE8a,IAAtE,IAAuFtY,cAAUxC,EAAWuC,uBAE7GC,EAAW,eAAC4Y,EAAA,EAAIU,KAAL,CAAUF,SAAS,eAAnB,UACTb,GACD,cAAC,EAAD,aAAuBzQ,OAAQA,GAAQG,eAAWzK,GAAe8a,QACrD,KACd,eAACM,EAAA,EAAIU,KAAL,CAAUF,SAAS,SAAnB,UACGb,GACD,cAAC1G,GAAD,aAAqBxS,eAAgBA,GAAoBiZ,kBAMlEpB,GAAU,cAACzN,EAAA,EAAK3C,OAAN,UACRoQ,OAaP,SAASuB,GAAT,GAA+M,IAAjLpZ,EAAgL,EAAhLA,eAAgBkL,EAAgK,EAAhKA,YAAaxC,EAAmJ,EAAnJA,UAAmJ,IAAxIA,UAAwI,IAA3H6C,kBAA2H,MAA9G,QAA8G,MAArGrH,aAAqG,MAA7F,EAA6F,MAA1FkH,iBAA0F,MAA9E,EAA8E,EAAzEvH,EAAyE,EAAzEA,SAAU8E,EAA+D,EAA/DA,kBAAmBiP,EAA4C,EAA5CA,gBAC1JsC,EAAoBla,EAAiB,iCACzC,cAAC6L,EAAA,EAAD,CAAOtF,IAAKvG,EAAema,SAAU5c,UAAU,0BAA0B+O,eAAa,IACtF,qBAAI/O,UAAU,WAAd,cAA2ByC,EAAeiF,KAA1C,UACQ,sDACJqJ,EAAWpQ,uBAAY,SAACgG,GAC5BA,EAAQsK,YAAMtK,EAAO,EAAG,IACxB,IAAMkH,EAAYqD,IAAkBC,WAAU,SAAAC,GAAO,OAAIzK,GAASyK,KAClEhG,EAAkB,CAAEzE,QAAOkH,gBAC1B,CAACzC,IACEiG,EAAiBH,IAAkBC,WAAU,SAAAC,GAAO,OAAc,KAAVzK,GAAgBA,IAAUyK,KAAW,EAC7FE,EAAe3Q,uBAAY,WAC/B,IAAM4Q,EAAiBL,IAAkBC,WAAU,SAAAC,GAAO,OAAc,KAAVzK,GAAgBA,IAAUyK,KACtDhG,EAA9ByC,IAAc0D,EAAkC,CAAE1D,UAAWA,EAAY,GACtD,CAAEA,UAAW0D,MACnC,CAACnG,EAAmByC,EAAWlH,IAClC,OAAO,mCAAGL,EAAW,eAAC4L,EAAA,EAAD,WACnB,eAAC9B,EAAA,EAAD,CAAaD,GAAI+B,IAAWC,QAA5B,UACE,eAACjC,EAAA,EAAD,CAAUC,GAAIC,IAAd,UACE,cAACF,EAAA,EAAS/F,OAAV,CAAiBgG,GAAInD,IAArB,SACG2P,IAEH,cAACzM,EAAA,EAAS7F,KAAV,CAAe8F,GAAIgI,GAAnB,SACG,YAAI,IAAIlT,IAAI4X,MAAmB1a,OAAOG,KAAI,SAAA8D,GAAO,OAAI,cAAC0W,GAAD,CAAgCva,aAAc6D,EAASiU,gBAAiBA,GAAjDjU,YAGlE,OAAd3D,QAAc,IAAdA,OAAA,EAAAA,EAAgBsD,QAAS,mBAAatD,QAAb,IAAaA,OAAb,EAAaA,EAAgBsD,QAAS,eAACmK,EAAA,EAAD,CAAUC,GAAIC,IAAd,UAC9D,cAACF,EAAA,EAAS/F,OAAV,CAAiBgG,GAAInD,IAAQhN,UAAS,eAAUgO,GAAhD,SACE,iCAAS+O,IAAc/O,GAAYtG,SAErC,cAACwI,EAAA,EAAS7F,KAAV,UACGjC,OAAOC,KAAK5F,EAAesD,MAAMsV,SAAS/Y,KAAI,SAAA0a,GAAM,OACnD,cAAC9M,EAAA,EAASrN,KAAV,CAA4B7C,UAAS,eAAUgd,GAAUla,QAAS,kBAAMsI,EAAkB,CAAE4C,WAAYgP,KAAxG,SAAmH,iCAASD,IAAcC,GAAQtV,QAA9HsV,cAI5B,cAAC9K,EAAA,EAAWC,QAAZ,UACE,cAACD,EAAA,EAAWG,KAAZ,UAAiB,+CAGnB,cAACH,EAAA,EAAWI,OAAZ,UACE,cAACzS,EAAA,EAAD,CAAmBM,iBAAaS,EAAWZ,UAAU,QAAQD,SAAUgR,EAAUjR,MAAO6G,EAAOrG,IAAK,EAAGD,IAAK,GAAIJ,UAAWwC,MAE7H,cAACyP,EAAA,EAAWI,OAAZ,UACE,cAACtF,EAAA,EAAD,CAAQ/M,UAAWoR,IAAmB5O,EAAgBK,QAASwO,EAA/D,SAA6E,wCAAWJ,IAAkBrD,UAE5G,cAACuC,EAAA,EAAD,CAAaD,GAAI+B,IAAWI,OAA5B,SACE,eAACpC,EAAA,EAAD,CAAUC,GAAIC,IAAd,UACE,cAACF,EAAA,EAAS/F,OAAV,CAAiBgG,GAAInD,IAAQ/M,UAAWwC,EAAxC,0BACA,cAACyN,EAAA,EAAS7F,KAAV,UACGkI,IAAgBjQ,KAAI,YAAe,IAAD,mBAAZkQ,EAAY,KAARrC,EAAQ,KAE3BsC,EADYD,IAAOtB,IAAkBf,GACnB,cAAUqC,GAAV,cAAwBA,EAAxB,YAA8BtB,IAAkBf,IACxE,OAAO,cAAC8M,EAAA,EAAD,CAAkCna,QAAS,kBAAMsI,EAAkB,CAAEzE,MAAO6L,EAAI3E,UAAWsC,KAA3F,SAAmGsC,GAAnG,UAAsBD,EAAtB,YAA4BrC,iBAK7B,iCAAOwM,EAAP,IAA2Bla,GAAkBkL,GAAe7J,IAAU6K,eAAexD,QAEvG,SAAS2R,GAAT,GAA8D,IAAlCva,EAAiC,EAAjCA,aAAc8X,EAAmB,EAAnBA,gBAClC5X,EAAiBC,YAAWC,KAAeC,IAAIL,GAAe,CAACA,IACrE,OAAKE,EACE,cAACyN,EAAA,EAASrN,KAAV,CAAeC,QAAS,kBAAMuX,EAAgB9X,IAAevC,UAAU,YAAvE,SACL,eAACmN,EAAA,EAAD,WACE,cAACC,EAAA,EAAD,CAAKtE,GAAG,OAAR,SAAe,cAACwF,EAAA,EAAD,CAAOtF,IAAKvG,EAAema,SAAU5c,UAAS,oCAA+ByC,EAAegM,KAA9C,QAA0DvF,WAAS,MAChI,cAACkE,EAAA,EAAD,UAAM3K,EAAeiF,YAJG,O,8FC9UvB,SAASwV,EAAgC1b,EAAzC,GAA+P,IAAvMiB,EAAsM,EAAtMA,eAAgBkL,EAAsL,EAAtLA,YAAa5B,EAAyK,EAAzKA,eAA2IiR,EAA8B,uDAAT,QAC1P,GAAY,cAARxb,EAAqB,MAAO,cAC3B,GAAY,kBAARA,EAAyB,MAAO,8BACpC,GAAY,mBAARA,EAA0B,MAAO,0BACrC,GAAIA,EAAI2b,WAAW,cAAe,CAAC,IAAD,IAC/BC,EAAS5b,EAAI6b,MAAM,cAAc,GACvC,wBAAQ5a,QAAR,IAAQA,GAAR,UAAQA,EAAgBoM,eAAeuO,EAAQJ,UAA/C,aAAQ,EAAgDtV,YAAxD,QAAgE0V,EAC3D,GAAI5b,EAAI2b,WAAW,WAAY,CAAC,IAAD,EAC9BC,EAAS5b,EAAI6b,MAAM,WAAW,GACpC,wBAAQ1P,QAAR,IAAQA,OAAR,EAAQA,EAAajG,YAArB,QAA6B0V,EACxB,GAAI5b,EAAI2b,WAAW,aAAc,CAAC,IAAD,IACd3b,EAAI6b,MAAM,KADI,mBAC7BnX,EAD6B,KACrBoX,EADqB,KAEtC,OAAO,2CAAOvR,EAAe7F,UAAtB,aAAO,EAAwBwB,KAA/B,IAAqC,eAAC,IAAD,CAAO3C,QAAQ,UAAf,UAA0BuY,EAA1B,aAE9C,MAAO,K,uLCVM,SAASC,EAAT,GAC6K,IAD9IC,EAC6I,EAD7IA,YAAaC,EACgI,EADhIA,iBAAkBC,EAC8G,EAD9GA,eAAgBhW,EAC8F,EAD9FA,KAAMzH,EACwF,EADxFA,SAAUuD,EAC8E,EAD9EA,MAC8E,cACvIia,EADuI,UAClLE,OADkL,MACjK,EADiK,EAC9JC,EAD8J,KAEzL,IAAKJ,EAAa,OAAO9V,EACzB,GAAI,WAAY8V,EAAa,CAC3B,IAAMhd,EAAQod,EAAsBJ,EAAYK,OAAOD,GAAuBxV,OAAO0V,OAAON,EAAYK,QAAQ,GAC1GjV,EAA0B,IAAnB+U,EAAuB,aAAe,iCAAOnd,EAAMkH,KAAb,IAAqBqW,YAAWvd,EAAOwd,SAAUxa,GAAmB,EAA/C,YAAyDma,EAAzD,iBAAgFA,EAAiB,EAAI,IAAM,IAAQ,MACrLM,EAAQ,cAACjP,EAAA,EAAD,CAAOjK,QAA4B,IAAnB4Y,EAAuB,YAAc,UAArD,SAAiE/U,IAC/E,OAAO,eAACsH,EAAA,EAAD,WACL,cAACA,EAAA,EAAS/F,OAAV,CAAiBC,KAAK,KAAKnK,SAAUA,EAArC,SACE,qBAAID,UAAU,gBAAgB6E,MAAO,CAAEqZ,WAAY,UAAnD,UAAgExW,EAAhE,IAAuEuW,OAEzE,eAAC/N,EAAA,EAAS7F,KAAV,WACE,cAAC6F,EAAA,EAASrN,KAAV,CAAeC,QAAS,kBAAM4a,EAAe,CAAC,KAA9C,SACE,gDAEDtV,OAAOiF,QAAQmQ,EAAYK,QAAQvb,KAAI,WAA2BkH,GAA3B,uBAAE2U,EAAF,KAAYC,EAAZ,YACtC,cAAC,IAAM7N,SAAP,UACG,YAAIlB,MAAM+O,EAAQJ,UAAU3V,QAAQ/F,KAAI,SAAA+b,GAAC,OAAIA,EAAI,KAAG/b,KAAI,SAACgc,EAAO9U,GAAR,OACvD,eAAC0G,EAAA,EAASrN,KAAV,CAAkCC,QAAS,kBAAM4a,EAAe,CAACY,EAAOH,KAAxE,UACGC,EAAQ1W,KAAM0W,EAAQJ,SAAW,EAAnB,YAA4BM,EAA5B,iBAA0CA,EAAQ,EAAI,IAAM,IAAO,KADhEH,EAAW3U,OAFdA,YAU3B,IAAMwU,EAAWD,YAAWP,EAAaQ,SAAUxa,GACnD,GAAIwa,EAAW,EAAG,CAEhB,IAAMC,EAAQ,cAACjP,EAAA,EAAD,CAAOjK,QAA4B,IAAnB4Y,EAAuB,YAAc,UAArD,SAAiEA,EAAiB,EAAjB,UAAwBA,EAAxB,iBAA+CA,EAAiB,EAAI,IAAM,IAAO,eAChK,OAAO,eAACzN,EAAA,EAAD,WACL,cAACA,EAAA,EAAS/F,OAAV,CAAiBC,KAAK,KAAKnK,SAAUA,EAArC,SACE,qBAAID,UAAU,gBAAgB6E,MAAO,CAAEqZ,WAAY,UAAnD,UAAgExW,EAAhE,IAAuEuW,OAEzE,eAAC/N,EAAA,EAAS7F,KAAV,WACE,cAAC6F,EAAA,EAASrN,KAAV,CAAeC,QAAS,kBAAM4a,EAAe,CAAC,KAA9C,SACE,gDAED,YAAIrO,MAAM2O,GAAU3V,QAAQ/F,KAAI,SAAA+b,GAAC,OAAIA,EAAI,KAAG/b,KAAI,SAAAgc,GAAK,OACpD,cAACpO,EAAA,EAASrN,KAAV,CAA2BC,QAAS,kBAAM4a,EAAe,CAACY,KAA1D,mBACMA,EADN,iBACoBA,EAAQ,EAAI,IAAM,KADlBA,YAKrB,OAAiB,IAAbN,EACF,cAAChR,EAAA,EAAD,CAAQ5C,KAAK,KAAKtH,QAAS,kBAAM4a,EAAe,CAACC,EAAiB,EAAI,KAAK1d,SAAUA,EAArF,SACL,qBAAID,UAAU,OAAd,UAAqB,cAAC,IAAD,CAAiB2E,KAAMgZ,EAAiBY,IAAgBC,MAA7E,IAA2F9W,OAI1F,K,qBC3CM,SAAS+W,EAAT,GAA6I,IAA/GjB,EAA8G,EAA9GA,YAAara,EAAiG,EAAjGA,cAAeC,EAAkF,EAAlFA,SAAUgI,EAAwE,EAAxEA,kBAAmB9E,EAAqD,EAArDA,SAAUoY,EAA2C,EAA3CA,eACxGlb,EAAQJ,GAAsBD,EAE9BM,EAAUC,mBAAQ,kBAAMib,IAAYlb,QAAQ+Z,EAAaha,KAAQ,CAACga,EAAaha,IAHoE,EAI9DE,mBAAQ,kBAAMD,GAAWkb,IAAYC,QAAQpB,EAAaha,OAAO5C,KAAY,CAAC6C,EAAS+Z,EAAaha,IAJtC,IAIjJA,MAAOqb,OAJ0I,MAIvH,GAJuH,MAInHlP,OAAQmP,OAJ2G,MAIvF,GAJuF,EAInFrB,EAJmF,EAInFA,iBAChEsB,EAAgBrb,mBAAQ,kBAAMD,GAAO,sBAAQmM,YAAciP,EAAkBrb,IAAxC,YAAmDsb,MAAoB,CAACrb,EAASob,EAAkBrb,EAAOsb,IAC/IpB,EAAiB/c,uBAAY,SAAAqe,GACjC,GAAKxb,EAAL,CAD0C,kBAEbwb,EAFa,kBAElB,EAFkB,GAM/BxB,EAAYnV,MACrB4W,YAAkBzb,EAAMsN,kBAAmB0M,EAAanV,KAAM2W,IAH9DE,YAAe1b,EAAMsN,kBAAmB0M,EAAanV,MACrD8W,YAAgB3b,EAAMsN,oBAGxB1F,EAAkB,CAAE0F,kBAAmBtN,EAAMsN,uBAC5C,CAAC0M,EAAaha,EAAO4H,IAExB,OAAK3H,GAAYD,EACV,eAACqJ,EAAA,EAAD,CAAMlE,GAAG,cAAcC,KAAM,YAAoB5I,UAAU,aAA3D,UACL,cAAC6M,EAAA,EAAKhE,OAAN,CAAa7I,UAAU,MAAvB,SACE,cAACud,EAAD,CAAqBtd,UAAWqG,EAC9BkX,YAAaA,EACbC,iBAAkBA,EAClBC,eAAgBA,EAChBhW,KAAM8V,EAAY9V,KAClBlE,MAAOA,MAEX,cAACqM,EAAA,EAAD,CAAW7P,UAAU,aAAa+E,QAAQ,QAA1C,SACGga,EAAczc,KAAI,SAACW,EAAOuG,GAAR,OAAc,cAACxG,EAAA,EAAD,CAAsBE,MAAOsG,EAASvG,QAAOE,gBAAeC,WAAUpD,UAAW0e,GAA9DlV,WAXzB,KCrBlB,SAASqJ,EAAT,GAAqH,IAA1FC,EAAyF,EAAzFA,SAAU1H,EAA+E,EAA/EA,kBAAmBjI,EAA4D,EAA5DA,cAAeC,EAA6C,EAA7CA,SAAUkD,EAAmC,EAAnCA,SACxFwH,EAAQ1K,GAAsBD,EACpC,OAAK2K,EACE,qBAAK9N,UAAU,QAAf,gBAAwB8S,QAAxB,IAAwBA,OAAxB,EAAwBA,EAAUxQ,KAAI,SAAC8c,EAAS5V,GAAO,IAAD,IAC3D,IAAK4V,EAAQ3b,QAASqK,GAAQ,OAAO,KACrC,IAAMuR,EAAatB,YAAWqB,EAAQxW,KAAMkF,GACtC6B,EAAM,UAAGyP,EAAQzP,cAAX,QAAqB,GACjC,OAAO,sBAAK3P,UAAU,OAAf,UACL,sBAAW8I,GAAI,GAAf,UACE,qBAAK9I,UAAU,OAAf,SAAuBqf,IACtB1P,EAAOhG,OAAS,GAAK,cAACkG,EAAA,EAAD,CAAW7P,UAAU,kBAArB,gBACnB2P,QADmB,IACnBA,GADmB,UACnBA,EAAQrN,WADW,aACnB,OAAAqN,GAAc,SAAC1M,EAAOuG,GAAR,OAAc,cAACxG,EAAA,EAAD,CAAsBE,MAAOsG,EAASvG,QAAOE,gBAAeC,YAAzCoG,aAGjD4V,EAAQ5B,aAAe,cAACiB,EAAD,CAA0BjB,YAAa4B,EAAQ5B,YAAara,gBAAeC,WAAUgI,oBAAmB9E,eAPlG,UAAYkD,QAL7B,O,iCChBrB,kHAkBe,SAASgE,EAAT,GAA8G,IAAlFtH,EAAiF,EAAjFA,OAAQoC,EAAyE,EAAzEA,UAAWnF,EAA8D,EAA9DA,cAAeC,EAA+C,EAA/CA,SAAUkD,EAAqC,EAArCA,SAAU8E,EAA2B,EAA3BA,kBACzFrF,EAAQrD,YAAWsD,IAAcpD,IAAIsD,GAAS,CAACA,IACrD,IAAKH,EAAO,OAAO,KAEnB,IAAMvC,EAAK,OAAGJ,QAAH,IAAGA,IAAYD,EACpBmc,EAAgBvZ,EAAMyC,cAAcF,GACpCiX,EAAWxZ,EAAMyZ,YAAYlX,EAAW9E,GACxCic,EAAiB7P,YAAc2P,EAAU/b,GACzCyO,EAAWlM,EAAM2Z,kBAAkBpX,GACzC,OAAO,qCACL,eAAC,IAAD,CAAMK,GAAG,cAAcC,KAAM,YAAoB5I,UAAU,aAA3D,UACE,eAAC,IAAK6I,OAAN,CAAa7I,UAAU,MAAvB,UACE,eAAC,IAAD,CAAO+E,QAAQ,UAAf,UAA0BuD,EAA1B,UADF,IACoDgX,KAEpD,cAAC,IAAD,CAAWtf,UAAU,aAAa+E,QAAQ,QAA1C,SACG0a,EAAend,KAAI,SAACW,EAAOuG,GAAR,OAAc,cAAC,IAAD,CAAsBtG,MAAOsG,EAASvG,QAAOE,gBAAeC,YAAzCoG,WAGxDyI,EAAW,cAAC,IAAD,CAAuBa,SAAUb,EAAU9O,gBAAeC,WAAUgI,oBAAmB9E,aAAiB,U,+HCTzG,SAASwG,EAAT,GAAuM,IAAvK5B,EAAsK,EAAtKA,OAAsK,IAA9JA,OAAUzI,EAAoJ,EAApJA,eAAgBkL,EAAoI,EAApIA,YAAexC,EAAqH,EAArHA,UAAWhI,EAA0G,EAA1GA,cAAeC,EAA2F,EAA3FA,SAAU2J,EAAiF,EAAjFA,iBAAkBzG,EAA+D,EAA/DA,SAA+D,IAArDqZ,cAAqD,MAA5C,cAA4C,EAC7M7R,EAAQ1K,GAAsBD,EACpC,OAAO,cAAC,IAAD,CAAKnD,UAAU,QAAf,SAAwBoI,OAAOiF,QAAQN,GAAkBzK,KAAI,YAAuC,IAAD,mBAApCsd,EAAoC,KAAxBC,EAAwB,KAClGrI,EAAS0F,YAAgC0C,EAAY1U,EAAb,OAAqB4C,QAArB,IAAqBA,OAArB,EAAqBA,EAAOG,cAC1E,OAAO,cAAC,IAAD,CAAsBjO,UAAU,OAAO8I,GAAI,GAAIC,GAAI,EAAGiM,GAAI,EAA1D,SACL,eAAC,IAAD,CAAMrM,GAAIgX,EAAQ/W,KAAM,YAAoB5I,UAAU,QAAtD,UACE,cAAC,IAAK6I,OAAN,UAAc2O,IACd,cAAC,IAAKpO,KAAN,UACE,cAAC,IAAD,UAAMyW,EAAcvd,KAAI,SAAA8R,GAAO,OAAI,cAAC,IAAD,CAAiD3R,iBAAgBkL,cAAaxC,YAAWhI,gBAAeC,WAAUkD,WAAU8N,WAA1G0L,KAAKC,UAAU3L,eAJzDwL,U,iCC/BrB,8GAaA,SAASI,EAAT,GAA2F,IAAD,QAA/DC,aAA+D,MAAvD,GAAuD,EAAnDC,EAAmD,EAAnDA,IAAKC,EAA8C,EAA9CA,OAA8C,IAAtCvc,aAAsC,MAA9B,EAA8B,MAA3BlC,YAA2B,MAApB,GAAoB,MAAhBqD,eAAgB,MAAN,GAAM,EAClE,qBAAXob,GAAyC,kBAARD,IAC1CC,EAASD,EACTA,OAAMtf,GAER,IAAMuD,OAAevD,IAARsf,EAAoBA,EAAMC,EAAS,EAC5CC,EAAuB,GAAIC,EAAwB,GAMvD,OALIF,GAAmB,IAAThc,EAAYic,EAAO,UAAGD,SAAH,aAAG,EAAQte,QAAQ+B,QAChChD,IAAXuf,IAAsBC,EAAO,UAAGF,SAAH,aAAG,EAAKre,QAAQ+B,IAClDwc,IAASA,EAAU,uBAAMpgB,UAAS,eAAU+E,GAAzB,UAAqCqb,EAAS1e,MACxD,IAATyC,IAAYkc,EAAW,uBAAMrgB,UAAS,eAAUmE,EAAO,EAAI,UAAY,UAAhD,UAA6DA,EAAO,EAAI,IAAM,GAA9E,OAAkFA,QAAlF,IAAkFA,OAAlF,EAAkFA,EAAMtC,QAAQ+B,GAAQlC,MAE5H,cAAC,IAAD,CAAKoH,GAAG,KAAR,SAAa,eAAC,IAAD,WAClB,cAAC,IAAD,UAAK,4BAAImX,MACT,eAAC,IAAD,CAAKnX,GAAG,OAAR,UAAgBsX,EAASjc,EAAO,IAAM,GAAIkc,UAY/B,SAASxL,EAAT,GAAgI,IAAzGpS,EAAwG,EAAxGA,eAAgBkL,EAAwF,EAAxFA,YAAaxC,EAA2E,EAA3EA,UAAWhI,EAAgE,EAAhEA,cAAeC,EAAiD,EAAjDA,SAAUkD,EAAuC,EAAvCA,SAAU8N,EAA6B,EAA7BA,QACzGpQ,EAAUtB,YAAW2M,MAAMiR,QAAQlM,GAAWmM,IAAQ3d,IAAIwR,QAAWxT,EAAW,CAACwT,IADqD,EAGvF1Q,mBAAQ,WAC3D,IAAIwc,EAAKC,EAAQvc,EAAOlC,EAAMqD,EAASkb,EAAqB,GAC5D,GAAuB,kBAAZ7L,EAAsB,CAC/B,GAAIhR,GAAYD,EAAe,CAAC,IAAD,IAG7B+c,EAAG,iBAAG9c,QAAH,IAAGA,OAAH,EAAGA,EAAWgR,UAAd,QAA0B,EAC7B+L,EAAM,iBAAGhd,QAAH,IAAGA,OAAH,EAAGA,EAAgBiR,UAAnB,QAA+B,MAChC,CAAC,IAAD,IACCtG,EAAQ1K,GAAsBD,EAEpC+c,EAAG,iBAAGpS,QAAH,IAAGA,OAAH,EAAGA,EAAQsG,UAAX,QAAuB,EAE1B,IAAMoM,EAAU,WAChBL,EAAM,UAAGrc,IAAU0Q,yBAAyBrJ,EAAW1I,EAAgBkL,EAAayG,UAA9E,QAA0FoM,KACrFA,IAAYL,OAASvf,GAC5BkN,IACc,YAAZsG,EACF+L,EAASrS,EAAM2S,YACI,aAAZrM,EACP+L,EAASrS,EAAM4S,aACI,aAAZtM,IACP+L,EAASrS,EAAM6S,aAAe7S,EAAM8S,YAG1Clf,EAAOyF,IAAKC,YAAYgN,GACxBxQ,EAAQuD,IAAK2N,UAAUV,GACvB6L,EAAQ,iCAAO5R,IAAS+F,GAAhB,IAA2BjN,IAAKmC,YAAY8K,WAC/C,GAAIpQ,EAAS,CAAC,IAAD,IAOa,IANzB8J,EAAQ1K,GAAsBD,EAC9BF,EAASe,EAAgBf,MACzB4d,EAAe/c,IAAUC,oBAAoBd,EAAO,UAAW6K,GAIrE,GAHAmS,EAAQ,sBAAMjgB,UAAS,eAAU6gB,GAAzB,SAA0C/c,IAAUC,oBAAoBd,EAAO,OAAQ6K,KAC/FlK,EAAQE,IAAUC,oBAAoBd,EAAO,QAAS6K,EAAO,GAC7DoS,EAAG,UAAGpc,IAAUC,oBAAoBd,EAAO,UAAW6K,UAAnD,iBAAG,EAAyD,UAA5D,aAAG,SAA8DA,GAChE1K,GAAYD,EACdgd,EAAM,UAAGrc,IAAUC,oBAAoBd,EAAO,UAAWE,UAAnD,iBAAG,EAAiE,UAApE,aAAG,SAAsEA,GAInF,OADImD,GAAYxC,IAAUgd,YAAY3V,EAAWiJ,KAAUrP,EAAU,WAC9D,CAAEmb,MAAKC,SAAQvc,QAAOlC,OAAMqD,UAASkb,WAC3C,CAAC9U,EAAW1I,EAAgBkL,EAAaxK,EAAeC,EAAUkD,EAAU8N,EAASpQ,IAzChFkc,EAHoI,EAGpIA,IAAKC,EAH+H,EAG/HA,OAAQvc,EAHuH,EAGvHA,MAAOlC,EAHgH,EAGhHA,KAAMqD,EAH0G,EAG1GA,QAASkb,EAHiG,EAGjGA,MA2C3C,OAAO,cAACD,EAAD,CAAuBE,MAAKC,SAAQvc,QAAOlC,OAAMqD,UAASkb,MAAOA,M,wHCxC3D5L,IAzBG,SAAC,GAAD,IAAG3M,EAAH,EAAGA,KAAM4M,EAAT,EAASA,WAAYxU,EAArB,EAAqBA,MAAOK,EAA5B,EAA4BA,YAAawU,EAAzC,EAAyCA,aAAcD,EAAvD,EAAuDA,cAAvD,IAAsED,eAAtE,aAAuFxU,gBAAvF,SAA4G8gB,EAA5G,sHAChB,eAAC,IAAD,2BAAgBA,GAAhB,cACGzM,EAAa,cAAC,IAAWnC,QAAZ,UAAqBmC,IAAmC,KACtE,cAAC,IAAWnC,QAAZ,UACE,cAAC,IAAWE,KAAZ,UAAkB3K,MAEpB,cAAC,IAAD,CACExH,MAAOuU,EACPtU,YAAaA,EACbL,MAAOA,EACPC,SAAU2U,EACVzU,SAAUA,IAEZ,eAAC,IAAWqS,OAAZ,WACGrF,QAAQwH,IAAY,cAAC,IAAWpC,KAAZ,qBACHzR,IAAjB+T,GAA8B,cAAC,IAAD,CAAgBnQ,UAAU,MACvDC,QAAS,cAAC,IAAD,CAASC,GAAG,gBAAZ,uDADoB,SAE7B,sBAAM1E,UAAU,iBAAhB,SACE,cAAC,IAAD,CAAQ8C,QAAS,kBAAM4R,EAAcC,IAAe1U,SAAUA,GAAYH,IAAU6U,EAAc9P,MAAO/E,IAAU6U,EAAe,CAAEqM,cAAe,QAAW,GAA9J,SACE,cAAC,IAAD,CAAiBrc,KAAMsc,qB,2XCnB7BC,EAAe,CACnB,GAAI,wDACJ,KAAQ,iCAAQC,IAAkBhL,KAA1B,oBACR,KAAQ,iCAAQgL,IAAkBpL,KAA1B,qBAQH,SAASqL,EAAT,GAA4J,IAA5H3e,EAA2H,EAA3HA,eAA2H,IAA3G0I,UAA2G,IAA9F0O,oBAA8F,MAA/E,GAA+E,EAA3DzO,GAA2D,EAA3E7I,aAA2E,EAA3D6I,mBAAmBpL,EAAwC,EAAxCA,UACxH,OAAKyC,EAAe4e,UACb,eAAC,IAAD,CAAUrhB,UAAWA,EAArB,UACL,cAAC,IAASmK,OAAV,CAAiBpF,QAAS8U,GAAgB,YAA1C,SAAwDqH,EAAarH,KACrE,cAAC,IAASxP,KAAV,UACGjC,OAAOiF,QAAQ6T,GAAc5e,KAAI,mCAAEd,EAAF,KAAOoH,EAAP,YAAiB,cAAC,IAAS/F,KAAV,CAAyB7C,UAAS,eAAUwB,GAAOsB,QAAS,kBAAMsI,EAAkB,CAAEyO,aAAcrY,KAApG,SAA6GoH,GAAzFpH,WAJrC,KAejC,SAAS8f,EAAT,GAAyI,IAAD,IAA9GnW,UAA8G,IAAjG6N,oBAAiG,MAAlF,KAAkF,EAA5Ea,EAA4E,EAA5EA,aAAgB/L,EAA4D,EAA5DA,MAAO1C,EAAqD,EAArDA,kBAAmBpL,EAAkC,EAAlCA,UAC3G,IAAK8N,EAAO,OAAO,KACnB,IAAMiJ,EAAajJ,EAAMG,aACzB,IAAK,CAAC,OAAQ,QAAS,QAAQiJ,SAASH,KAAgB,CAAC,OAAQ,QAAS,QAAQG,SAAS2C,GAAe,OAAO,KACjH,IAAMwE,EAAI,SAAAkD,GAAC,OAAIA,EAAI,UAAY,aAC/B,OAAO,eAAC,IAAD,CAAmBvhB,UAAWA,EAAWmB,KAAK,QAAQuG,KAAK,eAAe5H,MAAOkZ,EAAcjZ,SAAU,SAAAmgB,GAAG,OAAI9U,EAAkB,CAAE4N,aAAsB,SAARkH,EAAiB,KAAOA,KAA1K,UACL,cAAC,IAAD,CAAcpgB,MAAO,OAAQiF,QAASsZ,GAAGrF,GAAzC,2BACiB,SAAfjC,GAA0C,SAAjB8C,IAA4B,cAAC,IAAD,CAAc/Z,MAAO,gBAAiBiF,QAASsZ,EAAmB,kBAAjBrF,GAAjD,SACrD,uBAAMhZ,UAAU,gBAAhB,4BAAgDqO,IAAS4H,MAAzD,IAAiE5H,IAAS8H,WAE3D,SAAfY,GAA0C,SAAjB8C,IAA4B,cAAC,IAAD,CAAc/Z,MAAO,YAAaiF,QAASsZ,EAAmB,cAAjBrF,GAA7C,SACrD,uBAAMhZ,UAAU,YAAhB,wBAAwCqO,IAAS0H,KAAjD,IAAwD1H,IAAS8H,WAElD,UAAfY,GAA2C,UAAjB8C,IAA6B,cAAC,IAAD,CAAc/Z,MAAO,iBAAkBiF,QAASsZ,EAAmB,mBAAjBrF,GAAlD,SACvD,uBAAMhZ,UAAU,gBAAhB,6BAAiDqO,IAAS8H,KAA1D,IAAiE9H,IAAS4H,YAE3D,SAAfc,GAA0C,SAAjB8C,IAA4B,cAAC,IAAD,CAAc/Z,MAAO,YAAaiF,QAASsZ,EAAmB,cAAjBrF,GAA7C,SACrD,uBAAMhZ,UAAU,YAAhB,wBAAwCqO,IAAS8H,KAAjD,IAAwD9H,IAAS0H,aAIhE,SAASyL,EAAT,GAAmE,IAA1CzI,EAAyC,EAAzCA,QAAS3N,EAAgC,EAAhCA,kBAAmBpL,EAAa,EAAbA,UACpDqe,EAAI,SAAAkD,GAAC,OAAIA,EAAI,UAAY,aAC/B,OAAO,eAAC,IAAD,CAAmBpgB,KAAK,QAAQrB,MAAOiZ,EAASrR,KAAK,aAAa3H,SAAU,SAAA0hB,GAAC,OAAIrW,EAAkB,CAAE2N,QAAS0I,KAAMzhB,UAAWA,EAA/H,UACL,cAAC,IAAD,CAAcF,MAAM,SAASiF,QAASsZ,EAAc,WAAZtF,GAAxC,sBACA,cAAC,IAAD,CAAcjZ,MAAM,MAAMiF,QAASsZ,EAAc,QAAZtF,GAArC,0BACA,cAAC,IAAD,CAAcjZ,MAAM,UAAUiF,QAASsZ,EAAc,YAAZtF,GAAzC,6BAIJ,SAAS2I,EAAT,GAOI,IAP0BxW,EAO3B,EAP2BA,OAAQ4C,EAOnC,EAPmCA,MAQ9BwF,EAAkB5P,mBAAQ,kBAAMoK,GAAShK,IAAU2H,mBAAmBqC,EAAO5C,KAAS,CAAC4C,EAAO5C,IACpG,OAAK4C,EACE,8BACJ1F,OAAOiF,QAAQiG,GAAiBhR,KAAI,YAA0C,IAAD,mBAAvCsd,EAAuC,KAA3BjQ,EAA2B,KACtE6H,EAAS0F,YAAgC0C,EAAY1U,EAAQ4C,EAAMG,cACzE,OAAO,eAAC,IAAD,CAAMtF,GAAG,cAAcC,KAAM,YAAqC5I,UAAU,aAA5E,UACL,cAAC,IAAK6I,OAAN,UAAc2O,IACd,cAAC,IAAKpO,KAAN,CAAWpJ,UAAU,MAArB,SACE,cAAC,IAAD,CAAWA,UAAU,QAArB,SACG2P,EAAOrN,KAAI,SAACW,EAAO0e,GAClB,GAAItS,MAAMiR,QAAQrd,GAChB,OAAO,cAAC2e,EAAD,CAA0CC,UAAW5e,EAAO6K,MAAOA,EAAO6T,WAAYA,GAAxDA,GAClC,GAAqB,kBAAV1e,EAAoB,CAClC,IAAM6e,EAAwB3a,IAAK4a,+BAA+BC,YAAgBlU,EAAD,OAAQA,QAAR,IAAQA,OAAR,EAAQA,EAAOmU,UAAW,CAAChf,IAA9E,OAAuF6K,QAAvF,IAAuFA,OAAvF,EAAuFA,EAAOmU,WAAWC,UACvI,OAAOjV,QAAQ6U,EAAenY,SAAW,eAAC,IAAD,CAAuBhB,GAAG,eAAeC,KAAM,YAAoB5I,UAAU,OAA7E,UACvC,cAAC,IAAUmK,OAAX,CAAkBgG,GAAItD,IAAKhE,OAAQ7I,UAAU,qBAAqB+E,QAAQ,OAAOyX,SAAQ,eAAUmF,GAAnG,SACGxa,IAAKgb,UAAUlf,EAAO6K,KAEzB,cAAC,IAAUsU,SAAX,CAAoB5F,SAAQ,eAAUmF,GAAtC,SACE,cAAC,IAAKvY,KAAN,CAAWpJ,UAAU,MAArB,SACE,qBAAKA,UAAU,QAAf,SACG8hB,EAAexf,KAAI,SAAA+f,GAAM,OACxB,oBAAGriB,UAAU,OAAb,UAAkCmH,IAAKgb,UAAUE,EAAQvU,GAAzD,MAAmE,gCAAO,cAAC,IAAD,CAAgBsG,QAASiO,EAAQ7e,MAAOsK,EAAOmU,UAAWnU,EAAMmU,UAAWK,QAAQ,QAApID,cARiBV,GAetD,OAAO,cAxB8C/B,QAJ9C,KAoCrB,SAASgC,EAAT,GAA2I,IAAD,QAAvGC,EAAuG,EAAvGA,UAAW/T,EAA4F,EAA5FA,MAAO6T,EAAqF,EAArFA,WAC7C3d,EAAUtB,YAAW6d,IAAQ3d,IAAIif,GAAY,CAACA,IACpD,IAAK7d,EAAS,OAAO,KACrB,IAAMue,EAAgBve,EAAgBf,MAChCmB,EAAYN,IAAUC,oBAAoBwe,EAAc,OAAQzU,GAChEzJ,EAAeP,IAAUC,oBAAoBwe,EAAc,UAAWzU,GACtEvJ,EAAmBT,IAAUC,oBAAoBwe,EAAc,cAAezU,GAC9E0U,EAAU,UAAG1e,IAAUC,oBAAoBwe,EAAc,QAASzU,UAAxD,QAAkE,EAC5E2U,EAAS,UAAG3e,IAAUC,oBAAoBwe,EAAc,OAAQzU,UAAvD,QAAiE,GARwD,EASzFhK,IAAUC,oBAAoBwe,EAAc,UAAWzU,EAAO,IAT2B,mBASjI4U,EATiI,KASnHC,EATmH,KAUxI,IAAKD,IAAiBC,EAAwB,OAAO,KACrD,IAAMC,EAAU,OAAGF,QAAH,IAAGA,GAAH,UAAGA,EAAe5U,UAAlB,iBAAG,EAAuBjM,eAA1B,aAAG,SAAiC2gB,GAC9CV,EAAiB3a,IAAK4a,+BAA+BC,YAAgBlU,EAAD,OAAQA,QAAR,IAAQA,OAAR,EAAQA,EAAOmU,UAAWU,GAA7E,OAAsG7U,QAAtG,IAAsGA,OAAtG,EAAsGA,EAAOmU,WAAWC,UAC/I,OAAO,eAAC,IAAD,CAAMvZ,GAAG,eAAeC,KAAM,YAAoB5I,UAAU,OAA5D,UACL,eAAC,IAAUmK,OAAX,CAAkBgG,GAAItD,IAAKhE,OAAQ7I,UAAU,qBAAqB+E,QAAQ,OAAOyX,SAAQ,eAAUmF,GAAnG,UACE,mBAAG3hB,UAAS,eAAUqE,GAAtB,SAAuCD,IADzC,IACwD,uBAAMpE,UAAU,YAAhB,UAA6B4iB,EAAYH,QAEjG,cAAC,IAAUL,SAAX,CAAoB5F,SAAQ,eAAUmF,GAAtC,SACE,cAAC,IAAKvY,KAAN,CAAWpJ,UAAU,MAArB,SACE,sBAAKA,UAAU,QAAf,UACE,oBAAGA,UAAU,OAAb,UAAoB,mBAAGA,UAAS,eAAUqE,GAAtB,SAAuCD,IAA3D,IAA0E,sBAAMpE,UAAU,YAAhB,SAA6B4iB,IAAvG,MAA4H,gCAAQre,OACnIud,EAAexf,KAAI,SAAA+f,GAAM,OACxB,oBAAGriB,UAAU,OAAb,UAAkCmH,IAAKgb,UAAUE,EAAQvU,GAAzD,MAAmE,gCAAO,cAAC,IAAD,CAAgBsG,QAASiO,EAAQ7e,MAAOsK,EAAOmU,UAAWnU,EAAMmU,UAAWK,QAAQ,QAApID,gBAQrC,IAAMQ,EAAqB,SAAC,GAA4B,IAA1BrG,EAAyB,EAAzBA,SAAUsG,EAAe,EAAfA,SAChCC,EAAkBzf,qBAAW0f,KAC7BC,EAAmBC,YACvB1G,GACA,kBAAMsG,GAAYA,EAAStG,MAEvB2G,EAAWJ,IAAoBvG,EACrC,OACE,eAAC,IAAD,CAAQ1Z,QAASmgB,EAAkBle,QAAQ,OAA3C,UACE,cAAC,IAAD,CAAiBJ,KAAMwe,EAAWC,IAAmBC,IAAkBrjB,UAAS,gBAAWmjB,EAAW,gBAAkB,MACxH,qCAAeA,EAAW,UAAY,aAiB7B,SAASvH,EAAT,GAAuN,IAAhL1Q,EAA+K,EAA/KA,OAA+K,IAAvKA,OAAUzI,EAA6J,EAA7JA,eAAgBkL,EAA6I,EAA7IA,YAAexC,EAA8H,EAA9HA,UAAwB4N,EAAsG,EAAnH5N,UAAa4N,QAAW3N,EAA2F,EAA3FA,kBAAmBhI,EAAwE,EAAxEA,SAAUD,EAA8D,EAA9DA,cAAenD,EAA+C,EAA/CA,UAE9K8N,EAAQ1K,GAAsBD,EACpC,OAAO,sBAAKnD,UAAWA,EAAhB,UACL,cAAC,IAAD,CAAM2I,GAAG,eAAeC,KAAM,YAAoB5I,UAAU,OAA5D,SACE,cAAC,IAAK6I,OAAN,UACE,eAAC,IAAD,CAAK7I,UAAU,QAAf,UACE,cAAC,IAAD,CAAK8I,GAAG,OAAR,SAAe,cAACsY,EAAD,CAAsB3e,eAAgBA,EAAgB0I,UAAWA,EAAWC,kBAAmBA,EAAmBpL,UAAU,WAC3I,cAAC,IAAD,CAAK8I,GAAG,OAAR,SAAe,cAAC0Y,EAAD,CAAezI,QAASA,EAAS3N,kBAAmBA,EAAmBpL,UAAU,WAChG,cAAC,IAAD,CAAK8I,GAAG,OAAR,SAAe,cAACwY,EAAD,CAAgBnW,UAAWA,EAAW2C,MAAOA,EAAO1C,kBAAmBA,EAAmBpL,UAAU,kBAIzH,cAAC,IAAD,UACE,eAAC,IAAD,CAAM2I,GAAG,eAAeC,KAAM,YAA9B,UACE,cAAC,IAAKC,OAAN,UACE,eAAC,IAAD,WACE,eAAC,IAAD,WACE,sBAAM7I,UAAU,UAAhB,mDACA,wGAEF,cAAC,IAAD,CAAK8I,GAAG,OAAR,SACE,cAAC+Z,EAAD,CAAoBC,cAAUliB,EAAiBuP,GAAInD,IAAUwP,SAAS,mBAI5E,cAAC,IAAU4F,SAAX,CAAoB5F,SAAS,UAA7B,SACE,eAAC,IAAKpT,KAAN,CAAWpJ,UAAU,MAArB,UACE,eAAC,IAAD,CAAMA,UAAU,OAAO2I,GAAG,cAAcC,KAAM,YAA9C,UACE,cAAC,IAAKC,OAAN,UACE,eAAC,IAAD,WACE,cAAC,IAAD,2BACA,cAAC,IAAD,CAAKC,GAAG,OAAR,SACE,cAAC,IAAD,CAAQ/D,QAAQ,UAAUqF,KAAK,KAA/B,SACE,mBAAGkZ,KAAK,2EAA2EjiB,OAAO,SAASkiB,IAAI,aAAvG,+FAKR,cAAC,IAAKna,KAAN,CAAWpJ,UAAU,MAArB,SACE,eAAC,IAAD,WACE,cAAC,IAAD,CAAK8I,GAAI,GAAIkM,GAAI,EAAGhV,UAAU,OAA9B,SACE,cAAC,IAAD,CACE0H,KAAM,4CACN5H,MAAOgE,IAAU0Q,yBAAyBrJ,EAAW1I,EAAgBkL,EAAa,cAClFxN,YAAagH,IAAK4N,eAAe,cACjCJ,aAAc7Q,IAAU8Q,iBAAiBzJ,EAAW1I,EAAgBkL,EAAa,cACjF+G,cAAe,SAAA5U,GAAK,OAAIsL,EAAkB,CAAEjK,KAAM,eAAgBiT,QAAS,aAActU,QAAO2C,iBAAgBkL,qBAGnH,CAAC,YAAD,mBAAgB8F,MAAanR,KAAI,SAAA0a,GAChC,IAAI5I,EAAO,UAAM4I,EAAN,cACPwG,EAAe,UAAMxG,EAAN,kBACfyG,EAAkB3f,IAAU0Q,yBAAyBrJ,EAAW1I,EAAgBkL,EAAa6V,GACjG,OAAO,cAAC,IAAD,CAAK1a,GAAI,GAAIkM,GAAI,EAAgBhV,UAAU,OAA3C,SACL,cAAC,IAAD,CACEsU,WAAY,eAAC,IAAD,CAAQvP,QAASiY,EAAQla,QAAS,kBAAMsI,EAAkB,CAAEjK,KAAM,eAAgBiT,QAASoP,EAAiB1jB,OAAQ2jB,EAAiBhhB,iBAAgBkL,iBAAgB3N,UAAU,mBAA/K,UACV,cAAC,IAAD,CAAiB2E,KAAM8e,EAAkBlF,IAAgBC,IAAUxe,UAAU,UADnE,eAGZ0H,KAAM,4BAAIP,IAAKmC,YAAY8K,KAC3BtU,MAAOgE,IAAU0Q,yBAAyBrJ,EAAW1I,EAAgBkL,EAAayG,GAClFjU,YAAagH,IAAK4N,eAAeX,GACjCO,aAAc7Q,IAAU8Q,iBAAiBzJ,EAAW1I,EAAgBkL,EAAayG,GACjFM,cAAe,SAAA5U,GAAK,OAAIsL,EAAkB,CAAEjK,KAAM,eAAgBiT,UAAStU,QAAO2C,iBAAgBkL,iBAClG1N,SAAUwjB,EACVhP,SAAO,KAXqBuI,MAelC,cAAC,IAAD,CAAKlU,GAAI,GAAT,SAAa,uNAInB,cAAC4Y,EAAD,CAAoBxW,OAAQA,EAAQ4C,MAAOA","file":"static/js/1.a5defcbf.chunk.js","sourcesContent":["import { useCallback, useEffect, useState } from 'react'\r\nimport FormControl from 'react-bootstrap/FormControl'\r\ntype props = {\r\n  value: number | undefined,\r\n  onChange: (newValue: number | undefined) => void,\r\n  className?: string\r\n  disabled?: boolean\r\n  float?: boolean,\r\n  placeholder?: string,\r\n  allowEmpty?: boolean,\r\n  max?: string | number,\r\n  min?: string | number,\r\n}\r\nexport default function CustomFormControl({ value, onChange, className = \"\", disabled = false, float = false, placeholder, allowEmpty = false, max, min }: props) {\r\n  const [state, setState] = useState(\"\")\r\n  const sendChange = useCallback(\r\n    () => {\r\n      if (allowEmpty && state === \"\") return onChange(undefined)\r\n      if (state === \"\") return onChange(0)\r\n      const parseFunc = float ? parseFloat : parseInt\r\n      onChange(parseFunc(state))\r\n    },\r\n    [onChange, state, float, allowEmpty],\r\n  )\r\n  useEffect(() => setState(value?.toString() ?? \"\"), [value, setState]) // update value on value change\r\n\r\n  return <FormControl\r\n    value={state}\r\n    aria-label=\"custom-input\"\r\n    className={`hide-appearance ${className}`}\r\n    type=\"number\"\r\n    placeholder={placeholder}\r\n    onChange={(e: any) => setState(e.target.value)}\r\n    onBlur={sendChange}\r\n    disabled={disabled}\r\n    onKeyDown={(e: any) => e.key === \"Enter\" && sendChange()}\r\n    max={max}\r\n    min={min}\r\n  />\r\n}","export function valueStringWithUnit(value: number, unit: string): string {\r\n  switch (unit) {\r\n    case \"%\": return (Math.round(value * 10) / 10).toFixed(1) + \"%\"\r\n    case \"eff\": return value.toFixed(2) + \"%\"\r\n    default: return Math.round(value).toFixed(0)\r\n  }\r\n}\r\n\r\nexport function valueString(value: number, unit: string): string {\r\n  switch (unit) {\r\n    case \"%\": return (Math.round(value * 10) / 10).toFixed(1)\r\n    case \"eff\": return value.toFixed(2)\r\n    default: return Math.round(value).toFixed(0)\r\n  }\r\n}\r\n","import Dropdown from \"react-bootstrap/Dropdown\";\r\nimport CharacterSheet from \"../Character/CharacterSheet\";\r\nimport { database } from \"../Database/Database\";\r\nimport { usePromise } from \"../Util/ReactUtil\";\r\n\r\nexport function CharacterSelectionDropdownList({ onSelect }) {\r\n  return <>{database._getCharKeys().sort(((a, b) => {\r\n    if (a < b) return -1;\r\n    if (a > b) return 1;\r\n    // names must be equal\r\n    return 0;\r\n  })).map(characterKey => <DropDownItem key={characterKey} characterKey={characterKey} onSelect={onSelect} />)}</>\r\n}\r\nfunction DropDownItem({ characterKey, onSelect }) {\r\n  const characterSheet = usePromise(CharacterSheet.get(characterKey), [characterKey])\r\n  if (!characterSheet) return null\r\n  return <Dropdown.Item onClick={() => onSelect(characterKey)}>{characterSheet.nameWIthIcon}</Dropdown.Item>\r\n}\r\n\r\n","import { faQuestionCircle } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport React, { useContext, useMemo } from 'react';\r\nimport { ListGroup, OverlayTrigger, Tooltip } from \"react-bootstrap\";\r\nimport Character from \"../Character/Character\";\r\nimport { compareAgainstEquippedContext } from \"../Character/CharacterDisplayCard\";\r\nimport { ICalculatedStats } from \"../Types/stats\";\r\nimport { IFieldDisplay } from \"../Types/IFieldDisplay\";\r\n\r\nexport default function FieldDisplay({ field, index, equippedBuild, newBuild, className = \"p-2\" }: { field: IFieldDisplay, index: number, equippedBuild?: ICalculatedStats, newBuild?: ICalculatedStats, className?: string }) {\r\n  const compareAgainstEquipped = useContext(compareAgainstEquippedContext)\r\n  const stats = (newBuild ? newBuild : equippedBuild)\r\n  const canShow = useMemo(() => stats ? field?.canShow?.(stats) : false, [field, stats])\r\n  const fixedVal = field?.fixed || 0\r\n  const fieldVal = useMemo(() => {\r\n    if (field.value) return Character.getTalentFieldValue(field, \"value\", stats)\r\n    else if (field.formula) {\r\n      let retVal = Character.getTalentFieldValue(field, \"formula\", stats)?.[0]?.(stats)\r\n      //compareAgainstEquipped\r\n      if (compareAgainstEquipped && equippedBuild && typeof retVal === \"number\") {\r\n        let fieldEquippedVal = field.value ? field.value : field.formula?.(equippedBuild)?.[0]?.(equippedBuild)\r\n        if (typeof fieldEquippedVal === \"function\")\r\n          fieldEquippedVal = parseInt(fieldEquippedVal?.(equippedBuild)?.toFixed?.(fixedVal))\r\n        let diff = retVal - fieldEquippedVal\r\n        retVal = <span>{fieldEquippedVal?.toFixed(fixedVal) ?? fieldEquippedVal}{diff ? <span className={diff > 0 ? \"text-success\" : \"text-danger\"}> ({diff > 0 ? \"+\" : \"\"}{diff?.toFixed?.(fixedVal) || diff})</span> : \"\"}</span>\r\n      }\r\n      return retVal\r\n    }\r\n  }, [compareAgainstEquipped, fixedVal, equippedBuild, field, stats])\r\n\r\n  const fieldText = useMemo(() => Character.getTalentFieldValue(field, \"text\", stats), [field, stats])\r\n  const fieldVariant = useMemo(() => Character.getTalentFieldValue(field, \"variant\", stats), [field, stats])\r\n\r\n  const formulaTextOverlay = useMemo(() => {\r\n    const fieldFormulaText = Character.getTalentFieldValue(field, \"formulaText\", stats)\r\n    return fieldFormulaText ? <OverlayTrigger\r\n      placement=\"top\"\r\n      overlay={<Tooltip id=\"field-formula\">{fieldFormulaText}</Tooltip>}\r\n    >\r\n      <FontAwesomeIcon icon={faQuestionCircle} className=\"ml-2\" style={{ cursor: \"help\" }} />\r\n    </OverlayTrigger> : null\r\n  }, [field, stats])\r\n\r\n  const unit = useMemo(() => Character.getTalentFieldValue(field, \"unit\", stats), [field, stats])\r\n\r\n  if (!canShow) return null\r\n  return <ListGroup.Item variant={index % 2 ? \"customdark\" : \"customdarker\"} className={className}>\r\n    <span><b>{fieldText}</b>{formulaTextOverlay}</span>\r\n    <span className={`float-right text-right text-${fieldVariant}`} >{fieldVal?.toFixed?.(fixedVal) ?? fieldVal}{unit}</span>\r\n  </ListGroup.Item>\r\n}\r\n","import { faBriefcase, faEdit, faInfoCircle, faLock, faLockOpen, faTrashAlt } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { useEffect, useState } from 'react';\r\nimport Badge from 'react-bootstrap/Badge';\r\nimport Button from 'react-bootstrap/Button';\r\nimport ButtonGroup from 'react-bootstrap/ButtonGroup';\r\nimport Card from 'react-bootstrap/Card';\r\nimport Col from 'react-bootstrap/Col';\r\nimport Dropdown from 'react-bootstrap/Dropdown';\r\nimport Image from 'react-bootstrap/Image';\r\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger';\r\nimport Row from 'react-bootstrap/Row';\r\nimport Tooltip from 'react-bootstrap/Tooltip';\r\nimport { useTranslation } from 'react-i18next';\r\nimport CharacterSheet from '../Character/CharacterSheet';\r\nimport { CharacterSelectionDropdownList } from '../Components/CharacterSelection';\r\nimport { Stars } from '../Components/StarDisplay';\r\nimport { database } from '../Database/Database';\r\nimport Stat from '../Stat';\r\nimport { allSubstats, IArtifact, Substat, SubstatKey } from '../Types/artifact';\r\nimport { CharacterKey } from '../Types/consts';\r\nimport { usePromise } from '../Util/ReactUtil';\r\nimport { valueStringWithUnit } from '../Util/UIUtil';\r\nimport Artifact from './Artifact';\r\nimport { ArtifactSheet } from './ArtifactSheet';\r\nimport SlotNameWithIcon from './Component/SlotNameWIthIcon';\r\nimport PercentBadge from './PercentBadge';\r\n\r\ntype Data = { artifactId?: string, artifactObj?: IArtifact, onEdit?: () => void, onDelete?: () => void, mainStatAssumptionLevel?: number, effFilter?: Set<SubstatKey> }\r\nconst allSubstatFilter = new Set(allSubstats)\r\n\r\nexport default function ArtifactCard({ artifactId, artifactObj, onEdit, onDelete, mainStatAssumptionLevel = 0, effFilter = allSubstatFilter }: Data): JSX.Element | null {\r\n  const { t } = useTranslation([\"artifact\"]);\r\n  const [databaseArtifact, updateDatabaseArtifact] = useState(undefined as IArtifact | undefined)\r\n  useEffect(() =>\r\n    artifactId ? database.followArt(artifactId, updateDatabaseArtifact) : undefined,\r\n    [artifactId, updateDatabaseArtifact])\r\n  const sheet = usePromise(ArtifactSheet.get((artifactObj ?? (artifactId ? database._getArt(artifactId) : undefined))?.setKey), [artifactObj, artifactId])\r\n  const equipOnChar = (charKey: CharacterKey | \"\") => database.setLocation(artifactId!, charKey)\r\n\r\n  const editable = !artifactObj // dont allow edit for flex artifacts\r\n  const art = artifactObj ?? databaseArtifact\r\n  const characterSheet = usePromise(CharacterSheet.get(art?.location ?? \"\"), [art?.location])\r\n  if (!art) return null\r\n\r\n  const { id, slotKey, numStars, level, mainStatKey, substats, lock } = art\r\n  const mainStatLevel = Math.max(Math.min(mainStatAssumptionLevel, numStars * 4), level)\r\n  const mainStatVal = <span className={mainStatLevel !== level ? \"text-orange\" : \"\"}>{valueStringWithUnit(Artifact.mainStatValue(mainStatKey, numStars, mainStatLevel) ?? 0, Stat.getStatUnit(mainStatKey))}</span>\r\n  const { currentEfficiency, maxEfficiency } = Artifact.getArtifactEfficiency(art, effFilter)\r\n  const artifactValid = maxEfficiency !== 0\r\n  const locationName = characterSheet?.name ? characterSheet.nameWIthIcon : <span><FontAwesomeIcon icon={faBriefcase} /> {t`filterLocation.inventory`}</span>\r\n  const slotName = sheet?.getSlotName(slotKey) || \"Unknown Piece Name\"\r\n  const slotDesc = sheet?.getSlotDesc(slotKey)\r\n  const slotDescEle = slotDesc ? <OverlayTrigger\r\n    placement=\"top\"\r\n    overlay={<Tooltip id=\"slotdesc-tooltip\">{slotDesc}</Tooltip>}\r\n  >\r\n    <FontAwesomeIcon icon={faInfoCircle} />\r\n  </OverlayTrigger> : null\r\n  const setEffects = sheet?.setEffects\r\n  const setDesc = sheet && setEffects && <Tooltip id=\"setdesc-tooltop\">\r\n    {Object.keys(setEffects).map(setNumKey => <span key={setNumKey} className=\"text-left\">\r\n      <h6 className=\"mb-0\"><Badge variant=\"success\">{t(`setEffectNum`, { setNum: setNumKey })}</Badge></h6>\r\n      <p>{sheet.setEffectDesc(setNumKey as any)}</p>\r\n    </span>)}\r\n  </Tooltip>\r\n  const setDescEle = setDesc ? <OverlayTrigger\r\n    placement=\"top\"\r\n    overlay={setDesc}\r\n  >\r\n    <FontAwesomeIcon icon={faInfoCircle} />\r\n  </OverlayTrigger> : null\r\n\r\n  return (<Card className=\"h-100\" border={`${numStars}star`} bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n    <Card.Header className=\"p-0\">\r\n      <Row>\r\n        <Col xs={2} md={3}>\r\n          <Image src={sheet?.slotIcons[slotKey] ?? \"\"} className={`w-100 h-auto grad-${numStars}star m-1`} thumbnail />\r\n        </Col>\r\n        <Col className=\"pt-2\">\r\n          <h6><strong>{slotName} {slotDescEle}</strong></h6>\r\n          <div><SlotNameWithIcon slotKey={slotKey} /><strong>{` +${level}`}</strong></div>\r\n          <div><small><Stars stars={numStars} /></small></div>\r\n        </Col>\r\n      </Row>\r\n    </Card.Header>\r\n    <Card.Body className=\"d-flex flex-column py-2\">\r\n      <Card.Title>\r\n        <div>{sheet?.name ?? \"Artifact Set\"} {setDescEle}</div>\r\n      </Card.Title>\r\n      <h5 className=\"mb-1\">\r\n        <b>{Stat.getStatName(mainStatKey)} {mainStatVal}</b>\r\n      </h5>\r\n      <Row className=\"mb-0\">\r\n        {substats.map((stat: Substat, i) => {\r\n          if (!stat.value) return null\r\n          let numRolls = stat.rolls?.length ?? 0\r\n          let efficiency = stat.efficiency ?? 0\r\n          let effOpacity = 0.3 + efficiency * 0.7\r\n          let statName = Stat.getStatName(stat.key)\r\n          return (<Col key={i} xs={12}>\r\n            <Badge variant={numRolls ? `${numRolls}roll` : \"danger\"} className=\"text-darkcontent\"><b>{numRolls ? numRolls : \"?\"}</b></Badge>{\" \"}\r\n            <span className={`text-${numRolls}roll`}>{statName}{`+${valueStringWithUnit(stat.value, Stat.getStatUnit(stat.key))}`}</span>\r\n            <span className=\"float-right\" style={{ opacity: effOpacity }}>{stat.key && effFilter.has(stat.key) ? valueStringWithUnit(efficiency, \"eff\") : \"-\"}</span>\r\n          </Col>)\r\n        })}\r\n      </Row>\r\n      <div className=\"mt-auto\">\r\n        <Row>\r\n          <Col ><small>{t`editor.curSubEff`}</small></Col>\r\n          <Col xs=\"auto\"><PercentBadge value={currentEfficiency} valid={artifactValid} /></Col>\r\n        </Row>\r\n        {currentEfficiency !== maxEfficiency && <Row>\r\n          <Col ><small>{t`editor.maxSubEff`}</small></Col>\r\n          <Col xs=\"auto\"><PercentBadge value={maxEfficiency} valid={artifactValid} /></Col>\r\n        </Row>}\r\n      </div>\r\n    </Card.Body>\r\n\r\n    <Card.Footer className=\"pr-3\">\r\n      <Row className=\"d-flex justify-content-between no-gutters\">\r\n        {editable ? <Col xs=\"auto\">\r\n          <Dropdown>\r\n            <Dropdown.Toggle size=\"sm\" className=\"text-left\">{locationName}</Dropdown.Toggle>\r\n            <Dropdown.Menu>\r\n              <Dropdown.Item onClick={() => equipOnChar(\"\")}><FontAwesomeIcon icon={faBriefcase} /> Inventory</Dropdown.Item>\r\n              <Dropdown.Divider />\r\n              <CharacterSelectionDropdownList onSelect={equipOnChar} />\r\n            </Dropdown.Menu>\r\n          </Dropdown>\r\n        </Col> : <Col xs=\"auto\"><b>{locationName}</b></Col>}\r\n        <Col xs=\"auto\">\r\n          <ButtonGroup>\r\n            {editable ? <OverlayTrigger placement=\"top\"\r\n              overlay={<Tooltip id=\"lock-artifact-tip\">{t`lockArtifactTip`}</Tooltip>}>\r\n              <span className=\"d-inline-block\">\r\n                <Button size=\"sm\" onClick={() => database.lockArtifact(id, !lock)}>\r\n                  <FontAwesomeIcon icon={lock ? faLock : faLockOpen} className=\"fa-fw\" />\r\n                </Button>\r\n              </span>\r\n            </OverlayTrigger> : null}\r\n            {!!onEdit && <Button variant=\"info\" size=\"sm\"\r\n              onClick={onEdit}>\r\n              <FontAwesomeIcon icon={faEdit} className=\"fa-fw\" />\r\n            </Button>}\r\n            {!!onDelete && <Button variant=\"danger\" size=\"sm\"\r\n              onClick={onDelete}>\r\n              <FontAwesomeIcon icon={faTrashAlt} className=\"fa-fw\" />\r\n            </Button>}\r\n          </ButtonGroup>\r\n        </Col>\r\n      </Row>\r\n    </Card.Footer>\r\n  </Card >)\r\n}\r\n","import { Badge } from 'react-bootstrap';\r\n\r\nexport default function PercentBadge({ value, valid }: Data) {\r\n  let [badgeColor, text] = typeof value === 'number' ?\r\n    [`${Math.floor(value * 0.05) + 1}roll`, value.toFixed(2) + \"%\"] : [\"secondary\", value]\r\n  if (!valid) badgeColor = \"danger\"\r\n  return <Badge variant={badgeColor} className={badgeColor === \"secondary\" ? \"\" : \"text-darkcontent\"}>{text}</Badge>\r\n}\r\n\r\ntype Data = {\r\n  valid: boolean,\r\n  value: number | string,\r\n}\r\n","import { useCallback, useEffect, useMemo } from 'react';\r\nimport { Alert, Button, Card, Col, Row } from 'react-bootstrap';\r\nimport { useHistory } from 'react-router-dom';\r\nimport ArtifactCard from '../../Artifact/ArtifactCard';\r\nimport { ArtifactSheet } from '../../Artifact/ArtifactSheet';\r\nimport SetEffectDisplay from '../../Artifact/Component/SetEffectDisplay';\r\nimport { database } from '../../Database/Database';\r\nimport { ICharacter } from '../../Types/character';\r\nimport { allSlotKeys, ArtifactSetKey, SlotKey } from '../../Types/consts';\r\nimport { ICalculatedStats } from '../../Types/stats';\r\nimport { useForceUpdate, usePromise } from '../../Util/ReactUtil';\r\nimport WeaponSheet from '../../Weapon/WeaponSheet';\r\nimport Character from \"../Character\";\r\nimport CharacterSheet from '../CharacterSheet';\r\nimport StatDisplayComponent from './StatDisplayComponent';\r\nconst artLayoutSize = { xs: 12, md: 6, lg: 4 }\r\n\r\ntype CharacterArtifactPaneProps = {\r\n  sheets: {\r\n    characterSheet: CharacterSheet\r\n    weaponSheet: WeaponSheet,\r\n    artifactSheets: StrictDict<ArtifactSetKey, ArtifactSheet>\r\n  }\r\n  character: ICharacter,\r\n  equippedBuild?: ICalculatedStats,\r\n  newBuild?: ICalculatedStats,\r\n  editable: boolean,\r\n  characterDispatch: (any) => void,\r\n  artifacts?: any[]\r\n}\r\nfunction CharacterArtifactPane({ sheets, character, character: { characterKey }, equippedBuild, newBuild, editable, characterDispatch, artifacts }: CharacterArtifactPaneProps) {\r\n  const history = useHistory()\r\n  //choose which one to display stats for\r\n  const stats = (newBuild ? newBuild : equippedBuild)\r\n  const mainStatAssumptionLevel = stats?.mainStatAssumptionLevel ?? 0\r\n  const statKeys = useMemo(() => stats && Character.getDisplayStatKeys(stats, sheets), [stats, sheets])\r\n  const edit = useCallback(\r\n    artid => history.push({\r\n      pathname: \"/artifact\",\r\n      artToEditId: artid\r\n    } as any), [history])\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n\r\n  // TODO: We can also listen only to equipped artifacts\r\n  const [, updateArt] = useForceUpdate()\r\n  useEffect(() => database.followAnyArt(updateArt))\r\n\r\n  const equipArts = useCallback(() => {\r\n    if (!window.confirm(\"Do you want to equip this artifact build to this character?\")) return\r\n    if (!newBuild) return\r\n    newBuild.equippedArtifacts && database.equipArtifacts(characterKey, newBuild.equippedArtifacts)\r\n    characterDispatch?.({ type: \"fromDB\" })\r\n  }, [characterKey, newBuild, characterDispatch])\r\n\r\n  const unequipArts = useCallback(() => {\r\n    if (!window.confirm(\"Do you want to move all the artifacts equipped to inventory?\")) return\r\n    database.equipArtifacts(characterKey, Object.fromEntries(allSlotKeys.map(sKey => [sKey, \"\"])) as StrictDict<SlotKey, string>)\r\n    characterDispatch?.({ type: \"fromDB\" })\r\n  }, [characterKey, characterDispatch])\r\n  if (!stats) return null\r\n  return <>\r\n    <Card className=\"h-100 mb-2\" bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n      <Card.Body>\r\n        <StatDisplayComponent {...{ sheets, character, equippedBuild, newBuild, statsDisplayKeys: statKeys, editable }} />\r\n      </Card.Body>\r\n      <Card.Footer>\r\n        {newBuild ? <Button onClick={equipArts}>Equip all artifacts to current character</Button> : (editable && <Button onClick={unequipArts}>Unequip all artifacts</Button>)}\r\n        {Boolean(mainStatAssumptionLevel) && <Alert className=\"float-right text-right mb-0 py-2\" variant=\"orange\" ><b>Assume Main Stats are Level {mainStatAssumptionLevel}</b></Alert>}\r\n      </Card.Footer>\r\n    </Card>\r\n    <Row className=\"mb-n2\">\r\n      <Col {...artLayoutSize} className=\"d-flex flex-column\">\r\n        {artifactSheets && Object.entries(ArtifactSheet.setEffects(artifactSheets, stats.setToSlots)).map(([setKey, setNumKeyArr]) =>\r\n          <Card key={setKey} className=\"mb-2 flex-grow-1\" bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n            <Card.Header>{artifactSheets?.[setKey].name ?? \"\"}</Card.Header>\r\n            <Card.Body className=\"p-2 mb-n2\">\r\n              {(setNumKeyArr as any).map(setNumKey => <SetEffectDisplay key={setKey + setNumKey} {...{ setKey, setNumKey, equippedBuild, newBuild, characterDispatch, editable }} />)}\r\n            </Card.Body>\r\n          </Card>\r\n        )}\r\n      </Col>\r\n      {artifacts ?\r\n        allSlotKeys.map(slotKey => {//from flex\r\n          const art = artifacts.find(art => art.slotKey === slotKey)\r\n          return Boolean(art) && <Col {...artLayoutSize} key={slotKey} className=\"mb-2\">\r\n            <ArtifactCard artifactObj={art} />\r\n          </Col>\r\n        }) : allSlotKeys.map(slotKey =>\r\n          Boolean(stats?.equippedArtifacts?.[slotKey]) && <Col {...artLayoutSize} key={stats?.equippedArtifacts?.[slotKey]} className=\"mb-2\">\r\n            <ArtifactCard artifactId={stats?.equippedArtifacts?.[slotKey]} mainStatAssumptionLevel={mainStatAssumptionLevel} onEdit={() => edit(stats?.equippedArtifacts?.[slotKey])} />\r\n          </Col>\r\n        )}\r\n    </Row>\r\n  </>\r\n}\r\nexport default CharacterArtifactPane\r\n","import { faEdit, faSave } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport React, { useCallback, useState } from \"react\";\r\nimport { Badge, Button, ButtonGroup, Card, Col, Dropdown, Image, InputGroup, ListGroup, Row } from \"react-bootstrap\";\r\nimport Assets from \"../../Assets/Assets\";\r\nimport CustomFormControl from '../../Components/CustomFormControl';\r\nimport DocumentDisplay from \"../../Components/DocumentDisplay\";\r\nimport FieldDisplay from \"../../Components/FieldDisplay\";\r\nimport { Stars } from \"../../Components/StarDisplay\";\r\nimport StatDisplay from \"../../Components/StatDisplay\";\r\nimport StatIcon from \"../../Components/StatIcon\";\r\nimport { ascensionMaxLevel, milestoneLevels } from \"../../Data/CharacterData\";\r\nimport Stat from \"../../Stat\";\r\nimport { ICharacter } from \"../../Types/character\";\r\nimport { allElements, allRarities } from \"../../Types/consts\";\r\nimport { ICalculatedStats } from \"../../Types/stats\";\r\nimport statsToFields from \"../../Util/FieldUtil\";\r\nimport { usePromise } from \"../../Util/ReactUtil\";\r\nimport { clamp } from \"../../Util/Util\";\r\nimport WeaponSheet from \"../../Weapon/WeaponSheet\";\r\nimport Character from \"../Character\";\r\nimport CharacterSheet from \"../CharacterSheet\";\r\nimport StatInput from \"../StatInput\";\r\ntype CharacterOverviewPaneProps = {\r\n  characterSheet: CharacterSheet;\r\n  weaponSheet: WeaponSheet\r\n  editable: boolean;\r\n  character: ICharacter\r\n  characterDispatch: (any) => void\r\n  equippedBuild?: ICalculatedStats\r\n  newBuild?: ICalculatedStats\r\n}\r\nexport default function CharacterOverviewPane({ characterSheet, weaponSheet, editable, character, character: { constellation, level, ascension }, characterDispatch, equippedBuild, newBuild }: CharacterOverviewPaneProps) {\r\n  const build = newBuild ? newBuild : equippedBuild\r\n  if (!build) return null\r\n  const { tlvl } = build\r\n  const elementKey = build.characterEle\r\n  const weaponTypeKey = characterSheet.weaponTypeKey\r\n  return <Row>\r\n    <Col xs={12} md={3} >\r\n      {/* Image card with star and name and level */}\r\n      <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n        <Card.Img src={characterSheet.cardImg} className=\"w-100 h-auto\" />\r\n        <Card.Body>\r\n          <h3>{characterSheet.name} {StatIcon[elementKey]} <Image src={Assets.weaponTypes?.[weaponTypeKey]} className=\"inline-icon\" /></h3>\r\n          <h6><Stars stars={characterSheet.star} colored /></h6>\r\n          <h5>Level: {Character.getLevelString(character)}</h5>\r\n          <Row className=\"px-2 mb-2\">\r\n            {[\"auto\", \"skill\", \"burst\"].map(tKey =>\r\n              <Col xs={4} className=\"p-1\" key={tKey}>\r\n                <Image src={characterSheet.getTalentOfKey(tKey, build.characterEle)?.img} className=\"w-100 h-auto\" roundedCircle />\r\n                <h5 className=\"mb-0\"><Badge variant=\"info\" style={{ position: \"absolute\", bottom: \"0\", right: \"0\" }}><strong>{tlvl[tKey] + 1}</strong></Badge></h5>\r\n              </Col>)}\r\n          </Row>\r\n          <div className=\"text-center\"><h6>{characterSheet.constellationName}</h6></div>\r\n          <Row className=\"px-2\">\r\n            {[...Array(6).keys()].map(i =>\r\n              <Col xs={4} className=\"p-1\" key={i}>\r\n                <Image src={characterSheet.getTalentOfKey(`constellation${i + 1}`, build.characterEle)?.img} className={`w-100 h-auto ${constellation > i ? \"\" : \"overlay-dark\"} cursor-pointer`}\r\n                  roundedCircle onClick={() => editable && characterDispatch({ constellation: (i + 1) === constellation ? i : i + 1 })} />\r\n              </Col>)}\r\n          </Row>\r\n        </Card.Body>\r\n      </Card>\r\n    </Col>\r\n    <Col xs={12} md={9} >\r\n      <WeaponStatsEditorCard {...{ characterSheet, weaponSheet, editable, character, characterDispatch, equippedBuild, newBuild }} />\r\n      <MainStatsCards {...{ characterSheet, weaponSheet, editable, character, characterDispatch, equippedBuild, newBuild }} />\r\n    </Col>\r\n  </Row >\r\n}\r\n\r\nfunction WeaponStatsCard({ title, statsVals = {}, stats }: { title: Displayable, statsVals?: object, stats: ICalculatedStats }) {\r\n  if ((Object.keys(statsVals ?? {}) as any).length === 0) return null\r\n  const fields = statsToFields(statsVals, stats)\r\n  return <Card bg=\"darkcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n    <Card.Header className=\"py-2 px-3\">{title}</Card.Header>\r\n    <ListGroup className=\"text-white\" variant=\"flush\">\r\n      {fields.map((field, i) => <FieldDisplay newBuild={undefined} key={i} index={i} {...{ field, equippedBuild: stats, className: \"px-3 py-2\" }} />)}\r\n    </ListGroup>\r\n  </Card>\r\n}\r\n\r\nfunction WeaponDropdown({ weaponSheet, weaponTypeKey, setStateWeapon }: { weaponSheet: WeaponSheet, weaponTypeKey: string, setStateWeapon: (key: any, value: any) => void }) {\r\n  const weaponSheets = usePromise(WeaponSheet.getAll(), [])\r\n  if (!weaponSheets) return null\r\n\r\n  return <Dropdown as={ButtonGroup}>\r\n    <Dropdown.Toggle as={Button}>\r\n      {weaponSheet.name}\r\n    </Dropdown.Toggle>\r\n    <Dropdown.Menu>\r\n      {allRarities.map((stars, i, arr) => <React.Fragment key={stars}>\r\n        <Dropdown.ItemText key={\"star\" + stars}><Stars stars={stars} /></Dropdown.ItemText>\r\n        {Object.entries(WeaponSheet.getWeaponsOfType(weaponSheets, weaponTypeKey)).filter(([, weaponObj]: any) => weaponObj.rarity === stars).map(([key, weaponObj]: any) =>\r\n          <Dropdown.Item key={key} onClick={() => setStateWeapon(\"key\", key)}>\r\n            {weaponObj.name}\r\n          </Dropdown.Item>\r\n        )}\r\n        {(i !== arr.length - 1) && < Dropdown.Divider />}\r\n      </React.Fragment>)}\r\n    </Dropdown.Menu>\r\n  </Dropdown>\r\n}\r\n\r\ntype WeaponStatsEditorCardProps = {\r\n  characterSheet: CharacterSheet,\r\n  weaponSheet: WeaponSheet\r\n  editable: boolean\r\n  character: ICharacter\r\n  characterDispatch: (any) => void\r\n  equippedBuild?: ICalculatedStats\r\n  newBuild?: ICalculatedStats\r\n}\r\nfunction WeaponStatsEditorCard({ characterSheet, weaponSheet, editable, character, character: { weapon }, characterDispatch, equippedBuild, newBuild }: WeaponStatsEditorCardProps) {\r\n  //choose which one to display stats for\r\n  const build = newBuild ? newBuild : equippedBuild\r\n  const { level, ascension } = weapon\r\n  const setStateWeapon = useCallback((key, value) => {\r\n    if (key === \"key\") {\r\n      if (value === weapon.key) return\r\n      else {\r\n        //reset the conditionalNum when we switch weapons\r\n        const { conditionalValues } = character\r\n        delete conditionalValues.weapon\r\n        characterDispatch({ conditionalValues })\r\n      }\r\n    }\r\n    weapon[key] = value\r\n    characterDispatch({ weapon: weapon })\r\n  }, [character, weapon, characterDispatch])\r\n\r\n  const setLevel = useCallback((newLevel) => {\r\n    newLevel = clamp(newLevel, 1, 90)\r\n    const ascension = ascensionMaxLevel.findIndex(ascenML => newLevel <= ascenML)\r\n    setStateWeapon(\"level\", newLevel)\r\n    setStateWeapon(\"ascension\", ascension)\r\n  }, [setStateWeapon])\r\n\r\n  const ambiguousLevel = ascensionMaxLevel.findIndex(ascenML => level !== 90 && level === ascenML) > 0\r\n  const setAscension = useCallback(() => {\r\n    const lowerAscension = ascensionMaxLevel.findIndex(ascenML => level !== 90 && level === ascenML)\r\n    if (ascension === lowerAscension) setStateWeapon(\"ascension\", ascension + 1)\r\n    else setStateWeapon(\"ascension\", lowerAscension)\r\n  }, [setStateWeapon, ascension, level])\r\n\r\n  if (!build) return null\r\n\r\n  const substatKey = weaponSheet.getSubStatKey()\r\n  const weaponTypeKey = characterSheet.weaponTypeKey\r\n  const weaponDisplayMainVal = weaponSheet.getMainStatValue(level, ascension)\r\n  const weaponDisplaySubVal = weaponSheet.getSubStatValue(level, ascension)\r\n  const weaponPassiveName = weaponSheet.passiveName\r\n  const weaponBonusStats = weaponSheet.stats(build)\r\n  const document = weaponSheet.document\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n    <Card.Header>\r\n      <Row>\r\n        <Col>\r\n          {editable ? <InputGroup >\r\n            <ButtonGroup as={InputGroup.Prepend}>\r\n              <WeaponDropdown weaponSheet={weaponSheet} weaponTypeKey={weaponTypeKey} setStateWeapon={setStateWeapon} />\r\n              <Dropdown as={ButtonGroup}>\r\n                <Dropdown.Toggle as={Button}>Refinement {weapon.refineIndex + 1}</Dropdown.Toggle>\r\n                <Dropdown.Menu>\r\n                  <Dropdown.ItemText>\r\n                    <span>Select Weapon Refinement</span>\r\n                  </Dropdown.ItemText>\r\n                  <Dropdown.Divider />\r\n                  {[...Array(5).keys()].map(key =>\r\n                    <Dropdown.Item key={key} onClick={() => setStateWeapon(\"refineIndex\", key)}>\r\n                      {`Refinement ${key + 1}`}\r\n                    </Dropdown.Item>)}\r\n                </Dropdown.Menu>\r\n              </Dropdown>\r\n            </ButtonGroup>\r\n            <InputGroup.Prepend>\r\n              <InputGroup.Text><strong>Lvl. </strong></InputGroup.Text>\r\n            </InputGroup.Prepend>\r\n            <InputGroup.Append>\r\n              <CustomFormControl placeholder={undefined} onChange={setLevel} value={level} min={1} max={90} />\r\n            </InputGroup.Append>\r\n            <InputGroup.Append>\r\n              <Button disabled={!ambiguousLevel} onClick={setAscension}><strong>/ {ascensionMaxLevel[ascension]}</strong></Button>\r\n            </InputGroup.Append>\r\n            <ButtonGroup as={InputGroup.Append}>\r\n              <Dropdown as={ButtonGroup}>\r\n                <Dropdown.Toggle as={Button}>Select Level</Dropdown.Toggle>\r\n                <Dropdown.Menu>\r\n                  {milestoneLevels.map(([lv, as]) => {\r\n                    const sameLevel = lv === ascensionMaxLevel[as]\r\n                    const lvlstr = sameLevel ? `Lv. ${lv}` : `Lv. ${lv}/${ascensionMaxLevel[as]}`\r\n                    return <Dropdown.Item key={`${lv}/${as}`} onClick={() => { setStateWeapon(\"level\", lv); setStateWeapon(\"ascension\", as) }}>{lvlstr}</Dropdown.Item>\r\n                  })}\r\n                </Dropdown.Menu>\r\n              </Dropdown>\r\n            </ButtonGroup>\r\n          </InputGroup> : <span>Weapon</span>}\r\n        </Col>\r\n      </Row>\r\n    </Card.Header>\r\n    <Card.Body >\r\n      <Row className=\"mb-n2\">\r\n        <Col xs={12} md={3} lg={4}>\r\n          <Image src={weaponSheet.img} className={`w-100 h-auto grad-${weaponSheet.rarity}star`} thumbnail />\r\n          <small>{weaponSheet.description}</small>\r\n        </Col>\r\n        <Col>\r\n          <h5 className=\"mb-0\">{weaponSheet.name} Lv. {WeaponSheet.getLevelString(weapon)} {weaponPassiveName && <Badge variant=\"info\">Refinement {weapon.refineIndex + 1}</Badge>}</h5>\r\n          <div className=\"mb-2\"><Stars stars={weaponSheet.rarity} /></div>\r\n          <h6>{weaponPassiveName}</h6>\r\n          <div className=\"mb-2\">{weaponPassiveName && weaponSheet.passiveDescription(build)}</div>\r\n          <WeaponStatsCard title={\"Main Stats\"} statsVals={{ atk: weaponDisplayMainVal, [substatKey]: substatKey ? weaponDisplaySubVal : undefined }} stats={build} />\r\n          <WeaponStatsCard title={\"Bonus Stats\"} statsVals={weaponBonusStats} stats={build} />\r\n          {document ? <DocumentDisplay {...{ sections: document, equippedBuild, newBuild, characterDispatch, editable }} /> : null}\r\n        </Col>\r\n      </Row>\r\n    </Card.Body>\r\n  </Card>\r\n}\r\n\r\ntype MainStatsCardsProps = {\r\n  characterSheet: CharacterSheet,\r\n  weaponSheet: WeaponSheet,\r\n  editable: boolean,\r\n  character: ICharacter,\r\n  characterDispatch: (any) => void,\r\n  equippedBuild?: ICalculatedStats,\r\n  newBuild?: ICalculatedStats\r\n}\r\nfunction MainStatsCards({ characterSheet, weaponSheet, editable, character, characterDispatch, equippedBuild, newBuild }: MainStatsCardsProps) {\r\n  const [editing, SetEditing] = useState(false)\r\n  const [editingOther, SetEditingOther] = useState(false)\r\n  const [editingMisc, SetEditingMisc] = useState(false)\r\n\r\n  const additionalKeys = [\"eleMas\", \"critRate_\", \"critDMG_\", \"enerRech_\", \"heal_\"]\r\n  const displayStatKeys = [\"finalHP\", \"finalATK\", \"finalDEF\"]\r\n  displayStatKeys.push(...additionalKeys)\r\n  const editStatKeys = [\"hp\", \"hp_\", \"def\", \"def_\", \"atk\", \"atk_\"]\r\n  editStatKeys.push(...additionalKeys)\r\n  const otherStatKeys: any[] = [];\r\n\r\n  [\"physical\", ...allElements].forEach(ele => {\r\n    otherStatKeys.push(`${ele}_dmg_`)\r\n    otherStatKeys.push(`${ele}_res_`)\r\n  })\r\n  otherStatKeys.push(\"stamina\", \"incHeal_\", \"powShield_\", \"cdRed_\")\r\n\r\n  const miscStatkeys = [\r\n    \"normal_dmg_\", \"normal_critRate_\",\r\n    \"charged_dmg_\", \"charged_critRate_\",\r\n    \"plunging_dmg_\", \"plunging_critRate_\",\r\n    \"skill_dmg_\", \"skill_critRate_\",\r\n    \"burst_dmg_\", \"burst_critRate_\",\r\n    \"dmg_\", \"moveSPD_\", \"atkSPD_\", \"weakspotDMG_\"]\r\n\r\n  const specializedStatKey = characterSheet.getSpecializedStat(character.ascension)\r\n  const specializedStatVal = characterSheet.getSpecializedStatVal(character.ascension)\r\n  const specializedStatUnit = Stat.getStatUnit(specializedStatKey)\r\n\r\n  const displayNewBuildProps = { character, equippedBuild, newBuild, editable }\r\n  return <>\r\n    <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n      <Card.Header>\r\n        <Row>\r\n          <Col>\r\n            <span>Main Base Stats</span>\r\n          </Col>\r\n          {editable ? <Col xs=\"auto\" >\r\n            <Button variant={editing ? \"danger\" : \"info\"} onClick={() => SetEditing(!editing)} size=\"sm\">\r\n              <span><FontAwesomeIcon icon={editing ? faSave : faEdit} /> {editing ? \"EXIT\" : \"EDIT\"}</span>\r\n            </Button>\r\n          </Col> : null}\r\n        </Row>\r\n      </Card.Header>\r\n      {editing ?\r\n        <Card.Body>\r\n          <Row className=\"mb-2\">\r\n            {editStatKeys.map(statKey =>\r\n              <Col lg={6} xs={12} key={statKey}>\r\n                <StatInput\r\n                  prependEle={undefined}\r\n                  disabled={undefined}\r\n                  className=\"mb-2\"\r\n                  name={<span>{StatIcon[statKey]} {Stat.getStatNamePretty(statKey)}</span>}\r\n                  placeholder={`Base ${Stat.getStatName(statKey)}`}\r\n                  value={Character.getStatValueWithOverride(character, characterSheet, weaponSheet, statKey)}\r\n                  percent={Stat.getStatUnit(statKey) === \"%\"}\r\n                  onValueChange={value => characterDispatch({ type: \"statOverride\", statKey, value, characterSheet, weaponSheet })}\r\n                  defaultValue={Character.getBaseStatValue(character, characterSheet, weaponSheet, statKey)}\r\n                />\r\n              </Col>)}\r\n          </Row>\r\n        </Card.Body> :\r\n        <Card.Body>\r\n          <Row className=\"mb-2\">\r\n            {displayStatKeys.map(statKey => <Col xs={12} lg={6} key={statKey} ><StatDisplay characterSheet={characterSheet} weaponSheet={weaponSheet} statKey={statKey} {...displayNewBuildProps} /></Col>)}\r\n            <Col lg={6} xs={12}>\r\n              <span><b>Specialized:</b> <span>{specializedStatKey && StatIcon[specializedStatKey]} {Stat.getStatName(specializedStatKey)}</span></span>\r\n              <span className={`float-right`}>{`${specializedStatVal.toFixed(Stat.fixedUnit(specializedStatKey))}${specializedStatUnit}`}</span>\r\n            </Col>\r\n          </Row>\r\n        </Card.Body>\r\n      }\r\n    </Card >\r\n    <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n      <Card.Header>\r\n        <Row>\r\n          <Col>\r\n            <span>Other Stats</span>\r\n          </Col>\r\n          {editable && <Col xs=\"auto\" >\r\n            <Button variant={editingOther ? \"danger\" : \"info\"} onClick={() => SetEditingOther(!editingOther)} size=\"sm\">\r\n              <span><FontAwesomeIcon icon={editingOther ? faSave : faEdit} /> {editingOther ? \"EXIT\" : \"EDIT\"}</span>\r\n            </Button>\r\n          </Col>}\r\n        </Row>\r\n      </Card.Header>\r\n      {editingOther ?\r\n        <Card.Body>\r\n          <Row className=\"mb-2\">\r\n            {otherStatKeys.map(statKey =>\r\n              <Col lg={6} xs={12} key={statKey}>\r\n                <StatInput\r\n                  className=\"mb-2\"\r\n                  name={<span>{StatIcon[statKey]} {Stat.getStatName(statKey)}</span>}\r\n                  placeholder={`Base ${Stat.getStatNameRaw(statKey)}`}\r\n                  value={Character.getStatValueWithOverride(character, characterSheet, weaponSheet, statKey)}\r\n                  percent={Stat.getStatUnit(statKey) === \"%\"}\r\n                  onValueChange={value => characterDispatch({ type: \"statOverride\", statKey, value, characterSheet, weaponSheet })}\r\n                  defaultValue={Character.getBaseStatValue(character, characterSheet, weaponSheet, statKey)}\r\n                />\r\n              </Col>)}\r\n          </Row>\r\n        </Card.Body> :\r\n        <Card.Body>\r\n          <Row className=\"mb-2\">{otherStatKeys.map(statKey => <Col xs={12} lg={6} key={statKey} ><StatDisplay characterSheet={characterSheet} weaponSheet={weaponSheet} statKey={statKey} {...displayNewBuildProps} /></Col>)}</Row>\r\n        </Card.Body>\r\n      }\r\n    </Card>\r\n    <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n      <Card.Header>\r\n        <Row>\r\n          <Col>\r\n            <span>Misc Stats</span>\r\n          </Col>\r\n          {editable && <Col xs=\"auto\" >\r\n            <Button variant={editingMisc ? \"danger\" : \"info\"} onClick={() => SetEditingMisc(!editingMisc)} size=\"sm\">\r\n              <span><FontAwesomeIcon icon={editingMisc ? faSave : faEdit} /> {editingMisc ? \"EXIT\" : \"EDIT\"}</span>\r\n            </Button>\r\n          </Col>}\r\n        </Row>\r\n      </Card.Header>\r\n      {editingMisc ?\r\n        <Card.Body>\r\n          <Row className=\"mb-2\">\r\n            {miscStatkeys.map(statKey =>\r\n              <Col xl={6} xs={12} key={statKey}>\r\n                <StatInput\r\n                  className=\"mb-2\"\r\n                  name={<span>{StatIcon[statKey]} {Stat.getStatName(statKey)}</span>}\r\n                  placeholder={`Base ${Stat.getStatNameRaw(statKey)}`}\r\n                  value={Character.getStatValueWithOverride(character, characterSheet, weaponSheet, statKey)}\r\n                  percent={Stat.getStatUnit(statKey) === \"%\"}\r\n                  onValueChange={value => characterDispatch({ type: \"statOverride\", statKey, value, characterSheet, weaponSheet })}\r\n                  defaultValue={Character.getBaseStatValue(character, characterSheet, weaponSheet, statKey)}\r\n                />\r\n              </Col>)}\r\n          </Row>\r\n        </Card.Body> :\r\n        <Card.Body>\r\n          <Row className=\"mb-2\">{miscStatkeys.map(statKey => <Col xs={12} lg={6} key={statKey} ><StatDisplay characterSheet={characterSheet} weaponSheet={weaponSheet} statKey={statKey} {...displayNewBuildProps} /></Col>)}</Row>\r\n        </Card.Body>\r\n      }\r\n    </Card>\r\n  </>\r\n}\r\n","import { faQuestionCircle } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport React, { useState } from 'react';\r\nimport { Card, Col, Dropdown, DropdownButton, Image, ListGroup, OverlayTrigger, Row, Tooltip } from \"react-bootstrap\";\r\nimport DocumentDisplay from \"../../Components/DocumentDisplay\";\r\nimport FieldDisplay from \"../../Components/FieldDisplay\";\r\nimport StatIcon from \"../../Components/StatIcon\";\r\nimport Stat from \"../../Stat\";\r\nimport { ElementToReactionKeys } from \"../../StatData\";\r\nimport { ICharacter } from \"../../Types/character\";\r\nimport { ICalculatedStats } from \"../../Types/stats\";\r\nimport statsToFields from \"../../Util/FieldUtil\";\r\nimport CharacterSheet from \"../CharacterSheet\";\r\ntype CharacterTalentPaneProps = {\r\n  characterSheet: CharacterSheet,\r\n  character: ICharacter,\r\n  editable: boolean,\r\n  characterDispatch: (any) => void,\r\n  newBuild?: ICalculatedStats,\r\n  equippedBuild?: ICalculatedStats\r\n}\r\nexport default function CharacterTalentPane(props: CharacterTalentPaneProps) {\r\n  const { characterSheet, character: { ascension, constellation }, editable, characterDispatch, newBuild, equippedBuild } = props\r\n  const skillBurstList = [[\"auto\", \"Normal/Charged Attack\"], [\"skill\", \"Elemental Skill\"], [\"burst\", \"Elemental Burst\"]]\r\n  const passivesList: Array<[tKey: string, tText: string, asc: number]> = [[\"passive1\", \"Unlocked at Ascension 1\", 1], [\"passive2\", \"Unlocked at Ascension 4\", 4], [\"passive3\", \"Unlocked by Default\", 0]]\r\n  const skillDisplayProps = { ...props, ascension }\r\n  const build = newBuild ? newBuild : equippedBuild\r\n  return <>\r\n    <Row><Col><ReactionDisplay {...{ characterSheet, newBuild, equippedBuild }} /></Col></Row>\r\n    <Row>\r\n      {/* auto, skill, burst */}\r\n      {skillBurstList.map(([tKey, tText]) =>\r\n        <Col key={tKey} xs={12} md={6} lg={4} className=\"mb-2\">\r\n          <SkillDisplayCard\r\n            {...skillDisplayProps}\r\n            talentKey={tKey}\r\n            subtitle={tText}\r\n          />\r\n        </Col>)}\r\n      {!!characterSheet.getTalentOfKey(\"sprint\", build?.characterEle) && <Col xs={12} md={6} lg={4} className=\"mb-2\">\r\n        <SkillDisplayCard\r\n          {...skillDisplayProps}\r\n          talentKey=\"sprint\"\r\n          subtitle=\"Alternative Sprint\"\r\n        />\r\n      </Col>}\r\n    </Row>\r\n    <Row>\r\n      {/* passives */}\r\n      {passivesList.map(([tKey, tText, asc]) => {\r\n        let enabled = ascension >= asc\r\n        if (!characterSheet.getTalentOfKey(tKey, build?.characterEle)) return null\r\n        return <Col key={tKey} style={{ opacity: enabled ? 1 : 0.5 }} xs={12} md={4} className=\"mb-2\">\r\n          <SkillDisplayCard\r\n            {...skillDisplayProps}\r\n            talentKey={tKey}\r\n            subtitle={tText}\r\n          />\r\n        </Col>\r\n      })}\r\n    </Row>\r\n    <Row>\r\n      <Col>\r\n        <h5 className=\"text-center\">Constellation Lv. {constellation}</h5>\r\n      </Col>\r\n    </Row>\r\n    <Row className=\"mb-n2\">\r\n      {/* constellations */}\r\n      {[...Array(6).keys()].map(i => {\r\n        let tKey = `constellation${i + 1}`\r\n        return <Col key={i} xs={12} md={4} className=\"mb-2\"\r\n          style={{ opacity: constellation > i ? 1 : 0.5 }}>\r\n          <SkillDisplayCard\r\n            {...skillDisplayProps}\r\n            talentKey={tKey}\r\n            subtitle={`Contellation Lv. ${i + 1}`}\r\n            onClickTitle={() => editable && characterDispatch({ constellation: (i + 1) === constellation ? i : i + 1 })}\r\n          />\r\n        </Col>\r\n      })}\r\n    </Row>\r\n  </>\r\n}\r\nconst ReactionComponents = {\r\n  superconduct_hit: SuperConductCard,\r\n  electrocharged_hit: ElectroChargedCard,\r\n  overloaded_hit: OverloadedCard,\r\n  pyro_swirl_hit: SwirlCard,\r\n  shattered_hit: ShatteredCard,\r\n  crystalize_hit: CrystalizeCard,\r\n}\r\nfunction ReactionDisplay({ characterSheet, newBuild, equippedBuild }: { characterSheet: CharacterSheet, newBuild?: ICalculatedStats, equippedBuild?: ICalculatedStats }) {\r\n  const build = newBuild ? newBuild : equippedBuild\r\n  if (!build) return null\r\n  const charEleKey = build.characterEle\r\n  const eleInterArr = [...(ElementToReactionKeys[charEleKey] || [])]\r\n  if (!eleInterArr.includes(\"shattered_hit\") && characterSheet.weaponTypeKey === \"claymore\") eleInterArr.push(\"shattered_hit\")\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n    <Card.Body className=\"px-3 py-2\">\r\n      <Row className=\"mb-n2\">\r\n        {eleInterArr.map(key => {\r\n          const Ele = ReactionComponents[key]\r\n          if (!Ele) return null\r\n          return <Col xs=\"auto\" className=\"mb-2\" key={key}><Ele stats={build} /></Col>\r\n        })}\r\n      </Row>\r\n    </Card.Body>\r\n  </Card>\r\n}\r\nfunction SuperConductCard({ stats }) {\r\n  const sKey = \"superconduct_hit\"\r\n  return <Card bg=\"darkcontent\" text={\"lightfont\" as any}><Card.Body className=\"p-2\">\r\n    <span className=\"text-superconduct\">{Stat.getStatName(sKey)} {StatIcon.electro}+{StatIcon.cryo} <strong>{stats[sKey]?.toFixed(Stat.fixedUnit(sKey))}</strong></span>\r\n  </Card.Body></Card>\r\n}\r\nfunction ElectroChargedCard({ stats }) {\r\n  const sKey = \"electrocharged_hit\"\r\n  return <Card bg=\"darkcontent\" text={\"lightfont\" as any}><Card.Body className=\"p-2\">\r\n    <span className=\"text-electrocharged\">{Stat.getStatName(sKey)} {StatIcon.electro}+{StatIcon.hydro} <strong>{stats[sKey]?.toFixed(Stat.fixedUnit(sKey))}</strong></span>\r\n  </Card.Body></Card>\r\n}\r\nfunction OverloadedCard({ stats }) {\r\n  const sKey = \"overloaded_hit\"\r\n  return <Card bg=\"darkcontent\" text={\"lightfont\" as any}><Card.Body className=\"p-2\">\r\n    <span className=\"text-overloaded\">{Stat.getStatName(sKey)} {StatIcon.electro}+{StatIcon.pyro} <strong>{stats[sKey]?.toFixed(Stat.fixedUnit(sKey))}</strong></span>\r\n  </Card.Body></Card>\r\n}\r\n\r\nconst swirlEleToDisplay = {\r\n  \"pyro\": <span>{Stat.getStatName(\"pyro_swirl_hit\")} {StatIcon.pyro}+{StatIcon.anemo}</span>,\r\n  \"electro\": <span>{Stat.getStatName(\"electro_swirl_hit\")} {StatIcon.electro}+{StatIcon.anemo}</span>,\r\n  \"cryo\": <span>{Stat.getStatName(\"cryo_swirl_hit\")} {StatIcon.cryo}+{StatIcon.anemo}</span>,\r\n  \"hydro\": <span>{Stat.getStatName(\"hydro_swirl_hit\")} {StatIcon.hydro}+{StatIcon.anemo}</span>\r\n} as const\r\nfunction SwirlCard({ stats }) {\r\n  const [ele, setele] = useState(Object.keys(swirlEleToDisplay)[0])\r\n  const sKey = `${ele}_swirl_hit`\r\n  return <Card bg=\"darkcontent\" text={\"lightfont\" as any}><Card.Body className=\"p-0\">\r\n    <DropdownButton size=\"sm\" title={swirlEleToDisplay[ele]} className=\"d-inline-block\" variant=\"success\">\r\n      {Object.entries(swirlEleToDisplay).map(([key, element]) => <Dropdown.Item key={key} onClick={() => setele(key)}>{element}</Dropdown.Item>)}\r\n    </DropdownButton>\r\n    <span className={`text-${ele} p-2`}> <strong>{stats[sKey]?.toFixed(Stat.fixedUnit(sKey))}</strong></span>\r\n  </Card.Body></Card>\r\n}\r\nfunction ShatteredCard({ stats }) {\r\n  const sKey = \"shattered_hit\"\r\n  const information = <OverlayTrigger\r\n    placement=\"top\"\r\n    overlay={<Tooltip id=\"shatter-tooltip\">Claymores, Plunging Attacks and <span className=\"text-geo\">Geo DMG</span></Tooltip>}\r\n  >\r\n    <FontAwesomeIcon icon={faQuestionCircle} style={{ cursor: \"help\" }} />\r\n  </OverlayTrigger>\r\n  return <Card bg=\"darkcontent\" text={\"lightfont\" as any}><Card.Body className=\"p-2\">\r\n    <span className=\"text-shattered\">{Stat.getStatName(sKey)} {StatIcon.hydro}+{StatIcon.cryo}+ <small className=\"text-physical\">Heavy Attack{information} </small> <strong>{stats[sKey]?.toFixed(Stat.fixedUnit(sKey))}</strong></span>\r\n  </Card.Body></Card>\r\n}\r\nconst crystalizeEleToDisplay = {\r\n  \"default\": <span className=\"text-crystalize\">{Stat.getStatName(\"crystalize_hit\")} {StatIcon.electro}/{StatIcon.hydro}/{StatIcon.pyro}/{StatIcon.cryo}+{StatIcon.geo}</span>,\r\n  \"pyro\": <span>{Stat.getStatName(\"pyro_crystalize_hit\")} {StatIcon.pyro}+{StatIcon.geo}</span>,\r\n  \"electro\": <span>{Stat.getStatName(\"electro_crystalize_hit\")} {StatIcon.electro}+{StatIcon.geo}</span>,\r\n  \"cryo\": <span>{Stat.getStatName(\"cryo_crystalize_hit\")} {StatIcon.cryo}+{StatIcon.geo}</span>,\r\n  \"hydro\": <span>{Stat.getStatName(\"hydro_crystalize_hit\")} {StatIcon.hydro}+{StatIcon.geo}</span>\r\n} as const\r\nfunction CrystalizeCard({ stats }) {\r\n  const [ele, setele] = useState(Object.keys(crystalizeEleToDisplay)[0])\r\n  const sKey = ele === \"default\" ? \"crystalize_hit\" : `${ele}_crystalize_hit`\r\n  return <Card bg=\"darkcontent\" text={\"lightfont\" as any}><Card.Body className=\"p-0\">\r\n    <DropdownButton size=\"sm\" title={crystalizeEleToDisplay[ele]} className=\"d-inline-block\" variant=\"success\">\r\n      {Object.entries(crystalizeEleToDisplay).map(([key, element]) => <Dropdown.Item key={key} onClick={() => setele(key)}>{element}</Dropdown.Item>)}\r\n    </DropdownButton>\r\n    <span className={`text-${ele} p-2`}> <strong>{stats[sKey]?.toFixed(Stat.fixedUnit(sKey))}</strong></span>\r\n  </Card.Body></Card>\r\n}\r\n\r\nconst talentLimits = [1, 1, 2, 4, 6, 8, 10]\r\ntype SkillDisplayCardProps = {\r\n  characterSheet: CharacterSheet\r\n  character: ICharacter,\r\n  characterDispatch: (any) => void,\r\n  talentKey: string,\r\n  subtitle: string,\r\n  ascension: number,\r\n  equippedBuild?: ICalculatedStats,\r\n  newBuild?: ICalculatedStats,\r\n  editable: boolean,\r\n  onClickTitle?: (any) => any\r\n}\r\nfunction SkillDisplayCard({ characterSheet, character: { elementKey, talentLevelKeys, }, characterDispatch, talentKey, subtitle, ascension, equippedBuild, newBuild, editable, onClickTitle }: SkillDisplayCardProps) {\r\n  let build = newBuild ? newBuild : equippedBuild\r\n  if (!build) return null\r\n  let header: Displayable | null = null\r\n\r\n  let talentLvlKey = 0\r\n  if (talentKey in talentLevelKeys) {\r\n    const talentLvlKeyRaw = talentLevelKeys[talentKey]\r\n    const levelBoost: number = build[`${talentKey}Boost`] ?? 0\r\n    talentLvlKey = talentLvlKeyRaw + levelBoost\r\n    if (editable) {\r\n      const setTalentLevel = (tKey, newTalentLevelKey) => {\r\n        talentLevelKeys[tKey] = newTalentLevelKey\r\n        characterDispatch({ talentLevelKeys })\r\n      }\r\n      header = <Card.Header>\r\n        <DropdownButton title={`Talent Lv. ${talentLvlKey + 1}`}>\r\n          {[...Array(talentLimits[ascension] + (talentKey === \"auto\" && !levelBoost ? 1 : 0)).keys()].map(i => //spcial consideration for Tartaglia\r\n            <Dropdown.Item key={i} onClick={() => setTalentLevel(talentKey, i)}>Talent Lv. {i + levelBoost + 1}</Dropdown.Item>)}\r\n        </DropdownButton>\r\n      </Card.Header>\r\n    } else {\r\n      header = <Card.Header>{`Talent Level: ${talentLvlKey + 1}`}</Card.Header>\r\n    }\r\n  }\r\n  const talentStats = characterSheet.getTalentStats(talentKey, build)\r\n  const statsEle = talentStats && <Row><Col>\r\n    <Card bg=\"darkcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n      <ListGroup className=\"text-white\" variant=\"flush\">\r\n        {statsToFields(talentStats, build).map((field, i) =>\r\n          <FieldDisplay key={i} index={i} {...{ field, equippedBuild, newBuild }} />)}\r\n      </ListGroup>\r\n    </Card>\r\n  </Col></Row>\r\n\r\n  const talentSheet = characterSheet.getTalentOfKey(talentKey, build.characterEle)\r\n  const sections = talentSheet?.sections\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"h-100\">\r\n    {header}\r\n    <Card.Body className=\"mb-n2\">\r\n      <Row className={`d-flex flex-row mb-2 ${(editable && onClickTitle) ? \"cursor-pointer\" : \"\"}`} onClick={onClickTitle} >\r\n        <Col xs=\"auto\" className=\"flex-shrink-1 d-flex flex-column\">\r\n          <Image src={talentSheet?.img} className=\"thumb-mid\" />\r\n        </Col>\r\n        <Col className=\"flex-grow-1\">\r\n          <Card.Title>{talentSheet?.name}</Card.Title>\r\n          <Card.Subtitle>{subtitle}</Card.Subtitle>\r\n        </Col>\r\n      </Row>\r\n      {/* Display document sections */}\r\n      {sections ? <DocumentDisplay {...{ sections, characterDispatch, equippedBuild, newBuild, editable }} /> : null}\r\n      {statsEle}\r\n    </Card.Body>\r\n  </Card>\r\n}\r\n","import { faTimes } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React, { createContext, useCallback, useEffect, useMemo, useReducer, useRef, useState } from 'react';\r\nimport { Alert, ButtonGroup, Dropdown, Image, InputGroup, Nav, Tab } from 'react-bootstrap';\r\nimport Button from 'react-bootstrap/Button';\r\nimport Card from 'react-bootstrap/Card';\r\nimport Col from 'react-bootstrap/Col';\r\nimport DropdownItem from 'react-bootstrap/esm/DropdownItem';\r\nimport Row from 'react-bootstrap/Row';\r\nimport { ArtifactSheet } from '../Artifact/ArtifactSheet';\r\nimport CustomFormControl from '../Components/CustomFormControl';\r\nimport { ascensionMaxLevel, milestoneLevels } from '../Data/CharacterData';\r\nimport ElementalData from '../Data/ElementalData';\r\nimport { database } from '../Database/Database';\r\nimport { ICharacter } from '../Types/character';\r\nimport { allCharacterKeys, allSlotKeys, CharacterKey } from '../Types/consts';\r\nimport { ICalculatedStats } from '../Types/stats';\r\nimport { usePromise } from '../Util/ReactUtil';\r\nimport { clamp, deepClone } from '../Util/Util';\r\nimport WeaponSheet from '../Weapon/WeaponSheet';\r\nimport Character from './Character';\r\nimport CharacterArtifactPane from './CharacterDisplay/CharacterArtifactPane';\r\nimport CharacterOverviewPane from './CharacterDisplay/CharacterOverviewPane';\r\nimport CharacterTalentPane from './CharacterDisplay/CharacterTalentPane';\r\nimport DamageOptionsAndCalculation from './CharacterDisplay/DamageOptionsAndCalculation';\r\nimport CharacterSheet from './CharacterSheet';\r\n\r\nexport const compareAgainstEquippedContext = createContext(undefined)\r\n\r\nconst CustomMenu = React.forwardRef(\r\n  ({ children, style, className, 'aria-labelledby': labeledBy }: any, ref: any) => {\r\n    return (\r\n      <div\r\n        ref={ref}\r\n        style={{ style, minWidth: \"25rem\" } as any}\r\n        className={className}\r\n        aria-labelledby={labeledBy}\r\n      >\r\n        <Row>\r\n          {React.Children.toArray(children).map((child, i) => <Col key={i} xs={6}>{child}</Col>)}\r\n        </Row>\r\n      </div>\r\n    );\r\n  },\r\n);\r\nconst initialCharacter = (characterKey): ICharacter => ({\r\n  characterKey: characterKey ?? \"\",//the game character this is based off\r\n  level: 1,\r\n  ascension: 0,\r\n  hitMode: \"avgHit\",\r\n  reactionMode: null,\r\n  equippedArtifacts: Object.fromEntries(allSlotKeys.map(sKey => [sKey, \"\"])) as any,\r\n  conditionalValues: {},\r\n  baseStatOverrides: {},//overriding the baseStat\r\n  buildSettings: {//blank settings, so a new character will not be copied over.\r\n    setFilters: [],\r\n    statFilters: {},\r\n    mainStatKeys: [],\r\n    optimizationTarget: \"finalATK\",\r\n    mainStatAssumptionLevel: 0,\r\n    useLockedArts: false,\r\n    useEquippedArts: false,\r\n    ascending: false,\r\n  },\r\n  weapon: {\r\n    key: \"\" as any,\r\n    level: 1,\r\n    ascension: 0,\r\n    refineIndex: 0,\r\n  },\r\n  talentLevelKeys: {\r\n    auto: 0,\r\n    skill: 0,\r\n    burst: 0,\r\n  },\r\n  infusionAura: \"\",\r\n  constellation: 0,\r\n})\r\n\r\ntype characterReducerOverwrite = {\r\n  type: \"overwrite\",\r\n  character: ICharacter\r\n}\r\ntype characterReducerFromDB = {\r\n  type: \"fromDB\",\r\n}\r\ntype characterReducerStatOverride = {\r\n  type: \"statOverride\",\r\n  statKey: string\r\n  value: number | string\r\n  characterSheet: CharacterSheet\r\n  weaponSheet: WeaponSheet\r\n}\r\ntype characterReducerOverwriteAction = characterReducerOverwrite | characterReducerFromDB | characterReducerStatOverride | Partial<ICharacter>\r\n\r\nfunction characterReducer(state: ICharacter, action: characterReducerOverwriteAction) {\r\n  if (\"type\" in action) switch (action?.type) {\r\n    case \"overwrite\":\r\n      return { ...state, ...action.character }\r\n    case \"fromDB\": // for equipping artifacts, that makes the changes in DB instead of in state.\r\n      return { ...state, ...database._getChar(state.characterKey) ?? {} }\r\n    case \"statOverride\": {\r\n      const { statKey, value, characterSheet, weaponSheet, } = action\r\n      const baseStatOverrides = state.baseStatOverrides\r\n      const baseStatVal = Character.getBaseStatValue(state, characterSheet, weaponSheet, statKey)\r\n      if (baseStatVal === value)\r\n        delete baseStatOverrides[statKey]\r\n      else\r\n        baseStatOverrides[statKey] = value\r\n      return { ...state, baseStatOverrides }\r\n    }\r\n    default:\r\n      break;\r\n  }\r\n  return { ...state, ...action }\r\n}\r\ntype CharacterDisplayCardProps = {\r\n  characterKey?: CharacterKey | \"\",\r\n  character?: ICharacter,\r\n  setCharacterKey?: (any) => void\r\n  footer?: JSX.Element\r\n  newBuild?: ICalculatedStats,\r\n  editable?: boolean,\r\n  onClose?: (any) => void,\r\n  tabName?: string\r\n}\r\nexport default function CharacterDisplayCard({ characterKey: propCharacterKey = \"\", character: propCharacter, setCharacterKey: propSetCharacterKey, footer, newBuild: propNewBuild, editable = false, onClose, tabName }: CharacterDisplayCardProps) {\r\n  const [character, characterDispatch] = useReducer(characterReducer, initialCharacter(propCharacterKey))\r\n  const [compareAgainstEquipped, setcompareAgainstEquipped] = useState(false)\r\n  const firstUpdate = useRef(true)\r\n  const weaponSheets = usePromise(WeaponSheet.getAll(), [])\r\n  const characterKey = propCharacter?.characterKey ?? character.characterKey\r\n  const characterSheet = usePromise(CharacterSheet.get(characterKey), [characterKey])\r\n  const weaponSheet = usePromise(WeaponSheet.get(character.weapon.key), [character.weapon.key])\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n\r\n  useEffect(() => {\r\n    if (!propCharacterKey) return\r\n    const char = { ...initialCharacter(propCharacterKey), ...database._getChar(propCharacterKey) ?? {} }\r\n    characterDispatch({ type: \"overwrite\", character: char })\r\n  }, [propCharacterKey])\r\n\r\n  useEffect(() => {\r\n    if (!propCharacter) return\r\n    const char = { ...initialCharacter(propCharacter.characterKey), ...propCharacter }\r\n    characterDispatch({ type: \"overwrite\", character: char })\r\n  }, [propCharacter])\r\n\r\n  useEffect(() => {\r\n    //skip saving on the first update, since those updates are from loading from DB\r\n    if (firstUpdate.current) {\r\n      firstUpdate.current = false\r\n      return\r\n    }\r\n    //save character to DB\r\n    editable && database.updateChar(character)\r\n  }, [character, editable])\r\n\r\n  //callback for when switching to a new character, and need to initiate a weapon.\r\n  useEffect(() => {\r\n    if (!character.weapon.key && weaponSheets && characterSheet) {\r\n      const possibleWeapons = WeaponSheet.getWeaponsOfType(weaponSheets, characterSheet.weaponTypeKey)\r\n      //sort the weapons to get the lowest rarity weapon.\r\n      const [weaponKey] = Object.entries(possibleWeapons).sort(([k1, ws1], [k2, ws2]) => ws1.rarity - ws2.rarity)[0]\r\n      character.weapon.key = weaponKey\r\n      characterDispatch({ weapon: character.weapon })\r\n    }\r\n  }, [characterSheet, weaponSheets])// eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {//check for default value for traveler\r\n    if (characterSheet && \"talents\" in characterSheet.sheet && !character.elementKey)\r\n      characterDispatch({ elementKey: Object.keys(characterSheet.sheet.talents)[0] })\r\n  }, [character.elementKey, characterSheet])\r\n\r\n  const setCharacterKey = useCallback(\r\n    newCKey => {\r\n      let state = initialCharacter(newCKey)\r\n      const char = database._getChar(newCKey)\r\n      if (char) state = { ...state, ...char }\r\n      characterDispatch({ type: \"overwrite\", character: state })\r\n      if (newCKey !== characterKey)\r\n        propSetCharacterKey?.(newCKey)\r\n    }, [characterKey, characterDispatch, propSetCharacterKey])\r\n\r\n  const newBuild = useMemo(() => {\r\n    if (!propNewBuild) return\r\n    const newBuild = propNewBuild && deepClone(propNewBuild);\r\n    newBuild.hitMode = character.hitMode;\r\n    newBuild.reactionMode = character.reactionMode;\r\n    return newBuild\r\n  }, [propNewBuild, character.hitMode, character.reactionMode])\r\n\r\n  const { artifacts: flexArts } = character\r\n\r\n  const mainStatAssumptionLevel = newBuild?.mainStatAssumptionLevel ?? 0\r\n  const equippedBuild = useMemo(() => characterSheet && weaponSheet && artifactSheets && Character.calculateBuild(character, characterSheet, weaponSheet, artifactSheets, mainStatAssumptionLevel), [character, characterSheet, weaponSheet, artifactSheets, mainStatAssumptionLevel])\r\n  const sheets = useMemo(() => characterSheet && weaponSheet && artifactSheets && { characterSheet, weaponSheet, artifactSheets }, [characterSheet, weaponSheet, artifactSheets])\r\n  const commonPaneProps = { character, newBuild, equippedBuild: (!newBuild || compareAgainstEquipped) ? equippedBuild : undefined, editable, characterDispatch, compareAgainstEquipped }\r\n  if (flexArts) (commonPaneProps as any).artifacts = flexArts//from flex\r\n  // main CharacterDisplayCard\r\n  const DamageOptionsAndCalculationEle = sheets && <DamageOptionsAndCalculation {...{ sheets, weaponSheet, character, characterDispatch, newBuild, equippedBuild }} className=\"mb-2\" />\r\n  return (<Card bg=\"darkcontent\" text={\"lightfont\" as any} >\r\n    <Card.Header>\r\n      <Row>\r\n        <Col xs={\"auto\"} className=\"mr-auto\">\r\n          {/* character selecter/display */}\r\n          <CharSelectDropdown characterSheet={characterSheet} character={character} weaponSheet={weaponSheet} editable={editable} characterDispatch={characterDispatch} setCharacterKey={setCharacterKey} />\r\n        </Col>\r\n        {Boolean(mainStatAssumptionLevel) && <Col xs=\"auto\"><Alert className=\"mb-0 py-1 h-100\" variant=\"orange\" ><b>Assume Main Stats are Level {mainStatAssumptionLevel}</b></Alert></Col>}\r\n        {/* Compare against new build toggle */}\r\n        {newBuild ? <Col xs=\"auto\">\r\n          <ButtonGroup>\r\n            <Button variant={compareAgainstEquipped ? \"primary\" : \"success\"} disabled={!compareAgainstEquipped} onClick={() => setcompareAgainstEquipped(false)}>\r\n              <small>Show New artifact Stats</small>\r\n            </Button>\r\n            <Button variant={!compareAgainstEquipped ? \"primary\" : \"success\"} disabled={compareAgainstEquipped} onClick={() => setcompareAgainstEquipped(true)}>\r\n              <small>Compare against equipped artifacts</small>\r\n            </Button>\r\n          </ButtonGroup>\r\n        </Col> : null}\r\n        {Boolean(onClose) && <Col xs=\"auto\" >\r\n          <Button variant=\"danger\" onClick={onClose}>\r\n            <FontAwesomeIcon icon={faTimes} /></Button>\r\n        </Col>}\r\n      </Row>\r\n    </Card.Header>\r\n    {characterKey && sheets && characterSheet && weaponSheet && <Card.Body>\r\n      <compareAgainstEquippedContext.Provider value={compareAgainstEquipped as any}>\r\n        <Tab.Container defaultActiveKey={tabName ? tabName : (newBuild ? \"newartifacts\" : \"character\")} mountOnEnter={true} unmountOnExit={true}>\r\n          <Nav variant=\"pills\" className=\"mb-2 mx-0\" fill>\r\n            <Nav.Item >\r\n              <Nav.Link eventKey=\"character\"><h5 className=\"mb-0\">Character</h5></Nav.Link>\r\n            </Nav.Item>\r\n            {newBuild ? <Nav.Item>\r\n              <Nav.Link eventKey=\"newartifacts\"><h5 className=\"mb-0\">New Artifacts</h5></Nav.Link>\r\n            </Nav.Item> : null}\r\n            <Nav.Item>\r\n              <Nav.Link eventKey=\"artifacts\"><h5 className=\"mb-0\">{newBuild ? \"Current Artifacts\" : \"Artifacts\"}</h5></Nav.Link>\r\n            </Nav.Item>\r\n            <Nav.Item>\r\n              <Nav.Link eventKey=\"talent\"><h5 className=\"mb-0\">Talents</h5></Nav.Link>\r\n            </Nav.Item>\r\n          </Nav>\r\n          <Tab.Content>\r\n            <Tab.Pane eventKey=\"character\">\r\n              {DamageOptionsAndCalculationEle}\r\n              <CharacterOverviewPane characterSheet={characterSheet} weaponSheet={weaponSheet} {...commonPaneProps} />\r\n            </Tab.Pane>\r\n            <Tab.Pane eventKey=\"artifacts\" >\r\n              {DamageOptionsAndCalculationEle}\r\n              <CharacterArtifactPane sheets={sheets} artifacts={undefined} {...{ ...commonPaneProps, newBuild: undefined, equippedBuild, }} />\r\n            </Tab.Pane>\r\n            {newBuild ? <Tab.Pane eventKey=\"newartifacts\" >\r\n              {DamageOptionsAndCalculationEle}\r\n              <CharacterArtifactPane sheets={sheets} artifacts={undefined} {...commonPaneProps} />\r\n            </Tab.Pane> : null}\r\n            <Tab.Pane eventKey=\"talent\">\r\n              {DamageOptionsAndCalculationEle}\r\n              <CharacterTalentPane characterSheet={characterSheet} {...commonPaneProps} />\r\n            </Tab.Pane>\r\n          </Tab.Content>\r\n        </Tab.Container>\r\n      </compareAgainstEquippedContext.Provider>\r\n    </Card.Body>}\r\n    {footer && <Card.Footer>\r\n      {footer}\r\n    </Card.Footer>}\r\n  </Card>)\r\n}\r\n\r\ntype CharSelectDropdownProps = {\r\n  characterSheet?: CharacterSheet,\r\n  weaponSheet?: WeaponSheet,\r\n  character: ICharacter\r\n  editable: boolean\r\n  characterDispatch: (any) => void\r\n  setCharacterKey: (any) => void\r\n}\r\nfunction CharSelectDropdown({ characterSheet, weaponSheet, character, character: { elementKey = \"anemo\", level = 1, ascension = 0 }, editable, characterDispatch, setCharacterKey }: CharSelectDropdownProps) {\r\n  const HeaderIconDisplay = characterSheet ? <span >\r\n    <Image src={characterSheet.thumbImg} className=\"thumb-small my-n1 ml-n2\" roundedCircle />\r\n    <h6 className=\"d-inline\"> {characterSheet.name} </h6>\r\n  </span> : <span>Select a Character</span>\r\n  const setLevel = useCallback((level) => {\r\n    level = clamp(level, 1, 90)\r\n    const ascension = ascensionMaxLevel.findIndex(ascenML => level <= ascenML)\r\n    characterDispatch({ level, ascension })\r\n  }, [characterDispatch])\r\n  const ambiguousLevel = ascensionMaxLevel.findIndex(ascenML => level !== 90 && level === ascenML) > 0\r\n  const setAscension = useCallback(() => {\r\n    const lowerAscension = ascensionMaxLevel.findIndex(ascenML => level !== 90 && level === ascenML)\r\n    if (ascension === lowerAscension) characterDispatch({ ascension: ascension + 1 })\r\n    else characterDispatch({ ascension: lowerAscension })\r\n  }, [characterDispatch, ascension, level])\r\n  return <>{editable ? <InputGroup >\r\n    <ButtonGroup as={InputGroup.Prepend}>\r\n      <Dropdown as={ButtonGroup}>\r\n        <Dropdown.Toggle as={Button}>\r\n          {HeaderIconDisplay}\r\n        </Dropdown.Toggle>\r\n        <Dropdown.Menu as={CustomMenu}>\r\n          {[...new Set(allCharacterKeys)].sort().map(charKey => <CharDropdownItem key={charKey} characterKey={charKey} setCharacterKey={setCharacterKey} />)}\r\n        </Dropdown.Menu>\r\n      </Dropdown>\r\n      {characterSheet?.sheet && \"talents\" in characterSheet?.sheet && <Dropdown as={ButtonGroup}>\r\n        <Dropdown.Toggle as={Button} className={`text-${elementKey}`}>\r\n          <strong>{ElementalData[elementKey].name}</strong>\r\n        </Dropdown.Toggle>\r\n        <Dropdown.Menu >\r\n          {Object.keys(characterSheet.sheet.talents).map(eleKey =>\r\n            <Dropdown.Item key={eleKey} className={`text-${eleKey}`} onClick={() => characterDispatch({ elementKey: eleKey })}><strong>{ElementalData[eleKey].name}</strong></Dropdown.Item>)}\r\n        </Dropdown.Menu>\r\n      </Dropdown>}\r\n    </ButtonGroup>\r\n    <InputGroup.Prepend>\r\n      <InputGroup.Text><strong>Lvl. </strong></InputGroup.Text>\r\n    </InputGroup.Prepend>\r\n\r\n    <InputGroup.Append>\r\n      <CustomFormControl placeholder={undefined} className=\"h-100\" onChange={setLevel} value={level} min={1} max={90} disabled={!characterSheet} />\r\n    </InputGroup.Append>\r\n    <InputGroup.Append>\r\n      <Button disabled={!ambiguousLevel || !characterSheet} onClick={setAscension}><strong>/ {ascensionMaxLevel[ascension]}</strong></Button>\r\n    </InputGroup.Append>\r\n    <ButtonGroup as={InputGroup.Append}>\r\n      <Dropdown as={ButtonGroup} >\r\n        <Dropdown.Toggle as={Button} disabled={!characterSheet}>Select Level</Dropdown.Toggle>\r\n        <Dropdown.Menu>\r\n          {milestoneLevels.map(([lv, as]) => {\r\n            const sameLevel = lv === ascensionMaxLevel[as]\r\n            const lvlstr = sameLevel ? `Lv. ${lv}` : `Lv. ${lv}/${ascensionMaxLevel[as]}`\r\n            return <DropdownItem key={`${lv}/${as}`} onClick={() => characterDispatch({ level: lv, ascension: as })}>{lvlstr}</DropdownItem>\r\n          })}\r\n        </Dropdown.Menu>\r\n      </Dropdown>\r\n    </ButtonGroup>\r\n  </InputGroup> : <span>{HeaderIconDisplay} {characterSheet && weaponSheet && Character.getLevelString(character)}</span>}</>\r\n}\r\nfunction CharDropdownItem({ characterKey, setCharacterKey }) {\r\n  const characterSheet = usePromise(CharacterSheet.get(characterKey), [characterKey])\r\n  if (!characterSheet) return null\r\n  return <Dropdown.Item onClick={() => setCharacterKey(characterKey)} className=\"pl-2 pr-0\">\r\n    <Row>\r\n      <Col xs=\"auto\"><Image src={characterSheet.thumbImg} className={`thumb-small p-0 m-n1 grad-${characterSheet.star}star`} thumbnail /></Col>\r\n      <Col>{characterSheet.name}</Col>\r\n    </Row>\r\n  </Dropdown.Item>\r\n}","import { Badge } from \"react-bootstrap\"\r\nimport { ArtifactSheet } from \"../Artifact/ArtifactSheet\"\r\nimport { ArtifactSetKey, ElementKey } from \"../Types/consts\"\r\nimport WeaponSheet from \"../Weapon/WeaponSheet\"\r\nimport CharacterSheet from \"./CharacterSheet\"\r\n\r\nexport function getFormulaTargetsDisplayHeading(key: string, { characterSheet, weaponSheet, artifactSheets }: { characterSheet: CharacterSheet, weaponSheet: WeaponSheet, artifactSheets: StrictDict<ArtifactSetKey, ArtifactSheet> }, eleKey: ElementKey = \"anemo\") {\r\n  if (key === \"basicKeys\") return \"Basic Stats\"\r\n  else if (key === \"genericAvgHit\") return \"Generic Optimization Values\"\r\n  else if (key === \"transReactions\") return \"Transformation Reaction\"\r\n  else if (key.startsWith(\"talentKey_\")) {\r\n    const subkey = key.split(\"talentKey_\")[1]\r\n    return (characterSheet?.getTalentOfKey(subkey, eleKey)?.name ?? subkey)\r\n  } else if (key.startsWith(\"weapon_\")) {\r\n    const subkey = key.split(\"weapon_\")[1]\r\n    return (weaponSheet?.name ?? subkey)\r\n  } else if (key.startsWith(\"artifact_\")) {\r\n    const [, setKey, num] = key.split('_')\r\n    return <span>{artifactSheets[setKey]?.name} <Badge variant=\"success\">{num}-Set</Badge></span>\r\n  }\r\n  return \"\"\r\n}","import { faCheckSquare, faSquare } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React from 'react';\r\nimport Badge from 'react-bootstrap/Badge';\r\nimport Button from 'react-bootstrap/Button';\r\nimport Dropdown from 'react-bootstrap/Dropdown';\r\nimport { ICalculatedStats } from '../Types/stats';\r\nimport IConditional, { IConditionalValue } from '../Types/IConditional';\r\nimport { evalIfFunc } from '../Util/Util';\r\n\r\nexport default function ConditionalSelector({ conditional, conditionalValue, setConditional, name, disabled, stats }:\r\n  { conditional: IConditional, conditionalValue: IConditionalValue, setConditional: (newCond: IConditionalValue) => void, name: Displayable, disabled: boolean, stats: ICalculatedStats }) {\r\n  const [conditionalNum = 0, conditionalStateKey] = conditionalValue\r\n  if (!conditional) return name as JSX.Element\r\n  if (\"states\" in conditional) {//complex conditional\r\n    const state = conditionalStateKey ? conditional.states[conditionalStateKey] : Object.values(conditional.states)[0]\r\n    const text = conditionalNum === 0 ? \"Not Active\" : <span>{state.name} {(evalIfFunc(state!.maxStack, stats) as number > 1 ? (`: ${conditionalNum} stack${conditionalNum > 1 ? \"s\" : \"\"}`) : \"\")}</span>\r\n    const badge = <Badge variant={conditionalNum === 0 ? \"secondary\" : \"success\"}>{text}</Badge>\r\n    return <Dropdown>\r\n      <Dropdown.Toggle size=\"sm\" disabled={disabled}>\r\n        <h6 className=\"mb-0 d-inline\" style={{ whiteSpace: \"normal\" }}>{name} {badge}</h6>\r\n      </Dropdown.Toggle>\r\n      <Dropdown.Menu>\r\n        <Dropdown.Item onClick={() => setConditional([0])}>\r\n          <span>Not Active</span>\r\n        </Dropdown.Item>\r\n        {Object.entries(conditional.states).map(([stateKey, condial]: any, i) =>\r\n          <React.Fragment key={i}>\r\n            {[...Array(condial.maxStack).keys()].map(v => v + 1).map((stack, i) =>\r\n              <Dropdown.Item key={stateKey + i} onClick={() => setConditional([stack, stateKey])}>\r\n                {condial.name}{condial.maxStack > 1 ? `: ${stack} stack${stack > 1 ? \"s\" : \"\"}` : \"\"}\r\n              </Dropdown.Item>)}\r\n          </React.Fragment>\r\n        )}\r\n      </Dropdown.Menu>\r\n    </Dropdown>\r\n  } else {\r\n    const maxStack = evalIfFunc(conditional!.maxStack, stats) as number\r\n    if (maxStack > 1) {\r\n      //stacking conditional\r\n      const badge = <Badge variant={conditionalNum === 0 ? \"secondary\" : \"success\"}>{conditionalNum > 0 ? `${conditionalNum} stack${conditionalNum > 1 ? \"s\" : \"\"}` : \"Not Active\"}</Badge>\r\n      return <Dropdown>\r\n        <Dropdown.Toggle size=\"sm\" disabled={disabled}>\r\n          <h6 className=\"mb-0 d-inline\" style={{ whiteSpace: \"normal\" }}>{name} {badge}</h6>\r\n        </Dropdown.Toggle>\r\n        <Dropdown.Menu>\r\n          <Dropdown.Item onClick={() => setConditional([0])}>\r\n            <span>Not Active</span>\r\n          </Dropdown.Item>\r\n          {[...Array(maxStack).keys()].map(v => v + 1).map(stack =>\r\n            <Dropdown.Item key={stack} onClick={() => setConditional([stack])}>\r\n              {`${stack} stack${stack > 1 ? \"s\" : \"\"}`}\r\n            </Dropdown.Item>)}\r\n        </Dropdown.Menu>\r\n      </Dropdown>\r\n    } else if (maxStack === 1) {//single boolean conditional\r\n      return <Button size=\"sm\" onClick={() => setConditional([conditionalNum ? 0 : 1])} disabled={disabled}>\r\n        <h6 className=\"mb-0\"><FontAwesomeIcon icon={conditionalNum ? faCheckSquare : faSquare} /> {name}</h6>\r\n      </Button>\r\n    }\r\n  }\r\n  return null\r\n}","import { useCallback, useMemo } from \"react\"\r\nimport { Card, ListGroup } from \"react-bootstrap\"\r\nimport Conditional from \"../Conditional/Conditional\"\r\nimport ConditionalSelector from \"../Conditional/ConditionalSelector\"\r\nimport { ICalculatedStats } from \"../Types/stats\"\r\nimport IConditional from \"../Types/IConditional\"\r\nimport statsToFields from \"../Util/FieldUtil\"\r\nimport { deletePropPath, layeredAssignment, objClearEmpties } from \"../Util/Util\"\r\nimport FieldDisplay from \"./FieldDisplay\"\r\ntype ConditionalDisplayProps = {\r\n  conditional: IConditional,\r\n  equippedBuild?: ICalculatedStats,\r\n  newBuild?: ICalculatedStats,\r\n  characterDispatch: (any) => void,//TODO: characterDispatch type\r\n  editable: boolean,\r\n  fieldClassName?: string\r\n}\r\n\r\nexport default function ConditionalDisplay({ conditional, equippedBuild, newBuild, characterDispatch, editable, fieldClassName }: ConditionalDisplayProps) {\r\n  const stats = newBuild ? newBuild : equippedBuild\r\n  if (!stats) debugger\r\n  const canShow = useMemo(() => Conditional.canShow(conditional, stats), [conditional, stats])\r\n  const { stats: conditionalStats = {}, fields: conditionalFields = [], conditionalValue } = useMemo(() => canShow && Conditional.resolve(conditional, stats, undefined), [canShow, conditional, stats])\r\n  const displayFields = useMemo(() => canShow && [...statsToFields(conditionalStats, stats), ...conditionalFields], [canShow, conditionalStats, stats, conditionalFields])\r\n  const setConditional = useCallback(condV => {\r\n    if (!stats) return\r\n    const [conditionalNum = 0] = condV\r\n    if (!conditionalNum) {\r\n      deletePropPath(stats.conditionalValues, conditional!.keys)\r\n      objClearEmpties(stats.conditionalValues)\r\n    } else if (conditional.keys)\r\n      layeredAssignment(stats.conditionalValues, conditional!.keys, condV)\r\n    characterDispatch({ conditionalValues: stats.conditionalValues })\r\n  }, [conditional, stats, characterDispatch])\r\n\r\n  if (!canShow || !stats) return null\r\n  return <Card bg=\"darkcontent\" text={\"lightfont\" as any} className=\"mb-2 w-100\">\r\n    <Card.Header className=\"p-2\">\r\n      <ConditionalSelector disabled={!editable}\r\n        conditional={conditional}\r\n        conditionalValue={conditionalValue}\r\n        setConditional={setConditional}\r\n        name={conditional.name}\r\n        stats={stats} />\r\n    </Card.Header>\r\n    <ListGroup className=\"text-white\" variant=\"flush\">\r\n      {displayFields.map((field, i) => <FieldDisplay key={i} index={i} {...{ field, equippedBuild, newBuild, className: fieldClassName }} />)}\r\n    </ListGroup>\r\n  </Card>\r\n}","import { ListGroup } from \"react-bootstrap\"\r\nimport ConditionalDisplay from \"./ConditionalDisplay\"\r\nimport { DocumentSection } from \"../Types/character\"\r\nimport { ICalculatedStats } from \"../Types/stats\"\r\nimport { evalIfFunc } from \"../Util/Util\"\r\nimport FieldDisplay from \"./FieldDisplay\"\r\n\r\ntype SkillDisplayCardProps = {\r\n  sections: DocumentSection[],\r\n  characterDispatch: (any) => void,\r\n  equippedBuild?: ICalculatedStats,\r\n  newBuild?: ICalculatedStats,\r\n  editable: boolean,\r\n}\r\nexport default function DocumentDisplay({ sections, characterDispatch, equippedBuild, newBuild, editable }: SkillDisplayCardProps) {\r\n  const build = newBuild ? newBuild : equippedBuild\r\n  if (!build) return null\r\n  return <div className=\"w-100\">{sections?.map((section, i) => {\r\n    if (!section.canShow!(build)) return null\r\n    const talentText = evalIfFunc(section.text, build)\r\n    const fields = section.fields ?? []\r\n    return <div className=\"my-2\" key={\"section\" + i}>\r\n      <div {...{ xs: 12 }}>\r\n        <div className=\"mb-2\">{talentText}</div>\r\n        {fields.length > 0 && <ListGroup className=\"text-white mb-2\">\r\n          {fields?.map?.((field, i) => <FieldDisplay key={i} index={i} {...{ field, equippedBuild, newBuild }} />)}\r\n        </ListGroup>}\r\n      </div>\r\n      {!!section.conditional && <ConditionalDisplay {...{ conditional: section.conditional, equippedBuild, newBuild, characterDispatch, editable }} />}\r\n    </div>\r\n  })}</div>\r\n}\r\n","import { Badge, Card, ListGroup } from \"react-bootstrap\"\r\nimport DocumentDisplay from \"../../Components/DocumentDisplay\"\r\nimport FieldDisplay from \"../../Components/FieldDisplay\"\r\nimport { ArtifactSetKey, SetNum } from \"../../Types/consts\"\r\nimport { ICalculatedStats } from \"../../Types/stats\"\r\nimport statsToFields from \"../../Util/FieldUtil\"\r\nimport { usePromise } from \"../../Util/ReactUtil\"\r\nimport { ArtifactSheet } from \"../ArtifactSheet\"\r\n\r\ntype Data = {\r\n  setKey: ArtifactSetKey,\r\n  setNumKey: SetNum,\r\n  editable: boolean,\r\n  newBuild?: ICalculatedStats,\r\n  equippedBuild?: ICalculatedStats\r\n  characterDispatch: (arg0: any) => void,\r\n}\r\n\r\nexport default function SetEffectDisplay({ setKey, setNumKey, equippedBuild, newBuild, editable, characterDispatch }: Data) {\r\n  const sheet = usePromise(ArtifactSheet.get(setKey), [setKey])\r\n  if (!sheet) return null\r\n\r\n  const stats = newBuild ?? equippedBuild!\r\n  const setEffectText = sheet.setEffectDesc(setNumKey)\r\n  const setStats = sheet.setNumStats(setNumKey, stats)\r\n  const setStatsFields = statsToFields(setStats, stats)\r\n  const document = sheet.setEffectDocument(setNumKey)\r\n  return <>\r\n    <Card bg=\"darkcontent\" text={\"lightfont\" as any} className=\"mb-2 w-100\" >\r\n      <Card.Header className=\"p-2\">\r\n        <Badge variant=\"success\">{setNumKey}-Set</Badge> {setEffectText}\r\n      </Card.Header>\r\n      <ListGroup className=\"text-white\" variant=\"flush\">\r\n        {setStatsFields.map((field, i) => <FieldDisplay key={i} index={i} {...{ field, equippedBuild, newBuild }} />)}\r\n      </ListGroup>\r\n    </Card>\r\n    {document ? <DocumentDisplay {...{ sections: document, equippedBuild, newBuild, characterDispatch, editable }} /> : null}\r\n  </>\r\n}\r\n","\r\n//take the new statsDisplayKeys, and display the stats.\r\n\r\nimport { Card, Col, Row } from \"react-bootstrap\"\r\nimport StatDisplay from \"../../Components/StatDisplay\"\r\nimport { ICharacter } from \"../../Types/character\"\r\nimport CharacterSheet from \"../CharacterSheet\"\r\nimport { ICalculatedStats } from \"../../Types/stats\"\r\nimport WeaponSheet from \"../../Weapon/WeaponSheet\"\r\nimport { ArtifactSetKey } from \"../../Types/consts\"\r\nimport { ArtifactSheet } from \"../../Artifact/ArtifactSheet\"\r\nimport { getFormulaTargetsDisplayHeading } from \"../CharacterUtil\"\r\n\r\ntype StatDisplayComponentProps = {\r\n  sheets: {\r\n    characterSheet: CharacterSheet\r\n    weaponSheet: WeaponSheet,\r\n    artifactSheets: StrictDict<ArtifactSetKey, ArtifactSheet>\r\n  },\r\n  character: ICharacter\r\n  statsDisplayKeys: any,\r\n  editable: boolean,\r\n  cardbg?: string\r\n  equippedBuild?: ICalculatedStats\r\n  newBuild?: ICalculatedStats\r\n}\r\n\r\nexport default function StatDisplayComponent({ sheets, sheets: { characterSheet, weaponSheet }, character, equippedBuild, newBuild, statsDisplayKeys, editable, cardbg = \"darkcontent\" }: StatDisplayComponentProps) {\r\n  const build = newBuild ? newBuild : equippedBuild\r\n  return <Row className=\"mb-n2\">{Object.entries(statsDisplayKeys).map(([sectionKey, sectionValues]: any) => {\r\n    const header = getFormulaTargetsDisplayHeading(sectionKey, sheets, build?.characterEle)\r\n    return <Col key={sectionKey} className=\"mb-2\" xs={12} md={6} xl={4}>\r\n      <Card bg={cardbg} text={\"lightfont\" as any} className=\"h-100\">\r\n        <Card.Header>{header}</Card.Header>\r\n        <Card.Body>\r\n          <Row>{sectionValues.map(statKey => <StatDisplay key={JSON.stringify(statKey)} {...{ characterSheet, weaponSheet, character, equippedBuild, newBuild, editable, statKey }} />)}</Row>\r\n        </Card.Body>\r\n      </Card>\r\n    </Col>\r\n  })}</Row>\r\n}","import { useMemo } from \"react\"\r\nimport { Col, Row } from \"react-bootstrap\"\r\nimport Character from \"../Character/Character\"\r\nimport CharacterSheet from \"../Character/CharacterSheet\"\r\nimport Formula from \"../Formula\"\r\nimport Stat from \"../Stat\"\r\nimport { ICharacter } from \"../Types/character\"\r\nimport { IFieldDisplay } from \"../Types/IFieldDisplay\"\r\nimport { ICalculatedStats } from \"../Types/stats\"\r\nimport { usePromise } from \"../Util/ReactUtil\"\r\nimport WeaponSheet from \"../Weapon/WeaponSheet\"\r\nimport StatIcon from \"./StatIcon\"\r\n\r\nfunction DisplayStatDiff({ label = \"\", val, oldVal, fixed = 0, unit = \"\", variant = \"\" }) {\r\n  if (typeof oldVal === \"undefined\" && typeof val === \"number\") {//if only one value is filled, display that one.\r\n    oldVal = val\r\n    val = undefined\r\n  }\r\n  const diff = val !== undefined ? val - oldVal : 0;\r\n  let oldText: Displayable = \"\", diffText: Displayable = \"\"\r\n  if (oldVal || diff === 0) oldText = oldVal?.toFixed(fixed)\r\n  else if (oldVal === undefined) oldText = val?.toFixed(fixed)//if oldval isnt defined, just display val.\r\n  if (oldText) oldText = <span className={`text-${variant}`}>{oldText}{unit}</span>\r\n  if (diff !== 0) diffText = <span className={`text-${diff > 0 ? \"success\" : \"danger\"}`}>{diff > 0 ? \"+\" : \"\"}{diff?.toFixed(fixed)}{unit}</span>\r\n\r\n  return <Col xs=\"12\"><Row>\r\n    <Col><b>{label}</b></Col>\r\n    <Col xs=\"auto\">{oldText}{diff ? \" \" : \"\"}{diffText}</Col>\r\n  </Row></Col>\r\n}\r\ntype StatDisplayProps = {\r\n  characterSheet: CharacterSheet,\r\n  weaponSheet: WeaponSheet\r\n  character: ICharacter,\r\n  equippedBuild?: ICalculatedStats,\r\n  newBuild?: ICalculatedStats,\r\n  editable: boolean,\r\n  statKey: string\r\n}\r\nexport default function StatDisplay({ characterSheet, weaponSheet, character, equippedBuild, newBuild, editable, statKey }: StatDisplayProps) {\r\n  const formula = usePromise(Array.isArray(statKey) ? Formula.get(statKey) : undefined, [statKey])\r\n\r\n  const { val, oldVal, fixed, unit, variant, label } = useMemo(() => {\r\n    let val, oldVal, fixed, unit, variant, label: Displayable = \"\"\r\n    if (typeof statKey === \"string\") {//basic statKey\r\n      if (newBuild && equippedBuild) {//comparable\r\n        //newbuild -> val\r\n        //equippedbuild ->old\r\n        val = newBuild?.[statKey] ?? 0\r\n        oldVal = equippedBuild?.[statKey] ?? 0\r\n      } else {\r\n        const build = newBuild ? newBuild : equippedBuild\r\n        //build ->val\r\n        val = build?.[statKey] ?? 0\r\n        //statvaluewith override -> old\r\n        const invalid = \"invalid\" //can't use undeinfed as the defVal, since I want undefined for invalid numbers.\r\n        oldVal = Character.getStatValueWithOverride(character, characterSheet, weaponSheet, statKey) ?? invalid\r\n        oldVal === invalid && (oldVal = undefined)\r\n        if (build) {\r\n          if (statKey === \"finalHP\")\r\n            oldVal = build.characterHP\r\n          else if (statKey === \"finalDEF\")\r\n            oldVal = build.characterDEF\r\n          else if (statKey === \"finalATK\")\r\n            oldVal = build.characterATK + build.weaponATK\r\n        }\r\n      }\r\n      unit = Stat.getStatUnit(statKey)\r\n      fixed = Stat.fixedUnit(statKey)\r\n      label = <span>{StatIcon[statKey]} {Stat.getStatName(statKey)}</span>\r\n    } else if (formula) {//Formula\r\n      const build = newBuild ? newBuild : equippedBuild\r\n      const field = (formula as any).field as IFieldDisplay //assume it is attached in post-processing\r\n      const labelVariant = Character.getTalentFieldValue(field, \"variant\", build)\r\n      label = <span className={`text-${labelVariant}`}>{Character.getTalentFieldValue(field, \"text\", build)}</span>\r\n      fixed = Character.getTalentFieldValue(field, \"fixed\", build, 0 as any)\r\n      val = Character.getTalentFieldValue(field, \"formula\", build)?.[0]?.(build)\r\n      if (newBuild && equippedBuild) {//comparable\r\n        oldVal = Character.getTalentFieldValue(field, \"formula\", equippedBuild)?.[0]?.(equippedBuild)\r\n      }\r\n    }\r\n    if (editable && Character.hasOverride(character, statKey)) variant = \"warning\"\r\n    return { val, oldVal, fixed, unit, variant, label }\r\n  }, [character, characterSheet, weaponSheet, equippedBuild, newBuild, editable, statKey, formula])\r\n\r\n  return <DisplayStatDiff {...{ val, oldVal, fixed, unit, variant, label: label as any }} />\r\n}","import { faUndo } from \"@fortawesome/free-solid-svg-icons\"\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\r\nimport Button from \"react-bootstrap/Button\"\r\nimport InputGroup from \"react-bootstrap/InputGroup\"\r\nimport OverlayTrigger from \"react-bootstrap/OverlayTrigger\"\r\nimport Tooltip from \"react-bootstrap/Tooltip\"\r\nimport CustomFormControl from \"../Components/CustomFormControl\"\r\n\r\ntype StatInputInput = {\r\n  name: Displayable,\r\n  prependEle?: Displayable,\r\n  value: number,\r\n  placeholder: string,\r\n  defaultValue: number,\r\n  onValueChange: (newValue: number | undefined) => void,\r\n  percent?: boolean,\r\n  disabled?: boolean,\r\n  className?: any,\r\n}\r\n\r\nconst StatInput = ({ name, prependEle, value, placeholder, defaultValue, onValueChange, percent = false, disabled = false, ...restProps }: StatInputInput) =>\r\n  <InputGroup {...restProps}>\r\n    {prependEle ? <InputGroup.Prepend>{prependEle}</InputGroup.Prepend> : null}\r\n    <InputGroup.Prepend>\r\n      <InputGroup.Text>{name}</InputGroup.Text>\r\n    </InputGroup.Prepend>\r\n    <CustomFormControl\r\n      float={percent}\r\n      placeholder={placeholder}\r\n      value={value}\r\n      onChange={onValueChange}\r\n      disabled={disabled}\r\n    />\r\n    <InputGroup.Append>\r\n      {Boolean(percent) && <InputGroup.Text>%</InputGroup.Text>}\r\n      {defaultValue !== undefined && <OverlayTrigger placement=\"top\"\r\n        overlay={<Tooltip id=\"reset-tooltip\">Reset this override to the default value.</Tooltip>}>\r\n        <span className=\"d-inline-block\">\r\n          <Button onClick={() => onValueChange(defaultValue)} disabled={disabled || value === defaultValue} style={value === defaultValue ? { pointerEvents: 'none' } : {}}>\r\n            <FontAwesomeIcon icon={faUndo} />\r\n          </Button>\r\n        </span>\r\n      </OverlayTrigger>}\r\n    </InputGroup.Append>\r\n  </InputGroup>\r\nexport default StatInput","import { faCheckSquare, faSquare, faWindowMaximize, faWindowMinimize } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { useContext, useMemo } from 'react';\r\nimport { Accordion, AccordionContext, Button, Card, Col, Dropdown, Row, ToggleButton, ToggleButtonGroup } from \"react-bootstrap\";\r\nimport { useAccordionToggle } from 'react-bootstrap/AccordionToggle';\r\nimport { ArtifactSheet } from \"../../Artifact/ArtifactSheet\";\r\nimport StatIcon, { uncoloredEleIcons } from \"../../Components/StatIcon\";\r\nimport Formula from \"../../Formula\";\r\nimport Stat, { FormulaDisplay } from \"../../Stat\";\r\nimport { GetDependencies } from \"../../StatDependency\";\r\nimport { ICharacter } from \"../../Types/character\";\r\nimport { allElements, ArtifactSetKey } from \"../../Types/consts\";\r\nimport { IFieldDisplay } from \"../../Types/IFieldDisplay\";\r\nimport { ICalculatedStats } from \"../../Types/stats\";\r\nimport { usePromise } from \"../../Util/ReactUtil\";\r\nimport WeaponSheet from \"../../Weapon/WeaponSheet\";\r\nimport Character from \"../Character\";\r\nimport CharacterSheet from \"../CharacterSheet\";\r\nimport { getFormulaTargetsDisplayHeading } from \"../CharacterUtil\";\r\nimport StatInput from \"../StatInput\";\r\nconst infusionVals = {\r\n  \"\": <span>No External Infusion</span>,\r\n  \"pyro\": <span >{uncoloredEleIcons.pyro} Pyro Infusion</span>,\r\n  \"cryo\": <span >{uncoloredEleIcons.cryo} Cryo Infusion</span>,\r\n}\r\ntype InfusionAuraDropdownProps = {\r\n  characterSheet: CharacterSheet,\r\n  character: ICharacter,\r\n  characterDispatch: (any) => void,\r\n  className?: string\r\n}\r\nexport function InfusionAuraDropdown({ characterSheet, character: { infusionAura = \"\", characterKey }, characterDispatch, className }: InfusionAuraDropdownProps) {\r\n  if (!characterSheet.isMelee()) return null\r\n  return <Dropdown className={className}>\r\n    <Dropdown.Toggle variant={infusionAura || \"secondary\"}>{infusionVals[infusionAura]}</Dropdown.Toggle>\r\n    <Dropdown.Menu>\r\n      {Object.entries(infusionVals).map(([key, text]) => <Dropdown.Item key={key} className={`text-${key}`} onClick={() => characterDispatch({ infusionAura: key })}>{text}</Dropdown.Item>)}\r\n    </Dropdown.Menu>\r\n  </Dropdown>\r\n}\r\n\r\ntype ReactionToggleProps = {\r\n  character: ICharacter,\r\n  build: ICalculatedStats,\r\n  characterDispatch: (any) => void,\r\n  className: string\r\n}\r\nexport function ReactionToggle({ character: { reactionMode = null, infusionAura }, build, characterDispatch, className }: ReactionToggleProps) {\r\n  if (!build) return null\r\n  const charEleKey = build.characterEle\r\n  if (![\"pyro\", \"hydro\", \"cryo\"].includes(charEleKey) && ![\"pyro\", \"hydro\", \"cryo\"].includes(infusionAura)) return null\r\n  const v = s => s ? \"success\" : \"secondary\"\r\n  return <ToggleButtonGroup className={className} type=\"radio\" name=\"reactionMode\" value={reactionMode} onChange={val => characterDispatch({ reactionMode: val === \"none\" ? null : val })}>\r\n    <ToggleButton value={\"none\"} variant={v(!reactionMode)}>No Reactions</ToggleButton >\r\n    {(charEleKey === \"pyro\" || infusionAura === \"pyro\") && <ToggleButton value={\"pyro_vaporize\"} variant={v(reactionMode === \"pyro_vaporize\")}>\r\n      <span className=\"text-vaporize\">Vaporize(Pyro) {StatIcon.hydro}+{StatIcon.pyro}</span>\r\n    </ToggleButton >}\r\n    {(charEleKey === \"pyro\" || infusionAura === \"pyro\") && <ToggleButton value={\"pyro_melt\"} variant={v(reactionMode === \"pyro_melt\")}>\r\n      <span className=\"text-melt\">Melt(Pyro) {StatIcon.cryo}+{StatIcon.pyro}</span>\r\n    </ToggleButton >}\r\n    {(charEleKey === \"hydro\" || infusionAura === \"hydro\") && <ToggleButton value={\"hydro_vaporize\"} variant={v(reactionMode === \"hydro_vaporize\")}>\r\n      <span className=\"text-vaporize\">Vaporize(Hydro) {StatIcon.pyro}+{StatIcon.hydro}</span>\r\n    </ToggleButton >}\r\n    {(charEleKey === \"cryo\" || infusionAura === \"cryo\") && <ToggleButton value={\"cryo_melt\"} variant={v(reactionMode === \"cryo_melt\")}>\r\n      <span className=\"text-melt\">Melt(Cryo) {StatIcon.pyro}+{StatIcon.cryo}</span>\r\n    </ToggleButton >}\r\n  </ToggleButtonGroup>\r\n}\r\nexport function HitModeToggle({ hitMode, characterDispatch, className }) {\r\n  const v = s => s ? \"success\" : \"secondary\"\r\n  return <ToggleButtonGroup type=\"radio\" value={hitMode} name=\"hitOptions\" onChange={m => characterDispatch({ hitMode: m })} className={className}>\r\n    <ToggleButton value=\"avgHit\" variant={v(hitMode === \"avgHit\")}>Avg. DMG</ToggleButton>\r\n    <ToggleButton value=\"hit\" variant={v(hitMode === \"hit\")}>Non Crit DMG</ToggleButton>\r\n    <ToggleButton value=\"critHit\" variant={v(hitMode === \"critHit\")}>Crit Hit DMG</ToggleButton>\r\n  </ToggleButtonGroup>\r\n}\r\n\r\nfunction CalculationDisplay({ sheets, build }: {\r\n  sheets: {\r\n    characterSheet: CharacterSheet\r\n    weaponSheet: WeaponSheet,\r\n    artifactSheets: StrictDict<ArtifactSetKey, ArtifactSheet>\r\n  },\r\n  build: ICalculatedStats\r\n}) {\r\n  const displayStatKeys = useMemo(() => build && Character.getDisplayStatKeys(build, sheets), [build, sheets])\r\n  if (!build) return null\r\n  return <div>\r\n    {Object.entries(displayStatKeys).map(([sectionKey, fields]: [string, any]) => {\r\n      const header = getFormulaTargetsDisplayHeading(sectionKey, sheets, build.characterEle)\r\n      return <Card bg=\"darkcontent\" text={\"lightfont\" as any} key={sectionKey} className=\"w-100 mb-2\">\r\n        <Card.Header>{header}</Card.Header>\r\n        <Card.Body className=\"p-2\">\r\n          <Accordion className=\"mb-n2\">\r\n            {fields.map((field, fieldIndex) => {\r\n              if (Array.isArray(field))\r\n                return <FormulaCalculationField key={fieldIndex} fieldKeys={field} build={build} fieldIndex={fieldIndex} />\r\n              else if (typeof field === \"string\") {//simple statKey field\r\n                const subFormulaKeys: any[] = Stat.getPrintableFormulaStatKeyList(GetDependencies(build, build?.modifiers, [field]), build?.modifiers).reverse()\r\n                return Boolean(subFormulaKeys.length) && <Card key={fieldIndex} bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n                  <Accordion.Toggle as={Card.Header} className=\"p-2 cursor-pointer\" variant=\"link\" eventKey={`field${fieldIndex}`}>\r\n                    {Stat.printStat(field, build)}\r\n                  </Accordion.Toggle>\r\n                  <Accordion.Collapse eventKey={`field${fieldIndex}`}>\r\n                    <Card.Body className=\"p-2\">\r\n                      <div className=\"mb-n2\">\r\n                        {subFormulaKeys.map(subKey =>\r\n                          <p className=\"mb-2\" key={subKey}>{Stat.printStat(subKey, build)} = <small><FormulaDisplay statKey={subKey} stats={build} modifiers={build.modifiers} expand={false} /></small></p>\r\n                        )}\r\n                      </div>\r\n                    </Card.Body>\r\n                  </Accordion.Collapse>\r\n                </Card>\r\n              }\r\n              return null\r\n            })}\r\n          </Accordion>\r\n        </Card.Body>\r\n      </Card>\r\n    })}\r\n  </div>\r\n}\r\nfunction FormulaCalculationField({ fieldKeys, build, fieldIndex }: { fieldKeys: string[], build: ICalculatedStats, fieldIndex: number, }) {\r\n  const formula = usePromise(Formula.get(fieldKeys), [fieldKeys])\r\n  if (!formula) return null\r\n  const formulaField = (formula as any).field as IFieldDisplay\r\n  const fieldText = Character.getTalentFieldValue(formulaField, \"text\", build)\r\n  const fieldVariant = Character.getTalentFieldValue(formulaField, \"variant\", build)\r\n  const fieldFormulaText = Character.getTalentFieldValue(formulaField, \"formulaText\", build)\r\n  const fieldFixed = Character.getTalentFieldValue(formulaField, \"fixed\", build) ?? 0\r\n  const fieldUnit = Character.getTalentFieldValue(formulaField, \"unit\", build) ?? \"\"\r\n  const [fieldFormula, fieldFormulaDependency] = Character.getTalentFieldValue(formulaField, \"formula\", build, [] as any)\r\n  if (!fieldFormula || !fieldFormulaDependency) return null\r\n  const fieldValue = fieldFormula?.(build)?.toFixed?.(fieldFixed)\r\n  const subFormulaKeys = Stat.getPrintableFormulaStatKeyList(GetDependencies(build, build?.modifiers, fieldFormulaDependency), build?.modifiers).reverse()\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n    <Accordion.Toggle as={Card.Header} className=\"p-2 cursor-pointer\" variant=\"link\" eventKey={`field${fieldIndex}`}>\r\n      <b className={`text-${fieldVariant}`}>{fieldText}</b> <span className=\"text-info\">{fieldValue}{fieldUnit}</span>\r\n    </Accordion.Toggle>\r\n    <Accordion.Collapse eventKey={`field${fieldIndex}`}>\r\n      <Card.Body className=\"p-2\">\r\n        <div className=\"mb-n2\">\r\n          <p className=\"mb-2\"><b className={`text-${fieldVariant}`}>{fieldText}</b> <span className=\"text-info\">{fieldValue}</span> = <small>{fieldFormulaText}</small></p>\r\n          {subFormulaKeys.map(subKey =>\r\n            <p className=\"mb-2\" key={subKey}>{Stat.printStat(subKey, build)} = <small><FormulaDisplay statKey={subKey} stats={build} modifiers={build.modifiers} expand={false} /></small></p>\r\n          )}\r\n        </div>\r\n      </Card.Body>\r\n    </Accordion.Collapse>\r\n  </Card>\r\n}\r\n\r\nconst ContextAwareToggle = ({ eventKey, callback }) => {\r\n  const currentEventKey = useContext(AccordionContext);\r\n  const decoratedOnClick = useAccordionToggle(\r\n    eventKey,\r\n    () => callback && callback(eventKey),\r\n  );\r\n  const expanded = currentEventKey === eventKey;\r\n  return (\r\n    <Button onClick={decoratedOnClick} variant=\"info\">\r\n      <FontAwesomeIcon icon={expanded ? faWindowMinimize : faWindowMaximize} className={`fa-fw ${expanded ? \"fa-rotate-180\" : \"\"}`} />\r\n      <span> </span>{expanded ? \"Retract\" : \"Expand\"}\r\n    </Button>\r\n  );\r\n}\r\n\r\ntype DamageOptionsAndCalculationProps = {\r\n  sheets: {\r\n    characterSheet: CharacterSheet\r\n    weaponSheet: WeaponSheet,\r\n    artifactSheets: StrictDict<ArtifactSetKey, ArtifactSheet>\r\n  }\r\n  character: ICharacter,\r\n  characterDispatch: (any) => void,\r\n  equippedBuild?: ICalculatedStats,\r\n  newBuild?: ICalculatedStats,\r\n  className: string\r\n}\r\nexport default function DamageOptionsAndCalculation({ sheets, sheets: { characterSheet, weaponSheet }, character, character: { hitMode }, characterDispatch, newBuild, equippedBuild, className }: DamageOptionsAndCalculationProps) {\r\n  //choose which one to display stats for\r\n  const build = newBuild ? newBuild : equippedBuild!\r\n  return <div className={className}>\r\n    <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n      <Card.Header>\r\n        <Row className=\"mb-n2\">\r\n          <Col xs=\"auto\"><InfusionAuraDropdown characterSheet={characterSheet} character={character} characterDispatch={characterDispatch} className=\"mb-2\" /></Col>\r\n          <Col xs=\"auto\"><HitModeToggle hitMode={hitMode} characterDispatch={characterDispatch} className=\"mb-2\" /></Col>\r\n          <Col xs=\"auto\"><ReactionToggle character={character} build={build} characterDispatch={characterDispatch} className=\"mb-2\" /></Col>\r\n        </Row>\r\n      </Card.Header>\r\n    </Card>\r\n    <Accordion >\r\n      <Card bg=\"lightcontent\" text={\"lightfont\" as any} >\r\n        <Card.Header>\r\n          <Row>\r\n            <Col>\r\n              <span className=\"d-block\">Damage Calculation Options & Formulas</span>\r\n              <small>Expand below to edit enemy details and view calculation details.</small>\r\n            </Col>\r\n            <Col xs=\"auto\">\r\n              <ContextAwareToggle callback={undefined} {...{ as: Button }} eventKey=\"details\" />\r\n            </Col>\r\n          </Row>\r\n        </Card.Header>\r\n        <Accordion.Collapse eventKey=\"details\">\r\n          <Card.Body className=\"p-2\">\r\n            <Card className=\"mb-2\" bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n              <Card.Header>\r\n                <Row>\r\n                  <Col>Enemy Editor</Col>\r\n                  <Col xs=\"auto\">\r\n                    <Button variant=\"warning\" size=\"sm\">\r\n                      <a href=\"https://genshin-impact.fandom.com/wiki/Resistance#Base_Enemy_Resistances\" target=\"_blank\" rel=\"noreferrer\">To get the specific resistance values of enemies, please visit the wiki.</a>\r\n                    </Button >\r\n                  </Col>\r\n                </Row>\r\n              </Card.Header>\r\n              <Card.Body className=\"p-2\">\r\n                <Row >\r\n                  <Col xs={12} xl={6} className=\"mb-2\">\r\n                    <StatInput\r\n                      name={<b>Enemy Level</b>}\r\n                      value={Character.getStatValueWithOverride(character, characterSheet, weaponSheet, \"enemyLevel\")}\r\n                      placeholder={Stat.getStatNameRaw(\"enemyLevel\")}\r\n                      defaultValue={Character.getBaseStatValue(character, characterSheet, weaponSheet, \"enemyLevel\")}\r\n                      onValueChange={value => characterDispatch({ type: \"statOverride\", statKey: \"enemyLevel\", value, characterSheet, weaponSheet })}\r\n                    />\r\n                  </Col>\r\n                  {[\"physical\", ...allElements].map(eleKey => {\r\n                    let statKey = `${eleKey}_enemyRes_`\r\n                    let immunityStatKey = `${eleKey}_enemyImmunity`\r\n                    let elementImmunity = Character.getStatValueWithOverride(character, characterSheet, weaponSheet, immunityStatKey)\r\n                    return <Col xs={12} xl={6} key={eleKey} className=\"mb-2\">\r\n                      <StatInput\r\n                        prependEle={<Button variant={eleKey} onClick={() => characterDispatch({ type: \"statOverride\", statKey: immunityStatKey, value: !elementImmunity, characterSheet, weaponSheet })} className=\"text-darkcontent\">\r\n                          <FontAwesomeIcon icon={elementImmunity ? faCheckSquare : faSquare} className=\"fa-fw\" /> Immunity\r\n                        </Button>}\r\n                        name={<b>{Stat.getStatName(statKey)}</b>}\r\n                        value={Character.getStatValueWithOverride(character, characterSheet, weaponSheet, statKey)}\r\n                        placeholder={Stat.getStatNameRaw(statKey)}\r\n                        defaultValue={Character.getBaseStatValue(character, characterSheet, weaponSheet, statKey)}\r\n                        onValueChange={value => characterDispatch({ type: \"statOverride\", statKey, value, characterSheet, weaponSheet })}\r\n                        disabled={elementImmunity}\r\n                        percent\r\n                      />\r\n                    </Col>\r\n                  })}\r\n                  <Col xs={12}><small>Note: for negative resistances due to resistance shred like Zhongli's shield (e.g. -10%), enter the RAW value (-10). GO will half the value for you in the calculations.</small></Col>\r\n                </Row>\r\n              </Card.Body>\r\n            </Card>\r\n            <CalculationDisplay sheets={sheets} build={build} />\r\n          </Card.Body>\r\n        </Accordion.Collapse>\r\n      </Card>\r\n    </Accordion>\r\n  </div>\r\n}\r\n"],"sourceRoot":""}