{"version":3,"sources":["Components/StarDisplay.tsx","Assets/Weapon-class-bow-icon.png","Assets/Assets.ts","Assets/Weapon-class-catalyst-icon.png","Assets/Weapon-class-claymore-icon.png","Assets/Weapon-class-polearm-icon.png","Assets/Weapon-class-sword-icon.png","Assets/Item_Fragile_Resin.png","Assets/Item_Condensed_Resin.png","Assets/Item_Wanderer's_Advice.png","Assets/Item_Hero's_Wit.png","Assets/Item_Adventurer's_Experience.png","Character/Character.ts","Character/CharacterSelection.tsx","StatDependency.ts","Weapon/WeaponUtil.ts"],"names":["StarIcon","icon","faStar","Stars","stars","colored","className","Array","keys","map","_","i","Assets","weaponTypes","bow","catalyst","claymore","polearm","sword","resin","fragile","condensed","exp_books","advice","wit","experience","Character","this","Error","getElementalName","elementalKey","ElementalData","name","getLevelString","character","level","ascensionMaxLevel","ascension","getTalentFieldValue","field","key","stats","defVal","evalIfFunc","hasOverride","statKey","baseStatOverrides","getBaseStatValue","characetSheet","weaponSheet","includes","characterStatBase","getStatValueWithOverride","characterSheet","calculateBuild","database","artifactSheets","mainStatAssumptionLevel","artifacts","Object","fromEntries","entries","equippedArtifacts","artid","_getArt","initialStats","createInitialStats","calculateBuildwithArtifact","setToSlots","Artifact","artifactSetEffectsStats","ArtifactSheet","setEffectsStats","deepClone","values","forEach","art","mainStatKey","mainStatValue","rarity","Math","max","min","substats","substat","value","mergeStats","Conditional","parseConditionalValues","artifact","conditionalValues","conditional","conditionalValue","setKey","setNumKey","parseInt","length","condStats","resolve","val","id","dependencies","GetDependencies","modifiers","PreprocessFormulas","preprocessedStats","formula","characterKey","elementKey","hitMode","infusionAura","reactionMode","talent","constellation","equippedWeapon","weapon","_getWeapon","defaultInitialWeapon","weaponTypeKey","statKeys","characterHP","getBase","characterDEF","characterATK","characterLevel","characterEle","weaponType","tlvl","refineIndex","refine","allElements","eleKey","overrides","hasOwnProperty","specialStatKey","getSpecializedStat","specializedStatVal","getSpecializedStatVal","getTalentStatsAll","s","weaponATK","getMainStatValue","weaponSubKey","getSubStatKey","getSubStatValue","weaponCond","otherCond","canShow","getDisplayStatKeys","basicKeys","isAutoElemental","push","transReactions","ElementToReactionKeys","charFormulas","talentSheet","getTalent","addFormula","fields","parseSection","section","sheets","talentKey","sections","formKey","document","num","artifactSheet","setEffects","setNum","CharacterSelectionDropdownList","onSelect","useContext","DatabaseContext","characterSheets","usePromise","CharacterSheet","getAll","_getCharKeys","filter","cKey","sort","DropDownItem","get","Item","onClick","nameWIthIcon","CharSelectionButton","useState","show","setshow","HeaderIconDisplay","src","thumbImg","roundedCircle","disabled","CharacterSelectionModal","onHide","toggle","filterReducer","oldFilter","newFilter","sortBy","setsortBy","useReducer","elementalFilter","elementalFilterDispatch","weaponFilter","weaponFilterDispatch","sortingFunc","ck","_getChar","star","characterKeyList","Set","allCharacterKeys","a","b","diff","size","contentClassName","bg","text","Header","xs","variant","uncoloredEleIcons","allWeaponTypeKeys","type","onChange","faTimes","Body","CharacterBtn","undefined","WeaponSheet","useMemo","lg","md","thumbnail","auto","skill","burst","StatIcon","GetFormulaDependency","dependency","Proxy","target","prop","receiver","add","toString","formulaKeyDependency","freeze","Formulas","baseStat","StatData","found","numStages","InsertDependencies","flatMap","dep","has","k","path","Formula","getCurrent","getStage","initialWeapon","defaultInitialWeaponKey","location"],"mappings":"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","file":"static/js/0.904dcf68.chunk.js","sourcesContent":["import { faStar } from '@fortawesome/free-solid-svg-icons'\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\r\nimport { Rarity } from '../Types/consts'\r\n\r\nconst StarIcon = () => <FontAwesomeIcon icon={faStar} />\r\nconst Stars = ({ stars, colored = false }: { stars: Rarity, colored?: boolean }) => <span className={colored ? \"text-5star\" : \"\"}>\r\n  {stars ? [...Array(stars).keys()].map((_, i) => <StarIcon key={i} />) : null}\r\n</span>\r\n\r\nexport {\r\n  StarIcon,\r\n  Stars\r\n}\r\n","export default __webpack_public_path__ + \"static/media/Weapon-class-bow-icon.b8e7b5ca.png\";","import bow from './Weapon-class-bow-icon.png'\r\nimport catalyst from './Weapon-class-catalyst-icon.png'\r\nimport claymore from './Weapon-class-claymore-icon.png'\r\nimport polearm from './Weapon-class-polearm-icon.png'\r\nimport sword from './Weapon-class-sword-icon.png'\r\n\r\nimport fragile from './Item_Fragile_Resin.png'\r\nimport condensed from './Item_Condensed_Resin.png'\r\n\r\n//EXP BOOKS\r\nimport advice from './Item_Wanderer\\'s_Advice.png'\r\nimport wit from './Item_Hero\\'s_Wit.png'\r\nimport experience from './Item_Adventurer\\'s_Experience.png'\r\n\r\nconst Assets = {\r\n  weaponTypes: { bow, catalyst, claymore, polearm, sword },\r\n  resin: {\r\n    fragile,\r\n    condensed\r\n  },\r\n  exp_books: {\r\n    advice,\r\n    wit,\r\n    experience,\r\n  }\r\n};\r\nexport default Assets;","export default __webpack_public_path__ + \"static/media/Weapon-class-catalyst-icon.2cbef800.png\";","export default __webpack_public_path__ + \"static/media/Weapon-class-claymore-icon.17418b20.png\";","export default __webpack_public_path__ + \"static/media/Weapon-class-polearm-icon.a4e7fffc.png\";","export default __webpack_public_path__ + \"static/media/Weapon-class-sword-icon.4470b487.png\";","export default __webpack_public_path__ + \"static/media/Item_Fragile_Resin.f9ec8223.png\";","export default __webpack_public_path__ + \"static/media/Item_Condensed_Resin.1cecf64a.png\";","export default __webpack_public_path__ + \"static/media/Item_Wanderer's_Advice.58c62cf7.png\";","export default __webpack_public_path__ + \"static/media/Item_Hero's_Wit.a79e36d0.png\";","export default __webpack_public_path__ + \"static/media/Item_Adventurer's_Experience.92b5d195.png\";","import Artifact from \"../Artifact/Artifact\";\r\nimport { ArtifactSheet } from \"../Artifact/ArtifactSheet\";\r\nimport Conditional from \"../Conditional/Conditional\";\r\nimport { ascensionMaxLevel, characterStatBase } from \"../Data/CharacterData\";\r\nimport ElementalData from \"../Data/ElementalData\";\r\nimport { ArtCharDatabase } from \"../Database/Database\";\r\nimport { ElementToReactionKeys, PreprocessFormulas } from \"../StatData\";\r\nimport { GetDependencies } from \"../StatDependency\";\r\nimport { ICachedArtifact } from \"../Types/artifact\";\r\nimport { ICachedCharacter } from \"../Types/character\";\r\nimport { allElements, ArtifactSetKey, ElementKey, SlotKey } from \"../Types/consts\";\r\nimport { ICalculatedStats } from \"../Types/stats\";\r\nimport { IFieldDisplay } from \"../Types/IFieldDisplay\";\r\nimport { deepClone, evalIfFunc } from \"../Util/Util\";\r\nimport WeaponSheet from \"../Weapon/WeaponSheet\";\r\nimport CharacterSheet from \"./CharacterSheet\";\r\nimport { mergeStats } from \"../Util/StatUtil\";\r\nimport { defaultInitialWeapon } from \"../Weapon/WeaponUtil\";\r\n\r\nexport default class Character {\r\n  //do not instantiate.\r\n  constructor() { if (this instanceof Character) throw Error('A static class cannot be instantiated.'); }\r\n\r\n  static getElementalName = (elementalKey: ElementKey | \"physical\"): string =>\r\n    ElementalData[elementalKey].name\r\n  static getLevelString = (character: ICachedCharacter): string =>\r\n    `${character.level}/${ascensionMaxLevel[character.ascension]}`\r\n\r\n  static getTalentFieldValue = (field: IFieldDisplay, key: keyof IFieldDisplay, stats = {}, defVal = \"\"): any => {\r\n    if (!field[key]) return defVal\r\n    return evalIfFunc(field[key] as any, stats!)\r\n  }\r\n\r\n  static hasOverride = (character: ICachedCharacter, statKey): boolean => {\r\n    if (statKey === \"finalHP\")\r\n      return Character.hasOverride(character, \"hp\") || Character.hasOverride(character, \"hp_\") || Character.hasOverride(character, \"characterHP\")\r\n    if (statKey === \"finalDEF\")\r\n      return Character.hasOverride(character, \"def\") || Character.hasOverride(character, \"def_\") || Character.hasOverride(character, \"characterDEF\")\r\n    if (statKey === \"finalATK\")\r\n      return Character.hasOverride(character, \"atk\") || Character.hasOverride(character, \"atk_\") || Character.hasOverride(character, \"characterATK\")\r\n    return character?.baseStatOverrides ? (statKey in character.baseStatOverrides) : false;\r\n  }\r\n\r\n  static getBaseStatValue = (character: ICachedCharacter, characetSheet: CharacterSheet, weaponSheet: WeaponSheet, statKey: string): number => {\r\n    if (statKey === \"enemyLevel\") return character.level\r\n    if (statKey.includes(\"enemyRes_\")) return 10\r\n    if (statKey in characterStatBase) return characterStatBase[statKey]\r\n    return 0\r\n  }\r\n  static getStatValueWithOverride = (character: ICachedCharacter, characterSheet: CharacterSheet, weaponSheet: WeaponSheet, statKey: string) => {\r\n    if (Character.hasOverride(character, statKey)) return character.baseStatOverrides?.[statKey] ?? 0\r\n    else return Character.getBaseStatValue(character, characterSheet, weaponSheet, statKey)\r\n  }\r\n\r\n  static calculateBuild = (character: ICachedCharacter, database: ArtCharDatabase, characterSheet: CharacterSheet, weaponSheet: WeaponSheet, artifactSheets: StrictDict<ArtifactSetKey, ArtifactSheet>, mainStatAssumptionLevel = 0): ICalculatedStats => {\r\n    const artifacts = Object.fromEntries(Object.entries(character.equippedArtifacts).map(([key, artid]) => [key, database._getArt(artid)]))\r\n    const initialStats = Character.createInitialStats(character, database, characterSheet, weaponSheet)\r\n    initialStats.mainStatAssumptionLevel = mainStatAssumptionLevel\r\n    return Character.calculateBuildwithArtifact(initialStats, artifacts, artifactSheets)\r\n  }\r\n\r\n  static calculateBuildwithArtifact = (initialStats: ICalculatedStats, artifacts: Dict<SlotKey, ICachedArtifact>, artifactSheets: StrictDict<ArtifactSetKey, ArtifactSheet>): ICalculatedStats => {\r\n    const setToSlots = Artifact.setToSlots(artifacts)\r\n    const artifactSetEffectsStats = ArtifactSheet.setEffectsStats(artifactSheets, initialStats, setToSlots)\r\n\r\n    let stats = deepClone(initialStats)\r\n    //add artifact and artifactsets\r\n    Object.values(artifacts).forEach(art => {\r\n      if (!art) return\r\n      //main stats\r\n      stats[art.mainStatKey] = (stats[art.mainStatKey] || 0) + Artifact.mainStatValue(art.mainStatKey, art.rarity, Math.max(Math.min(stats.mainStatAssumptionLevel, art.rarity * 4), art.level))\r\n      //substats\r\n      art.substats.forEach((substat) =>\r\n        substat && substat.key && (stats[substat.key] = (stats[substat.key] || 0) + substat.value))\r\n    })\r\n    //setEffects\r\n    mergeStats(stats, artifactSetEffectsStats)\r\n    //setEffects conditionals\r\n    Conditional.parseConditionalValues({ artifact: stats?.conditionalValues?.artifact }, (conditional, conditionalValue, [, setKey, setNumKey]) => {\r\n      if (parseInt(setNumKey) > (setToSlots?.[setKey]?.length ?? 0)) return\r\n      const { stats: condStats } = Conditional.resolve(conditional, stats, conditionalValue)\r\n      mergeStats(stats, condStats)\r\n    })\r\n\r\n    stats.equippedArtifacts = Object.fromEntries(Object.entries(artifacts).map(([key, val]: any) => [key, val?.id]))\r\n    stats.setToSlots = setToSlots\r\n    let dependencies = GetDependencies(stats, stats?.modifiers)\r\n    const { initialStats: preprocessedStats, formula } = PreprocessFormulas(dependencies, stats)\r\n    formula(preprocessedStats)\r\n    return { ...stats, ...preprocessedStats }\r\n  }\r\n\r\n  static createInitialStats = (character: ICachedCharacter, database: ArtCharDatabase, characterSheet: CharacterSheet, weaponSheet: WeaponSheet): ICalculatedStats => {\r\n    character = deepClone(character)\r\n    const { key: characterKey, elementKey, level, ascension, hitMode, infusionAura, reactionMode, talent, constellation, equippedArtifacts, conditionalValues = {}, equippedWeapon } = character\r\n    const weapon = database._getWeapon(equippedWeapon) ?? defaultInitialWeapon(characterSheet.weaponTypeKey) // need to ensure all characters have a weapon\r\n\r\n    //generate the initalStats obj with data from Character & overrides\r\n    const statKeys = [\"enemyLevel\", ...Object.keys(characterStatBase)]\r\n    const initialStats = Object.fromEntries(statKeys.map(key => [key, Character.getStatValueWithOverride(character, characterSheet, weaponSheet, key)])) as ICalculatedStats\r\n    initialStats.characterHP = characterSheet.getBase(\"hp\", level, ascension)\r\n    initialStats.characterDEF = characterSheet.getBase(\"def\", level, ascension)\r\n    initialStats.characterATK = characterSheet.getBase(\"atk\", level, ascension)\r\n    initialStats.characterLevel = level\r\n    initialStats.characterEle = characterSheet.elementKey ?? elementKey ?? \"anemo\";\r\n    initialStats.characterKey = characterKey\r\n    initialStats.hitMode = hitMode;\r\n    initialStats.infusionAura = infusionAura\r\n    initialStats.reactionMode = reactionMode;\r\n    initialStats.conditionalValues = conditionalValues\r\n    initialStats.weaponType = characterSheet.weaponTypeKey\r\n    initialStats.tlvl = Object.fromEntries(Object.entries(talent ?? {}).map(([key, value]) => [key, value - 1])) as any;\r\n    initialStats.constellation = constellation\r\n    initialStats.ascension = ascension\r\n    initialStats.weapon = { key: weapon.key, refineIndex: weapon.refine - 1 }\r\n    initialStats.equippedArtifacts = equippedArtifacts;\r\n\r\n    //enemy stuff\r\n    [\"physical\", ...allElements].forEach(eleKey => {\r\n      let statKey = `${eleKey}_enemyRes_`\r\n      initialStats[statKey] = Character.getStatValueWithOverride(character, characterSheet, weaponSheet, statKey);\r\n      statKey = `${eleKey}_enemyImmunity`\r\n      initialStats[statKey] = Character.getStatValueWithOverride(character, characterSheet, weaponSheet, statKey);\r\n    })\r\n\r\n    //all the rest of the overrides\r\n    let overrides = character?.baseStatOverrides || {}\r\n    Object.entries(overrides).forEach(([statKey, val]: any) => {\r\n      if (!initialStats.hasOwnProperty(statKey)) initialStats[statKey] = val\r\n    })\r\n\r\n    //add specialized stat\r\n    const specialStatKey = characterSheet.getSpecializedStat(ascension)\r\n    if (specialStatKey) {\r\n      const specializedStatVal = characterSheet.getSpecializedStatVal(ascension)\r\n      mergeStats(initialStats, { [specialStatKey]: specializedStatVal })\r\n    }\r\n\r\n    //add stats from all talents\r\n    characterSheet.getTalentStatsAll(initialStats as ICalculatedStats, initialStats.characterEle).forEach(s => mergeStats(initialStats, s))\r\n\r\n    //add levelBoosts, from Talent stats.\r\n    for (const key in initialStats.tlvl)\r\n      initialStats.tlvl[key] += initialStats[`${key}Boost`] ?? 0\r\n\r\n    //add stats from weapons\r\n    const weaponATK = weaponSheet.getMainStatValue(weapon.level, weapon.ascension)\r\n    initialStats.weaponATK = weaponATK\r\n    const weaponSubKey = weaponSheet.getSubStatKey()\r\n    if (weaponSubKey) mergeStats(initialStats, { [weaponSubKey]: weaponSheet.getSubStatValue(weapon.level, weapon.ascension) })\r\n    mergeStats(initialStats, weaponSheet.stats(initialStats as ICalculatedStats))\r\n\r\n\r\n    //Handle conditionals, without artifact, since the pipeline for that comes later.\r\n    const { artifact: artifactCond, weapon: weaponCond, ...otherCond } = conditionalValues\r\n\r\n    //handle conditionals. only the conditional applicable to the equipped weapon is parsed.\r\n    Conditional.parseConditionalValues({ ...weapon.key && { weapon: { [weapon.key]: weaponCond?.[weapon.key] } }, ...otherCond }, (conditional, conditionalValue, keys) => {\r\n      if (keys[0] === \"character\" && keys[3] === \"talents\" && keys[4] !== elementKey) return //fix for Traveler, make sure conditionals match element.\r\n      if (!Conditional.canShow(conditional, initialStats)) return\r\n      const { stats: condStats } = Conditional.resolve(conditional, initialStats, conditionalValue)\r\n      mergeStats(initialStats, condStats)\r\n    })\r\n    return initialStats as ICalculatedStats\r\n  }\r\n  //TODO: this needs weaponSheet/artifactsheets as a parameter.\r\n  static getDisplayStatKeys = (stats: ICalculatedStats, { characterSheet, weaponSheet, artifactSheets }: { characterSheet: CharacterSheet, weaponSheet: WeaponSheet, artifactSheets: StrictDict<ArtifactSetKey, ArtifactSheet> }) => {\r\n    const eleKey = stats.characterEle\r\n    const basicKeys = [\"finalHP\", \"finalATK\", \"finalDEF\", \"eleMas\", \"critRate_\", \"critDMG_\", \"heal_\", \"enerRech_\", `${eleKey}_dmg_`]\r\n    const isAutoElemental = characterSheet.isAutoElemental\r\n    if (!isAutoElemental) basicKeys.push(\"physical_dmg_\")\r\n\r\n    //show elemental interactions\r\n    const transReactions = deepClone(ElementToReactionKeys[eleKey])\r\n    const weaponTypeKey = characterSheet.weaponTypeKey\r\n    if (!transReactions.includes(\"shattered_hit\") && weaponTypeKey === \"claymore\") transReactions.push(\"shattered_hit\")\r\n    const charFormulas = {}\r\n    const talentSheet = characterSheet.getTalent(eleKey)\r\n    const addFormula = (fields, key) => fields.forEach(field => {\r\n      if (!field.formula || !field?.canShow?.(stats)) return\r\n      if (!charFormulas[key]) charFormulas[key] = []\r\n      charFormulas[key].push((field.formula as any).keys)\r\n    })\r\n    const parseSection = (section, key) => {\r\n      //conditional\r\n      if (section.conditional && Conditional.canShow(section.conditional, stats)) {\r\n        const { fields }: { fields?: Array<IFieldDisplay> } = Conditional.resolve(section.conditional, stats, null)\r\n        fields && addFormula(fields, key)\r\n      }\r\n      //fields\r\n      if (section.fields) addFormula(section.fields, key)\r\n    }\r\n    talentSheet && Object.entries(talentSheet.sheets).forEach(([talentKey, { sections }]) => {\r\n      if (talentKey === \"normal\" || talentKey === \"charged\" || talentKey === \"plunging\") talentKey = \"auto\"\r\n      sections.forEach(section => parseSection(section, `talentKey_${talentKey}`))\r\n    })\r\n\r\n    const formKey = `weapon_${stats.weapon.key}`\r\n    weaponSheet.document && weaponSheet.document.map(section => parseSection(section, formKey))\r\n\r\n    stats.setToSlots && Object.entries(stats.setToSlots).map(([setKey, slots]) => [setKey, slots.length]).forEach(([setKey, num]) => {\r\n      const artifactSheet = artifactSheets[setKey] as ArtifactSheet\r\n      if (!artifactSheet) return\r\n      Object.entries(artifactSheet.setEffects).forEach(([setNum, { document }]) => {\r\n        if (num < parseInt(setNum)) return\r\n        document && document.map(section => parseSection(section, `artifact_${setKey}_${setNum}`))\r\n      })\r\n    })\r\n\r\n    return { basicKeys, ...charFormulas, transReactions }\r\n  }\r\n}","import { faTimes } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { useContext, useMemo, useReducer, useState } from \"react\";\r\nimport { Badge, Button, ButtonGroup, Card, Col, Image, Modal, Row, ToggleButton, ToggleButtonGroup } from \"react-bootstrap\";\r\nimport Dropdown from \"react-bootstrap/Dropdown\";\r\nimport Assets from \"../Assets/Assets\";\r\nimport CharacterSheet from \"./CharacterSheet\";\r\nimport { DatabaseContext } from \"../Database/Database\";\r\nimport { ICachedCharacter } from \"../Types/character\";\r\nimport { allCharacterKeys, allElements, allWeaponTypeKeys, CharacterKey, WeaponTypeKey } from \"../Types/consts\";\r\nimport { usePromise } from \"../Util/ReactUtil\";\r\nimport { Stars } from \"../Components/StarDisplay\";\r\nimport StatIcon, { uncoloredEleIcons } from \"../Components/StatIcon\";\r\nimport Character from './Character'\r\nimport WeaponSheet from \"../Weapon/WeaponSheet\";\r\nimport { ArtifactSheet } from \"../Artifact/ArtifactSheet\";\r\n\r\nexport function CharacterSelectionDropdownList({ onSelect, weaponTypeKey }: { onSelect: (ckey: CharacterKey) => void, weaponTypeKey?: WeaponTypeKey }) {\r\n  const database = useContext(DatabaseContext)\r\n  const characterSheets = usePromise(CharacterSheet.getAll(), [])\r\n  return <>{database._getCharKeys().filter(cKey =>\r\n    weaponTypeKey ? (characterSheets?.[cKey]?.weaponTypeKey === weaponTypeKey) : true\r\n  ).sort().map(characterKey => <DropDownItem key={characterKey} characterKey={characterKey} onSelect={onSelect} />)}</>\r\n}\r\nfunction DropDownItem({ characterKey, onSelect }) {\r\n  const characterSheet = usePromise(CharacterSheet.get(characterKey), [characterKey])\r\n  if (!characterSheet) return null\r\n  return <Dropdown.Item onClick={() => onSelect(characterKey)}>{characterSheet.nameWIthIcon}</Dropdown.Item>\r\n}\r\n\r\ntype characterFilter = (character: ICachedCharacter | undefined, sheet: CharacterSheet) => boolean\r\n\r\nexport function CharSelectionButton({ characterSheet, onSelect, filter }: { characterSheet?: CharacterSheet, onSelect?: (cKey: CharacterKey) => void, filter?: characterFilter }) {\r\n  const [show, setshow] = useState(false)\r\n  const HeaderIconDisplay = characterSheet ? <span >\r\n    <Image src={characterSheet.thumbImg} className=\"thumb-small my-n1 ml-n2\" roundedCircle />\r\n    <h6 className=\"d-inline\"> {characterSheet.name} </h6>\r\n  </span> : <span>Select a Character</span>\r\n  return <>\r\n    <Button disabled={!onSelect} onClick={() => setshow(true)} >{HeaderIconDisplay}</Button>\r\n    <CharacterSelectionModal show={show} onHide={() => setshow(false)} onSelect={onSelect} filter={filter} />\r\n  </>\r\n}\r\n\r\nconst toggle = {\r\n  rarity: \"Rarity\",\r\n  level: \"Level\",\r\n  name: \"Name\"\r\n} as const\r\n\r\nfunction filterReducer(oldFilter, newFilter) {\r\n  if (newFilter === oldFilter)\r\n    return \"\"\r\n  return newFilter\r\n}\r\n\r\n\r\ntype CharacterSelectionModalProps = {\r\n  show: boolean,\r\n  onHide: () => void,\r\n  onSelect?: (ckey: CharacterKey) => void,\r\n  filter?: characterFilter\r\n}\r\n\r\nexport function CharacterSelectionModal({ show, onHide, onSelect, filter = () => true }: CharacterSelectionModalProps) {\r\n  const database = useContext(DatabaseContext)\r\n\r\n  const [sortBy, setsortBy] = useState(() => Object.keys(toggle)[0])\r\n  const [elementalFilter, elementalFilterDispatch] = useReducer(filterReducer, \"\")\r\n  const [weaponFilter, weaponFilterDispatch] = useReducer(filterReducer, \"\")\r\n\r\n  const characterSheets = usePromise(CharacterSheet.getAll(), [])\r\n\r\n  const sortingFunc = {\r\n    level: (ck) => database._getChar(ck)?.level ?? 0,\r\n    rarity: (ck) => characterSheets?.[ck]?.star,\r\n    name: (ck) => characterSheets?.[ck]?.name\r\n  }\r\n\r\n  const characterKeyList = !characterSheets ? [] : [...new Set(allCharacterKeys)].filter(cKey => filter(database._getChar(cKey), characterSheets[cKey])).filter(cKey => {\r\n    if (elementalFilter && elementalFilter !== characterSheets?.[cKey]?.elementKey) return false\r\n    if (weaponFilter && weaponFilter !== characterSheets?.[cKey]?.weaponTypeKey) return false\r\n    return true\r\n  }).sort((a, b) => {\r\n    if (sortBy === \"name\") {\r\n      if (a < b) return -1;\r\n      if (a > b) return 1;\r\n      // names must be equal\r\n      return 0;\r\n    }\r\n    if (sortBy === \"level\") {\r\n      const diff = sortingFunc[\"level\"](b) - sortingFunc[\"level\"](a)\r\n      if (diff) return diff\r\n      return sortingFunc[\"rarity\"](b) - sortingFunc[\"rarity\"](a)\r\n    } else {\r\n      const diff = sortingFunc[\"rarity\"](b) - sortingFunc[\"rarity\"](a)\r\n      if (diff) return diff\r\n      return sortingFunc[\"level\"](b) - sortingFunc[\"level\"](a)\r\n    }\r\n  })\r\n\r\n  if (!characterSheets) return null\r\n  return <Modal show={show} size=\"xl\" contentClassName=\"bg-transparent\" onHide={onHide}>\r\n    <Card bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n      <Card.Header>\r\n        <Row>\r\n          <Col xs=\"auto\">\r\n            <ButtonGroup>\r\n              {allElements.map(eleKey => <Button key={eleKey} variant={(!elementalFilter || elementalFilter === eleKey) ? eleKey : \"secondary\"} className=\"py-1 px-2 text-white\" onClick={() => elementalFilterDispatch(eleKey)} >\r\n                <h3 className=\"mb-0\">{uncoloredEleIcons[eleKey]}</h3>\r\n              </Button>)}\r\n            </ButtonGroup>\r\n          </Col>\r\n          <Col>\r\n            <ButtonGroup >\r\n              {allWeaponTypeKeys.map(weaponType =>\r\n                <Button key={weaponType} variant={(!weaponFilter || weaponFilter === weaponType) ? \"success\" : \"secondary\"} className=\"py-1 px-2\" onClick={() => weaponFilterDispatch(weaponType)}>\r\n                  <h3 className=\"mb-0\"><Image src={Assets.weaponTypes?.[weaponType]} className=\"inline-icon\" /></h3></Button>)}\r\n            </ButtonGroup>\r\n          </Col>\r\n          <Col xs=\"auto\">\r\n            <span>Sort by: </span>\r\n            <ToggleButtonGroup type=\"radio\" name=\"level\" value={sortBy} onChange={setsortBy}>\r\n              {Object.entries(toggle).map(([key, text]) =>\r\n                <ToggleButton key={key} value={key} variant={sortBy === key ? \"success\" : \"primary\"}>\r\n                  <h6 className=\"mb-0\">{text}</h6>\r\n                </ToggleButton>)}\r\n            </ToggleButtonGroup>\r\n          </Col>\r\n          <Col xs=\"auto\">\r\n            <Button onClick={onHide} variant=\"danger\"><FontAwesomeIcon icon={faTimes} /></Button>\r\n          </Col>\r\n        </Row>\r\n      </Card.Header>\r\n      <Card.Body><Row>\r\n        {characterKeyList.map(characterKey => <CharacterBtn key={characterKey} characterKey={characterKey} onClick={() => { onHide(); onSelect?.(characterKey) }} />)}\r\n      </Row></Card.Body>\r\n    </Card>\r\n  </Modal>\r\n}\r\n\r\nfunction CharacterBtn({ onClick, characterKey }) {\r\n  const database = useContext(DatabaseContext)\r\n  const character = database._getChar(characterKey)\r\n  const characterSheet = usePromise(CharacterSheet.get(characterKey), [characterKey])\r\n  const weapon = character?.equippedWeapon ? database._getWeapon(character.equippedWeapon) : undefined\r\n  const weaponSheet = usePromise(weapon ? WeaponSheet.get(weapon.key) : undefined, [weapon?.key])\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n  const stats = useMemo(() => character && characterSheet && weaponSheet && artifactSheets && Character.calculateBuild(character, database, characterSheet, weaponSheet, artifactSheets), [character, characterSheet, weaponSheet, artifactSheets, database])\r\n  if (!characterSheet) return null\r\n  return <Col key={characterKey} lg={3} md={4} className=\"mb-2\">\r\n    <Button className=\"w-100\" variant=\"darkcontent\" onClick={onClick}>\r\n      <h5>{characterSheet.name}</h5>\r\n      <Row>\r\n        <Col xs=\"auto\" className=\"pr-0\">\r\n          <Image src={characterSheet.thumbImg} className={`thumb-big grad-${characterSheet.star}star p-0`} thumbnail />\r\n        </Col>\r\n        <Col>\r\n          {stats && character ? <>\r\n            <h5 className=\"mb-0\">Lv. {Character.getLevelString(character)} {`C${character.constellation}`}</h5>\r\n            <h6 className=\"mb-0\">\r\n              <Badge variant=\"secondary\"><strong className=\"mx-1\">{stats.tlvl.auto + 1}</strong></Badge>{` `}\r\n              <Badge variant=\"secondary\"><strong className=\"mx-1\">{stats.tlvl.skill + 1}</strong></Badge>{` `}\r\n              <Badge variant=\"secondary\"><strong className=\"mx-1\">{stats.tlvl.burst + 1}</strong></Badge>\r\n            </h6>\r\n          </> : <>\r\n            <h4><Badge variant=\"primary\">NEW</Badge></h4>\r\n          </>}\r\n          <h6 className=\"mb-0\"><Stars stars={characterSheet.star} colored /></h6>\r\n          <h3 className=\"mb-0\">{characterSheet.elementKey && StatIcon[characterSheet.elementKey]} <Image src={Assets.weaponTypes?.[characterSheet.weaponTypeKey]} className=\"inline-icon\" /></h3>\r\n        </Col>\r\n      </Row>\r\n    </Button>\r\n  </Col>\r\n}","import Formula from \"./Formula\"\r\nimport { Formulas, getStage, numStages, StatData } from \"./StatData\"\r\nimport { IBaseStat } from \"./Types/character\"\r\nimport { Modifier } from \"./Types/stats\"\r\n\r\n// Generate a statKey dependency, to reduce build generation calculation on a single stat.\r\nfunction GetFormulaDependency(formula: (s) => number) {\r\n  const dependency: Set<string> = new Set()\r\n  formula(new Proxy({}, { get: (target, prop, receiver) => { dependency.add(prop.toString()) } }))\r\n  return [...dependency]\r\n}\r\nconst formulaKeyDependency = Object.freeze(Object.fromEntries(\r\n  Object.entries(Formulas).map(([key, value]) => [key, GetFormulaDependency(value)])\r\n)) as Dict<string, string[]>\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  let statKeys = Object.keys(StatData)\r\n  Object.entries(formulaKeyDependency).forEach(([formulaKey, dependencies]) =>\r\n    dependencies.forEach(key =>\r\n      !statKeys.includes(key as any) &&\r\n      console.error(`Formula ${formulaKey} depends key ${key} that does not Exist in StatData.`))\r\n  )\r\n  Object.entries(formulaKeyDependency).forEach(([formulaKey, dependencies]) =>\r\n    StatData[formulaKey]?.const && dependencies.forEach(key =>\r\n      !StatData[key as any]?.const &&\r\n      console.error(`Constant formula ${formulaKey} depends on dynamic key ${key}.`)\r\n    )\r\n  )\r\n}\r\n\r\nfunction GetDependencies(baseStat: IBaseStat, modifiers: Modifier = {}, keys = Object.keys(StatData)): Dependencies {\r\n  const found = new Set<string>()\r\n  const dependencies = [...Array(numStages)].map(_ => new Set<string>())\r\n  keys.forEach(key => InsertDependencies(baseStat, key, modifiers, dependencies, found))\r\n  return dependencies.flatMap(dep => [...dep])\r\n}\r\nfunction InsertDependencies(baseStat: IBaseStat, key: string, modifiers: Modifier, dependencies: Set<string>[], found: Set<string>) {\r\n  if (found.has(key)) return\r\n  found.add(key)\r\n\r\n  formulaKeyDependency[key]?.forEach(k => InsertDependencies(baseStat, k, modifiers, dependencies, found));\r\n  (modifiers[key] ?? []).forEach(path => Formula.getCurrent(path, baseStat)[1].forEach(k =>\r\n    InsertDependencies(baseStat, k, modifiers, dependencies, found)))\r\n  dependencies[getStage(key)].add(key)\r\n}\r\n\r\ntype Dependencies = string[]\r\n\r\nexport {\r\n  GetFormulaDependency,\r\n  GetDependencies,\r\n}\r\n","import { WeaponKey, WeaponTypeKey } from \"../Types/consts\"\r\nimport { ICachedWeapon } from \"../Types/weapon\"\r\n\r\nfunction defaultInitialWeaponKey(type: WeaponTypeKey): WeaponKey {\r\n  switch (type) {\r\n    case \"sword\": return \"DullBlade\"\r\n    case \"bow\": return \"HuntersBow\"\r\n    case \"claymore\": return \"WasterGreatsword\"\r\n    case \"polearm\": return \"BeginnersProtector\"\r\n    case \"catalyst\": return \"ApprenticesNotes\"\r\n    default: return \"DullBlade\"\r\n  }\r\n}\r\nexport const defaultInitialWeapon = (type: WeaponTypeKey): ICachedWeapon =>\r\n  initialWeapon(defaultInitialWeaponKey(type))\r\n\r\nexport const initialWeapon = (key: WeaponKey): ICachedWeapon => ({\r\n  id: \"\",\r\n  key,\r\n  level: 1,\r\n  ascension: 0,\r\n  refine: 1,\r\n  location: \"\"\r\n})"],"sourceRoot":""}