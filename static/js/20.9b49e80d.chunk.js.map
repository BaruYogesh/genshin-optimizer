{"version":3,"sources":["Character/CharacterUtil.tsx","Character/CharacterCard.tsx","Util/TimeUtil.ts","../node_modules/react-bootstrap/esm/ProgressBar.js","Build/BuildWorker.ts","Build/BuildDisplay.tsx"],"names":["getFormulaTargetsDisplayHeading","key","characterSheet","weaponSheet","artifactSheets","eleKey","startsWith","subkey","split","getTalentOfKey","name","setKey","num","variant","initialCharacter","level","ascension","hitMode","reactionMode","equippedArtifacts","objectFromKeyMap","allSlotKeys","equippedWeapon","conditionalValues","bonusStats","buildSettings","initialBuildSettings","talent","auto","skill","burst","infusionAura","constellation","CharacterCard","characterKey","onEdit","onDelete","cardClassName","bg","header","footer","database","useContext","DatabaseContext","useState","undefined","databaseCharacter","updateDatabaseCharacter","useEffect","followChar","usePromise","ArtifactSheet","getAll","character","CharacterSheet","get","weapon","_getWeapon","WeaponSheet","stats","useMemo","Character","calculateBuild","tlvl","elementKey","characterEle","weaponTypeKey","weaponName","weaponMainVal","getMainStatValue","toFixed","Stat","fixedUnit","weaponSubKey","getSubStatKey","weaponSubVal","getSubStatValue","weaponLevelName","getLevelString","weaponPassiveName","passiveName","className","text","Header","xs","size","onClick","icon","faEdit","faTrashAlt","Body","src","thumbImg","star","thumbnail","stars","colored","StatIcon","Assets","weaponTypes","refinement","getStatName","getStatUnit","Object","entries","setEffects","setToSlots","map","arr","artifactSetName","highestNum","Math","max","statKey","unit","statVal","Footer","as","Link","to","pathname","faCalculator","faLink","msToUnits","ms","milliseconds","seconds","floor","minutes","hours","timeString","timeText","strPadLeft","timeStringMs","_excluded","_excluded2","_excluded3","getPercentage","now","min","percentage","round","renderProgressBar","_ref","ref","_classNames","label","srOnly","striped","animated","style","bsPrefix","props","_objectWithoutPropertiesLoose","React","createElement","_extends","role","classNames","width","ProgressBar","forwardRef","_ref2","isChild","useBootstrapPrefix","children","wrapperProps","child","cloneElement","displayName","defaultProps","Worker_fn","Worker","InfoDisplay","lazy","CharacterDisplayCard","warningBuildNumber","artifactsSlotsToSelectMainStats","BuildDisplay","propCharacterKey","location","dbStorage","setcharacterKey","modalBuild","setmodalBuild","showArtCondModal","setshowArtCondModal","showCharacterModal","setshowCharacterModal","generatingBuilds","setgeneratingBuilds","generationProgress","setgenerationProgress","generationDuration","setgenerationDuration","generationSkipped","setgenerationSkipped","useForceUpdate","charDirty","setCharDirty","artsDirty","setArtsDirty","isMounted","useRef","worker","initialStats","statsDisplayKeys","setCharacterData","setFilters","statFilters","mainStatKeys","optimizationTarget","mainStatAssumptionLevel","useExcludedArts","useEquippedArts","builds","buildDate","maxBuildsToShow","buildStats","build","arts","fromEntries","id","_getArt","art","slotKey","calculateBuildwithArtifact","filter","buildSettingsDispatch","useCallback","action","state","type","mainStatKey","includes","k","push","index","buildSettingsReducer","updateChar","ReactGA","pageview","selectCharacter","cKey","a","_getChar","createInitialStats","getDisplayStatKeys","followAnyArt","current","terminate","set","Array","isArray","sectionKey","section","keys","JSON","stringify","totBuildNumber","artifactDatabase","_getArts","exclude","Artifact","splitArtifactsBySlot","forEach","length","calculateTotalBuildNumber","generateBuilds","artifactSetEffects","setEffectsObjs","splitArtifacts","deepClone","values","artArr","mainStatVal","mainStatValue","rarity","data","minFilters","onmessage","e","progress","timing","skipped","category","variable","value","toString","b","artifacts","Date","postMessage","dropdownitemsForStar","setsWithMaxRarity","setobj","some","setsNumArr","artsAccountedOther","reduce","accu","cur","ind","every","parseInt","Dropdown","Item","nameWithIcon","characterName","characterDropDown","DropdownButton","title","disabled","Divider","CharacterSelection","onSelect","formula","Formula","sortByText","getStatVariant","getStatNameWithPercent","talentKey","field","getTalentFieldValue","artsAccounted","artifactCondCount","count","crawlObject","artifact","v","Container","Provider","equippedBuild","InfoComponent","pageKey","modalTitle","BuildModal","close","ArtConditionalModal","Row","Col","Card","lg","endsWith","setStatsFields","statsToFields","ListGroup","i","FieldDisplay","Accordion","getStatValueWithBonus","callback","Button","eventKey","allElements","element","Collapse","bsProps","StatFilterCard","statKeys","basicKeys","setStatFilters","sFs","HitModeCard","Boolean","Badge","s","setNum","ButtonGroup","ItemText","setNKey","setNkey","setNumKey","SetEffectDisplay","newBuild","editable","faCheckSquare","faSquare","AssumeFullLevelToggle","setmainStatAssumptionLevel","numSel","faUndo","slotMainStats","selected","OverlayTrigger","overlay","Tooltip","Toggle","Menu","maxBuildsToShowList","drop","align","minWidth","fields","md","overflow","textOverflow","target","TargetSelectorDropdownItem","BuildAlert","toLocaleString","ArtifactDisplayItem","sheets","talentField","Modal","show","onHide","contentClassName","Suspense","fallback","tabName","setCharacterKey","onClose","closeArtCondModal","characterDispatch","useCharacterReducer","artSetKeyList","setKeysByRarities","reverse","flatMap","faTimes","sheet","slotIcons","rarities","xl","Image","ns","StatFilterItem","setFilter","isFloat","inputProps","allowEmpty","float","minInputProps","placeholder","onChange","InputGroup","Prepend","sKey","CustomFormControl","Append","faTrash","remainingKeys","currentlyEquipped","sort","slotarr1","slotarr","artifactSlotIcon","StatDisplayComponent","cardbg","totalBuildNumberString","totalUnskipped","generationProgressString","generationSkippedString","totalUnskippedString","generationSkippedText","progPercent","Alert","levels","0","4","8","12","16","20"],"mappings":"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","file":"static/js/20.9b49e80d.chunk.js","sourcesContent":["import { Badge } from \"react-bootstrap\"\r\nimport { ArtifactSheet } from \"../Artifact/ArtifactSheet\"\r\nimport { initialBuildSettings } from \"../Build/BuildSetting\"\r\nimport { ICachedCharacter } from \"../Types/character\"\r\nimport { allSlotKeys, ArtifactSetKey, CharacterKey, ElementKey } from \"../Types/consts\"\r\nimport { objectFromKeyMap } from \"../Util/Util\"\r\nimport WeaponSheet from \"../Weapon/WeaponSheet\"\r\nimport CharacterSheet from \"./CharacterSheet\"\r\n\r\nexport function getFormulaTargetsDisplayHeading(key: string, { characterSheet, weaponSheet, artifactSheets }: { characterSheet: CharacterSheet, weaponSheet: WeaponSheet, artifactSheets: StrictDict<ArtifactSetKey, ArtifactSheet> }, eleKey: ElementKey = \"anemo\") {\r\n  if (key === \"basicKeys\") return \"Basic Stats\"\r\n  else if (key === \"genericAvgHit\") return \"Generic Optimization Values\"\r\n  else if (key === \"transReactions\") return \"Transformation Reaction\"\r\n  else if (key.startsWith(\"talentKey_\")) {\r\n    const subkey = key.split(\"talentKey_\")[1]\r\n    return (characterSheet?.getTalentOfKey(subkey, eleKey)?.name ?? subkey)\r\n  } else if (key.startsWith(\"weapon_\")) {\r\n    const subkey = key.split(\"weapon_\")[1]\r\n    return (weaponSheet?.name ?? subkey)\r\n  } else if (key.startsWith(\"artifact_\")) {\r\n    const [, setKey, num] = key.split('_')\r\n    return <span>{artifactSheets[setKey]?.name} <Badge variant=\"success\">{num}-Set</Badge></span>\r\n  }\r\n  return \"\"\r\n}\r\n\r\nexport function initialCharacter(key: CharacterKey): ICachedCharacter {\r\n  return {\r\n    key, // the game character this is based off\r\n    level: 1,\r\n    ascension: 0,\r\n    hitMode: \"avgHit\",\r\n    reactionMode: null,\r\n    equippedArtifacts: objectFromKeyMap(allSlotKeys, () => \"\"),\r\n    equippedWeapon: \"\",\r\n    conditionalValues: {},\r\n    bonusStats: {},\r\n    buildSettings: initialBuildSettings(),\r\n    talent: {\r\n      auto: 1,\r\n      skill: 1,\r\n      burst: 1,\r\n    },\r\n    infusionAura: \"\",\r\n    constellation: 0,\r\n  }\r\n}","import { faCalculator, faEdit, faLink, faTrashAlt } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { useContext, useEffect, useMemo, useState } from 'react';\r\nimport { Badge, Image } from 'react-bootstrap';\r\nimport Button from 'react-bootstrap/Button';\r\nimport Card from 'react-bootstrap/Card';\r\nimport Col from 'react-bootstrap/Col';\r\nimport Row from 'react-bootstrap/Row';\r\nimport { Link } from 'react-router-dom';\r\nimport { ArtifactSheet } from '../Artifact/ArtifactSheet';\r\nimport Assets from '../Assets/Assets';\r\nimport { Stars } from '../Components/StarDisplay';\r\nimport StatIcon from '../Components/StatIcon';\r\nimport { DatabaseContext } from '../Database/Database';\r\nimport usePromise from '../ReactHooks/usePromise';\r\nimport Stat from '../Stat';\r\nimport { ICachedCharacter } from '../Types/character';\r\nimport { CharacterKey } from '../Types/consts';\r\nimport { ICachedWeapon } from '../Types/weapon';\r\nimport WeaponSheet from '../Weapon/WeaponSheet';\r\nimport Character from './Character';\r\nimport CharacterSheet from './CharacterSheet';\r\n\r\ntype CharacterCardProps = { characterKey: CharacterKey | \"\", onEdit?: (any) => void, onDelete?: (any) => void, cardClassName: string, header?: JSX.Element, bg?: string, footer?: boolean }\r\nexport default function CharacterCard({ characterKey, onEdit, onDelete, cardClassName = \"\", bg = \"\", header, footer = false }: CharacterCardProps) {\r\n  const database = useContext(DatabaseContext)\r\n  const [databaseCharacter, updateDatabaseCharacter] = useState(undefined as ICachedCharacter | undefined)\r\n  useEffect(() =>\r\n    characterKey ? database.followChar(characterKey, updateDatabaseCharacter) : undefined,\r\n    [characterKey, updateDatabaseCharacter, database])\r\n\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n  const character = databaseCharacter\r\n  const characterSheet = usePromise(CharacterSheet.get(characterKey), [characterKey])\r\n  const weapon = character?.equippedWeapon ? database._getWeapon(character.equippedWeapon) : undefined\r\n  const weaponSheet = usePromise(weapon ? WeaponSheet.get(weapon.key) : undefined, [weapon?.key])\r\n  const stats = useMemo(() => character && characterSheet && weaponSheet && artifactSheets && Character.calculateBuild(character, database, characterSheet, weaponSheet, artifactSheets), [character, characterSheet, weaponSheet, artifactSheets, database])\r\n  if (!character || !weapon || !characterSheet || !weaponSheet || !stats) return null;\r\n\r\n  const { constellation } = character\r\n  const { level, ascension } = weapon\r\n  const { tlvl } = stats\r\n  const name = characterSheet.name\r\n  const elementKey = stats.characterEle\r\n  const weaponTypeKey = characterSheet.weaponTypeKey\r\n  const weaponName = weaponSheet?.name\r\n  const weaponMainVal = weaponSheet.getMainStatValue(level, ascension).toFixed(Stat.fixedUnit(\"atk\"))\r\n  const weaponSubKey = weaponSheet.getSubStatKey()\r\n  const weaponSubVal = weaponSheet.getSubStatValue(level, ascension).toFixed(Stat.fixedUnit(weaponSubKey))\r\n  const weaponLevelName = WeaponSheet.getLevelString(weapon as ICachedWeapon)\r\n  const weaponPassiveName = weaponSheet?.passiveName\r\n  const statkeys = [\"finalHP\", \"finalATK\", \"finalDEF\", \"eleMas\", \"critRate_\", \"critDMG_\", \"enerRech_\",]\r\n\r\n  return (<Card className={cardClassName} bg={bg ? bg : \"darkcontent\"} text={\"lightfont\" as any}>\r\n    <Card.Header className=\"pr-2\">\r\n      <Row className=\"no-gutters\">\r\n        <Col >\r\n          {header ? header : <h5><b>{name}</b></h5>}\r\n        </Col>\r\n        <Col xs={\"auto\"}>\r\n          <span className=\"float-right align-top ml-1\">\r\n            {onEdit && <Button variant=\"primary\" size=\"sm\" className=\"mr-1\"\r\n              onClick={() => onEdit(characterKey)}>\r\n              <FontAwesomeIcon icon={faEdit} />\r\n            </Button>}\r\n            {onDelete && <Button variant=\"danger\" size=\"sm\"\r\n              onClick={() => onDelete(characterKey)}>\r\n              <FontAwesomeIcon icon={faTrashAlt} />\r\n            </Button>}\r\n          </span>\r\n        </Col>\r\n      </Row>\r\n    </Card.Header>\r\n    <Card.Body onClick={() => onEdit?.(characterKey)} className={onEdit ? \"cursor-pointer\" : \"\"} >\r\n      <Row>\r\n        <Col xs=\"auto\" className=\"pr-0\">\r\n          <Image src={characterSheet.thumbImg} className={`thumb-big grad-${characterSheet.star}star p-0`} thumbnail />\r\n        </Col>\r\n        <Col>\r\n          <h5 className=\"mb-0\">Lv. {Character.getLevelString(character)} {`C${constellation}`}</h5>\r\n          <h6 className=\"mb-0\">\r\n            <Badge variant=\"secondary\"><strong className=\"mx-1\">{tlvl.auto + 1}</strong></Badge>{` `}\r\n            <Badge variant=\"secondary\"><strong className=\"mx-1\">{tlvl.skill + 1}</strong></Badge>{` `}\r\n            <Badge variant=\"secondary\"><strong className=\"mx-1\">{tlvl.burst + 1}</strong></Badge>\r\n          </h6>\r\n          <h6 className=\"mb-0\"><Stars stars={characterSheet.star} colored /></h6>\r\n          <h3 className=\"mb-0\">{StatIcon[elementKey]} <Image src={Assets.weaponTypes?.[weaponTypeKey]} className=\"inline-icon\" /></h3>\r\n        </Col>\r\n      </Row>\r\n      <Row className=\"mb-2\">\r\n        <Col>\r\n          <h6 className=\"mb-0\">{weaponName}{weaponPassiveName && <Badge variant=\"info\" className=\"ml-1\">{weapon.refinement}</Badge>} {weaponLevelName}</h6>\r\n          <span>ATK: {weaponMainVal}  {weaponPassiveName && <span>{Stat.getStatName(weaponSubKey)}: {weaponSubVal}{Stat.getStatUnit(weaponSubKey)}</span>}</span>\r\n        </Col>\r\n      </Row>\r\n      <Row>\r\n        <Col>\r\n          {artifactSheets && Object.entries(ArtifactSheet.setEffects(artifactSheets, stats.setToSlots)).map(([key, arr]) => {\r\n            let artifactSetName = artifactSheets?.[key].name ?? \"\"\r\n            let highestNum = Math.max(...arr)\r\n            return <h5 key={key}><Badge variant=\"secondary\">{artifactSetName} <Badge variant=\"success\">{highestNum}</Badge></Badge></h5>\r\n          })}\r\n        </Col>\r\n      </Row>\r\n      <Row>\r\n        {statkeys.map(statKey => {\r\n          let unit = Stat.getStatUnit(statKey)\r\n          let statVal = stats[statKey]\r\n          return <Col xs={12} key={statKey}>\r\n            <h6 className=\"d-inline\">{StatIcon[statKey]} {Stat.getStatName(statKey)}</h6>\r\n            <span className={`float-right`}>\r\n              {statVal?.toFixed(Stat.fixedUnit(statKey)) + unit}\r\n            </span>\r\n          </Col>\r\n        })}\r\n      </Row>\r\n    </Card.Body>\r\n    {footer && <Card.Footer>\r\n      <Row>\r\n        <Col><Button as={Link} to={{\r\n          pathname: \"/build\",\r\n          characterKey\r\n        } as any}><FontAwesomeIcon icon={faCalculator} /> Generate Builds</Button>\r\n        </Col>\r\n        <Col>\r\n          <Button variant=\"info\" as={Link} to={{ pathname: \"/flex\", characterKey } as any}><FontAwesomeIcon icon={faLink} /> Share Character</Button>\r\n        </Col>\r\n      </Row>\r\n\r\n    </Card.Footer>}\r\n  </Card>)\r\n}","import { strPadLeft } from \"./Util\"\r\n\r\nexport function msToUnits(ms: number) {\r\n  let milliseconds = ms % 1000\r\n  let seconds = Math.floor((ms / 1000) % 60)\r\n  let minutes = Math.floor((ms / (1000 * 60)) % 60)\r\n  let hours = Math.floor((ms / (1000 * 60 * 60)))\r\n  return { hours, minutes, seconds, milliseconds }\r\n}\r\nexport function timeString(ms: number) {\r\n  //shows only in terms of hours/minutes. there are better calculations for days using Date functions.\r\n  let { hours, minutes, seconds } = msToUnits(ms)\r\n  let timeText = \"Minutes\"\r\n  if (hours) timeText = \"Hours\"\r\n  return `${hours ? `${hours}:` : \"\"}${strPadLeft(minutes, '0', 2)}:${strPadLeft(seconds, '0', 2)} ${timeText}`;\r\n}\r\nexport function timeStringMs(ms: number) {\r\n  //shows only in terms of hours/minutes. there are better calculations for days using Date functions.\r\n  let { hours, minutes, seconds, milliseconds } = msToUnits(ms)\r\n  let timeText = \"Minutes\"\r\n  if (hours) timeText = \"Hours\"\r\n  return `${hours ? `${hours}:` : \"\"}${strPadLeft(minutes, '0', 2)}:${strPadLeft(seconds, '0', 2)}.${strPadLeft(milliseconds, '0', 3)} ${timeText}`;\r\n}\r\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nvar _excluded = [\"min\", \"now\", \"max\", \"label\", \"srOnly\", \"striped\", \"animated\", \"className\", \"style\", \"variant\", \"bsPrefix\"],\n    _excluded2 = [\"isChild\"],\n    _excluded3 = [\"min\", \"now\", \"max\", \"label\", \"srOnly\", \"striped\", \"animated\", \"bsPrefix\", \"variant\", \"className\", \"children\"];\nimport classNames from 'classnames';\nimport React, { cloneElement } from 'react';\nimport { useBootstrapPrefix } from './ThemeProvider';\nimport { map } from './ElementChildren';\nvar ROUND_PRECISION = 1000;\n/**\n * Validate that children, if any, are instances of `<ProgressBar>`.\n */\n\nfunction onlyProgressBar(props, propName, componentName) {\n  var children = props[propName];\n\n  if (!children) {\n    return null;\n  }\n\n  var error = null;\n  React.Children.forEach(children, function (child) {\n    if (error) {\n      return;\n    }\n    /**\n     * Compare types in a way that works with libraries that patch and proxy\n     * components like react-hot-loader.\n     *\n     * see https://github.com/gaearon/react-hot-loader#checking-element-types\n     */\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n\n\n    var element = /*#__PURE__*/React.createElement(ProgressBar, null);\n    if (child.type === element.type) return;\n    var childType = child.type;\n    var childIdentifier = /*#__PURE__*/React.isValidElement(child) ? childType.displayName || childType.name || childType : child;\n    error = new Error(\"Children of \" + componentName + \" can contain only ProgressBar \" + (\"components. Found \" + childIdentifier + \".\"));\n  });\n  return error;\n}\n\nvar defaultProps = {\n  min: 0,\n  max: 100,\n  animated: false,\n  isChild: false,\n  srOnly: false,\n  striped: false\n};\n\nfunction getPercentage(now, min, max) {\n  var percentage = (now - min) / (max - min) * 100;\n  return Math.round(percentage * ROUND_PRECISION) / ROUND_PRECISION;\n}\n\nfunction renderProgressBar(_ref, ref) {\n  var _classNames;\n\n  var min = _ref.min,\n      now = _ref.now,\n      max = _ref.max,\n      label = _ref.label,\n      srOnly = _ref.srOnly,\n      striped = _ref.striped,\n      animated = _ref.animated,\n      className = _ref.className,\n      style = _ref.style,\n      variant = _ref.variant,\n      bsPrefix = _ref.bsPrefix,\n      props = _objectWithoutPropertiesLoose(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: ref\n  }, props, {\n    role: \"progressbar\",\n    className: classNames(className, bsPrefix + \"-bar\", (_classNames = {}, _classNames[\"bg-\" + variant] = variant, _classNames[bsPrefix + \"-bar-animated\"] = animated, _classNames[bsPrefix + \"-bar-striped\"] = animated || striped, _classNames)),\n    style: _extends({\n      width: getPercentage(now, min, max) + \"%\"\n    }, style),\n    \"aria-valuenow\": now,\n    \"aria-valuemin\": min,\n    \"aria-valuemax\": max\n  }), srOnly ? /*#__PURE__*/React.createElement(\"span\", {\n    className: \"sr-only\"\n  }, label) : label);\n}\n\nvar ProgressBar = /*#__PURE__*/React.forwardRef(function (_ref2, ref) {\n  var isChild = _ref2.isChild,\n      props = _objectWithoutPropertiesLoose(_ref2, _excluded2);\n\n  props.bsPrefix = useBootstrapPrefix(props.bsPrefix, 'progress');\n\n  if (isChild) {\n    return renderProgressBar(props, ref);\n  }\n\n  var min = props.min,\n      now = props.now,\n      max = props.max,\n      label = props.label,\n      srOnly = props.srOnly,\n      striped = props.striped,\n      animated = props.animated,\n      bsPrefix = props.bsPrefix,\n      variant = props.variant,\n      className = props.className,\n      children = props.children,\n      wrapperProps = _objectWithoutPropertiesLoose(props, _excluded3);\n\n  return /*#__PURE__*/React.createElement(\"div\", _extends({\n    ref: ref\n  }, wrapperProps, {\n    className: classNames(className, bsPrefix)\n  }), children ? map(children, function (child) {\n    return /*#__PURE__*/cloneElement(child, {\n      isChild: true\n    });\n  }) : renderProgressBar({\n    min: min,\n    now: now,\n    max: max,\n    label: label,\n    srOnly: srOnly,\n    striped: striped,\n    animated: animated,\n    bsPrefix: bsPrefix,\n    variant: variant\n  }, ref));\n});\nProgressBar.displayName = 'ProgressBar';\nProgressBar.defaultProps = defaultProps;\nexport default ProgressBar;","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/BuildWorker.5e2f2717.worker.js\");\n}\n","import { faCheckSquare, faSquare, faTimes, faTrash, faUndo } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React, { lazy, useCallback, useContext, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { Accordion, Alert, Badge, Button, ButtonGroup, Card, Col, Container, Dropdown, DropdownButton, Image, InputGroup, ListGroup, Modal, OverlayTrigger, ProgressBar, Row, Tooltip } from 'react-bootstrap';\r\nimport ReactGA from 'react-ga';\r\n// eslint-disable-next-line\r\nimport Worker from \"worker-loader!./BuildWorker\";\r\nimport Artifact from '../Artifact/Artifact';\r\nimport { ArtifactSheet } from '../Artifact/ArtifactSheet';\r\nimport SetEffectDisplay from '../Artifact/Component/SetEffectDisplay';\r\nimport SlotNameWithIcon, { artifactSlotIcon } from '../Artifact/Component/SlotNameWIthIcon';\r\nimport Character from '../Character/Character';\r\nimport CharacterCard from '../Character/CharacterCard';\r\nimport { ContextAwareToggle, EnemyEditor, EnemyResText, HitModeToggle, InfusionAuraDropdown, ReactionToggle } from '../Character/CharacterDisplay/DamageOptionsAndCalculation';\r\nimport StatDisplayComponent from '../Character/CharacterDisplay/StatDisplayComponent';\r\nimport { CharacterSelectionDropdownList } from '../Character/CharacterSelection';\r\nimport CharacterSheet from '../Character/CharacterSheet';\r\nimport { getFormulaTargetsDisplayHeading } from '../Character/CharacterUtil';\r\nimport CustomFormControl from '../Components/CustomFormControl';\r\nimport FieldDisplay from '../Components/FieldDisplay';\r\nimport InfoComponent from '../Components/InfoComponent';\r\nimport { Stars } from '../Components/StarDisplay';\r\nimport StatIcon from '../Components/StatIcon';\r\nimport { DatabaseContext } from '../Database/Database';\r\nimport { dbStorage } from '../Database/DBStorage';\r\nimport Formula from '../Formula';\r\nimport useCharacterReducer from '../ReactHooks/useCharacterReducer';\r\nimport useForceUpdate from '../ReactHooks/useForceUpdate';\r\nimport usePromise from '../ReactHooks/usePromise';\r\nimport Stat from '../Stat';\r\nimport { StatKey } from '../Types/artifact';\r\nimport { ArtifactsBySlot, Build, BuildSetting } from '../Types/Build';\r\nimport { ICachedCharacter } from '../Types/character';\r\nimport { allElements, allSlotKeys, ArtifactSetKey, CharacterKey, SetNum, SlotKey } from '../Types/consts';\r\nimport { IFieldDisplay } from '../Types/IFieldDisplay';\r\nimport { ICalculatedStats } from '../Types/stats';\r\nimport statsToFields from '../Util/FieldUtil';\r\nimport { timeStringMs } from '../Util/TimeUtil';\r\nimport { crawlObject, deepClone, objectFromKeyMap } from '../Util/Util';\r\nimport WeaponSheet from '../Weapon/WeaponSheet';\r\nimport { buildContext, calculateTotalBuildNumber, maxBuildsToShowList } from './Build';\r\nimport { initialBuildSettings } from './BuildSetting';\r\nconst InfoDisplay = React.lazy(() => import('./InfoDisplay'));\r\n\r\n//lazy load the character display\r\nconst CharacterDisplayCard = lazy(() => import('../Character/CharacterDisplayCard'))\r\n\r\nconst warningBuildNumber = 10000000\r\n\r\nconst artifactsSlotsToSelectMainStats = [\"sands\", \"goblet\", \"circlet\"] as const\r\n\r\nfunction buildSettingsReducer(state: BuildSetting, action): BuildSetting {\r\n  switch (action.type) {\r\n    case 'mainStatKey': {\r\n      const { slotKey, mainStatKey } = action\r\n      const mainStatKeys = { ...state.mainStatKeys }//create a new object to update react dependencies\r\n\r\n      if (state.mainStatKeys[slotKey].includes(mainStatKey))\r\n        mainStatKeys[slotKey] = mainStatKeys[slotKey].filter(k => k !== mainStatKey)\r\n      else\r\n        mainStatKeys[slotKey].push(mainStatKey)\r\n      return { ...state, mainStatKeys }\r\n    }\r\n    case 'mainStatKeyReset': {\r\n      const { slotKey } = action\r\n      const mainStatKeys = { ...state.mainStatKeys }//create a new object to update react dependencies\r\n      mainStatKeys[slotKey] = []\r\n      return { ...state, mainStatKeys }\r\n    }\r\n    case `setFilter`: {\r\n      const { index, key, num = 0 } = action\r\n      state.setFilters[index] = { key, num }\r\n      return { ...state, setFilters: [...state.setFilters] }//do this because this is a dependency, so needs to be a \"new\" array\r\n    }\r\n    default:\r\n      break;\r\n  }\r\n  return { ...state, ...action }\r\n}\r\n\r\nexport default function BuildDisplay({ location: { characterKey: propCharacterKey } }) {\r\n  const database = useContext(DatabaseContext)\r\n  const [characterKey, setcharacterKey] = useState(() => {\r\n    const { characterKey = \"\" } = dbStorage.get(\"BuildsDisplay.state\") ?? {}\r\n    //NOTE that propCharacterKey can override the selected character.\r\n    return (propCharacterKey ?? characterKey) as CharacterKey | \"\"\r\n  })\r\n\r\n  const [modalBuild, setmodalBuild] = useState(-1) // the index of the newBuild that is being displayed in the character modal,\r\n  const [showArtCondModal, setshowArtCondModal] = useState(false)\r\n  const [showCharacterModal, setshowCharacterModal] = useState(false)\r\n\r\n  const [generatingBuilds, setgeneratingBuilds] = useState(false)\r\n  const [generationProgress, setgenerationProgress] = useState(0)\r\n  const [generationDuration, setgenerationDuration] = useState(0)//in ms\r\n  const [generationSkipped, setgenerationSkipped] = useState(0)\r\n\r\n  const [charDirty, setCharDirty] = useForceUpdate()\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n\r\n  const [artsDirty, setArtsDirty] = useForceUpdate()\r\n\r\n  const isMounted = useRef(false)\r\n\r\n  const worker = useRef(null as Worker | null)\r\n\r\n  type characterDataType = { character?: ICachedCharacter, characterSheet?: CharacterSheet, weaponSheet?: WeaponSheet, initialStats?: ICalculatedStats, statsDisplayKeys?: { basicKeys: any, [key: string]: any } }\r\n  const [{ character, characterSheet, weaponSheet, initialStats, statsDisplayKeys }, setCharacterData] = useState({} as characterDataType)\r\n  const buildSettings = useMemo(() => character?.buildSettings ?? initialBuildSettings(), [character])\r\n  const { setFilters, statFilters, mainStatKeys, optimizationTarget, mainStatAssumptionLevel, useExcludedArts, useEquippedArts, builds, buildDate, maxBuildsToShow } = buildSettings\r\n\r\n  if (initialStats)\r\n    initialStats.mainStatAssumptionLevel = mainStatAssumptionLevel\r\n\r\n  const buildStats = useMemo(() => {\r\n    if (!initialStats || !artifactSheets) return []\r\n    return builds.map(build => {\r\n      const arts = Object.fromEntries(build.map(id => database._getArt(id)).map(art => [art?.slotKey, art]))\r\n      return Character.calculateBuildwithArtifact(initialStats, arts, artifactSheets)\r\n    }).filter(build => build)\r\n  }, [builds, database, initialStats, artifactSheets])\r\n\r\n  const buildSettingsDispatch = useCallback((action) => {\r\n    if (!character) return\r\n    character.buildSettings = buildSettingsReducer(buildSettings, action)\r\n    database.updateChar(character)\r\n  }, [character, buildSettings, database])\r\n\r\n  useEffect(() => ReactGA.pageview('/build'), [])\r\n\r\n  //select a new character Key\r\n  const selectCharacter = useCallback((cKey = \"\") => {\r\n    if (characterKey === cKey) return\r\n    setcharacterKey(cKey)\r\n    setCharDirty()\r\n    setCharacterData({})\r\n  }, [setCharDirty, setcharacterKey, characterKey])\r\n\r\n  //load the character data as a whole\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (!characterKey || !artifactSheets) return\r\n      const character = database._getChar(characterKey)\r\n      if (!character) return selectCharacter(\"\")// character is prob deleted.\r\n      const characterSheet = await CharacterSheet.get(characterKey)\r\n      const weapon = database._getWeapon(character.equippedWeapon)\r\n      if (!weapon) return\r\n      const weaponSheet = await WeaponSheet.get(weapon.key)\r\n      if (!characterSheet || !weaponSheet) return\r\n      const initialStats = Character.createInitialStats(character, database, characterSheet, weaponSheet)\r\n      //NOTE: since initialStats are used, there are no inclusion of artifact formulas here.\r\n      const statsDisplayKeys = Character.getDisplayStatKeys(initialStats, { characterSheet, weaponSheet, artifactSheets })\r\n      setCharacterData({ character, characterSheet, weaponSheet, initialStats, statsDisplayKeys })\r\n    })()\r\n  }, [charDirty, characterKey, artifactSheets, database, selectCharacter])\r\n\r\n  //register changes in artifact database\r\n  useEffect(() =>\r\n    database.followAnyArt(setArtsDirty),\r\n    [setArtsDirty, database])\r\n\r\n  //register changes in character in db\r\n  useEffect(() =>\r\n    characterKey ? database.followChar(characterKey, setCharDirty) : undefined,\r\n    [characterKey, setCharDirty, database])\r\n\r\n  //terminate worker when component unmounts\r\n  useEffect(() => () => worker.current?.terminate(), [])\r\n\r\n  //save to BuildsDisplay.state on change\r\n  useEffect(() => {\r\n    if (isMounted.current) dbStorage.set(\"BuildsDisplay.state\", { characterKey })\r\n    else isMounted.current = true\r\n  }, [characterKey])\r\n\r\n  //validate optimizationTarget \r\n  useEffect(() => {\r\n    if (!statsDisplayKeys) return\r\n    if (!Array.isArray(optimizationTarget)) return\r\n    for (const sectionKey in statsDisplayKeys) {\r\n      const section = statsDisplayKeys[sectionKey]\r\n      for (const keys of section)\r\n        if (JSON.stringify(keys) === JSON.stringify(optimizationTarget)) return\r\n    }\r\n    buildSettingsDispatch({ optimizationTarget: initialBuildSettings().optimizationTarget })\r\n  }, [optimizationTarget, statsDisplayKeys, buildSettingsDispatch])\r\n\r\n  const { split, totBuildNumber } = useMemo(() => {\r\n    if (!characterKey) // Make sure we have all slotKeys\r\n      return { split: objectFromKeyMap(allSlotKeys, () => []) as ArtifactsBySlot, totBuildNumber: 0 }\r\n    const artifactDatabase = database._getArts().filter(art => {\r\n      //if its equipped on the selected character, bypass the check\r\n      if (art.location === characterKey) return true\r\n\r\n      if (art.exclude && !useExcludedArts) return false\r\n      if (art.location && !useEquippedArts) return false\r\n      return true\r\n    })\r\n    const split = Artifact.splitArtifactsBySlot(artifactDatabase);\r\n    //filter the split slots on the mainstats selected.\r\n    artifactsSlotsToSelectMainStats.forEach(slotKey =>\r\n      mainStatKeys[slotKey].length && (split[slotKey] = split[slotKey]?.filter((art) => mainStatKeys[slotKey].includes(art.mainStatKey))))\r\n    const totBuildNumber = calculateTotalBuildNumber(split, setFilters)\r\n    return artsDirty && { split, totBuildNumber }\r\n  }, [characterKey, useExcludedArts, useEquippedArts, mainStatKeys, setFilters, artsDirty, database])\r\n\r\n  const generateBuilds = useCallback(() => {\r\n    if (!initialStats || !artifactSheets) return\r\n    setgeneratingBuilds(true)\r\n    setgenerationDuration(0)\r\n    setgenerationProgress(0)\r\n    setgenerationSkipped(0)\r\n    //get the formula for this target\r\n\r\n    const artifactSetEffects = Artifact.setEffectsObjs(artifactSheets, initialStats)\r\n    const splitArtifacts = deepClone(split) as ArtifactsBySlot\r\n    //add mainStatVal to each artifact\r\n    Object.values(splitArtifacts).forEach(artArr => {\r\n      artArr!.forEach(art => {\r\n        art.mainStatVal = Artifact.mainStatValue(art.mainStatKey, art.rarity, Math.max(Math.min(mainStatAssumptionLevel, art.rarity * 4), art.level)) ?? 0;\r\n      })\r\n    })\r\n    //create an obj with app the artifact set effects to pass to buildworker.\r\n    const data = {\r\n      splitArtifacts, initialStats, artifactSetEffects,\r\n      setFilters, minFilters: statFilters, maxBuildsToShow, optimizationTarget\r\n    };\r\n    worker.current?.terminate()\r\n    worker.current = new Worker()\r\n    worker.current.onmessage = (e) => {\r\n      if (typeof e.data.progress === \"number\") {\r\n        const { progress, timing = 0, skipped = 0 } = e.data\r\n        setgenerationProgress(progress)\r\n        setgenerationDuration(timing)\r\n        setgenerationSkipped(skipped)\r\n        return\r\n      }\r\n      ReactGA.timing({\r\n        category: \"Build Generation\",\r\n        variable: \"timing\",\r\n        value: e.data.timing,\r\n        label: totBuildNumber.toString()\r\n      })\r\n      const builds = (e.data.builds as Build[]).map(b => Object.values(b.artifacts).map(a => a.id))\r\n      buildSettingsDispatch({ builds, buildDate: Date.now() })\r\n\r\n      setgeneratingBuilds(false)\r\n      worker.current?.terminate()\r\n      worker.current = null\r\n    };\r\n    worker.current.postMessage(data)\r\n  }, [artifactSheets, split, totBuildNumber, mainStatAssumptionLevel, initialStats, maxBuildsToShow, optimizationTarget, setFilters, statFilters, buildSettingsDispatch])\r\n\r\n\r\n  const dropdownitemsForStar = useCallback((star, index) => artifactSheets && ArtifactSheet.setsWithMaxRarity(artifactSheets, star).map(([setKey, setobj]) => {\r\n    if (setFilters.some(filter => filter.key === setKey)) return false;\r\n    const setsNumArr = Object.keys(artifactSheets?.[setKey]?.setEffects ?? {})\r\n    const artsAccountedOther = setFilters.reduce((accu, cur, ind) => (cur.key && ind !== index) ? accu + cur.num : accu, 0)\r\n    if (setsNumArr.every((num: any) => parseInt(num) + artsAccountedOther > 5)) return false;\r\n    return (<Dropdown.Item key={setKey} onClick={() => buildSettingsDispatch({ type: 'setFilter', index, key: setKey, num: parseInt(setsNumArr[0] as any) ?? 0 })} >\r\n      {setobj.nameWithIcon}\r\n    </Dropdown.Item>)\r\n  }), [setFilters, buildSettingsDispatch, artifactSheets])\r\n\r\n  const characterName = characterSheet?.name ?? \"Character Name\"\r\n  const characterDropDown = useMemo(() => <DropdownButton title={characterName} disabled={generatingBuilds}>\r\n    <Dropdown.Item onClick={() => selectCharacter(\"\")}>Unselect Character</Dropdown.Item>\r\n    <Dropdown.Divider />\r\n    <CharacterSelectionDropdownList onSelect={cKey => selectCharacter(cKey)} />\r\n  </DropdownButton>, [characterName, generatingBuilds, selectCharacter])\r\n\r\n  const formula = usePromise(Array.isArray(optimizationTarget) ? Formula.get(optimizationTarget) : undefined, [optimizationTarget])\r\n  const sortByText = useMemo(() => {\r\n    if (Array.isArray(optimizationTarget)) {\r\n      if (!formula) return null\r\n      let [type, , talentKey] = (formula as any).keys as string[]\r\n      const field = (formula as any).field as IFieldDisplay\r\n      const variant = Character.getTalentFieldValue(field, \"variant\", initialStats)\r\n      const text = Character.getTalentFieldValue(field, \"text\", initialStats)\r\n      if (type === \"character\") {\r\n        if (talentKey === \"normal\" || talentKey === \"charged\" || talentKey === \"plunging\") talentKey = \"auto\"\r\n        return <b>{characterSheet?.getTalentOfKey(talentKey, initialStats?.characterEle)?.name}: <span className={`text-${variant}`}>{text}</span></b>\r\n      } else if (type === \"weapon\") {\r\n        return <b>{weaponSheet?.name}: <span className={`text-${variant}`}>{text}</span></b>\r\n      }\r\n    } else return <b>Basic Stat: <span className={`text-${Stat.getStatVariant(optimizationTarget)}`}>{Stat.getStatNameWithPercent(optimizationTarget)}</span></b>\r\n    // return <Badge variant=\"danger\">INVALID</Badge>\r\n  }, [optimizationTarget, formula, initialStats, characterSheet, weaponSheet])\r\n\r\n\r\n  const artsAccounted = setFilters.reduce((accu, cur) => cur.key ? accu + cur.num : accu, 0)\r\n  const artifactCondCount = useMemo(() => {\r\n    let count = 0;\r\n    crawlObject(initialStats?.conditionalValues?.artifact, [], v => Array.isArray(v), () => count++)\r\n    return count\r\n  }, [initialStats?.conditionalValues])\r\n  return <Container className=\"mt-2\"> <buildContext.Provider value={{ equippedBuild: initialStats }}>\r\n\r\n    <InfoComponent\r\n      pageKey=\"buildPage\"\r\n      modalTitle=\"Character Management Page Guide\"\r\n      text={[\"For self-infused attacks, like Noelle's Sweeping Time, enable the skill in the talent page.\",\r\n        \"You can compare the difference between equipped artifacts and generated builds.\",\r\n        \"The more complex the formula, the longer the generation time.\",]}\r\n    ><InfoDisplay /></InfoComponent>\r\n    <BuildModal {...{\r\n      build: buildStats[modalBuild], showCharacterModal, characterKey, selectCharacter, close: () => {\r\n        setmodalBuild(-1)\r\n        setshowCharacterModal(false)\r\n      }\r\n    }} />\r\n    {!!initialStats && !!characterKey && <ArtConditionalModal {...{ showArtCondModal, setshowArtCondModal, initialStats, characterKey, artifactCondCount }} />}\r\n    <Row className=\"mt-2 mb-2\">\r\n      <Col>\r\n        {/* Build Generator Editor */}\r\n        <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n          <Card.Header>Build Generator</Card.Header>\r\n          <Card.Body>\r\n            <Row >\r\n              <Col xs={12} lg={6}>\r\n                {/* character selection */}\r\n                {characterKey ?\r\n                  <CharacterCard header={characterDropDown} characterKey={characterKey} bg={\"lightcontent\"} cardClassName=\"mb-2\" onEdit={!generatingBuilds ? () => setshowCharacterModal(true) : undefined} /> :\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n                    <Card.Header>\r\n                      {characterDropDown}\r\n                    </Card.Header>\r\n                  </Card>}\r\n                {/* Bonus Stats */}\r\n                {(() => {\r\n                  if (!character) return null\r\n                  const bonusStats = Object.fromEntries(Object.entries(character?.bonusStats).filter(([key]) =>\r\n                    !((key as string).endsWith(\"enemyImmunity\") || (key as string).endsWith(\"enemyRes_\") || key === \"enemyLevel\")))\r\n                  if (!Object.keys(bonusStats).length) return null\r\n                  const setStatsFields = statsToFields(bonusStats)\r\n                  return < Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2 w-100\" >\r\n                    <Card.Header >Bonus Stats</Card.Header>\r\n                    <Card.Body><ListGroup className=\"text-white\" >\r\n                      {setStatsFields.map((field, i) => <FieldDisplay key={i} index={i} field={field} />)}\r\n                    </ListGroup></Card.Body>\r\n                  </Card>\r\n                })()}\r\n                {/* enemy editor */}\r\n                {!!character && <Accordion >\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n                    <Card.Header>\r\n                      <Row>\r\n                        <Col>\r\n                          {Stat.getStatName(\"enemyLevel\")} <strong>{Character.getStatValueWithBonus(character, \"enemyLevel\")}</strong>\r\n                        </Col>\r\n                        <Col xs=\"auto\">\r\n                          <ContextAwareToggle callback={undefined} {...{ as: Button }} eventKey=\"enemyEditor\" />\r\n                        </Col>\r\n                      </Row>\r\n                    </Card.Header>\r\n                    <Card.Body>\r\n                      <Row className=\"mb-n2\">\r\n                        {[\"physical\", ...allElements].map(element => <Col xs={3} key={element}><EnemyResText element={element} character={character} /></Col>)}</Row>\r\n                    </Card.Body>\r\n                    <Accordion.Collapse eventKey=\"enemyEditor\">\r\n                      <Card.Body className=\"p-2\">\r\n                        <EnemyEditor character={character} bsProps={{ xs: 12 }} />\r\n                      </Card.Body>\r\n                    </Accordion.Collapse>\r\n                  </Card>\r\n                </Accordion>}\r\n                {/*Minimum Final Stat Filter */}\r\n                {!!statsDisplayKeys && <StatFilterCard className=\"mb-2\" statFilters={statFilters} statKeys={statsDisplayKeys?.basicKeys as any} setStatFilters={sFs => buildSettingsDispatch({ statFilters: sFs })} disabled={generatingBuilds} />}\r\n                {/* Hit mode options */}\r\n                {characterSheet && character && initialStats && <HitModeCard build={initialStats} characterSheet={characterSheet} className=\"mb-2\" character={character} disabled={generatingBuilds} />}\r\n              </Col>\r\n              <Col xs={12} lg={6}><Row>\r\n                <Col className=\"mb-2\" xs={12}>\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any}><Card.Body>\r\n                    <Button className=\"w-100\" onClick={() => setshowArtCondModal(true)} disabled={generatingBuilds}>\r\n                      <span>Default Artifact Set Effects {Boolean(artifactCondCount) && <Badge variant=\"success\">{artifactCondCount} Selected</Badge>}</span>\r\n                    </Button>\r\n                  </Card.Body></Card>\r\n                </Col>\r\n                {/* Artifact set picker */}\r\n                {(() => {\r\n                  const count = setFilters.filter(s => s.key).length\r\n                  return setFilters.map(({ key: setKey, num: setNum }, index) => index <= count && <Col className=\"mb-2\" key={index} xs={12}>\r\n                    <Card className=\"h-100\" bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n                      <Card.Header>\r\n                        <ButtonGroup>\r\n                          {/* Artifact set */}\r\n                          <DropdownButton as={ButtonGroup} title={artifactSheets?.[setKey]?.nameWithIcon ?? \"Artifact Set Filter\"} disabled={generatingBuilds}>\r\n                            <Dropdown.Item onClick={() => buildSettingsDispatch({ type: 'setFilter', index, key: \"\" })}>Unselect Artifact</Dropdown.Item>\r\n                            <Dropdown.ItemText>Max Rarity 🟊🟊🟊🟊🟊</Dropdown.ItemText>\r\n                            {dropdownitemsForStar(5, index)}\r\n                            <Dropdown.Divider />\r\n                            <Dropdown.ItemText>Max Rarity 🟊🟊🟊🟊</Dropdown.ItemText>\r\n                            {dropdownitemsForStar(4, index)}\r\n                            <Dropdown.Divider />\r\n                            <Dropdown.ItemText>Max Rarity 🟊🟊🟊</Dropdown.ItemText>\r\n                            {dropdownitemsForStar(3, index)}\r\n                          </DropdownButton>\r\n                          {/* set number */}\r\n                          <DropdownButton as={ButtonGroup} title={`${setNum}-set`}\r\n                            disabled={generatingBuilds || !setKey || artsAccounted >= 5}\r\n                          >\r\n                            {!!initialStats && Object.keys(artifactSheets?.[setKey]?.setEffects ?? {}).map((num: any) => {\r\n                              let artsAccountedOther = setFilters.reduce((accu, cur) => (cur.key && cur.key !== setKey) ? accu + cur.num : accu, 0)\r\n                              return (parseInt(num) + artsAccountedOther <= 5) &&\r\n                                (<Dropdown.Item key={num} onClick={() => buildSettingsDispatch({ type: 'setFilter', index, key: setFilters[index].key, num: parseInt(num) })} >\r\n                                  {`${num}-set`}\r\n                                </Dropdown.Item>)\r\n                            })}\r\n                          </DropdownButton>\r\n                        </ButtonGroup>\r\n                      </Card.Header>\r\n                      {setKey ? <Card.Body><Row className=\"mb-n2\">\r\n                        {!!initialStats && !!characterKey && Object.keys(artifactSheets?.[setKey].setEffects ?? {}).map(setNKey => parseInt(setNKey) as SetNum).filter(setNkey => setNkey <= setNum).map(setNumKey =>\r\n                          <SetEffectDisplay newBuild={undefined} key={setKey + setNumKey} {...{ setKey, setNumKey, equippedBuild: initialStats, characterKey, editable: true }} />)}\r\n                      </Row></Card.Body> : null}\r\n                    </Card>\r\n                  </Col>)\r\n                })()}\r\n                <Col className=\"mb-2\" xs={12}>\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any}><Card.Body className=\"mb-n2\">\r\n                    <Button className=\"w-100 mb-2\" onClick={() => buildSettingsDispatch({ useEquippedArts: !useEquippedArts })} disabled={generatingBuilds}>\r\n                      <span><FontAwesomeIcon icon={useEquippedArts ? faCheckSquare : faSquare} /> Use Equipped Artifacts</span>\r\n                    </Button>\r\n                    <Button className=\"w-100 mb-2\" onClick={() => buildSettingsDispatch({ useExcludedArts: !useExcludedArts })} disabled={generatingBuilds}>\r\n                      <span><FontAwesomeIcon icon={useExcludedArts ? faCheckSquare : faSquare} /> Use Excluded Artifacts</span>\r\n                    </Button>\r\n                  </Card.Body></Card>\r\n                </Col>\r\n                {/* main stat selector */}\r\n                <Col className=\"mb-2\" xs={12}>\r\n                  <Card bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n                    <Card.Header>\r\n                      <Row>\r\n                        <Col>Artifact Main Stat</Col>\r\n                        <Col xs=\"auto\"><AssumeFullLevelToggle mainStatAssumptionLevel={mainStatAssumptionLevel} setmainStatAssumptionLevel={v => buildSettingsDispatch({ mainStatAssumptionLevel: v })} disabled={generatingBuilds} /></Col>\r\n                      </Row>\r\n                    </Card.Header>\r\n                    <Card.Body className=\"mb-n2\">\r\n                      {artifactsSlotsToSelectMainStats.map(slotKey => {\r\n                        const numSel = mainStatKeys[slotKey].length\r\n                        return <Card bg=\"darkcontent\" text={\"lightfont\" as any} className=\"mb-2\" key={slotKey}>\r\n                          <Card.Header className=\"p-2\"><Row >\r\n                            <Col className=\"ml-2\"><SlotNameWithIcon slotKey={slotKey} /></Col>\r\n                            <Col xs=\"auto\">\r\n                              <Badge variant=\"info\">{numSel ? `${numSel} Selected` : `Any`}</Badge>\r\n                              <Button variant=\"danger\" size=\"sm\" className=\"py-0 px-1 ml-2\" disabled={!mainStatKeys[slotKey].length}\r\n                                onClick={() => buildSettingsDispatch({ type: \"mainStatKeyReset\", slotKey })}>\r\n                                <FontAwesomeIcon icon={faUndo} />\r\n                              </Button>\r\n                            </Col>\r\n                          </Row></Card.Header>\r\n                          <Card.Body className=\"p-0\"><Row className=\"no-gutters\">\r\n                            {Artifact.slotMainStats(slotKey).map((mainStatKey, i) => {\r\n                              const selected = mainStatKeys[slotKey].includes(mainStatKey)\r\n                              return <Col xs={i < 3 ? 4 : 6} key={mainStatKey}>\r\n                                <Button className=\"w-100 rounded-0\" size=\"sm\" variant={selected ? \"success\" : \"secondary\"} disabled={generatingBuilds}\r\n                                  onClick={() => buildSettingsDispatch({ type: \"mainStatKey\", slotKey, mainStatKey })}>\r\n                                  {StatIcon[mainStatKey]} {Stat.getStatNameWithPercent(mainStatKey, \"\", false)}\r\n                                </Button>\r\n                              </Col>\r\n                            })}\r\n                          </Row></Card.Body>\r\n                        </Card>\r\n                      })}\r\n                    </Card.Body>\r\n                  </Card>\r\n                </Col>\r\n              </Row></Col>\r\n            </Row>\r\n            <Row className=\"d-flex justify-content-between mb-2\">\r\n              <Col xs=\"auto\" >\r\n                <ButtonGroup>\r\n                  <Button\r\n                    className=\"h-100\"\r\n                    disabled={!characterKey || generatingBuilds}\r\n                    variant={(characterKey && totBuildNumber <= warningBuildNumber) ? \"success\" : \"warning\"}\r\n                    onClick={generateBuilds}\r\n                  ><span>Generate</span></Button>\r\n                  <Dropdown as={ButtonGroup}>\r\n                    <OverlayTrigger\r\n                      overlay={<Tooltip id=\"max-build-tooltip\">\r\n                        Decreasing the number of generated build will decrease build calculation time for large number of builds.\r\n                      </Tooltip>}\r\n                    >\r\n                      <Dropdown.Toggle disabled={generatingBuilds}><b>{maxBuildsToShow}</b> {maxBuildsToShow === 1 ? \"Build\" : \"Builds\"}</Dropdown.Toggle>\r\n                    </OverlayTrigger>\r\n                    <Dropdown.Menu>\r\n                      {maxBuildsToShowList.map(v => <Dropdown.Item key={v} onClick={() => buildSettingsDispatch({ maxBuildsToShow: v })}>{v} {v === 1 ? \"Build\" : \"Builds\"}</Dropdown.Item>)}\r\n                    </Dropdown.Menu>\r\n                  </Dropdown>\r\n                  <Button\r\n                    className=\"h-100\"\r\n                    disabled={!generatingBuilds}\r\n                    variant=\"danger\"\r\n                    onClick={() => {\r\n                      if (!worker.current) return;\r\n                      worker.current.terminate();\r\n                      worker.current = null\r\n                      setgeneratingBuilds(false)\r\n                      setgenerationDuration(0)\r\n                      setgenerationProgress(0)\r\n                      setgenerationSkipped(0)\r\n                    }}\r\n                  ><span>Cancel</span></Button>\r\n                </ButtonGroup>\r\n              </Col>\r\n              <Col xs=\"auto\">\r\n                {/* Dropdown to select sorting value */}\r\n                {<Dropdown as={ButtonGroup} drop=\"up\">\r\n                  <Dropdown.Toggle disabled={generatingBuilds} variant=\"light\" >\r\n                    <span>Optimization Target: {sortByText}</span>\r\n                  </Dropdown.Toggle>\r\n                  <Dropdown.Menu align=\"right\" style={{ minWidth: \"40rem\" }} >\r\n                    <Row>\r\n                      {!!statsDisplayKeys && Object.entries(statsDisplayKeys).map(([sectionKey, fields]: [string, any]) => {\r\n                        const header = (characterSheet && weaponSheet && artifactSheets) ? getFormulaTargetsDisplayHeading(sectionKey, { characterSheet, weaponSheet, artifactSheets }, initialStats?.characterEle) : sectionKey\r\n                        return <Col xs={12} md={6} key={sectionKey}>\r\n                          <Dropdown.Header style={{ overflow: \"hidden\", textOverflow: \"ellipsis\" }}><b>{header}</b></Dropdown.Header>\r\n                          {fields.map((target, i) => {\r\n                            if (Array.isArray(target))\r\n                              return <TargetSelectorDropdownItem key={i} {...{ target, buildSettingsDispatch, initialStats }} />\r\n                            else if (typeof target === \"string\")\r\n                              return <Dropdown.Item key={i} onClick={() => buildSettingsDispatch({ optimizationTarget: target })}>{Stat.getStatNameWithPercent(target)}</Dropdown.Item>\r\n                            return null\r\n                          })}\r\n                        </Col>\r\n                      })}\r\n                    </Row>\r\n                  </Dropdown.Menu>\r\n                </Dropdown>}\r\n              </Col>\r\n            </Row>\r\n            <Row className=\"\">\r\n              <Col>{!!characterKey && <BuildAlert {...{ totBuildNumber, generatingBuilds, generationSkipped, generationProgress, generationDuration, characterName, maxBuildsToShow }} />}</Col>\r\n            </Row>\r\n          </Card.Body>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n    <Row className=\"mb-2\">\r\n      <Col>\r\n        <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n          <Card.Header>\r\n            <Row>\r\n              <Col>{buildStats ? <span>Showing <strong>{buildStats.length}</strong> Builds generated for {characterName}. {!!buildDate && <span>Build generated on: <strong>{(new Date(buildDate)).toLocaleString()}</strong></span>}</span>\r\n                : <span>Select a character to generate builds.</span>}</Col>\r\n            </Row>\r\n          </Card.Header>\r\n          {/* Build List */}\r\n          <ListGroup>\r\n            {buildStats?.map((build, index) =>\r\n              characterSheet && weaponSheet && artifactSheets && <ArtifactDisplayItem sheets={{ characterSheet, weaponSheet, artifactSheets }} build={build} characterKey={characterKey as CharacterKey} index={index} key={index} statsDisplayKeys={statsDisplayKeys} onClick={() => setmodalBuild(index)} />\r\n            )}\r\n          </ListGroup>\r\n        </Card>\r\n      </Col>\r\n    </Row>\r\n  </buildContext.Provider></Container >\r\n}\r\n\r\nfunction TargetSelectorDropdownItem({ target, buildSettingsDispatch, initialStats }) {\r\n  const formula = usePromise(Formula.get(target), [target])\r\n  if (!formula) return null\r\n  const talentField = (formula as any).field as IFieldDisplay\r\n  return <Dropdown.Item onClick={() => buildSettingsDispatch({ optimizationTarget: target })} style={{ overflow: \"hidden\", textOverflow: \"ellipsis\" }}>\r\n    <span className={`text-${Character.getTalentFieldValue(talentField, \"variant\", initialStats)}`}>{Character.getTalentFieldValue(talentField, \"text\", initialStats)}</span>\r\n  </Dropdown.Item>\r\n}\r\n\r\nfunction BuildModal({ build, showCharacterModal, characterKey, selectCharacter, close }) {\r\n  return <Modal show={Boolean(showCharacterModal || build)} onHide={close} size=\"xl\" contentClassName=\"bg-transparent\">\r\n    <React.Suspense fallback={<span>Loading...</span>}>\r\n      <CharacterDisplayCard\r\n        tabName={undefined}\r\n        characterKey={characterKey}\r\n        setCharacterKey={cKey => selectCharacter(cKey)}\r\n        newBuild={build}\r\n        onClose={close}\r\n        footer={<Button variant=\"danger\" onClick={close}>Close</Button>} />\r\n    </React.Suspense>\r\n  </Modal>\r\n}\r\n\r\nfunction ArtConditionalModal({ showArtCondModal, setshowArtCondModal, initialStats, characterKey, artifactCondCount }: {\r\n  showArtCondModal, setshowArtCondModal, initialStats: ICalculatedStats, characterKey: CharacterKey, artifactCondCount\r\n}) {\r\n  const closeArtCondModal = useCallback(() => setshowArtCondModal(false), [setshowArtCondModal])\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n  const characterDispatch = useCharacterReducer(characterKey)\r\n  if (!artifactSheets) return null\r\n  const artSetKeyList = Object.entries(ArtifactSheet.setKeysByRarities(artifactSheets)).reverse().flatMap(([, sets]) => sets)\r\n  return <Modal show={showArtCondModal} onHide={closeArtCondModal} size=\"xl\" contentClassName=\"bg-transparent\">\r\n    <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n      <Card.Header>\r\n        <Row>\r\n          <Col>\r\n            <h5>Default Artifact Set Effects  {Boolean(artifactCondCount) && <Badge variant=\"success\">{artifactCondCount} Selected</Badge>}</h5>\r\n          </Col>\r\n          <Col xs=\"auto\" >\r\n            <Button onClick={() => {\r\n              if (initialStats.conditionalValues.artifact) initialStats.conditionalValues.artifact = {}\r\n              characterDispatch({ conditionalValues: initialStats.conditionalValues })\r\n            }}><span><FontAwesomeIcon icon={faUndo} /> Reset All</span></Button>\r\n          </Col>\r\n          <Col xs=\"auto\" >\r\n            <Button variant=\"danger\" onClick={closeArtCondModal}>\r\n              <FontAwesomeIcon icon={faTimes} /></Button>\r\n          </Col>\r\n        </Row>\r\n      </Card.Header>\r\n      <Card.Body>\r\n        <Row>\r\n          {artSetKeyList.map(setKey => {\r\n            const sheet = artifactSheets[setKey]\r\n            let icon = Object.values(sheet.slotIcons)[0]\r\n            const rarities = sheet.rarity\r\n            const rarity = rarities[0]\r\n            return <Col className=\"mb-2\" key={setKey} xs={12} lg={6} xl={4}>\r\n              <Card className=\"h-100\" bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n                <Card.Header >\r\n                  <Row>\r\n                    <Col xs=\"auto\" className=\"ml-n3 my-n2\">\r\n                      <Image src={icon} className={`thumb-mid grad-${rarity}star m-1`} thumbnail />\r\n                    </Col>\r\n                    <Col >\r\n                      <h6><b>{artifactSheets?.[setKey].name ?? \"\"}</b></h6>\r\n                      <span>{rarities.map((ns, i) => <span key={ns}>{ns}<Stars stars={1} /> {i < (rarities.length - 1) ? \"/ \" : null}</span>)}</span>\r\n                    </Col>\r\n                  </Row>\r\n                </Card.Header>\r\n                <Card.Body><Row className=\"mb-n2\">\r\n                  {Boolean(setKey) && Object.keys(sheet.setEffects).map(key => parseInt(key) as SetNum).map(setNumKey =>\r\n                    <SetEffectDisplay newBuild={undefined} key={setKey + setNumKey} {...{ setKey, setNumKey, equippedBuild: initialStats, editable: true, characterKey }} />)}\r\n                </Row></Card.Body>\r\n              </Card>\r\n            </Col>\r\n          })}\r\n        </Row>\r\n      </Card.Body>\r\n      <Card.Footer>\r\n        <Button variant=\"danger\" onClick={closeArtCondModal}>\r\n          <FontAwesomeIcon icon={faTimes} /> CLOSE</Button>\r\n      </Card.Footer>\r\n    </Card>\r\n  </Modal>\r\n}\r\n\r\nfunction StatFilterItem({ statKey, statKeys = [], min, close, setFilter, disabled }: {\r\n  statKey?, statKeys, min, close, setFilter, disabled\r\n}) {\r\n  const isFloat = Stat.getStatUnit(statKey) === \"%\"\r\n  const inputProps = {\r\n    disabled: !statKey,\r\n    allowEmpty: true,\r\n    float: isFloat,\r\n  }\r\n  const minInputProps = {\r\n    ...inputProps,\r\n    placeholder: \"MIN\",\r\n    value: min,\r\n    onChange: (s) => setFilter(statKey, s)\r\n  }\r\n  return <InputGroup className=\"mb-2\">\r\n    <DropdownButton\r\n      as={InputGroup.Prepend}\r\n      title={Stat.getStatNameWithPercent(statKey, \"New Stat\")}\r\n      id=\"input-group-dropdown-1\"\r\n      disabled={disabled}\r\n    >\r\n      {statKeys.map(sKey => <Dropdown.Item key={sKey} onClick={() => { close?.(); setFilter(sKey, min) }}>{Stat.getStatNameWithPercent(sKey)}</Dropdown.Item>)}\r\n    </DropdownButton>\r\n    <CustomFormControl {...minInputProps} />\r\n    {Boolean(close) && <InputGroup.Append>\r\n      <Button variant=\"danger\" onClick={close} disabled={disabled}><FontAwesomeIcon icon={faTrash} /></Button>\r\n    </InputGroup.Append>}\r\n  </InputGroup>\r\n}\r\n\r\nfunction HitModeCard({ characterSheet, character, character: { key: characterKey }, build, className, disabled }: { characterSheet: CharacterSheet, character: ICachedCharacter, build: ICalculatedStats, className: string, disabled: boolean }) {\r\n  if (!character) return null\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className={className}>\r\n    <Card.Header>\r\n      <Row>\r\n        <Col>Hit Mode Options</Col>\r\n        <Col xs=\"auto\"><InfusionAuraDropdown characterSheet={characterSheet} character={character} disabled={disabled} /></Col>\r\n      </Row>\r\n    </Card.Header>\r\n    <Card.Body className=\"mb-n2\">\r\n      <HitModeToggle characterKey={characterKey} hitMode={character.hitMode} className=\"w-100 mb-2\" disabled={disabled} />\r\n      <ReactionToggle build={build} character={character} className=\"w-100 mb-2\" disabled={disabled} />\r\n    </Card.Body>\r\n  </Card >\r\n}\r\n\r\nfunction StatFilterCard({ statKeys = [], statFilters = {}, setStatFilters, className, disabled }: { statKeys: StatKey[], statFilters: Dict<StatKey, number>, setStatFilters: (object) => void, className: string, disabled?: boolean }) {\r\n  const remainingKeys = statKeys.filter(key => !(Object.keys(statFilters) as any).some(k => k === key))\r\n  const setFilter = (sKey, min) => setStatFilters({ ...statFilters, [sKey]: min })\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className={className}>\r\n    <Card.Header>Minimum Final Stat Filter</Card.Header>\r\n    <Card.Body>\r\n      <Row className=\"mb-n2\">\r\n        {Object.entries(statFilters).map(([statKey, min]) => {\r\n          return <Col xs={12} key={statKey} ><StatFilterItem statKey={statKey} statKeys={remainingKeys} setFilter={setFilter} disabled={disabled} min={min} close={() => {\r\n            delete statFilters[statKey]\r\n            setStatFilters({ ...statFilters })\r\n          }} /></Col>\r\n        })}\r\n        <Col xs={12}>\r\n          <StatFilterItem min={undefined} close={undefined} statKeys={remainingKeys} setFilter={setFilter} disabled={disabled} />\r\n        </Col>\r\n      </Row>\r\n    </Card.Body>\r\n  </Card>\r\n}\r\n\r\ntype ArtifactDisplayItemProps = {\r\n  sheets: {\r\n    characterSheet: CharacterSheet\r\n    weaponSheet: WeaponSheet,\r\n    artifactSheets: StrictDict<ArtifactSetKey, ArtifactSheet>\r\n  },\r\n  index: number,\r\n  characterKey: CharacterKey,\r\n  build: ICalculatedStats,\r\n  statsDisplayKeys: any,\r\n  onClick: () => void\r\n}\r\n//for displaying each artifact build\r\nfunction ArtifactDisplayItem({ sheets, sheets: { artifactSheets }, index, characterKey, build, statsDisplayKeys, onClick }: ArtifactDisplayItemProps) {\r\n  const database = useContext(DatabaseContext)\r\n  const character = database._getChar(characterKey)\r\n  if (!character) return null\r\n  const { equippedArtifacts } = character\r\n  const currentlyEquipped = allSlotKeys.every(slotKey => equippedArtifacts[slotKey] === build.equippedArtifacts?.[slotKey])\r\n  return (<div>\r\n    <ListGroup.Item\r\n      variant={index % 2 ? \"customdark\" : \"customdarker\"} className=\"text-white\" action\r\n      onClick={onClick}\r\n    >\r\n      <h5 className=\"mb-2\"><Row>\r\n        <Col xs=\"auto\">\r\n          <Badge variant=\"info\"><strong>{index + 1}{currentlyEquipped ? \" (Equipped)\" : \"\"}</strong></Badge>\r\n        </Col>\r\n        <Col xs=\"auto\">{(Object.entries(build.setToSlots) as [ArtifactSetKey, SlotKey[]][]).sort(([key1, slotarr1], [key2, slotarr2]) => slotarr2.length - slotarr1.length).map(([key, slotarr]) =>\r\n          <Badge key={key} variant={currentlyEquipped ? \"success\" : \"primary\"} className=\"mr-2\">\r\n            {slotarr.map(slotKey => artifactSlotIcon(slotKey))} {artifactSheets?.[key].name ?? \"\"}\r\n          </Badge>\r\n        )}</Col>\r\n      </Row></h5>\r\n      <StatDisplayComponent {...{ sheets, character, equippedBuild: build, statsDisplayKeys, cardbg: (index % 2 ? \"lightcontent\" : \"darkcontent\") }} />\r\n    </ListGroup.Item>\r\n  </div>)\r\n}\r\n\r\nfunction BuildAlert({ totBuildNumber, generatingBuilds, generationSkipped, generationProgress, generationDuration, characterName, maxBuildsToShow }) {\r\n  const totalBuildNumberString = totBuildNumber?.toLocaleString() ?? totBuildNumber\r\n  const totalUnskipped = totBuildNumber - generationSkipped\r\n  const generationProgressString = generationProgress?.toLocaleString() ?? generationProgress\r\n  const generationSkippedString = generationSkipped?.toLocaleString() ?? generationSkipped\r\n  const totalUnskippedString = totalUnskipped?.toLocaleString() ?? totalUnskipped\r\n  const generationSkippedText = Boolean(generationSkipped) && <span>(<b>{generationSkippedString}</b> skipped)</span>\r\n  if (generatingBuilds) {\r\n    let progPercent = generationProgress * 100 / (totalUnskipped)\r\n    return <Alert variant=\"success\">\r\n      <span>Generating and testing <b className=\"text-monospace\">{generationProgressString}/{totalUnskippedString}</b> build configurations against the criteria for <b>{characterName}</b>. {generationSkippedText}</span><br />\r\n      <h6>Time elapsed: <strong className=\"text-monospace\">{timeStringMs(generationDuration)}</strong></h6>\r\n      <ProgressBar now={progPercent} label={`${progPercent.toFixed(1)}%`} />\r\n    </Alert>\r\n  } else if (!generatingBuilds && generationProgress) {//done\r\n    return <Alert variant=\"success\">\r\n      <span>Generated and tested <b className=\"text-monospace\">{totalUnskippedString}</b> Build configurations against the criteria for <b>{characterName}</b>. {generationSkippedText}</span>\r\n      <h6>Total duration: <strong className=\"text-monospace\">{timeStringMs(generationDuration)}</strong></h6>\r\n      <ProgressBar now={100} variant=\"success\" label=\"100%\" />\r\n    </Alert>\r\n  } else {\r\n    return totBuildNumber === 0 ?\r\n      <Alert variant=\"warning\" className=\"mb-0\"><span>Current configuration will not generate any builds for <b>{characterName}</b>. Please change your Artifact configurations, or add/include more Artifacts.</span></Alert>\r\n      : (totBuildNumber > warningBuildNumber ?\r\n        <Alert variant=\"warning\" className=\"mb-0\"><span>Current configuration will generate <b>{totalBuildNumberString}</b> builds for <b>{characterName}</b>. This might take quite a while to generate...</span></Alert> :\r\n        <Alert variant=\"success\" className=\"mb-0\"><span>Current configuration {totBuildNumber <= maxBuildsToShow ? \"generated\" : \"will generate\"} <b>{totalBuildNumberString}</b> builds for <b>{characterName}</b>.</span></Alert>)\r\n  }\r\n}\r\n\r\nconst levels = {\r\n  0: <span>No level assumption</span>,\r\n  4: <span>Assume at least level 4</span>,\r\n  8: <span>Assume at least level 8</span>,\r\n  12: <span>Assume at least level 12</span>,\r\n  16: <span>Assume at least level 16</span>,\r\n  20: <span>Assume at least level 20</span>\r\n}\r\nfunction AssumeFullLevelToggle({ mainStatAssumptionLevel = 0, setmainStatAssumptionLevel, disabled }) {\r\n  return <OverlayTrigger overlay={<Tooltip id=\"assume-level-tooltip\">Change Main Stat value to be at least a specific level. Does not change substats.</Tooltip>} >\r\n    <Dropdown>\r\n      <Dropdown.Toggle variant={mainStatAssumptionLevel ? \"orange\" : \"primary\"} disabled={disabled}>{levels[mainStatAssumptionLevel]}</Dropdown.Toggle>\r\n      <Dropdown.Menu>\r\n        {Object.entries(levels).map(([key, text]) => <Dropdown.Item key={key} onClick={() => setmainStatAssumptionLevel(parseInt(key))}>{text}</Dropdown.Item>)}\r\n      </Dropdown.Menu>\r\n    </Dropdown>\r\n  </OverlayTrigger>\r\n}\r\n"],"sourceRoot":""}