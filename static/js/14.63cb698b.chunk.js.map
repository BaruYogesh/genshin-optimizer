{"version":3,"sources":["Components/StarDisplay.tsx","Components/CustomFormControl.tsx","Util/UIUtil.ts","Components/CharacterSelection.tsx","Components/InfoComponent.tsx","Artifact/ArtifactCard.tsx","Artifact/PercentBadge.tsx","Artifact/Component/ArtifactSetDropDownMenuFragment.tsx","Artifact/imgs/scan_art_main.png","Artifact/imgs/snippet.png","Artifact/UploadDisplay.tsx","Util/BorrowManager.ts","Artifact/ArtifactEditor.tsx","Artifact/ArtifactDisplay.tsx"],"names":["StarIcon","icon","faStar","Stars","stars","colored","className","Array","keys","map","_","i","CustomFormControl","value","onChange","disabled","float","placeholder","allowEmpty","max","min","useState","state","setState","sendChange","useCallback","undefined","parseFunc","parseFloat","parseInt","useEffect","toString","aria-label","type","e","target","onBlur","onKeyDown","key","valueStringWithUnit","unit","Math","round","toFixed","valueString","CharacterSelectionDropdownList","onSelect","database","_getCharKeys","sort","a","b","characterKey","DropDownItem","characterSheet","usePromise","CharacterSheet","get","Item","onClick","nameWIthIcon","InfoComponent","pageKey","text","modalTitle","children","loadFromLocalStorage","showInfoModal","setshowInfoModal","isArray","getRandomElementFromArray","displayText","closeModal","infoShown","saveToLocalStorage","show","onHide","size","variant","contentClassName","bg","Header","Title","xs","faTimes","Body","fallback","animation","Footer","ns","key18","faQuestionCircle","allSubstatFilter","Set","allSubstats","ArtifactCard","artifactId","artifactObj","onEdit","onDelete","mainStatAssumptionLevel","effFilter","t","useTranslation","databaseArtifact","updateDatabaseArtifact","followArt","sheet","ArtifactSheet","_getArt","setKey","equipOnChar","charKey","setLocation","editable","art","location","id","slotKey","numStars","level","mainStatKey","substats","lock","mainStatLevel","mainStatVal","Artifact","mainStatValue","Stat","getStatUnit","getArtifactEfficiency","currentEfficiency","maxEfficiency","artifactValid","locationName","name","faBriefcase","slotName","getSlotName","slotDesc","getSlotDesc","slotDescEle","placement","overlay","faInfoCircle","setEffects","setDesc","Object","setNumKey","setNum","setEffectDesc","setDescEle","border","md","src","slotIcons","thumbnail","getStatName","stat","numRolls","rolls","length","efficiency","effOpacity","statName","style","opacity","has","valid","Toggle","Menu","Divider","lockArtifact","faLock","faLockOpen","faEdit","faTrashAlt","PercentBadge","floor","badgeColor","ArtifactSetDropDownMenuFragment","sheets","click","Fragment","entries","setKeysByRarities","reverse","star","sets","Dropdown","Trans","i18nKey","nameWithIcon","starColor","r","g","schedulers","init","deinit","data","this","callback","refCount","box","result","language","scheduler","createScheduler","promises","fill","worker","createWorker","errorHandler","console","error","load","loadLanguage","initialize","addWorker","Promise","any","_language","then","terminate","UploadDisplay","setReset","artifactInEditor","modalShow","setModalShow","useReducer","queueReducer","processed","outstanding","dispatchQueue","firstProcessed","firstOutstanding","processingImageURL","imageURL","processingResult","remaining","image","artifact","texts","fileName","numProcessing","processingCurrent","slice","forEach","processEntry","removeCurrent","uploadFiles","files","file","clearQueue","pasteFunc","clipboardData","window","addEventListener","removeEventListener","img","alt","Row","ExplainationModal","hide","Col","Button","ReactGA","modalview","Card","process","lg","ProgressBar","animated","now","Form","File","label","accept","custom","multiple","Boolean","Label","Modal","Snippet","href","rel","scan_art_main","queue","message","entry","fileToURL","getAll","ocr","ocrResult","findBestArtifact","rarities","parseSetKeys","artifactSetTexts","parseSlotKeys","whiteTexts","parseSubstats","substatTexts","parseMainStatKeys","parseMainStatValues","resolve","reader","FileReader","onloadend","readAsDataURL","urlToImageData","urlFile","Image","onload","canvas","document","createElement","context","getContext","width","height","drawImage","getImageData","imageToImageData","imageDataToCanvas","imageData","putImageData","halfHeight","bottomOpts","rectangle","top","left","awaits","textsFromImage","bandPass","mode","region","parseRarities","all","options","borrow","addJob","rec","lines","line","textSetKeys","slotKeys","mainStatKeys","mainStatValues","relevantSetKey","bestScore","bestArtifacts","rarityRates","fromEntries","allArtifactRarities","rarity","score","reduce","count","set","includes","substat","getSubstatRolls","allSlotKeys","slotMainStats","mainStatScore","relevantMainStatValues","filter","numStarsString","rarityIndividualScore","setKeys","rarityScore","minimumMainStatValue","values","findIndex","mainStatValScore","push","chosen","resultMainStatVal","every","other","add","unknownText","detectedText","inferredText","addText","available","recommended","v","index","ambiguousText","getStatNameRaw","find","results","allArtifactSets","hammingDistance","replace","nameRaw","f","pixels","d","lastRowNum","rowsWithNumber","y","onStar","x","colorCloseEnough","clamp","color1","color2","threshold","intCloseEnough","abs","allMainStatKeys","toLowerCase","regex","match","exec","matches","RegExp","pixelData","Uint8ClampedArray","from","bot","bw","invert","halfInd","ImageData","uploadDisplayReset","ArtifactEditor","artifactIdToEdit","cancelEdit","artifactReducer","flexArtifact","artifactDispatch","artifactSheets","useMemo","validateFlexArtifact","errors","deepClone","reset","update","newValue","newSheet","pick","prefer","slots","setSubstat","isValid","editorArt","isDup","candidates","_getArts","candidate","upgraded","some","duplicated","candidateSubstat","dupId","checkDuplicate","InputGroup","as","Prepend","DropdownButton","Append","title","Text","l","sKey","getStatNameWithPercent","ItemText","mainStatK","FormControl","readOnly","OverlayTrigger","Popover","Content","cursor","SubstatInput","Alert","saveArtifact","confirm","accurateValue","fround","rollNum","rollData","allowedRolls","rollLabel","rollInfo","numUpgrades","high","getSubstatRollData","rollOffset","rollBadge","Badge","rollArr","val","indexOf","ButtonGroup","action","oldIndex","current","updateArt","InfoDisplay","React","lazy","sortKeys","initialFilter","filterArtSetKey","filterStars","filterLevelLow","filterLevelHigh","filterSlotKey","filterMainStatKey","filterSubstats","filterLocation","filterLocked","ascending","sortType","maxNumArtifactsToDisplay","filterReducer","filterInit","initial","ArtifactDisplay","props","filters","filterDispatch","artToEditId","setartToEditId","pageIdex","setpageIdex","scrollRef","useRef","invScrollRef","useForceUpdate","dbDirty","forceUpdate","effFilterSet","deleteArtifact","removeArt","editArtifact","scrollIntoView","behavior","cancelEditArtifact","pageview","followAnyArt","locationDisplay","lockedDisplay","allArtifacts","artifacts","filterKey","item","numUnequip","numUnlock","numLock","totalArtNum","numPages","ceil","currentPageIndex","artifactsToShow","locationCharacterSheet","faUserShield","paginationCard","showingValue","Container","returnObjects","ref","faUndo","ToggleButtonGroup","selected","ToggleButton","faCheckSquare","faSquare","faSortAmountDownAlt","faSortAmountUp","statKey","CharacterSelection","cid","substatKey","getSubstatKeys","faUserSlash","faTrash","ButtonToolbar","slicep","n"],"mappings":"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","file":"static/js/14.63cb698b.chunk.js","sourcesContent":["import { faStar } from '@fortawesome/free-solid-svg-icons'\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\r\nimport { Rarity } from '../Types/consts'\r\n\r\nconst StarIcon = () => <FontAwesomeIcon icon={faStar} />\r\nconst Stars = ({ stars, colored = false }: { stars: Rarity, colored?: boolean }) => <span className={colored ? \"text-5star\" : \"\"}>\r\n  {stars ? [...Array(stars).keys()].map((_, i) => <StarIcon key={i} />) : null}\r\n</span>\r\n\r\nexport {\r\n  StarIcon,\r\n  Stars\r\n}\r\n","import { useCallback, useEffect, useState } from 'react'\r\nimport FormControl from 'react-bootstrap/FormControl'\r\ntype props = {\r\n  value: number | undefined,\r\n  onChange: (newValue: number | undefined) => void,\r\n  className?: string\r\n  disabled?: boolean\r\n  float?: boolean,\r\n  placeholder?: string,\r\n  allowEmpty?: boolean,\r\n  max?: string | number,\r\n  min?: string | number,\r\n}\r\nexport default function CustomFormControl({ value, onChange, className = \"\", disabled = false, float = false, placeholder, allowEmpty = false, max, min }: props) {\r\n  const [state, setState] = useState(\"\")\r\n  const sendChange = useCallback(\r\n    () => {\r\n      if (allowEmpty && state === \"\") return onChange(undefined)\r\n      if (state === \"\") return onChange(0)\r\n      const parseFunc = float ? parseFloat : parseInt\r\n      onChange(parseFunc(state))\r\n    },\r\n    [onChange, state, float, allowEmpty],\r\n  )\r\n  useEffect(() => setState(value?.toString() ?? \"\"), [value, setState]) // update value on value change\r\n\r\n  return <FormControl\r\n    value={state}\r\n    aria-label=\"custom-input\"\r\n    className={`hide-appearance ${className}`}\r\n    type=\"number\"\r\n    placeholder={placeholder}\r\n    onChange={(e: any) => setState(e.target.value)}\r\n    onBlur={sendChange}\r\n    disabled={disabled}\r\n    onKeyDown={(e: any) => e.key === \"Enter\" && sendChange()}\r\n    max={max}\r\n    min={min}\r\n  />\r\n}","export function valueStringWithUnit(value: number, unit: string): string {\r\n  switch (unit) {\r\n    case \"%\": return (Math.round(value * 10) / 10).toFixed(1) + \"%\"\r\n    case \"eff\": return value.toFixed(2) + \"%\"\r\n    default: return Math.round(value).toFixed(0)\r\n  }\r\n}\r\n\r\nexport function valueString(value: number, unit: string): string {\r\n  switch (unit) {\r\n    case \"%\": return (Math.round(value * 10) / 10).toFixed(1)\r\n    case \"eff\": return value.toFixed(2)\r\n    default: return Math.round(value).toFixed(0)\r\n  }\r\n}\r\n","import Dropdown from \"react-bootstrap/Dropdown\";\r\nimport CharacterSheet from \"../Character/CharacterSheet\";\r\nimport { database } from \"../Database/Database\";\r\nimport { usePromise } from \"../Util/ReactUtil\";\r\n\r\nexport function CharacterSelectionDropdownList({ onSelect }) {\r\n  return <>{database._getCharKeys().sort(((a, b) => {\r\n    if (a < b) return -1;\r\n    if (a > b) return 1;\r\n    // names must be equal\r\n    return 0;\r\n  })).map(characterKey => <DropDownItem key={characterKey} characterKey={characterKey} onSelect={onSelect} />)}</>\r\n}\r\nfunction DropDownItem({ characterKey, onSelect }) {\r\n  const characterSheet = usePromise(CharacterSheet.get(characterKey), [characterKey])\r\n  if (!characterSheet) return null\r\n  return <Dropdown.Item onClick={() => onSelect(characterKey)}>{characterSheet.nameWIthIcon}</Dropdown.Item>\r\n}\r\n\r\n","import { faQuestionCircle, faTimes } from \"@fortawesome/free-solid-svg-icons\"\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\"\r\nimport { Suspense, useState } from \"react\"\r\nimport { Button, Card, Col, Modal, Row, Spinner } from \"react-bootstrap\"\r\nimport { getRandomElementFromArray, loadFromLocalStorage, saveToLocalStorage } from \"../Util/Util\"\r\nimport { TransWrapper } from \"./Translate\"\r\n\r\nexport default function InfoComponent({ pageKey = \"\", text = \"\", modalTitle = \"\", children }: { pageKey: string, text: Displayable | Displayable[], modalTitle: Displayable, children: JSX.Element }) {\r\n  const [showInfoModal, setshowInfoModal] = useState(loadFromLocalStorage(\"infoShown\")?.[pageKey] ?? true)\r\n  const [displayText,] = useState(Array.isArray(text) ? getRandomElementFromArray(text) : text)\r\n  const closeModal = () => {\r\n    const infoShown = loadFromLocalStorage(\"infoShown\") ?? {}\r\n    infoShown[pageKey] = false\r\n    saveToLocalStorage(\"infoShown\", infoShown)\r\n    setshowInfoModal(false)\r\n  }\r\n  return <>\r\n    <Modal show={showInfoModal} onHide={() => closeModal()} size=\"xl\" variant=\"success\" contentClassName=\"bg-transparent\">\r\n      <Card bg=\"darkcontent\" text={\"lightfont\" as any} >\r\n        <Card.Header>\r\n          <Row>\r\n            <Col>\r\n              <Card.Title>{modalTitle}</Card.Title>\r\n            </Col>\r\n            <Col xs=\"auto\">\r\n              <Button variant=\"danger\" onClick={() => closeModal()} >\r\n                <FontAwesomeIcon icon={faTimes} /></Button>\r\n            </Col>\r\n          </Row>\r\n        </Card.Header>\r\n        <Card.Body>\r\n          <Suspense fallback={<h3 className=\"text-center\">Loading... <Spinner animation=\"border\" variant=\"primary\" /></h3>}>\r\n            {children}\r\n          </Suspense>\r\n        </Card.Body>\r\n        <Card.Footer>\r\n          <Button variant=\"danger\" onClick={() => closeModal()}>\r\n            <span>Close</span>\r\n          </Button>\r\n        </Card.Footer>\r\n      </Card>\r\n    </Modal >\r\n    <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n      <Card.Body className=\"pl-2 py-0 pr-0\">\r\n        <Row>\r\n          <Col><small>{displayText}</small></Col>\r\n          <Col xs=\"auto\">\r\n            <Button size=\"sm\" variant=\"info\" className=\"m-0 py-1\" onClick={() => setshowInfoModal(true)}><TransWrapper ns=\"ui\" key18=\"info\" /> <FontAwesomeIcon icon={faQuestionCircle} /></Button>\r\n          </Col>\r\n        </Row>\r\n      </Card.Body>\r\n    </Card>\r\n  </>\r\n}","import { faBriefcase, faEdit, faInfoCircle, faLock, faLockOpen, faTrashAlt } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { useEffect, useState } from 'react';\r\nimport Badge from 'react-bootstrap/Badge';\r\nimport Button from 'react-bootstrap/Button';\r\nimport ButtonGroup from 'react-bootstrap/ButtonGroup';\r\nimport Card from 'react-bootstrap/Card';\r\nimport Col from 'react-bootstrap/Col';\r\nimport Dropdown from 'react-bootstrap/Dropdown';\r\nimport Image from 'react-bootstrap/Image';\r\nimport OverlayTrigger from 'react-bootstrap/OverlayTrigger';\r\nimport Row from 'react-bootstrap/Row';\r\nimport Tooltip from 'react-bootstrap/Tooltip';\r\nimport { useTranslation } from 'react-i18next';\r\nimport CharacterSheet from '../Character/CharacterSheet';\r\nimport { CharacterSelectionDropdownList } from '../Components/CharacterSelection';\r\nimport { Stars } from '../Components/StarDisplay';\r\nimport { database } from '../Database/Database';\r\nimport Stat from '../Stat';\r\nimport { allSubstats, IArtifact, Substat, SubstatKey } from '../Types/artifact';\r\nimport { CharacterKey } from '../Types/consts';\r\nimport { usePromise } from '../Util/ReactUtil';\r\nimport { valueStringWithUnit } from '../Util/UIUtil';\r\nimport Artifact from './Artifact';\r\nimport { ArtifactSheet } from './ArtifactSheet';\r\nimport SlotNameWithIcon from './Component/SlotNameWIthIcon';\r\nimport PercentBadge from './PercentBadge';\r\n\r\ntype Data = { artifactId?: string, artifactObj?: IArtifact, onEdit?: () => void, onDelete?: () => void, mainStatAssumptionLevel?: number, effFilter?: Set<SubstatKey> }\r\nconst allSubstatFilter = new Set(allSubstats)\r\n\r\nexport default function ArtifactCard({ artifactId, artifactObj, onEdit, onDelete, mainStatAssumptionLevel = 0, effFilter = allSubstatFilter }: Data): JSX.Element | null {\r\n  const { t } = useTranslation([\"artifact\"]);\r\n  const [databaseArtifact, updateDatabaseArtifact] = useState(undefined as IArtifact | undefined)\r\n  useEffect(() =>\r\n    artifactId ? database.followArt(artifactId, updateDatabaseArtifact) : undefined,\r\n    [artifactId, updateDatabaseArtifact])\r\n  const sheet = usePromise(ArtifactSheet.get((artifactObj ?? (artifactId ? database._getArt(artifactId) : undefined))?.setKey), [artifactObj, artifactId])\r\n  const equipOnChar = (charKey: CharacterKey | \"\") => database.setLocation(artifactId!, charKey)\r\n\r\n  const editable = !artifactObj // dont allow edit for flex artifacts\r\n  const art = artifactObj ?? databaseArtifact\r\n  const characterSheet = usePromise(CharacterSheet.get(art?.location ?? \"\"), [art?.location])\r\n  if (!art) return null\r\n\r\n  const { id, slotKey, numStars, level, mainStatKey, substats, lock } = art\r\n  const mainStatLevel = Math.max(Math.min(mainStatAssumptionLevel, numStars * 4), level)\r\n  const mainStatVal = <span className={mainStatLevel !== level ? \"text-orange\" : \"\"}>{valueStringWithUnit(Artifact.mainStatValue(mainStatKey, numStars, mainStatLevel) ?? 0, Stat.getStatUnit(mainStatKey))}</span>\r\n  const { currentEfficiency, maxEfficiency } = Artifact.getArtifactEfficiency(art, effFilter)\r\n  const artifactValid = maxEfficiency !== 0\r\n  const locationName = characterSheet?.name ? characterSheet.nameWIthIcon : <span><FontAwesomeIcon icon={faBriefcase} /> {t`filterLocation.inventory`}</span>\r\n  const slotName = sheet?.getSlotName(slotKey) || \"Unknown Piece Name\"\r\n  const slotDesc = sheet?.getSlotDesc(slotKey)\r\n  const slotDescEle = slotDesc ? <OverlayTrigger\r\n    placement=\"top\"\r\n    overlay={<Tooltip id=\"slotdesc-tooltip\">{slotDesc}</Tooltip>}\r\n  >\r\n    <FontAwesomeIcon icon={faInfoCircle} />\r\n  </OverlayTrigger> : null\r\n  const setEffects = sheet?.setEffects\r\n  const setDesc = sheet && setEffects && <Tooltip id=\"setdesc-tooltop\">\r\n    {Object.keys(setEffects).map(setNumKey => <span key={setNumKey} className=\"text-left\">\r\n      <h6 className=\"mb-0\"><Badge variant=\"success\">{t(`setEffectNum`, { setNum: setNumKey })}</Badge></h6>\r\n      <p>{sheet.setEffectDesc(setNumKey as any)}</p>\r\n    </span>)}\r\n  </Tooltip>\r\n  const setDescEle = setDesc ? <OverlayTrigger\r\n    placement=\"top\"\r\n    overlay={setDesc}\r\n  >\r\n    <FontAwesomeIcon icon={faInfoCircle} />\r\n  </OverlayTrigger> : null\r\n\r\n  return (<Card className=\"h-100\" border={`${numStars}star`} bg=\"lightcontent\" text={\"lightfont\" as any}>\r\n    <Card.Header className=\"p-0\">\r\n      <Row>\r\n        <Col xs={2} md={3}>\r\n          <Image src={sheet?.slotIcons[slotKey] ?? \"\"} className={`w-100 h-auto grad-${numStars}star m-1`} thumbnail />\r\n        </Col>\r\n        <Col className=\"pt-2\">\r\n          <h6><strong>{slotName} {slotDescEle}</strong></h6>\r\n          <div><SlotNameWithIcon slotKey={slotKey} /><strong>{` +${level}`}</strong></div>\r\n          <div><small><Stars stars={numStars} /></small></div>\r\n        </Col>\r\n      </Row>\r\n    </Card.Header>\r\n    <Card.Body className=\"d-flex flex-column py-2\">\r\n      <Card.Title>\r\n        <div>{sheet?.name ?? \"Artifact Set\"} {setDescEle}</div>\r\n      </Card.Title>\r\n      <h5 className=\"mb-1\">\r\n        <b>{Stat.getStatName(mainStatKey)} {mainStatVal}</b>\r\n      </h5>\r\n      <Row className=\"mb-0\">\r\n        {substats.map((stat: Substat, i) => {\r\n          if (!stat.value) return null\r\n          let numRolls = stat.rolls?.length ?? 0\r\n          let efficiency = stat.efficiency ?? 0\r\n          let effOpacity = 0.3 + efficiency * 0.7\r\n          let statName = Stat.getStatName(stat.key)\r\n          return (<Col key={i} xs={12}>\r\n            <Badge variant={numRolls ? `${numRolls}roll` : \"danger\"} className=\"text-darkcontent\"><b>{numRolls ? numRolls : \"?\"}</b></Badge>{\" \"}\r\n            <span className={`text-${numRolls}roll`}>{statName}{`+${valueStringWithUnit(stat.value, Stat.getStatUnit(stat.key))}`}</span>\r\n            <span className=\"float-right\" style={{ opacity: effOpacity }}>{stat.key && effFilter.has(stat.key) ? valueStringWithUnit(efficiency, \"eff\") : \"-\"}</span>\r\n          </Col>)\r\n        })}\r\n      </Row>\r\n      <div className=\"mt-auto\">\r\n        <Row>\r\n          <Col ><small>{t`editor.curSubEff`}</small></Col>\r\n          <Col xs=\"auto\"><PercentBadge value={currentEfficiency} valid={artifactValid} /></Col>\r\n        </Row>\r\n        {currentEfficiency !== maxEfficiency && <Row>\r\n          <Col ><small>{t`editor.maxSubEff`}</small></Col>\r\n          <Col xs=\"auto\"><PercentBadge value={maxEfficiency} valid={artifactValid} /></Col>\r\n        </Row>}\r\n      </div>\r\n    </Card.Body>\r\n\r\n    <Card.Footer className=\"pr-3\">\r\n      <Row className=\"d-flex justify-content-between no-gutters\">\r\n        {editable ? <Col xs=\"auto\">\r\n          <Dropdown>\r\n            <Dropdown.Toggle size=\"sm\" className=\"text-left\">{locationName}</Dropdown.Toggle>\r\n            <Dropdown.Menu>\r\n              <Dropdown.Item onClick={() => equipOnChar(\"\")}><FontAwesomeIcon icon={faBriefcase} /> Inventory</Dropdown.Item>\r\n              <Dropdown.Divider />\r\n              <CharacterSelectionDropdownList onSelect={equipOnChar} />\r\n            </Dropdown.Menu>\r\n          </Dropdown>\r\n        </Col> : <Col xs=\"auto\"><b>{locationName}</b></Col>}\r\n        <Col xs=\"auto\">\r\n          <ButtonGroup>\r\n            {editable ? <OverlayTrigger placement=\"top\"\r\n              overlay={<Tooltip id=\"lock-artifact-tip\">{t`lockArtifactTip`}</Tooltip>}>\r\n              <span className=\"d-inline-block\">\r\n                <Button size=\"sm\" onClick={() => database.lockArtifact(id, !lock)}>\r\n                  <FontAwesomeIcon icon={lock ? faLock : faLockOpen} className=\"fa-fw\" />\r\n                </Button>\r\n              </span>\r\n            </OverlayTrigger> : null}\r\n            {!!onEdit && <Button variant=\"info\" size=\"sm\"\r\n              onClick={onEdit}>\r\n              <FontAwesomeIcon icon={faEdit} className=\"fa-fw\" />\r\n            </Button>}\r\n            {!!onDelete && <Button variant=\"danger\" size=\"sm\"\r\n              onClick={onDelete}>\r\n              <FontAwesomeIcon icon={faTrashAlt} className=\"fa-fw\" />\r\n            </Button>}\r\n          </ButtonGroup>\r\n        </Col>\r\n      </Row>\r\n    </Card.Footer>\r\n  </Card >)\r\n}\r\n","import { Badge } from 'react-bootstrap';\r\n\r\nexport default function PercentBadge({ value, valid }: Data) {\r\n  let [badgeColor, text] = typeof value === 'number' ?\r\n    [`${Math.floor(value * 0.05) + 1}roll`, value.toFixed(2) + \"%\"] : [\"secondary\", value]\r\n  if (!valid) badgeColor = \"danger\"\r\n  return <Badge variant={badgeColor} className={badgeColor === \"secondary\" ? \"\" : \"text-darkcontent\"}>{text}</Badge>\r\n}\r\n\r\ntype Data = {\r\n  valid: boolean,\r\n  value: number | string,\r\n}\r\n","import React from \"react\"\r\nimport { Dropdown } from \"react-bootstrap\"\r\nimport { Trans, useTranslation } from \"react-i18next\"\r\nimport { Stars } from \"../../Components/StarDisplay\"\r\nimport { ArtifactSetKey, Rarity } from \"../../Types/consts\"\r\nimport { ArtifactSheet } from \"../ArtifactSheet\"\r\ntype Data = {\r\n  sheets?: StrictDict<ArtifactSetKey, ArtifactSheet>\r\n  click: (ArtifactSetKey) => void\r\n}\r\nexport default function ArtifactSetDropDownMenuFragment({ sheets, click }: Data) {\r\n  const { t } = useTranslation(\"artifact\")\r\n  return <React.Fragment>\r\n    {sheets && Object.entries(ArtifactSheet.setKeysByRarities(sheets)).reverse().map(([star, sets], i) =>\r\n      <React.Fragment key={star}>\r\n        {i > 0 && <Dropdown.Divider />}\r\n        <Dropdown.Header><Trans t={t} i18nKey=\"editor.set.maxRarity\">Max Rarity <Stars stars={parseInt(star) as Rarity} /></Trans></Dropdown.Header>\r\n        {sets.map(setKey => <Dropdown.Item key={setKey} onClick={() => click(setKey)}>{sheets[setKey].nameWithIcon}</Dropdown.Item >)}\r\n      </React.Fragment>)}\r\n  </React.Fragment>\r\n}\r\n","export default __webpack_public_path__ + \"static/media/scan_art_main.ab1cfe61.png\";","export default __webpack_public_path__ + \"static/media/snippet.d223e797.png\";","import { faTimes } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { useCallback, useEffect, useReducer, useState } from 'react';\r\nimport { Button, Card, Col, Form, Modal, ProgressBar, Row } from 'react-bootstrap';\r\nimport ReactGA from 'react-ga';\r\nimport { createScheduler, createWorker, RecognizeResult, Scheduler } from 'tesseract.js';\r\nimport scan_art_main from \"./imgs/scan_art_main.png\";\r\nimport Snippet from \"./imgs/snippet.png\";\r\nimport Stat from '../Stat';\r\nimport { clamp, hammingDistance } from '../Util/Util';\r\nimport Artifact from './Artifact';\r\nimport { allMainStatKeys, allSubstats, IArtifact, IFlexArtifact, IFlexSubstat, MainStatKey, SubstatKey } from '../Types/artifact';\r\nimport { allArtifactRarities, allArtifactSets, allSlotKeys, ArtifactSetKey, Rarity, SlotKey } from '../Types/consts';\r\nimport { ArtifactSheet } from './ArtifactSheet';\r\nimport { valueStringWithUnit } from '../Util/UIUtil';\r\nimport { usePromise } from '../Util/ReactUtil';\r\nimport { BorrowManager } from '../Util/BorrowManager';\r\n\r\nconst starColor = { r: 255, g: 204, b: 50 } //#FFCC32\r\nconst maxProcessingCount = 3, maxProcessedCount = 16, workerCount = 2\r\n\r\nconst schedulers = new BorrowManager(async (language): Promise<Scheduler> => {\r\n  const scheduler = createScheduler()\r\n  const promises = Array(workerCount).fill(0).map(async _ => {\r\n    const worker = createWorker({\r\n      errorHandler: console.error\r\n    })\r\n\r\n    await worker.load()\r\n    await worker.loadLanguage(language)\r\n    await worker.initialize(language)\r\n    scheduler.addWorker(worker)\r\n  })\r\n\r\n  await Promise.any(promises)\r\n  return scheduler\r\n}, (_language, value) => {\r\n  value.then(value => value.terminate())\r\n})\r\n\r\nexport default function UploadDisplay({ setState, setReset, artifactInEditor }: { setState: (art: IFlexArtifact) => void, setReset: (reset: () => void) => void, artifactInEditor: boolean }) {\r\n  const [modalShow, setModalShow] = useState(false)\r\n\r\n  const [{ processed, outstanding }, dispatchQueue] = useReducer(queueReducer, { processed: [], outstanding: [] })\r\n  const firstProcessed = processed[0] as ProcessedEntry | undefined\r\n  const firstOutstanding = outstanding[0] as OutstandingEntry | undefined\r\n\r\n  const processingImageURL = usePromise(firstOutstanding?.imageURL, [firstOutstanding?.imageURL])\r\n  const processingResult = usePromise(firstOutstanding?.result, [firstOutstanding?.result])\r\n\r\n  const remaining = processed.length + outstanding.length\r\n\r\n  const image = firstProcessed?.imageURL ?? processingImageURL\r\n  const { artifact, texts } = firstProcessed ?? {}\r\n  const fileName = firstProcessed?.fileName ?? firstOutstanding?.fileName ?? \"Click here to upload Artifact screenshot files\"\r\n\r\n  useEffect(() => {\r\n    if (!artifactInEditor && artifact)\r\n      setState(artifact)\r\n  }, [artifactInEditor, artifact, setState])\r\n\r\n  useEffect(() => {\r\n    const numProcessing = Math.min(maxProcessedCount - processed.length, maxProcessingCount, outstanding.length)\r\n    const processingCurrent = numProcessing && !outstanding[0].result\r\n    outstanding.slice(0, numProcessing).forEach(processEntry)\r\n    if (processingCurrent)\r\n      dispatchQueue({ type: \"processing\" })\r\n  }, [processed.length, outstanding])\r\n\r\n  useEffect(() => {\r\n    if (processingResult)\r\n      dispatchQueue({ type: \"processed\", ...processingResult })\r\n  }, [processingResult, dispatchQueue])\r\n\r\n  const removeCurrent = useCallback(() => dispatchQueue({ type: \"pop\" }), [dispatchQueue])\r\n  const uploadFiles = useCallback((files: FileList) =>\r\n    dispatchQueue({ type: \"upload\", files: [...files].map(file => ({ file, fileName: file.name })) }), [dispatchQueue])\r\n  const clearQueue = useCallback(() => dispatchQueue({ type: \"clear\" }), [dispatchQueue])\r\n\r\n  useEffect(() => {\r\n    const pasteFunc = (e: any) => uploadFiles(e.clipboardData.files)\r\n    window.addEventListener('paste', pasteFunc);\r\n    setReset?.(removeCurrent);\r\n    return () =>\r\n      window.removeEventListener('paste', pasteFunc)\r\n  }, [setReset, removeCurrent, uploadFiles])\r\n\r\n  const img = image && <img src={image} className=\"w-100 h-auto\" alt=\"Screenshot to parse for artifact values\" />\r\n  return (<Row>\r\n    <ExplainationModal {...{ modalShow, hide: () => setModalShow(false) }} />\r\n    <Col xs={12} className=\"mb-2\">\r\n      <Row>\r\n        <Col>\r\n          <h6 className=\"mb-0\">Parse Artifact by Uploading Image</h6>\r\n        </Col>\r\n        <Col xs=\"auto\"><Button variant=\"info\" size=\"sm\" onClick={() => {\r\n          setModalShow(true)\r\n          ReactGA.modalview('/artifact/how-to-upload')\r\n        }}>Show Me How!</Button></Col>\r\n      </Row>\r\n    </Col>\r\n    {remaining > 0 && <Col xs={12}>\r\n      <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n        <Row>\r\n          <Col className=\"p-1 ml-2\">Screenshots in file-queue: <b>{remaining}</b>{process.env.NODE_ENV === \"development\" &&\r\n            ` (Debug: Processed ${processed.length}/${maxProcessedCount}, Processing: ${outstanding.filter(entry => entry.result).length}/${maxProcessingCount}, Outstanding: ${outstanding.length})`}</Col>\r\n          <Col xs=\"auto\"><Button size=\"sm\" variant=\"danger\" onClick={clearQueue}>Clear file-queue</Button></Col>\r\n        </Row>\r\n      </Card>\r\n    </Col>}\r\n    <Col xs={8} lg={image ? 4 : 0}>{img}</Col>\r\n    <Col xs={12} lg={image ? 8 : 12}>\r\n      {!firstProcessed && firstOutstanding &&\r\n        <div className=\"mb-2\">\r\n          <h6 className=\"mb-0\">Scanning current artifact</h6>\r\n          <ProgressBar animated now={100} />\r\n        </div>}\r\n      <Form.File\r\n        type=\"file\"\r\n        className=\"mb-0\"\r\n        label={fileName}\r\n        onChange={e => {\r\n          uploadFiles(e.target.files)\r\n          e.target.value = null // reset the value so the same file can be uploaded again...\r\n        }}\r\n        accept=\"image/*\"\r\n        custom\r\n        multiple\r\n      />\r\n      {texts && <div className=\"mb-2\">\r\n        <div>{texts.slotKey}</div>\r\n        <div>{texts.mainStatKey}</div>\r\n        <div>{texts.mainStatVal}</div>\r\n        <div>{texts.numStars}</div>\r\n        <div>{texts.level}</div>\r\n        <div>{texts.substats}</div>\r\n        <div>{texts.setKey}</div>\r\n      </div>}\r\n      {Boolean(!image) && <Form.Label className=\"mb-0\">Please Select an Image, or paste a screenshot here (Ctrl+V)</Form.Label>}\r\n    </Col>\r\n  </Row >)\r\n}\r\nfunction ExplainationModal({ modalShow, hide }: { modalShow: boolean, hide: () => void }) {\r\n  return <Modal show={modalShow} onHide={hide} size=\"xl\" variant=\"success\" contentClassName=\"bg-transparent\">\r\n    <Card bg=\"darkcontent\" text={\"lightfont\" as any} >\r\n      <Card.Header>\r\n        <Row>\r\n          <Col><Card.Title>How do Upload Screenshots for parsing</Card.Title></Col>\r\n          <Col xs=\"auto\">\r\n            <Button variant=\"danger\" onClick={hide} >\r\n              <FontAwesomeIcon icon={faTimes} /></Button>\r\n          </Col>\r\n        </Row>\r\n      </Card.Header>\r\n      <Card.Body>\r\n        <h5 className=\"text-warning\">NOTE: Artifact Scanning currently only work for ENGLISH artifacts.</h5>\r\n        <Row>\r\n          <Col xs={8} md={4}>\r\n            <img alt=\"snippet of the screen to take\" src={Snippet} className=\"w-100 h-auto\" />\r\n          </Col>\r\n          <Col xs={12} md={8}>\r\n            <p>Using screenshots can dramatically decrease the amount of time you manually input in stats on the Genshin Optimizer.</p>\r\n            <h5>Where to snip the screenshot.</h5>\r\n            <p>In game, Open your bag, and navigate to the artifacts tab. Select the artifact you want to scan with Genshin Optimizer. <b>Only artifact from this screen can be scanned.</b></p>\r\n            <h6>Single artifact</h6>\r\n            <p>To take a screenshot, in Windows, the shortcut is <strong>Shift + WindowsKey + S</strong>. Once you selected the region, the image is automatically included in your clipboard.</p>\r\n            <h6>Multiple artifacts</h6>\r\n            <p>To take advantage of batch uploads, you can use a tool like <a href=\"https://picpick.app/\" target=\"_blank\" rel=\"noreferrer\">PicPick</a> to create a macro to easily to screenshot a region to screenshot multiple artifacts at once.</p>\r\n            <h5>What to include in the screenshot.</h5>\r\n            <p>As shown in the Image, starting from the top with the artifact name, all the way to the set name(the text in green). </p>\r\n          </Col>\r\n        </Row>\r\n        <Row>\r\n          <Col>\r\n            <h5>Adding Screenshot to Genshin Optimizer</h5>\r\n            <p>At this point, you should have the artifact snippet either saved to your harddrive, or in your clipboard.</p>\r\n            <p className=\"mb-0\">You can click on the box next to \"Browse\" to browse the files in your harddrive for multiple screenshots.</p>\r\n            <p>For single screenshots from the snippets, just press <strong>Ctrl + V</strong> to paste from your clipboard.</p>\r\n            <p>You should be able to see a Preview of your artifact snippet, and after waiting a few seconds, the artifact set and the substats will be filled in in the <b>Artifact Editor</b>.\r\n            </p>\r\n          </Col>\r\n          <Col xs={12}>\r\n            <h5>Finishing the Artifact</h5>\r\n            <p>Unfortunately, computer vision is not 100%. There will always be cases where something is not scanned properly. You should always double check the scanned artifact values! Once the artifact has been filled, Click on <strong>Add Artifact</strong> to finish editing the artifact.</p>\r\n            <img alt=\"main screen after importing stats\" src={scan_art_main} className=\"w-75 h-auto\" />\r\n          </Col>\r\n        </Row>\r\n      </Card.Body>\r\n      <Card.Footer>\r\n        <Button variant=\"danger\" onClick={hide}>\r\n          <span>Close</span>\r\n        </Button>\r\n      </Card.Footer>\r\n    </Card>\r\n  </Modal>\r\n}\r\n\r\nconst queueReducer = (queue: Queue, message: UploadMessage | ProcessingMessage | ProcessedMessage | PopMessage | ClearMessage): Queue => {\r\n  switch (message.type) {\r\n    case \"upload\": return { processed: queue.processed, outstanding: [...queue.outstanding, ...message.files] }\r\n    case \"processing\": // Processing `outstanding` head. Refresh\r\n      return { processed: queue.processed, outstanding: [...queue.outstanding] }\r\n    case \"processed\":\r\n      if (queue.outstanding[0].file === message.file)\r\n        return { processed: [...queue.processed, message.result], outstanding: queue.outstanding.slice(1) }\r\n      return queue // Not in the list, ignored\r\n    case \"pop\": return { processed: queue.processed.slice(1), outstanding: queue.outstanding }\r\n    case \"clear\": return { processed: [], outstanding: [] }\r\n  }\r\n}\r\n\r\nfunction processEntry(entry: OutstandingEntry) {\r\n  if (entry.result) return\r\n\r\n  const { file, fileName } = entry\r\n  entry.imageURL = fileToURL(file)\r\n  entry.result = entry.imageURL.then(async imageURL => {\r\n    const sheets = await ArtifactSheet.getAll()\r\n    const ocrResult = await ocr(imageURL)\r\n\r\n    const [artifact, texts] = findBestArtifact(\r\n      sheets, ocrResult.rarities,\r\n      parseSetKeys(ocrResult.artifactSetTexts, sheets),\r\n      parseSlotKeys(ocrResult.whiteTexts),\r\n      parseSubstats(ocrResult.substatTexts),\r\n      parseMainStatKeys(ocrResult.whiteTexts),\r\n      parseMainStatValues(ocrResult.whiteTexts)\r\n    )\r\n\r\n    return { file, result: { fileName, imageURL, artifact, texts } }\r\n  })\r\n}\r\n\r\nconst fileToURL = (file: File): Promise<string> => new Promise(resolve => {\r\n  const reader = new FileReader()\r\n  reader.onloadend = ({ target }) =>\r\n    resolve(target!.result as string)\r\n  reader.readAsDataURL(file)\r\n})\r\nconst urlToImageData = (urlFile: string): Promise<ImageData> => new Promise(resolve => {\r\n  const img = new Image()\r\n  img.onload = ({ target }) =>\r\n    resolve(imageToImageData(target as HTMLImageElement))\r\n  img.src = urlFile\r\n})\r\nfunction imageToImageData(image: HTMLImageElement): ImageData {\r\n  const canvas = document.createElement('canvas'), context = canvas.getContext('2d')!\r\n  canvas.width = image.width\r\n  canvas.height = image.height\r\n  context.drawImage(image, 0, 0, image.width, image.height)\r\n  return context.getImageData(0, 0, image.width, image.height) as ImageData // TODO: May be undefined\r\n}\r\nfunction imageDataToCanvas(imageData: ImageData) {\r\n  // create off-screen canvas element\r\n  const canvas = document.createElement('canvas')\r\n  canvas.width = imageData.width\r\n  canvas.height = imageData.height\r\n\r\n  // update canvas with new data\r\n  canvas.getContext('2d')!.putImageData(imageData, 0, 0)\r\n  return canvas // produces a PNG file\r\n}\r\n\r\nasync function ocr(imageURL: string): Promise<{ artifactSetTexts: string[], substatTexts: string[], whiteTexts: string[], rarities: Set<Rarity> }> {\r\n  const imageData = await urlToImageData(imageURL)\r\n\r\n  const width = imageData.width, halfHeight = Math.floor(imageData.height / 2)\r\n  const bottomOpts = { rectangle: { top: halfHeight, left: 0, width, height: halfHeight } }\r\n\r\n  const awaits = [\r\n    textsFromImage(bandPass(imageData, [140, 140, 140], [255, 255, 255], { mode: \"bw\", region: \"top\" })), // slotkey, mainStatValue, level\r\n    textsFromImage(bandPass(imageData, [30, 50, 80], [160, 160, 160], { region: \"bot\" }), bottomOpts), // substats\r\n    textsFromImage(bandPass(imageData, [30, 160, 30], [200, 255, 200], { mode: \"bw\", region: \"bot\" }), bottomOpts), // artifact set, look for greenish texts\r\n  ]\r\n\r\n  const rarities = parseRarities(imageData.data, imageData.width, imageData.height)\r\n  const [whiteTexts, substatTexts, artifactSetTexts] = await Promise.all(awaits)\r\n  return { whiteTexts, substatTexts, artifactSetTexts, rarities }\r\n}\r\nasync function textsFromImage(imageData: ImageData, options: object | undefined = undefined): Promise<string[]> {\r\n  const canvas = imageDataToCanvas(imageData)\r\n  const rec = await schedulers.borrow(\"eng\", async (scheduler) =>\r\n    await (await scheduler).addJob(\"recognize\", canvas, options) as RecognizeResult)\r\n  return rec.data.lines.map(line => line.text)\r\n}\r\n\r\nexport function findBestArtifact(sheets: StrictDict<ArtifactSetKey, ArtifactSheet>, rarities: Set<number>, textSetKeys: Set<ArtifactSetKey>, slotKeys: Set<SlotKey>, substats: IFlexSubstat[], mainStatKeys: Set<MainStatKey>, mainStatValues: { mainStatValue: number, unit?: string }[]): [IFlexArtifact, Dict<keyof IArtifact, Displayable>] {\r\n  const relevantSetKey = [...new Set<ArtifactSetKey>([...textSetKeys, \"Adventurer\", \"ArchaicPetra\"])]\r\n\r\n  let bestScore = -1, bestArtifacts: IFlexArtifact[] = [{\r\n    id: \"\",\r\n    setKey: \"Adventurer\", numStars: 3, level: 0, slotKey: \"flower\", mainStatKey: \"hp\", substats: [],\r\n    location: \"\", lock: false,\r\n  }]\r\n\r\n  // Rate each rarity\r\n  const rarityRates: Dict<Rarity, number> = Object.fromEntries(allArtifactRarities.map(rarity => {\r\n    let score = 0\r\n    if (textSetKeys.size) {\r\n      const count = [...textSetKeys].reduce((count, set) => count + (sheets[set].rarity.includes(rarity) ? 1 : 0), 0)\r\n      score += count / textSetKeys.size\r\n    }\r\n    if (substats.length) {\r\n      const count = substats.reduce((count, substat) =>\r\n        count + (Artifact.getSubstatRolls(substat.key as SubstatKey, substat.value, rarity).length ? 1 : 0), 0)\r\n      score += count / substats.length * 2\r\n    }\r\n    return [rarity, score]\r\n  }))\r\n\r\n  // Test all *probable* combinations\r\n  for (const slotKey of allSlotKeys) {\r\n    for (const mainStatKey of Artifact.slotMainStats(slotKey)) {\r\n      const mainStatScore = (slotKeys.has(slotKey) ? 1 : 0) + (mainStatKeys.has(mainStatKey) ? 1 : 0)\r\n      const relevantMainStatValues = mainStatValues\r\n        .filter(value => value.unit !== \"%\" || Stat.getStatUnit(mainStatKey) === \"%\") // Ignore \"%\" text if key isn't \"%\"\r\n        .map(value => value.mainStatValue)\r\n\r\n      for (const [numStarsString, rarityIndividualScore] of Object.entries(rarityRates)) {\r\n        const numStars = parseInt(numStarsString) as Rarity\r\n        const setKeys = relevantSetKey.filter(setKey => sheets[setKey].rarity.includes(numStars))\r\n        const rarityScore = mainStatScore + rarityIndividualScore\r\n\r\n        if (rarityScore + 2 < bestScore) continue // Early bail out\r\n\r\n        for (const minimumMainStatValue of relevantMainStatValues) {\r\n          const values = Artifact.mainStatValues(numStars, mainStatKey)\r\n          const level = Math.max(0, values.findIndex(level => level >= minimumMainStatValue))\r\n          const mainStatVal = values[level]\r\n          const mainStatValScore = rarityScore + (mainStatVal === minimumMainStatValue ? 1 : 0)\r\n\r\n          for (const setKey of setKeys) {\r\n            const score = mainStatValScore + (textSetKeys.has(setKey) ? 1 : 0)\r\n            if (score >= bestScore) {\r\n              if (score > bestScore) bestArtifacts = []\r\n              bestScore = score\r\n              bestArtifacts.push({\r\n                id: \"\", setKey, numStars, level, slotKey, mainStatKey, substats: [], location: \"\", lock: false\r\n              })\r\n            }\r\n          }\r\n        }\r\n        if (rarityScore >= bestScore) {\r\n          const level = 0\r\n          for (const setKey of setKeys) {\r\n            const score = rarityScore + (textSetKeys.has(setKey) ? 1 : 0)\r\n\r\n            if (score > bestScore) bestArtifacts = []\r\n            bestScore = score\r\n            bestArtifacts.push({\r\n              id: \"\", setKey, numStars, level, slotKey, mainStatKey, substats: [], location: \"\", lock: false\r\n            })\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  const texts = {} as Dict<keyof IArtifact, Displayable>\r\n  const chosen = {\r\n    setKey: new Set(), numStars: new Set(), level: new Set(), slotKey: new Set(), mainStatKey: new Set(), mainStatVal: new Set(),\r\n  } as Dict<keyof IArtifact, Set<string>>\r\n\r\n  const result = bestArtifacts[0], resultMainStatVal = Artifact.mainStatValue(result.mainStatKey, result.numStars, result.level)!\r\n  result.substats = substats.filter((substat, i) =>\r\n    substat.key !== result.mainStatKey &&\r\n    substats.slice(0, i).every(other => other.key !== substat.key))\r\n  for (let i = result.substats.length; i < 4; i++)\r\n    result.substats.push({ key: \"\", value: 0 })\r\n\r\n  for (const other of bestArtifacts) {\r\n    chosen.setKey!.add(other.setKey)\r\n    chosen.numStars!.add(other.numStars as any)\r\n    chosen.level!.add(other.level as any)\r\n    chosen.slotKey!.add(other.slotKey)\r\n    chosen.mainStatKey!.add(other.mainStatKey)\r\n  }\r\n\r\n  function unknownText<T>(value: T, name: Displayable, text: (arg: T) => Displayable) {\r\n    return <>Unknown {name} : Set to <span className=\"text-danger\">{text(value)}</span></>\r\n  }\r\n  function ambiguousText<T>(value: T, available: T[], name: Displayable, text: (arg: T) => Displayable) {\r\n    return <>Ambiguous {name} <span className=\"text-danger\">{text(value)}</span> : May also be {\r\n      available.filter(v => v !== value).map((value, index) => <><b>{index > 0 ? \"/\" : \"\"}</b><span className=\"text-warning\">{text(value)}</span></>)}</>\r\n  }\r\n  function detectedText<T>(value: T, name: Displayable, text: (arg: T) => Displayable) {\r\n    return <>Detected {name} <span className=\"text-success\">{text(value)}</span></>\r\n  }\r\n  function inferredText<T>(value: T, name: Displayable, text: (arg: T) => Displayable) {\r\n    return <>Inferred {name} <span className=\"text-warning\">{text(value)}</span></>\r\n  }\r\n\r\n  function addText(key: keyof IArtifact, available: Set<any>, name: Displayable, text: (value) => Displayable) {\r\n    const recommended = new Set([...chosen[key]!].filter(value => available.has(value)))\r\n    if (recommended.size > 1)\r\n      texts[key] = ambiguousText(result[key], [...available], name, text)\r\n    else if (recommended.size === 1)\r\n      texts[key] = detectedText(result[key], name, text)\r\n    else if (chosen[key]!.size > 1)\r\n      texts[key] = unknownText(result[key], name, text)\r\n    else\r\n      texts[key] = inferredText(result[key], name, text)\r\n  }\r\n\r\n  addText(\"setKey\", textSetKeys, \"Set\", (value) => sheets[value].name)\r\n  addText(\"numStars\", rarities, \"Rarity\", (value) => <>{value} {value !== 1 ? \"Stars\" : \"Star\"}</>)\r\n  addText(\"slotKey\", slotKeys, \"Slot\", (value) => <>{Artifact.slotName(value)}</>)\r\n  addText(\"mainStatKey\", mainStatKeys, \"Main Stat\", (value) => <>{Stat.getStatNameRaw(value)}</>)\r\n  texts.substats = <>{result.substats.filter(substat => substat.key !== \"\").map((substat, i) =>\r\n    <div key={i}>{detectedText(substat, \"Sub Stat\", (value) => <>{Stat.getStatNameRaw(value.key)}+{valueStringWithUnit(value.value, Stat.getStatUnit(value.key))}</>)}</div>)\r\n  }</>\r\n\r\n  const unit = Stat.getStatUnit(result.mainStatKey)\r\n  if (mainStatValues.find(value => value.mainStatValue === resultMainStatVal)) {\r\n    if (mainStatKeys.has(result.mainStatKey)) {\r\n      texts.level = detectedText(result.level, \"Level\", (value) => \"+\" + value)\r\n      texts.mainStatVal = detectedText(resultMainStatVal, \"Main Stat value\", (value) => <>{valueStringWithUnit(value, unit)}</>)\r\n    } else {\r\n      texts.level = inferredText(result.level, \"Level\", (value) => \"+\" + value)\r\n      texts.mainStatVal = inferredText(resultMainStatVal, \"Main Stat value\", (value) => <>{valueStringWithUnit(value, unit)}</>)\r\n    }\r\n  } else {\r\n    texts.level = unknownText(result.level, \"Level\", (value) => \"+\" + value)\r\n    texts.mainStatVal = unknownText(resultMainStatVal, \"Main Stat value\", (value) => <>{valueStringWithUnit(value, unit)}</>)\r\n  }\r\n\r\n  return [result, texts]\r\n}\r\n\r\nfunction parseSetKeys(texts: string[], sheets): Set<ArtifactSetKey> {\r\n  const results = new Set<ArtifactSetKey>([])\r\n  for (const text of texts)\r\n    for (const key of allArtifactSets)\r\n      if (hammingDistance(text.replace(/\\W/g, ''), sheets[key].nameRaw.replace(/\\W/g, '')) <= 2)\r\n        results.add(key)\r\n  return results\r\n}\r\nfunction parseRarities(pixels: Uint8ClampedArray, width: number, height: number): Set<Rarity> {\r\n  let d = pixels, lastRowNum = 0, rowsWithNumber = 0;\r\n  const results = new Set<Rarity>([])\r\n  for (let y = 0; y < height; y++) {\r\n    let star = 0, onStar = false;\r\n    for (let x = 0; x < width; x++) {\r\n      let i = (y * width + x) * 4\r\n      let r = d[i], g = d[i + 1], b = d[i + 2];\r\n      if (colorCloseEnough({ r, g, b }, starColor)) {\r\n        if (!onStar) {\r\n          onStar = true\r\n          star++\r\n        }\r\n      } else {\r\n        onStar = false\r\n      }\r\n    }\r\n\r\n    if (lastRowNum !== star) {\r\n      lastRowNum = star\r\n      rowsWithNumber = 1;\r\n    } else if (lastRowNum) {\r\n      rowsWithNumber++\r\n      if (rowsWithNumber >= 10) results.add(clamp(lastRowNum, 3, 5) as Rarity)\r\n    }\r\n  }\r\n  return results\r\n}\r\nfunction colorCloseEnough(color1, color2, threshold = 5) {\r\n  const intCloseEnough = (a, b) => (Math.abs(a - b) <= threshold)\r\n  return intCloseEnough(color1.r, color2.r) &&\r\n    intCloseEnough(color1.g, color2.g) &&\r\n    intCloseEnough(color1.b, color2.b)\r\n}\r\nfunction parseSlotKeys(texts: string[]): Set<SlotKey> {\r\n  const results = new Set<SlotKey>()\r\n  for (const text of texts)\r\n    for (const key of allSlotKeys)\r\n      if (hammingDistance(text.replace(/\\W/g, ''), Artifact.slotName(key).replace(/\\W/g, '')) <= 2)\r\n        results.add(key)\r\n  return results\r\n}\r\nfunction parseMainStatKeys(texts: string[]): Set<MainStatKey> {\r\n  const results = new Set<MainStatKey>([])\r\n  for (const text of texts)\r\n    for (const key of allMainStatKeys) {\r\n      if (text.toLowerCase().includes(Stat.getStatNameRaw(key).toLowerCase()))\r\n        results.add(key)\r\n      //use fuzzy compare on the ... Bonus texts. heal_ is included.\r\n      if (key.includes(\"_bonu\") && hammingDistance(text.replace(/\\W/g, ''), Stat.getStatNameRaw(key).replace(/\\W/g, '')) <= 1)\r\n        results.add(key)\r\n    }\r\n  return results\r\n}\r\nfunction parseMainStatValues(texts: string[]): { mainStatValue: number, unit?: string }[] {\r\n  const results: { mainStatValue: number, unit?: string }[] = []\r\n  for (const text of texts) {\r\n    let regex = /(\\d+[,|\\\\.]+\\d)%/\r\n    let match = regex.exec(text)\r\n    if (match) results.push({ mainStatValue: parseFloat(match[1].replace(/,/g, \".\").replace(/\\.{2,}/g, \".\")), unit: \"%\" })\r\n    regex = /(\\d+[,|\\\\.]\\d{3}|\\d{2,3})/\r\n    match = regex.exec(text)\r\n    if (match) results.push({ mainStatValue: parseInt(match[1].replace(/[,|\\\\.]+/g, \"\")) })\r\n  }\r\n  return results\r\n}\r\nfunction parseSubstats(texts: string[]): IFlexSubstat[] {\r\n  const matches: IFlexSubstat[] = []\r\n  for (let text of texts) {\r\n    text = text.replace(/^[\\W]+/, \"\").replace(/\\n/, \"\")\r\n    //parse substats\r\n    allSubstats.forEach(key => {\r\n      const name = Stat.getStatNameRaw(key)\r\n      const regex = Stat.getStatUnit(key) === \"%\" ?\r\n        new RegExp(name + \"\\\\s*\\\\+\\\\s*(\\\\d+[\\\\.|,]+\\\\d)%\", \"im\") :\r\n        new RegExp(name + \"\\\\s*\\\\+\\\\s*(\\\\d+,\\\\d+|\\\\d+)($|\\\\s)\", \"im\")\r\n      const match = regex.exec(text)\r\n      if (match)\r\n        matches.push({ key, value: parseFloat(match[1].replace(/,/g, \".\").replace(/\\.{2,}/g, \".\")) })\r\n    })\r\n  }\r\n  return matches\r\n}\r\n\r\nfunction bandPass(pixelData: ImageData, color1: Color, color2: Color, options: { region?: \"top\" | \"bot\" | \"all\", mode?: \"bw\" | \"color\" | \"invert\" }) {\r\n  const { region = \"all\", mode = \"color\" } = options\r\n  const d = Uint8ClampedArray.from(pixelData.data)\r\n  const top = region === \"top\", bot = region === \"bot\", all = region === \"all\"\r\n  const bw = mode === \"bw\", invert = mode === \"invert\"\r\n  const halfInd = Math.floor(pixelData.width * (pixelData.height / 2) * 4)\r\n  for (let i = 0; i < d.length; i += 4) {\r\n    const r = d[i], g = d[i + 1], b = d[i + 2];\r\n    if ((all || (top && i < halfInd) || (bot && i > halfInd)) &&\r\n      r >= color1[0] && r <= color2[0] &&\r\n      g >= color1[1] && g <= color2[1] &&\r\n      b >= color1[2] && b <= color2[2]) {\r\n      if (bw) d[i] = d[i + 1] = d[i + 2] = 0\r\n      else if (invert) {\r\n        d[i] = 255 - r\r\n        d[i + 1] = 255 - g\r\n        d[i + 2] = 255 - b\r\n      } // else orignal color\r\n    } else {\r\n      d[i] = d[i + 1] = d[i + 2] = 255\r\n    }\r\n  }\r\n  return new ImageData(d, pixelData.width, pixelData.height)\r\n}\r\n\r\ntype ProcessedEntry = {\r\n  fileName: string, imageURL: string, artifact: IFlexArtifact, texts: Dict<keyof IArtifact, Displayable>\r\n}\r\ntype OutstandingEntry = {\r\n  file: File, fileName: string, imageURL?: Promise<string>, result?: Promise<{ file: File, result: ProcessedEntry }>\r\n}\r\ntype Queue = { processed: ProcessedEntry[], outstanding: OutstandingEntry[] }\r\ntype UploadMessage = { type: \"upload\", files: OutstandingEntry[] }\r\ntype ProcessingMessage = { type: \"processing\" }\r\ntype ProcessedMessage = { type: \"processed\", file: File, result: ProcessedEntry }\r\ntype PopMessage = { type: \"pop\" }\r\ntype ClearMessage = { type: \"clear\" }\r\ntype Color = [number, number, number] // RGB\r\n","export class BorrowManager<T> {\r\n  data: Dict<string, { value: T, refCount: number }> = {}\r\n  init: (key: string) => T\r\n  deinit: (key: string, value: T) => void\r\n\r\n  constructor(init: (key: string) => T, deinit: (key: string, value: T) => void) {\r\n    this.init = init\r\n    this.deinit = deinit\r\n  }\r\n\r\n  /**\r\n   * Borrow the object corresponding to `key`, creating the object as necessary.\r\n   * The borrowing ends when `callback`'s promise is fulfilled.\r\n   * When the last borrowing ends, `deinit` the object.\r\n   *\r\n   * Do not use `arg` after the `callback`'s promise is fulfilled.\r\n   */\r\n  async borrow<R>(key: string, callback: (arg: T) => Promise<R>): Promise<R> {\r\n    if (!this.data[key]) {\r\n      this.data[key] = { value: this.init(key), refCount: 0 }\r\n    }\r\n\r\n    const box = this.data[key]!\r\n    box.refCount += 1\r\n    const result = await callback(box.value)\r\n    box.refCount -= 1\r\n    if (!box.refCount) {\r\n      // Last user. Cleaning up\r\n      delete this.data[key]\r\n      this.deinit(key, box.value)\r\n    }\r\n    return result\r\n  }\r\n}","import { faQuestionCircle } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { useCallback, useEffect, useMemo, useReducer } from 'react';\r\nimport { Alert, Badge, Button, ButtonGroup, Card, Col, Dropdown, DropdownButton, FormControl, InputGroup, OverlayTrigger, Popover, Row } from 'react-bootstrap';\r\nimport { Trans, useTranslation } from 'react-i18next';\r\nimport CustomFormControl from '../Components/CustomFormControl';\r\nimport { Stars } from '../Components/StarDisplay';\r\nimport { database } from '../Database/Database';\r\nimport { validateFlexArtifact } from '../Database/validation';\r\nimport Stat from '../Stat';\r\nimport { allSubstats, IArtifact, IFlexArtifact, IFlexSubstat } from '../Types/artifact';\r\nimport { Rarity, SlotKey } from '../Types/consts';\r\nimport { randomizeArtifact } from '../Util/ArtifactUtil';\r\nimport { usePromise } from '../Util/ReactUtil';\r\nimport { valueString } from '../Util/UIUtil';\r\nimport { clamp, deepClone } from '../Util/Util';\r\nimport Artifact from './Artifact';\r\nimport ArtifactCard from './ArtifactCard';\r\nimport { ArtifactSheet } from './ArtifactSheet';\r\nimport ArtifactSetDropDownMenuFragment from './Component/ArtifactSetDropDownMenuFragment';\r\nimport SlotNameWithIcon from './Component/SlotNameWIthIcon';\r\nimport PercentBadge from './PercentBadge';\r\nimport UploadDisplay from './UploadDisplay';\r\n\r\ntype ArtifactEditorArgument = { artifactIdToEdit: string, cancelEdit: () => void }\r\nconst allSubstatFilter = new Set(allSubstats)\r\n\r\nlet uploadDisplayReset: (() => void) | undefined\r\nexport default function ArtifactEditor({ artifactIdToEdit, cancelEdit }: ArtifactEditorArgument) {\r\n  const { t } = useTranslation(\"artifact\")\r\n  const [flexArtifact, artifactDispatch] = useReducer(artifactReducer, undefined)\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n\r\n  const { artifact, errors } = useMemo(() =>\r\n    flexArtifact ? validateFlexArtifact(flexArtifact) : { artifact: undefined, errors: [] }\r\n    , [flexArtifact])\r\n\r\n  const artifactInEditor = artifact !== undefined\r\n  const sheet = artifact ? artifactSheets?.[artifact.setKey] : undefined\r\n\r\n  useEffect(() => {\r\n    if (artifactIdToEdit && artifactIdToEdit !== artifact?.id) {\r\n      const databaseArtifact = database._getArt(artifactIdToEdit)\r\n      if (databaseArtifact)\r\n        artifactDispatch({ type: \"overwrite\", artifact: deepClone(databaseArtifact) })\r\n    }\r\n  }, [artifactIdToEdit, artifact?.id])\r\n\r\n  const getUpdloadDisplayReset = (reset: () => void) => uploadDisplayReset = reset\r\n\r\n  const reset = useCallback(() => {\r\n    cancelEdit?.();\r\n    uploadDisplayReset?.()\r\n    artifactDispatch({ type: \"reset\" })\r\n  }, [cancelEdit, artifactDispatch])\r\n  const update = useCallback((newValue: Partial<IFlexArtifact>) => {\r\n    const newSheet = newValue.setKey ? artifactSheets![newValue.setKey] : sheet!\r\n\r\n    function pick<T>(value: T | undefined, available: readonly T[], prefer?: T): T {\r\n      return (value && available.includes(value)) ? value : (prefer ?? available[0])\r\n    }\r\n\r\n    if (newValue.setKey) {\r\n      newValue.numStars = pick(artifact?.numStars, newSheet.rarity, Math.max(...newSheet.rarity) as Rarity)\r\n      newValue.slotKey = pick(artifact?.slotKey, newSheet.slots)\r\n    }\r\n    if (newValue.numStars)\r\n      newValue.level = artifact?.level ?? 0\r\n    if (newValue.level)\r\n      newValue.level = clamp(newValue.level, 0, 4 * (newValue.numStars ?? artifact!.numStars))\r\n    if (newValue.slotKey)\r\n      newValue.mainStatKey = pick(artifact?.mainStatKey, Artifact.slotMainStats(newValue.slotKey))\r\n\r\n    if (newValue.mainStatKey) {\r\n      newValue.substats = [0, 1, 2, 3].map(i =>\r\n        (artifact && artifact.substats[i].key !== newValue.mainStatKey) ? artifact!.substats[i] : { key: \"\", value: 0 })\r\n    }\r\n    artifactDispatch({ type: \"update\", artifact: newValue })\r\n  }, [artifact, artifactSheets, sheet, artifactDispatch])\r\n  const setSubstat = useCallback((index: number, substat: IFlexSubstat) => {\r\n    artifactDispatch({ type: \"substat\", index, substat })\r\n  }, [artifactDispatch])\r\n  const isValid = !errors.length\r\n  const canClearArtifact = (): boolean => window.confirm(t`editor.clearPrompt` as string)\r\n  const { dupId, isDup } = useMemo(() => checkDuplicate(artifact), [artifact])\r\n  const { numStars = 5, level = 0, slotKey = \"flower\" } = artifact ?? {}\r\n  const { currentEfficiency = 0, maxEfficiency = 0 } = artifact ? Artifact.getArtifactEfficiency(artifact, allSubstatFilter) : {}\r\n  return <Card bg=\"darkcontent\" text={\"lightfont\" as any}>\r\n    <Card.Header><Trans t={t} i18nKey=\"editor.title\" >Artifact Editor</Trans></Card.Header>\r\n    <Card.Body>\r\n      <Row>\r\n        {/* Left column */}\r\n        <Col xs={12} lg={6}>\r\n          {/* set & rarity */}\r\n          <InputGroup className=\"w-100 d-flex mb-2\">\r\n            {/* Artifact Set */}\r\n            <Dropdown as={InputGroup.Prepend} className=\"flex-grow-1\">\r\n              <Dropdown.Toggle className=\"w-100\" variant={artifact ? \"success\" : \"primary\"}>\r\n                {sheet?.nameWithIcon ?? t`editor.set.artifactSet`}\r\n              </Dropdown.Toggle>\r\n              <Dropdown.Menu>\r\n                <ArtifactSetDropDownMenuFragment sheets={artifactSheets} click={(setKey => update({ setKey }))} />\r\n              </Dropdown.Menu>\r\n            </Dropdown>\r\n            {/* rarity dropdown */}\r\n            <DropdownButton as={InputGroup.Append} title={artifact ? <Stars stars={numStars} /> : t`editor.rarity`} disabled={!sheet} variant={artifact ? \"success\" : \"primary\"}>\r\n              {([5, 4, 3] as Rarity[]).map((numStars, index) => <Dropdown.Item key={index} disabled={!sheet?.rarity.includes(numStars)} onClick={() => update({ numStars })}>\r\n                {<Stars stars={numStars} />}\r\n              </Dropdown.Item>)}\r\n            </DropdownButton>\r\n          </InputGroup>\r\n\r\n          {/* level */}\r\n          <InputGroup className=\"mb-2\">\r\n            <InputGroup.Prepend>\r\n              <InputGroup.Text>{t`editor.level`}</InputGroup.Text>\r\n            </InputGroup.Prepend>\r\n            <CustomFormControl value={level} disabled={!sheet} placeholder={`0~${numStars * 4}`} onChange={l => update({ level: l })} />\r\n            <InputGroup.Append>\r\n              <Button onClick={() => update({ level: level - 1 })} disabled={!sheet || level === 0}>-</Button>\r\n              {numStars ? [...Array(numStars + 1).keys()].map(i => 4 * i).map(i => <Button key={i} onClick={() => update({ level: i })} disabled={!sheet || level === i}>{i}</Button>) : null}\r\n              <Button onClick={() => update({ level: level + 1 })} disabled={!sheet || level === (numStars * 4)}>+</Button>\r\n            </InputGroup.Append>\r\n          </InputGroup>\r\n\r\n          {/* slot */}\r\n          <InputGroup className=\"mb-2 w-100 d-flex flex-row\">\r\n            <DropdownButton\r\n              title={<SlotNameWithIcon slotKey={slotKey} />}\r\n              disabled={!sheet}\r\n              variant={artifact ? \"success\" : \"primary\"}\r\n              as={InputGroup.Prepend}\r\n            >\r\n              {sheet?.slots?.map((sKey: SlotKey) =>\r\n                <Dropdown.Item key={sKey as any} onClick={() => update({ slotKey: sKey })} ><SlotNameWithIcon slotKey={sKey} /></Dropdown.Item>)}\r\n            </DropdownButton>\r\n            <InputGroup.Text as={InputGroup.Append} className=\"flex-grow-1\">{sheet?.getSlotName(artifact!.slotKey) ?? t`editor.unknownPieceName` as any}</InputGroup.Text>\r\n          </InputGroup>\r\n\r\n          {/* main stat */}\r\n          <InputGroup className=\"mb-2\">\r\n            <DropdownButton\r\n              title={<b>{artifact ? Stat.getStatNameWithPercent(artifact.mainStatKey) : t`mainStat`}</b>}\r\n              disabled={!sheet}\r\n              variant={artifact ? \"success\" : \"primary\"}\r\n              as={InputGroup.Prepend}\r\n            >\r\n              <Dropdown.ItemText>{t`editor.mainSelect`}</Dropdown.ItemText>\r\n              {Artifact.slotMainStats(slotKey).map(mainStatK =>\r\n                <Dropdown.Item key={mainStatK} onClick={() => update({ mainStatKey: mainStatK })} >\r\n                  {Stat.getStatNameWithPercent(mainStatK)}\r\n                </Dropdown.Item>)}\r\n            </DropdownButton>\r\n            <FormControl\r\n              value={artifact ? `${valueString(Artifact.mainStatValue(artifact.mainStatKey, numStars, level), Stat.getStatUnit(artifact.mainStatKey))}` : t`mainStat` as any}\r\n              disabled\r\n              readOnly\r\n            />\r\n          </InputGroup>\r\n\r\n          {/* Current Substats Efficiency */}\r\n          <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n            <Card.Body className=\"py-1 px-2\">\r\n              <Row>\r\n                <Col className=\"text-center\">{t`editor.curSubEff`}</Col>\r\n                <Col xs=\"auto\">\r\n                  <PercentBadge valid={isValid} value={isValid ? currentEfficiency : \"ERR\"} />\r\n                  <OverlayTrigger\r\n                    placement=\"bottom\"\r\n                    overlay={<Popover id=\"current-efficiency\">\r\n                      <Popover.Title as=\"h5\">{t`editor.curSubEff`}</Popover.Title>\r\n                      <Popover.Content><Trans t={t} i18nKey=\"editor.curSubEffDesc\" /></Popover.Content>\r\n                    </Popover>}\r\n                  >\r\n                    <FontAwesomeIcon icon={faQuestionCircle} className=\"ml-2\" style={{ cursor: \"help\" }} />\r\n                  </OverlayTrigger>\r\n                </Col>\r\n              </Row>\r\n            </Card.Body>\r\n          </Card>\r\n\r\n          {/* Maximum Substats Efficiency */}\r\n          <Card bg=\"lightcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n            <Card.Body className=\"py-1 px-2\">\r\n              <Row>\r\n                <Col className=\"text-center\">{t`editor.maxSubEff`}</Col>\r\n                <Col xs=\"auto\">\r\n                  <PercentBadge valid={isValid} value={isValid ? maxEfficiency : \"ERR\"} />\r\n                  <OverlayTrigger\r\n                    placement=\"bottom\"\r\n                    overlay={<Popover id=\"max-efficiency\">\r\n                      <Popover.Title as=\"h5\">{t`editor.maxSubEff`}</Popover.Title>\r\n                      <Popover.Content><Trans t={t} i18nKey=\"editor.maxSubEffDesc\" /></Popover.Content>\r\n                    </Popover>}\r\n                  >\r\n                    <FontAwesomeIcon icon={faQuestionCircle} className=\"ml-2\" style={{ cursor: \"help\" }} />\r\n                  </OverlayTrigger>\r\n                </Col>\r\n              </Row>\r\n            </Card.Body>\r\n          </Card>\r\n        </Col>\r\n\r\n        {/* Right column */}\r\n        <Col xs={12} lg={6}>\r\n          {/* substat selections */}\r\n          {[0, 1, 2, 3].map((index) => <SubstatInput key={index} className=\"mb-2\" {...{ index, artifact, setSubstat }} />)}\r\n        </Col>\r\n      </Row>\r\n      <Row className=\"mb-n2\">\r\n        {/* Image OCR */}\r\n        <Col xs={12} className=\"mb-2\">\r\n          {/* TODO: artifactDispatch not overwrite */}\r\n          <UploadDisplay setState={state => artifactDispatch({ type: \"overwrite\", artifact: state })} setReset={getUpdloadDisplayReset} artifactInEditor={artifactInEditor} />\r\n        </Col>\r\n        {/* Duplicate/Updated/Edit UI */}\r\n        {(dupId || artifact?.id) && <Col xs={12} className=\"mb-2\">\r\n          <Row className=\"d-flex justify-content-around mb-n2\">\r\n            <Col lg={4} md={6} className=\"mb-2\">\r\n              <h6 className=\"text-center\">{t`editor.preview`}</h6>\r\n              <div><ArtifactCard artifactObj={artifact} /></div>\r\n            </Col>\r\n            <Col lg={4} md={6} className=\"mb-2\">\r\n              <h6 className=\"text-center\">{dupId ? (isDup ? t`editor.dupArt` : t`editor.upArt`) : t`editor.beforeEdit`}</h6>\r\n              <div><ArtifactCard artifactId={dupId || artifact?.id} /></div>\r\n            </Col>\r\n          </Row>\r\n        </Col>}\r\n        {/* Error alert */}\r\n        {!isValid && <Col xs={12} className=\"mb-2\">\r\n          <Alert variant=\"danger\" className=\"py-2 px-3 mb-0 \">{errors.map((e, i) => <div key={i}>{e}</div>)}</Alert>\r\n        </Col>}\r\n      </Row></Card.Body>\r\n    <Card.Footer>\r\n      <Button className=\"mr-2\" onClick={() => { saveArtifact(artifact!, artifact!.id); reset() }} disabled={!isValid} variant={dupId ? \"warning\" : \"primary\"}>\r\n        {artifact?.id ? t`editor.btnSave` : t`editor.btnAdd`}\r\n      </Button>\r\n      <Button className=\"mr-2\" disabled={!artifactInEditor} onClick={() => { canClearArtifact() && reset() }} variant=\"success\">{t`editor.btnClear`}</Button>\r\n      {process.env.NODE_ENV === \"development\" && <Button variant=\"info\" onClick={async () => artifactDispatch({ type: \"overwrite\", artifact: await randomizeArtifact() })}>{t`editor.btnRandom`}</Button>}\r\n      {Boolean(dupId) && <Button className=\"float-right\" onClick={() => { saveArtifact(artifact!, dupId); reset() }} disabled={!isValid} variant=\"success\">{t`editor.btnUpdate`}</Button>}\r\n    </Card.Footer>\r\n  </Card >\r\n}\r\n\r\nfunction SubstatInput({ index, artifact, setSubstat, className }: { index: number, artifact: IArtifact | undefined, setSubstat: (index: number, substat: IFlexSubstat) => void, className: string }) {\r\n  const { t } = useTranslation(\"artifact\")\r\n  const { mainStatKey = \"\" } = artifact ?? {}\r\n  const { key = \"\", value = 0, rolls = [], efficiency = 0 } = artifact?.substats[index] ?? {}\r\n\r\n  const accurateValue = rolls.reduce((a, b) => Math.fround(a + b), 0)\r\n  const unit = Stat.getStatUnit(key), rollNum = rolls.length\r\n\r\n  let error: string = \"\", rollData: readonly number[] = [], allowedRolls = 0, rollLabel: Displayable | null = null\r\n\r\n  if (artifact) {\r\n    // Account for the rolls it will need to fill all 4 substates, +1 for its base roll\r\n    const numStars = artifact.numStars\r\n    const { numUpgrades, high } = Artifact.rollInfo(numStars)\r\n    const maxRollNum = numUpgrades + high - 3;\r\n    allowedRolls = maxRollNum - rollNum\r\n    rollData = key ? Artifact.getSubstatRollData(key, numStars) : []\r\n  }\r\n  const rollOffset = 7 - rollData.length\r\n\r\n  if (!rollNum && key && value) error = error || t`editor.substat.error.noCalc`\r\n  if (allowedRolls < 0) error = error || t(\"editor.substat.error.noOverRoll\", { value: allowedRolls + rollNum })\r\n\r\n  if (!error) {\r\n    const rollBadge = <Badge variant={rollNum === 0 ? \"secondary\" : `${rollNum}roll`} className=\"text-darkcontent\">\r\n      {rollNum ? t(\"editor.substat.RollCount\", { count: rollNum }) : t`editor.substat.noRoll`}\r\n    </Badge>\r\n    const rollArr = rolls.map((val, i) =>\r\n      <span key={i} className={`mr-2 text-${rollOffset + rollData.indexOf(val)}roll`}>{valueString(val, unit)}</span>)\r\n\r\n    rollLabel = <Row>\r\n      <Col>{rollBadge} {rollArr}</Col>\r\n      <Col xs=\"auto\"><Trans t={t} i18nKey=\"editor.substat.eff\">Efficiency: <PercentBadge valid={true} value={efficiency ? efficiency : t`editor.substat.noStat` as string} /></Trans></Col>\r\n    </Row>\r\n  }\r\n\r\n  return <Card bg=\"lightcontent\" text={\"lightfont\" as any} className={className}>\r\n    <InputGroup>\r\n      <DropdownButton\r\n        title={key ? Stat.getStatNameWithPercent(key) : t('editor.substat.substatFormat', { value: index + 1 })}\r\n        disabled={!artifact}\r\n        variant={key ? \"success\" : \"primary\"}\r\n        as={InputGroup.Prepend}\r\n      >\r\n        {Boolean(key) && <Dropdown.Item key={key} onClick={() => setSubstat(index, { key: \"\", value: 0 })}>{t`editor.substat.noSubstat`}</Dropdown.Item>}\r\n        {allSubstats\r\n          .filter(key => mainStatKey !== key)\r\n          .map(key =>\r\n            <Dropdown.Item key={key} onClick={() => setSubstat(index, { key, value: 0 })} >\r\n              {Stat.getStatNameWithPercent(key)}\r\n            </Dropdown.Item>\r\n          )}\r\n      </DropdownButton>\r\n      <CustomFormControl\r\n        float={unit === \"%\"}\r\n        placeholder={t`editor.substat.selectSub`}\r\n        value={key ? value : undefined}\r\n        onChange={value => setSubstat(index, { key, value: value ?? 0 })}\r\n        disabled={!key}\r\n        allowEmpty\r\n      />\r\n      {<ButtonGroup size=\"sm\" as={InputGroup.Append}>\r\n        {rollData.map((v, i) => {\r\n          const newValue = valueString(Math.fround(accurateValue + v), unit)\r\n          return <Button key={i} variant={`${rollOffset + i}roll`} className=\"py-0 text-darkcontent\" disabled={(value && !rollNum) || allowedRolls <= 0} onClick={() => setSubstat(index, { key, value: parseFloat(newValue) })}>{newValue}</Button>\r\n        })}\r\n      </ButtonGroup>}\r\n    </InputGroup>\r\n    <div className=\"p-1\">{error && <Badge variant=\"danger\">{t`ui:error`}</Badge>} {error || rollLabel}</div>\r\n  </Card >\r\n}\r\n\r\ntype ResetMessage = { type: \"reset\" }\r\ntype SubstatMessage = { type: \"substat\", index: number, substat: IFlexSubstat }\r\ntype OverwriteMessage = { type: \"overwrite\", artifact: IFlexArtifact }\r\ntype UpdateMessage = { type: \"update\", artifact: Partial<IFlexArtifact> }\r\ntype Message = ResetMessage | SubstatMessage | OverwriteMessage | UpdateMessage\r\nexport function artifactReducer(state: IFlexArtifact | undefined, action: Message): IFlexArtifact | undefined {\r\n  switch (action.type) {\r\n    case \"reset\": return\r\n    case \"substat\": {\r\n      const { index, substat } = action\r\n      const oldIndex = substat.key ? state!.substats.findIndex(current => current.key === substat.key) : -1\r\n      if (oldIndex === -1 || oldIndex === index)\r\n        state!.substats[index] = substat\r\n      else  // Already in used, swap the items instead\r\n        [state!.substats[index], state!.substats[oldIndex]] =\r\n          [state!.substats[oldIndex], state!.substats[index]]\r\n      return { ...state! }\r\n    }\r\n    case \"overwrite\": return action.artifact\r\n    case \"update\": return { ...state!, ...action.artifact }\r\n  }\r\n}\r\n\r\nfunction checkDuplicate(editorArt: IFlexArtifact | undefined): { dupId?: string, isDup: boolean } {\r\n  if (!editorArt) return { isDup: false }\r\n  const { id, setKey, numStars, level, slotKey, mainStatKey, substats } = editorArt\r\n  if (id) return { isDup: false }\r\n\r\n  const candidates = database._getArts().filter(candidate =>\r\n    setKey === candidate.setKey &&\r\n    numStars === candidate.numStars &&\r\n    slotKey === candidate.slotKey &&\r\n    mainStatKey === candidate.mainStatKey &&\r\n    level >= candidate.level &&\r\n    substats.every((substat, i) =>\r\n      !candidate.substats[i].key || // Candidate doesn't have anything on this slot\r\n      (substat.key === candidate.substats[i].key && // Or editor simply has better substat\r\n        substat.value >= candidate.substats[i].value)\r\n    )\r\n  )\r\n\r\n  // Strictly upgraded artifact\r\n  const upgraded = candidates.filter(candidate =>\r\n    level > candidate.level &&\r\n    (Math.floor(level / 4) === Math.floor(candidate.level / 4) ? // Check for extra rolls\r\n      substats.every((substat, i) => // Has no extra roll\r\n        substat.key === candidate.substats[i].key && substat.value === candidate.substats[i].value) :\r\n      substats.some((substat, i) => // Has extra rolls\r\n        candidate.substats[i].key ?\r\n          substat.value > candidate.substats[i].value : // Extra roll to existing substat\r\n          substat.key // Extra roll to new substat\r\n      )\r\n    )\r\n  )\r\n  // Strictly duplicated artifact\r\n  const duplicated = candidates.filter(candidate =>\r\n    level === candidate.level &&\r\n    substats.every(substat =>\r\n      !substat.key ||  // Empty slot\r\n      candidate.substats.some(candidateSubstat =>\r\n        substat.key === candidateSubstat.key && // Or same slot\r\n        substat.value === candidateSubstat.value\r\n      )))\r\n\r\n  if (!duplicated.length && !upgraded.length)\r\n    return { isDup: false }\r\n\r\n  const dupId = duplicated[0]?.id! ?? upgraded[0].id!\r\n  return { dupId, isDup: duplicated.length > 0 }\r\n}\r\n\r\nconst saveArtifact = (artifact: IArtifact, id: string | undefined) => {\r\n  artifact.id = id ?? \"\"\r\n  database.updateArt(artifact)\r\n}\r\n","import { faBriefcase, faCheckSquare, faLock, faLockOpen, faSortAmountDownAlt, faSortAmountUp, faSquare, faTrash, faUndo, faUserShield, faUserSlash } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React, { useCallback, useEffect, useMemo, useReducer, useRef, useState } from 'react';\r\nimport { Button, ButtonGroup, ButtonToolbar, Card, Dropdown, InputGroup, ToggleButton, ToggleButtonGroup } from 'react-bootstrap';\r\nimport Col from 'react-bootstrap/Col';\r\nimport Container from 'react-bootstrap/Container';\r\nimport Row from 'react-bootstrap/Row';\r\nimport ReactGA from 'react-ga';\r\nimport { Trans, useTranslation } from 'react-i18next';\r\nimport CharacterSheet from '../Character/CharacterSheet';\r\nimport { CharacterSelectionDropdownList } from '../Components/CharacterSelection';\r\nimport CustomFormControl from '../Components/CustomFormControl';\r\nimport InfoComponent from '../Components/InfoComponent';\r\nimport { Stars } from '../Components/StarDisplay';\r\nimport { database } from '../Database/Database';\r\nimport Stat from '../Stat';\r\nimport { allMainStatKeys, allSubstats, IArtifact, SubstatKey } from '../Types/artifact';\r\nimport { allArtifactRarities, allSlotKeys } from '../Types/consts';\r\nimport { useForceUpdate, usePromise } from '../Util/ReactUtil';\r\nimport { clamp, loadFromLocalStorage, saveToLocalStorage } from '../Util/Util';\r\nimport Artifact from './Artifact';\r\nimport ArtifactCard from './ArtifactCard';\r\nimport ArtifactEditor from './ArtifactEditor';\r\nimport { ArtifactSheet } from './ArtifactSheet';\r\nimport ArtifactSetDropDownMenuFragment from './Component/ArtifactSetDropDownMenuFragment';\r\nimport SlotNameWithIcon from './Component/SlotNameWIthIcon';\r\n\r\nconst InfoDisplay = React.lazy(() => import('./InfoDisplay'));\r\nconst sortKeys = [\"quality\", \"level\", \"efficiency\", \"mefficiency\"]\r\n\r\nconst initialFilter = () => ({\r\n  filterArtSetKey: \"\",\r\n  filterStars: [3, 4, 5],\r\n  filterLevelLow: 0,\r\n  filterLevelHigh: 20,\r\n  filterSlotKey: \"\",\r\n  filterMainStatKey: \"\",\r\n  filterSubstats: [\"\", \"\", \"\", \"\"],\r\n  filterLocation: \"\",\r\n  filterLocked: \"\",\r\n  ascending: false,\r\n  sortType: sortKeys[0],\r\n  maxNumArtifactsToDisplay: 50,\r\n  effFilter: [...allSubstats]\r\n})\r\nfunction filterReducer(state, action) {\r\n  //reset all except the efficiency filter, since its a separate UI with its own reset\r\n  if (action.type === \"reset\") return { ...initialFilter(), effFilter: state.effFilter }\r\n  return { ...state, ...action }\r\n}\r\nfunction filterInit(initial = initialFilter()) {\r\n  return { ...initial, ...(loadFromLocalStorage(\"ArtifactDisplay.state\") ?? {}) }\r\n}\r\nexport default function ArtifactDisplay(props) {\r\n  const { t } = useTranslation([\"artifact\", \"ui\"]);\r\n  const [filters, filterDispatch] = useReducer(filterReducer, initialFilter(), filterInit)\r\n  const { effFilter } = filters\r\n  const [artToEditId, setartToEditId] = useState(props?.location?.artToEditId)\r\n  const [pageIdex, setpageIdex] = useState(0)\r\n  const scrollRef = useRef(null)\r\n  const invScrollRef = useRef(null)\r\n  const [dbDirty, forceUpdate] = useForceUpdate()\r\n  const artifactSheets = usePromise(ArtifactSheet.getAll(), [])\r\n  const effFilterSet = useMemo(() => new Set(effFilter), [effFilter]) as Set<SubstatKey>\r\n  const deleteArtifact = useCallback(\r\n    (id: string) => database.removeArt(id), [])\r\n  const editArtifact = useCallback(\r\n    id => {\r\n      setartToEditId(id);\r\n      (scrollRef?.current as any)?.scrollIntoView({ behavior: \"smooth\" })\r\n    }, [])\r\n  const cancelEditArtifact = useCallback(() => setartToEditId(null), [])\r\n\r\n  useEffect(() => {\r\n    ReactGA.pageview('/artifact')\r\n    return database.followAnyArt(forceUpdate)\r\n  }, [forceUpdate])\r\n\r\n  useEffect(() => {\r\n    saveToLocalStorage(\"ArtifactDisplay.state\", filters)\r\n  }, [filters])\r\n\r\n  const { artifacts, totalArtNum, numUnequip, numUnlock, numLock } = useMemo(() => {\r\n    const { filterArtSetKey, filterSlotKey, filterMainStatKey, filterStars, filterLevelLow, filterLevelHigh, filterSubstats = initialFilter().filterSubstats, filterLocation = \"\", filterLocked = \"\", sortType = sortKeys[0], ascending = false } = filters\r\n    const allArtifacts = database._getArts()\r\n    const artifacts: IArtifact[] = allArtifacts.filter(art => {\r\n      if (filterLocked) {\r\n        if (filterLocked === \"locked\" && !art.lock) return false\r\n        if (filterLocked === \"unlocked\" && art.lock) return false\r\n      }\r\n      if (filterLocation === \"Inventory\") {\r\n        if (art.location) return false;\r\n      } else if (filterLocation === \"Equipped\") {\r\n        if (!art.location) return false;\r\n      } else if (filterLocation && filterLocation !== art.location) return false;\r\n\r\n      if (filterArtSetKey && filterArtSetKey !== art.setKey) return false;\r\n      if (filterSlotKey && filterSlotKey !== art.slotKey) return false\r\n      if (filterMainStatKey && filterMainStatKey !== art.mainStatKey) return false\r\n      if (art.level < filterLevelLow || art.level > filterLevelHigh) return false;\r\n      if (!filterStars.includes(art.numStars)) return false;\r\n      for (const filterKey of filterSubstats)\r\n        if (filterKey && !art.substats.some(substat => substat.key === filterKey)) return false;\r\n      return true\r\n    }).map((art) => {\r\n      switch (sortType) {\r\n        case \"quality\": return { value: [art.numStars], art }\r\n        case \"level\": return { value: [art.level, art.numStars], art }\r\n        case \"efficiency\": return { value: [Artifact.getArtifactEfficiency(art, effFilterSet).currentEfficiency], art }\r\n        case \"mefficiency\": return { value: [Artifact.getArtifactEfficiency(art, effFilterSet).maxEfficiency], art }\r\n      }\r\n      return { value: [0], art }\r\n    }).sort((a, b) => {\r\n      for (let i = 0; i < a.value.length; i++) {\r\n        if (a.value[i] !== b.value[i])\r\n          return (a.value[i] - b.value[i]) * (ascending ? 1 : -1)\r\n      }\r\n      return 0\r\n    }).map(item => item.art)\r\n    const numUnequip = artifacts.reduce((a, art) => a + (art.location ? 1 : 0), 0)\r\n    const numUnlock = artifacts.reduce((a, art) => a + (art.lock ? 1 : 0), 0)\r\n    const numLock = artifacts.length - numUnlock\r\n\r\n    return { artifacts, totalArtNum: allArtifacts.length, numUnequip, numUnlock, numLock, ...dbDirty }//use dbDirty to shoo away warnings!\r\n  }, [filters, dbDirty, effFilterSet])\r\n\r\n  const { filterArtSetKey, filterSlotKey, filterMainStatKey, filterStars, filterLevelLow, filterLevelHigh, filterSubstats = initialFilter().filterSubstats, maxNumArtifactsToDisplay, filterLocation = \"\", filterLocked = \"\", sortType = sortKeys[0], ascending = false } = filters\r\n\r\n  const { artifactsToShow, numPages, currentPageIndex } = useMemo(() => {\r\n    const numPages = Math.ceil(artifacts.length / maxNumArtifactsToDisplay)\r\n    const currentPageIndex = clamp(pageIdex, 0, numPages - 1)\r\n    return { artifactsToShow: artifacts.slice(currentPageIndex * maxNumArtifactsToDisplay, (currentPageIndex + 1) * maxNumArtifactsToDisplay), numPages, currentPageIndex }\r\n  }, [artifacts, pageIdex, maxNumArtifactsToDisplay])\r\n\r\n  const locationCharacterSheet = usePromise(CharacterSheet.get(filterLocation), [filterLocation])\r\n  let locationDisplay\r\n  if (!filterLocation) locationDisplay = t(\"filterLocation.any\")\r\n  else if (filterLocation === \"Inventory\") locationDisplay = <span><FontAwesomeIcon icon={faBriefcase} /> {t(\"filterLocation.inventory\")}</span>\r\n  else if (filterLocation === \"Equipped\") locationDisplay = <span><FontAwesomeIcon icon={faUserShield} /> {t(\"filterLocation.currentlyEquipped\")}</span>\r\n  else locationDisplay = <b>{locationCharacterSheet?.nameWIthIcon}</b>\r\n\r\n  let lockedDisplay\r\n  if (filterLocked === \"locked\") lockedDisplay = <span><FontAwesomeIcon icon={faLock} /> {t`lock.locked`}</span>\r\n  else if (filterLocked === \"unlocked\") lockedDisplay = <span><FontAwesomeIcon icon={faLockOpen} /> {t`lock.unlocked`}</span>\r\n  else lockedDisplay = t(\"lockDisplay\", { value: t(\"lock.any\") })\r\n\r\n  const unequipArtifacts = () =>\r\n    window.confirm(`Are you sure you want to unequip ${numUnequip} artifacts currently equipped on characters?`) &&\r\n    artifacts.map(art => database.setLocation(art.id!, \"\"))\r\n\r\n  const deleteArtifacts = () =>\r\n    window.confirm(`Are you sure you want to delete ${artifacts.length} artifacts?`) &&\r\n    artifacts.map(art => database.removeArt(art.id!))\r\n\r\n  const lockArtifacts = () =>\r\n    window.confirm(`Are you sure you want to lock ${numLock} artifacts?`) &&\r\n    artifacts.map(art => database.lockArtifact(art.id))\r\n\r\n  const unlockArtifacts = () =>\r\n    window.confirm(`Are you sure you want to unlock ${numUnlock} artifacts?`) &&\r\n    artifacts.map(art => database.lockArtifact(art.id, false))\r\n\r\n  const paginationCard = useMemo(() => {\r\n    const showingValue = artifacts.length !== totalArtNum ? `${artifacts.length}/${totalArtNum}` : `${totalArtNum}`\r\n    return <Card bg=\"darkcontent\" text={\"lightfont\" as any} className=\"mb-2\">\r\n      <Card.Body>\r\n        <Row>\r\n          <Col>\r\n            <ButtonGroup size=\"sm\">\r\n              {[...Array(numPages).keys()].map(i => <Button key={i} className=\"px-3\" variant={currentPageIndex === i ? \"success\" : \"primary\"} onClick={() => {\r\n                setpageIdex(i);\r\n                (invScrollRef.current as any)?.scrollIntoView({ behavior: \"smooth\" })\r\n              }} >\r\n                {i === 0 ? \"Page \" : \"\"}{i + 1}\r\n              </Button>)}\r\n            </ButtonGroup>\r\n          </Col>\r\n          <Col xs=\"auto\"><Trans t={t} i18nKey=\"showingNum\" count={artifactsToShow.length} value={showingValue} >Showing <b>{{ count: artifactsToShow.length }}</b> out of {{ value: showingValue }} Artifacts</Trans></Col>\r\n        </Row>\r\n      </Card.Body>\r\n    </Card>\r\n  }, [numPages, currentPageIndex, artifactsToShow.length, artifacts.length, totalArtNum, t])\r\n\r\n  return <Container className=\"mt-2\" >\r\n    <InfoComponent\r\n      pageKey=\"artifactPage\"\r\n      modalTitle={t`info.title`}\r\n      text={t(\"tipsOfTheDay\", { returnObjects: true }) as string[]}\r\n    >\r\n      <InfoDisplay />\r\n    </InfoComponent>\r\n    <div className=\"mb-2\" ref={scrollRef}>\r\n      <ArtifactEditor\r\n        artifactIdToEdit={artToEditId}\r\n        cancelEdit={cancelEditArtifact}\r\n      />\r\n    </div>\r\n    <Card bg=\"darkcontent\" text={\"lightfont\" as any} className=\"mb-2\" ref={invScrollRef}>\r\n      <Card.Header>\r\n        <Row>\r\n          <Col><span><Trans t={t} i18nKey=\"artifactFilter\">Artifact Filter</Trans></span></Col>\r\n          <Col xs=\"auto\"><Button size=\"sm\" className=\"ml-2\" variant=\"danger\" onClick={() => filterDispatch({ type: \"reset\" })} ><FontAwesomeIcon icon={faUndo} className=\"fa-fw\" /> <Trans t={t} i18nKey=\"resetFilters\" /></Button></Col>\r\n        </Row>\r\n      </Card.Header>\r\n      <Card.Body>\r\n        <Row>\r\n          {/* Left half */}\r\n          <Col xs={12} lg={6}>\r\n            {/* Artifact set filter */}\r\n            <Dropdown as={InputGroup.Prepend} className=\"flex-grow-1 mb-2\">\r\n              <Dropdown.Toggle className=\"w-100\" variant={filterArtSetKey ? \"success\" : \"primary\"}>\r\n                {artifactSheets?.[filterArtSetKey]?.name ?? t('editor.set.artifactSet')}\r\n              </Dropdown.Toggle>\r\n              <Dropdown.Menu>\r\n                <Dropdown.Item onClick={() => filterDispatch({ filterArtSetKey: \"\" })}><Trans t={t} i18nKey=\"ui:unselect\" >Unselect</Trans></Dropdown.Item>\r\n                <Dropdown.Divider />\r\n                <ArtifactSetDropDownMenuFragment sheets={artifactSheets} click={(filterArtSetKey => filterDispatch({ filterArtSetKey }))} />\r\n              </Dropdown.Menu>\r\n            </Dropdown>\r\n\r\n            {/* Artifact stars filter */}\r\n            <ToggleButtonGroup className=\"w-100 d-flex mb-2\" type=\"checkbox\" as={InputGroup.Append} onChange={(e) => filterDispatch({ filterStars: e })} value={filterStars}>\r\n              {allArtifactRarities.map(star => {\r\n                let selected = filterStars.includes(star)\r\n                return <ToggleButton key={star} value={star} variant={selected ? \"success\" : \"primary\"}><FontAwesomeIcon icon={selected ? faCheckSquare : faSquare} /> <Stars stars={star} /></ToggleButton>\r\n              })}\r\n            </ToggleButtonGroup>\r\n\r\n            {/* Artiface level filter */}\r\n            <InputGroup className=\"mb-2\">\r\n              <InputGroup.Prepend>\r\n                <InputGroup.Text>\r\n                  <span>\r\n                    <Trans t={t} i18nKey=\"filterLevelFormat\">\r\n                      Level <span className={`text-${filterLevelLow > 0 ? \"success\" : \"\"}`}>Low</span>/<span className={`text-${filterLevelHigh < 20 ? \"success\" : \"\"}`}>High</span> (Inclusive)\r\n                    </Trans>\r\n                  </span>\r\n                </InputGroup.Text>\r\n              </InputGroup.Prepend>\r\n              <CustomFormControl\r\n                value={filterLevelLow}\r\n                placeholder={t('ui:game.minLevel')}\r\n                onChange={val => filterDispatch({ filterLevelLow: clamp(val, 0, filterLevelHigh) })}\r\n              />\r\n              <CustomFormControl\r\n                value={filterLevelHigh}\r\n                placeholder={t('ui:game.maxLevel')}\r\n                onChange={val => filterDispatch({ filterLevelHigh: clamp(val, filterLevelLow, 20) })}\r\n              />\r\n            </InputGroup>\r\n\r\n            {/* Sort */}\r\n            <ButtonGroup className=\"w-100 d-flex flex-row mb-2\">\r\n              <Dropdown as={ButtonGroup} className=\"flex-grow-1\">\r\n                <Dropdown.Toggle >\r\n                  <span>\r\n                    <Trans t={t} i18nKey=\"ui:sortByFormat\" value={t(`sortMap.${sortType}`) as any}>Sort By: {{ value: t(`sortMap.${sortType}`) }}</Trans>\r\n                  </span>\r\n                </Dropdown.Toggle>\r\n                <Dropdown.Menu>\r\n                  {sortKeys.map(key =>\r\n                    <Dropdown.Item key={key} onClick={() => filterDispatch({ sortType: key })}>{t(`sortMap.${key}`) as any}</Dropdown.Item>)}\r\n                </Dropdown.Menu>\r\n              </Dropdown>\r\n              <Button onClick={() => filterDispatch({ ascending: !ascending })} className=\"flex-shrink-1\">\r\n                <FontAwesomeIcon icon={ascending ? faSortAmountDownAlt : faSortAmountUp} className=\"fa-fw\" /><span> {ascending ? <Trans t={t} i18nKey=\"ui:ascending\" >Ascending</Trans> : <Trans t={t} i18nKey=\"ui:descending\" >Descending</Trans>}</span>\r\n              </Button>\r\n            </ButtonGroup>\r\n          </Col>\r\n          {/* Right half */}\r\n          <Col xs={12} lg={6}>\r\n            <Row>\r\n              {/* Left */}\r\n              <Col>\r\n                {/* Artifact Slot */}\r\n                <Dropdown className=\"flex-grow-1 mb-2\">\r\n                  <Dropdown.Toggle className=\"w-100\" variant={filterSlotKey ? \"success\" : \"primary\"}>\r\n                    {filterSlotKey ? <SlotNameWithIcon slotKey={filterSlotKey} /> : t('slot')}\r\n                  </Dropdown.Toggle>\r\n                  <Dropdown.Menu>\r\n                    <Dropdown.Item onClick={() => filterDispatch({ filterSlotKey: \"\" })} ><Trans t={t} i18nKey=\"ui:unselect\" >Unselect</Trans></Dropdown.Item>\r\n                    {allSlotKeys.map(key =>\r\n                      <Dropdown.Item key={key} onClick={() => filterDispatch({ filterSlotKey: key })} ><SlotNameWithIcon slotKey={key} /></Dropdown.Item>)}\r\n                  </Dropdown.Menu>\r\n                </Dropdown>\r\n                {/* Main Stat filter */}\r\n                <Dropdown className=\"flex-grow-1 mb-2\">\r\n                  <Dropdown.Toggle className=\"w-100\" variant={filterMainStatKey ? \"success\" : \"primary\"}>\r\n                    {Stat.getStatNameWithPercent(filterMainStatKey, t(`mainStat`))}\r\n                  </Dropdown.Toggle>\r\n                  <Dropdown.Menu>\r\n                    <Dropdown.Item onClick={() => filterDispatch({ filterMainStatKey: \"\" })}><Trans t={t} i18nKey=\"ui:unselect\" >Unselect</Trans></Dropdown.Item>\r\n                    {allMainStatKeys.map(statKey => <Dropdown.Item key={statKey} onClick={() => filterDispatch({ filterMainStatKey: statKey })} >\r\n                      {Stat.getStatNameWithPercent(statKey)}\r\n                    </Dropdown.Item>)}\r\n                  </Dropdown.Menu>\r\n                </Dropdown>\r\n\r\n                {/* location */}\r\n                <Dropdown className=\"flex-grow-1 mb-2\" >\r\n                  <Dropdown.Toggle className=\"w-100\" variant={filterLocation ? \"success\" : \"primary\"} >\r\n                    {locationDisplay}\r\n                  </Dropdown.Toggle>\r\n                  <Dropdown.Menu>\r\n                    <Dropdown.Item onClick={() => filterDispatch({ filterLocation: \"\" })}><Trans t={t} i18nKey=\"ui:unselect\" >Unselect</Trans></Dropdown.Item>\r\n                    <Dropdown.Item onClick={() => filterDispatch({ filterLocation: \"Inventory\" })}><FontAwesomeIcon icon={faBriefcase} /> <Trans t={t} i18nKey=\"filterLocation.inventory\" >Inventory</Trans></Dropdown.Item>\r\n                    <Dropdown.Item onClick={() => filterDispatch({ filterLocation: \"Equipped\" })}><FontAwesomeIcon icon={faUserShield} /> <Trans t={t} i18nKey=\"filterLocation.currentlyEquipped\" >Currently Equipped</Trans></Dropdown.Item>\r\n                    <Dropdown.Divider />\r\n                    <CharacterSelectionDropdownList onSelect={cid => filterDispatch({ filterLocation: cid })} />\r\n                  </Dropdown.Menu>\r\n                </Dropdown>\r\n\r\n                {/* locked state */}\r\n                <Dropdown className=\"flex-grow-1 mb-2\" >\r\n                  <Dropdown.Toggle className=\"w-100\" variant={filterLocked ? \"success\" : \"primary\"} >\r\n                    {lockedDisplay}\r\n                  </Dropdown.Toggle>\r\n                  <Dropdown.Menu>\r\n                    <Dropdown.Item onClick={() => filterDispatch({ filterLocked: \"\" })}><Trans t={t} i18nKey=\"lock.any\" >Any</Trans></Dropdown.Item>\r\n                    <Dropdown.Item onClick={() => filterDispatch({ filterLocked: \"locked\" })}><span><FontAwesomeIcon icon={faLock} /> <Trans t={t} i18nKey=\"lock.locked\" >Locked</Trans></span></Dropdown.Item>\r\n                    <Dropdown.Item onClick={() => filterDispatch({ filterLocked: \"unlocked\" })}><span><FontAwesomeIcon icon={faLockOpen} /> <Trans t={t} i18nKey=\"lock.unlocked\" >Unlocked</Trans></span></Dropdown.Item>\r\n                  </Dropdown.Menu>\r\n                </Dropdown>\r\n              </Col>\r\n              {/* Right */}\r\n              <Col>\r\n                {/* substat filter */}\r\n                {filterSubstats.map((substatKey, index) =>\r\n                  <Dropdown className=\"mb-2\" key={index}>\r\n                    <Dropdown.Toggle id=\"dropdown-basic\" className=\"w-100\" variant={substatKey ? \"success\" : \"primary\"}>\r\n                      {substatKey ? Stat.getStatNameWithPercent(substatKey) : t('editor.substat.substatFormat', { value: index + 1 })}\r\n                    </Dropdown.Toggle>\r\n                    <Dropdown.Menu>\r\n                      <Dropdown.Item\r\n                        onClick={() => {\r\n                          filterSubstats[index] = \"\"\r\n                          filterDispatch({ filterSubstats })\r\n                        }}\r\n                      ><Trans t={t} i18nKey=\"editor.substat.noSubstat\" >No Substat</Trans></Dropdown.Item>\r\n                      {Artifact.getSubstatKeys().filter(key => !filterSubstats.includes(key)).map(key =>\r\n                        <Dropdown.Item key={key}\r\n                          onClick={() => {\r\n                            filterSubstats[index] = key\r\n                            filterDispatch({ filterSubstats })\r\n                          }}\r\n                        >{Stat.getStatNameWithPercent(key)}</Dropdown.Item>\r\n                      )}\r\n                    </Dropdown.Menu>\r\n                  </Dropdown>\r\n                )}\r\n              </Col>\r\n            </Row>\r\n          </Col>\r\n        </Row>\r\n        <Row className=\"mb-n2\">\r\n          <Col xs={6} lg={3} className=\"mb-2\"><Button className=\"w-100\" variant=\"danger\" disabled={!numUnequip} onClick={unequipArtifacts}><FontAwesomeIcon icon={faUserSlash} /> <Trans t={t} i18nKey=\"button.unequipArtifacts\" >Unequip Artifacts</Trans></Button></Col>\r\n          <Col xs={6} lg={3} className=\"mb-2\"><Button className=\"w-100\" variant=\"danger\" disabled={!artifacts.length} onClick={deleteArtifacts}><FontAwesomeIcon icon={faTrash} /> <Trans t={t} i18nKey=\"button.deleteArtifacts\" >Delete Artifacts</Trans></Button></Col>\r\n          <Col xs={6} lg={3} className=\"mb-2\"><Button className=\"w-100\" variant=\"danger\" disabled={!numLock} onClick={lockArtifacts}><FontAwesomeIcon icon={faLock} /> <Trans t={t} i18nKey=\"button.lockArtifacts\" >Lock Artifacts</Trans></Button></Col>\r\n          <Col xs={6} lg={3} className=\"mb-2\"><Button className=\"w-100\" variant=\"danger\" disabled={!numUnlock} onClick={unlockArtifacts}><FontAwesomeIcon icon={faLockOpen} /> <Trans t={t} i18nKey=\"button.unlockArtifacts\" >Unlock Artifacts</Trans></Button></Col>\r\n          <Col xs={12} className=\"mt-n2\"><small><Trans t={t} i18nKey=\"buttonHint\">Note: the above buttons only applies to <b>filtered artifacts</b></Trans></small></Col>\r\n        </Row>\r\n      </Card.Body>\r\n    </Card>\r\n    <Card bg=\"darkcontent\" text={\"lightfont\" as any} className=\"mb-2\" ref={invScrollRef}>\r\n      <Card.Header>\r\n        <Row>\r\n          <Col><span><Trans t={t} i18nKey=\"efficiencyFilter.title\">Efficiency Filter</Trans></span></Col>\r\n          <Col xs=\"auto\"><Button size=\"sm\" className=\"ml-2\" variant=\"danger\" onClick={() => filterDispatch({ effFilter: [...allSubstats] })} ><FontAwesomeIcon icon={faUndo} className=\"fa-fw\" /> <Trans t={t} i18nKey=\"ui:reset\" /></Button></Col>\r\n        </Row>\r\n      </Card.Header>\r\n      <Card.Body>\r\n        <ButtonToolbar as={Row} className=\"w-100 d-flex flex-row\">\r\n          {[[0, 6], [6]].map(slicep => <ToggleButtonGroup key={slicep.toString()} as={Col} type=\"checkbox\" value={effFilter} onChange={n => filterDispatch({ effFilter: n })} className=\"flex-grow-1 mb-2\">\r\n            {allSubstats.slice(...slicep).map(substat => <ToggleButton key={substat} value={substat} variant={effFilter.includes(substat) ? \"success\" : \"primary\"}>{Stat.getStatNameWithPercent(substat)}</ToggleButton>)}\r\n          </ToggleButtonGroup>)}\r\n        </ButtonToolbar>\r\n      </Card.Body>\r\n    </Card>\r\n    {paginationCard}\r\n    <Row>\r\n      {artifactsToShow.map((art, i) =>\r\n        <Col key={i} lg={4} md={6} className=\"mb-2\">\r\n          <ArtifactCard\r\n            artifactId={art.id}\r\n            effFilter={effFilterSet}\r\n            onDelete={() => deleteArtifact(art.id)}\r\n            onEdit={() => editArtifact(art.id)}\r\n          />\r\n        </Col>\r\n      )}\r\n    </Row>\r\n    {numPages > 1 && paginationCard}\r\n  </Container >\r\n}\r\n"],"sourceRoot":""}